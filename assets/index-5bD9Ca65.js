(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();var GA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function z0(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var a1={exports:{}},sd={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $A;function wP(){if($A)return sd;$A=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,r){var o=null;if(r!==void 0&&(o=""+r),i.key!==void 0&&(o=""+i.key),"key"in i){r={};for(var u in i)u!=="key"&&(r[u]=i[u])}else r=i;return i=r.ref,{$$typeof:s,type:n,key:o,ref:i!==void 0?i:null,props:r}}return sd.Fragment=e,sd.jsx=t,sd.jsxs=t,sd}var HA;function MP(){return HA||(HA=1,a1.exports=wP()),a1.exports}var U=MP(),o1={exports:{}},id={},l1={exports:{}},u1={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jA;function NP(){return jA||(jA=1,(function(s){function e(F,k){var I=F.length;F.push(k);e:for(;0<I;){var $=I-1>>>1,re=F[$];if(0<i(re,k))F[$]=k,F[I]=re,I=$;else break e}}function t(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var k=F[0],I=F.pop();if(I!==k){F[0]=I;e:for(var $=0,re=F.length,V=re>>>1;$<V;){var q=2*($+1)-1,he=F[q],fe=q+1,W=F[fe];if(0>i(he,I))fe<re&&0>i(W,he)?(F[$]=W,F[fe]=I,$=fe):(F[$]=he,F[q]=I,$=q);else if(fe<re&&0>i(W,I))F[$]=W,F[fe]=I,$=fe;else break e}}return k}function i(F,k){var I=F.sortIndex-k.sortIndex;return I!==0?I:F.id-k.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;s.unstable_now=function(){return r.now()}}else{var o=Date,u=o.now();s.unstable_now=function(){return o.now()-u}}var c=[],d=[],f=1,p=null,g=3,y=!1,x=!1,v=!1,S=!1,w=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function A(F){for(var k=t(d);k!==null;){if(k.callback===null)n(d);else if(k.startTime<=F)n(d),k.sortIndex=k.expirationTime,e(c,k);else break;k=t(d)}}function C(F){if(v=!1,A(F),!x)if(t(c)!==null)x=!0,D||(D=!0,j());else{var k=t(d);k!==null&&Y(C,k.startTime-F)}}var D=!1,R=-1,B=5,L=-1;function X(){return S?!0:!(s.unstable_now()-L<B)}function G(){if(S=!1,D){var F=s.unstable_now();L=F;var k=!0;try{e:{x=!1,v&&(v=!1,M(R),R=-1),y=!0;var I=g;try{t:{for(A(F),p=t(c);p!==null&&!(p.expirationTime>F&&X());){var $=p.callback;if(typeof $=="function"){p.callback=null,g=p.priorityLevel;var re=$(p.expirationTime<=F);if(F=s.unstable_now(),typeof re=="function"){p.callback=re,A(F),k=!0;break t}p===t(c)&&n(c),A(F)}else n(c);p=t(c)}if(p!==null)k=!0;else{var V=t(d);V!==null&&Y(C,V.startTime-F),k=!1}}break e}finally{p=null,g=I,y=!1}k=void 0}}finally{k?j():D=!1}}}var j;if(typeof T=="function")j=function(){T(G)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,P=ee.port2;ee.port1.onmessage=G,j=function(){P.postMessage(null)}}else j=function(){w(G,0)};function Y(F,k){R=w(function(){F(s.unstable_now())},k)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(F){F.callback=null},s.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<F?Math.floor(1e3/F):5},s.unstable_getCurrentPriorityLevel=function(){return g},s.unstable_next=function(F){switch(g){case 1:case 2:case 3:var k=3;break;default:k=g}var I=g;g=k;try{return F()}finally{g=I}},s.unstable_requestPaint=function(){S=!0},s.unstable_runWithPriority=function(F,k){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var I=g;g=F;try{return k()}finally{g=I}},s.unstable_scheduleCallback=function(F,k,I){var $=s.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?$+I:$):I=$,F){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=I+re,F={id:f++,callback:k,priorityLevel:F,startTime:I,expirationTime:re,sortIndex:-1},I>$?(F.sortIndex=I,e(d,F),t(c)===null&&F===t(d)&&(v?(M(R),R=-1):v=!0,Y(C,I-$))):(F.sortIndex=re,e(c,F),x||y||(x=!0,D||(D=!0,j()))),F},s.unstable_shouldYield=X,s.unstable_wrapCallback=function(F){var k=g;return function(){var I=g;g=k;try{return F.apply(this,arguments)}finally{g=I}}}})(u1)),u1}var qA;function AP(){return qA||(qA=1,l1.exports=NP()),l1.exports}var c1={exports:{}},Je={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WA;function EP(){if(WA)return Je;WA=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),g=Symbol.iterator;function y(V){return V===null||typeof V!="object"?null:(V=g&&V[g]||V["@@iterator"],typeof V=="function"?V:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,S={};function w(V,q,he){this.props=V,this.context=q,this.refs=S,this.updater=he||x}w.prototype.isReactComponent={},w.prototype.setState=function(V,q){if(typeof V!="object"&&typeof V!="function"&&V!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,V,q,"setState")},w.prototype.forceUpdate=function(V){this.updater.enqueueForceUpdate(this,V,"forceUpdate")};function M(){}M.prototype=w.prototype;function T(V,q,he){this.props=V,this.context=q,this.refs=S,this.updater=he||x}var A=T.prototype=new M;A.constructor=T,v(A,w.prototype),A.isPureReactComponent=!0;var C=Array.isArray;function D(){}var R={H:null,A:null,T:null,S:null},B=Object.prototype.hasOwnProperty;function L(V,q,he){var fe=he.ref;return{$$typeof:s,type:V,key:q,ref:fe!==void 0?fe:null,props:he}}function X(V,q){return L(V.type,q,V.props)}function G(V){return typeof V=="object"&&V!==null&&V.$$typeof===s}function j(V){var q={"=":"=0",":":"=2"};return"$"+V.replace(/[=:]/g,function(he){return q[he]})}var ee=/\/+/g;function P(V,q){return typeof V=="object"&&V!==null&&V.key!=null?j(""+V.key):q.toString(36)}function Y(V){switch(V.status){case"fulfilled":return V.value;case"rejected":throw V.reason;default:switch(typeof V.status=="string"?V.then(D,D):(V.status="pending",V.then(function(q){V.status==="pending"&&(V.status="fulfilled",V.value=q)},function(q){V.status==="pending"&&(V.status="rejected",V.reason=q)})),V.status){case"fulfilled":return V.value;case"rejected":throw V.reason}}throw V}function F(V,q,he,fe,W){var le=typeof V;(le==="undefined"||le==="boolean")&&(V=null);var pe=!1;if(V===null)pe=!0;else switch(le){case"bigint":case"string":case"number":pe=!0;break;case"object":switch(V.$$typeof){case s:case e:pe=!0;break;case f:return pe=V._init,F(pe(V._payload),q,he,fe,W)}}if(pe)return W=W(V),pe=fe===""?"."+P(V,0):fe,C(W)?(he="",pe!=null&&(he=pe.replace(ee,"$&/")+"/"),F(W,q,he,"",function(Fe){return Fe})):W!=null&&(G(W)&&(W=X(W,he+(W.key==null||V&&V.key===W.key?"":(""+W.key).replace(ee,"$&/")+"/")+pe)),q.push(W)),1;pe=0;var xe=fe===""?".":fe+":";if(C(V))for(var Me=0;Me<V.length;Me++)fe=V[Me],le=xe+P(fe,Me),pe+=F(fe,q,he,le,W);else if(Me=y(V),typeof Me=="function")for(V=Me.call(V),Me=0;!(fe=V.next()).done;)fe=fe.value,le=xe+P(fe,Me++),pe+=F(fe,q,he,le,W);else if(le==="object"){if(typeof V.then=="function")return F(Y(V),q,he,fe,W);throw q=String(V),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(V).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return pe}function k(V,q,he){if(V==null)return V;var fe=[],W=0;return F(V,fe,"","",function(le){return q.call(he,le,W++)}),fe}function I(V){if(V._status===-1){var q=V._result;q=q(),q.then(function(he){(V._status===0||V._status===-1)&&(V._status=1,V._result=he)},function(he){(V._status===0||V._status===-1)&&(V._status=2,V._result=he)}),V._status===-1&&(V._status=0,V._result=q)}if(V._status===1)return V._result.default;throw V._result}var $=typeof reportError=="function"?reportError:function(V){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof V=="object"&&V!==null&&typeof V.message=="string"?String(V.message):String(V),error:V});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",V);return}console.error(V)},re={map:k,forEach:function(V,q,he){k(V,function(){q.apply(this,arguments)},he)},count:function(V){var q=0;return k(V,function(){q++}),q},toArray:function(V){return k(V,function(q){return q})||[]},only:function(V){if(!G(V))throw Error("React.Children.only expected to receive a single React element child.");return V}};return Je.Activity=p,Je.Children=re,Je.Component=w,Je.Fragment=t,Je.Profiler=i,Je.PureComponent=T,Je.StrictMode=n,Je.Suspense=c,Je.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=R,Je.__COMPILER_RUNTIME={__proto__:null,c:function(V){return R.H.useMemoCache(V)}},Je.cache=function(V){return function(){return V.apply(null,arguments)}},Je.cacheSignal=function(){return null},Je.cloneElement=function(V,q,he){if(V==null)throw Error("The argument must be a React element, but you passed "+V+".");var fe=v({},V.props),W=V.key;if(q!=null)for(le in q.key!==void 0&&(W=""+q.key),q)!B.call(q,le)||le==="key"||le==="__self"||le==="__source"||le==="ref"&&q.ref===void 0||(fe[le]=q[le]);var le=arguments.length-2;if(le===1)fe.children=he;else if(1<le){for(var pe=Array(le),xe=0;xe<le;xe++)pe[xe]=arguments[xe+2];fe.children=pe}return L(V.type,W,fe)},Je.createContext=function(V){return V={$$typeof:o,_currentValue:V,_currentValue2:V,_threadCount:0,Provider:null,Consumer:null},V.Provider=V,V.Consumer={$$typeof:r,_context:V},V},Je.createElement=function(V,q,he){var fe,W={},le=null;if(q!=null)for(fe in q.key!==void 0&&(le=""+q.key),q)B.call(q,fe)&&fe!=="key"&&fe!=="__self"&&fe!=="__source"&&(W[fe]=q[fe]);var pe=arguments.length-2;if(pe===1)W.children=he;else if(1<pe){for(var xe=Array(pe),Me=0;Me<pe;Me++)xe[Me]=arguments[Me+2];W.children=xe}if(V&&V.defaultProps)for(fe in pe=V.defaultProps,pe)W[fe]===void 0&&(W[fe]=pe[fe]);return L(V,le,W)},Je.createRef=function(){return{current:null}},Je.forwardRef=function(V){return{$$typeof:u,render:V}},Je.isValidElement=G,Je.lazy=function(V){return{$$typeof:f,_payload:{_status:-1,_result:V},_init:I}},Je.memo=function(V,q){return{$$typeof:d,type:V,compare:q===void 0?null:q}},Je.startTransition=function(V){var q=R.T,he={};R.T=he;try{var fe=V(),W=R.S;W!==null&&W(he,fe),typeof fe=="object"&&fe!==null&&typeof fe.then=="function"&&fe.then(D,$)}catch(le){$(le)}finally{q!==null&&he.types!==null&&(q.types=he.types),R.T=q}},Je.unstable_useCacheRefresh=function(){return R.H.useCacheRefresh()},Je.use=function(V){return R.H.use(V)},Je.useActionState=function(V,q,he){return R.H.useActionState(V,q,he)},Je.useCallback=function(V,q){return R.H.useCallback(V,q)},Je.useContext=function(V){return R.H.useContext(V)},Je.useDebugValue=function(){},Je.useDeferredValue=function(V,q){return R.H.useDeferredValue(V,q)},Je.useEffect=function(V,q){return R.H.useEffect(V,q)},Je.useEffectEvent=function(V){return R.H.useEffectEvent(V)},Je.useId=function(){return R.H.useId()},Je.useImperativeHandle=function(V,q,he){return R.H.useImperativeHandle(V,q,he)},Je.useInsertionEffect=function(V,q){return R.H.useInsertionEffect(V,q)},Je.useLayoutEffect=function(V,q){return R.H.useLayoutEffect(V,q)},Je.useMemo=function(V,q){return R.H.useMemo(V,q)},Je.useOptimistic=function(V,q){return R.H.useOptimistic(V,q)},Je.useReducer=function(V,q,he){return R.H.useReducer(V,q,he)},Je.useRef=function(V){return R.H.useRef(V)},Je.useState=function(V){return R.H.useState(V)},Je.useSyncExternalStore=function(V,q,he){return R.H.useSyncExternalStore(V,q,he)},Je.useTransition=function(){return R.H.useTransition()},Je.version="19.2.3",Je}var XA;function vf(){return XA||(XA=1,c1.exports=EP()),c1.exports}var h1={exports:{}},Yn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var YA;function RP(){if(YA)return Yn;YA=1;var s=vf();function e(c){var d="https://react.dev/errors/"+c;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)d+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+c+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function r(c,d,f){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:p==null?null:""+p,children:c,containerInfo:d,implementation:f}}var o=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(c,d){if(c==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Yn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Yn.createPortal=function(c,d){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return r(c,d,null,f)},Yn.flushSync=function(c){var d=o.T,f=n.p;try{if(o.T=null,n.p=2,c)return c()}finally{o.T=d,n.p=f,n.d.f()}},Yn.preconnect=function(c,d){typeof c=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,n.d.C(c,d))},Yn.prefetchDNS=function(c){typeof c=="string"&&n.d.D(c)},Yn.preinit=function(c,d){if(typeof c=="string"&&d&&typeof d.as=="string"){var f=d.as,p=u(f,d.crossOrigin),g=typeof d.integrity=="string"?d.integrity:void 0,y=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;f==="style"?n.d.S(c,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:p,integrity:g,fetchPriority:y}):f==="script"&&n.d.X(c,{crossOrigin:p,integrity:g,fetchPriority:y,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Yn.preinitModule=function(c,d){if(typeof c=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var f=u(d.as,d.crossOrigin);n.d.M(c,{crossOrigin:f,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&n.d.M(c)},Yn.preload=function(c,d){if(typeof c=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var f=d.as,p=u(f,d.crossOrigin);n.d.L(c,f,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Yn.preloadModule=function(c,d){if(typeof c=="string")if(d){var f=u(d.as,d.crossOrigin);n.d.m(c,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:f,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else n.d.m(c)},Yn.requestFormReset=function(c){n.d.r(c)},Yn.unstable_batchedUpdates=function(c,d){return c(d)},Yn.useFormState=function(c,d,f){return o.H.useFormState(c,d,f)},Yn.useFormStatus=function(){return o.H.useHostTransitionStatus()},Yn.version="19.2.3",Yn}var ZA;function lC(){if(ZA)return h1.exports;ZA=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),h1.exports=RP(),h1.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QA;function CP(){if(QA)return id;QA=1;var s=AP(),e=vf(),t=lC();function n(a){var l="https://react.dev/errors/"+a;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)l+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+a+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function r(a){var l=a,h=a;if(a.alternate)for(;l.return;)l=l.return;else{a=l;do l=a,(l.flags&4098)!==0&&(h=l.return),a=l.return;while(a)}return l.tag===3?h:null}function o(a){if(a.tag===13){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function u(a){if(a.tag===31){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function c(a){if(r(a)!==a)throw Error(n(188))}function d(a){var l=a.alternate;if(!l){if(l=r(a),l===null)throw Error(n(188));return l!==a?null:a}for(var h=a,m=l;;){var b=h.return;if(b===null)break;var _=b.alternate;if(_===null){if(m=b.return,m!==null){h=m;continue}break}if(b.child===_.child){for(_=b.child;_;){if(_===h)return c(b),a;if(_===m)return c(b),l;_=_.sibling}throw Error(n(188))}if(h.return!==m.return)h=b,m=_;else{for(var E=!1,O=b.child;O;){if(O===h){E=!0,h=b,m=_;break}if(O===m){E=!0,m=b,h=_;break}O=O.sibling}if(!E){for(O=_.child;O;){if(O===h){E=!0,h=_,m=b;break}if(O===m){E=!0,m=_,h=b;break}O=O.sibling}if(!E)throw Error(n(189))}}if(h.alternate!==m)throw Error(n(190))}if(h.tag!==3)throw Error(n(188));return h.stateNode.current===h?a:l}function f(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a;for(a=a.child;a!==null;){if(l=f(a),l!==null)return l;a=a.sibling}return null}var p=Object.assign,g=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),T=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),L=Symbol.for("react.activity"),X=Symbol.for("react.memo_cache_sentinel"),G=Symbol.iterator;function j(a){return a===null||typeof a!="object"?null:(a=G&&a[G]||a["@@iterator"],typeof a=="function"?a:null)}var ee=Symbol.for("react.client.reference");function P(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===ee?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case v:return"Fragment";case w:return"Profiler";case S:return"StrictMode";case C:return"Suspense";case D:return"SuspenseList";case L:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case x:return"Portal";case T:return a.displayName||"Context";case M:return(a._context.displayName||"Context")+".Consumer";case A:var l=a.render;return a=a.displayName,a||(a=l.displayName||l.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case R:return l=a.displayName||null,l!==null?l:P(a.type)||"Memo";case B:l=a._payload,a=a._init;try{return P(a(l))}catch{}}return null}var Y=Array.isArray,F=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,k=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,I={pending:!1,data:null,method:null,action:null},$=[],re=-1;function V(a){return{current:a}}function q(a){0>re||(a.current=$[re],$[re]=null,re--)}function he(a,l){re++,$[re]=a.current,a.current=l}var fe=V(null),W=V(null),le=V(null),pe=V(null);function xe(a,l){switch(he(le,l),he(W,a),he(fe,null),l.nodeType){case 9:case 11:a=(a=l.documentElement)&&(a=a.namespaceURI)?hA(a):0;break;default:if(a=l.tagName,l=l.namespaceURI)l=hA(l),a=dA(l,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}q(fe),he(fe,a)}function Me(){q(fe),q(W),q(le)}function Fe(a){a.memoizedState!==null&&he(pe,a);var l=fe.current,h=dA(l,a.type);l!==h&&(he(W,a),he(fe,h))}function De(a){W.current===a&&(q(fe),q(W)),pe.current===a&&(q(pe),Jh._currentValue=I)}var Le,Ve;function nt(a){if(Le===void 0)try{throw Error()}catch(h){var l=h.stack.trim().match(/\n( *(at )?)/);Le=l&&l[1]||"",Ve=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Le+a+Ve}var Dt=!1;function dt(a,l){if(!a||Dt)return"";Dt=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(l){var Te=function(){throw Error()};if(Object.defineProperty(Te.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Te,[])}catch(ge){var de=ge}Reflect.construct(a,[],Te)}else{try{Te.call()}catch(ge){de=ge}a.call(Te.prototype)}}else{try{throw Error()}catch(ge){de=ge}(Te=a())&&typeof Te.catch=="function"&&Te.catch(function(){})}}catch(ge){if(ge&&de&&typeof ge.stack=="string")return[ge.stack,de.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var _=m.DetermineComponentFrameRoot(),E=_[0],O=_[1];if(E&&O){var Q=E.split(`
`),ce=O.split(`
`);for(b=m=0;m<Q.length&&!Q[m].includes("DetermineComponentFrameRoot");)m++;for(;b<ce.length&&!ce[b].includes("DetermineComponentFrameRoot");)b++;if(m===Q.length||b===ce.length)for(m=Q.length-1,b=ce.length-1;1<=m&&0<=b&&Q[m]!==ce[b];)b--;for(;1<=m&&0<=b;m--,b--)if(Q[m]!==ce[b]){if(m!==1||b!==1)do if(m--,b--,0>b||Q[m]!==ce[b]){var be=`
`+Q[m].replace(" at new "," at ");return a.displayName&&be.includes("<anonymous>")&&(be=be.replace("<anonymous>",a.displayName)),be}while(1<=m&&0<=b);break}}}finally{Dt=!1,Error.prepareStackTrace=h}return(h=a?a.displayName||a.name:"")?nt(h):""}function Dn(a,l){switch(a.tag){case 26:case 27:case 5:return nt(a.type);case 16:return nt("Lazy");case 13:return a.child!==l&&l!==null?nt("Suspense Fallback"):nt("Suspense");case 19:return nt("SuspenseList");case 0:case 15:return dt(a.type,!1);case 11:return dt(a.type.render,!1);case 1:return dt(a.type,!0);case 31:return nt("Activity");default:return""}}function Ni(a){try{var l="",h=null;do l+=Dn(a,h),h=a,a=a.return;while(a);return l}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var Os=Object.prototype.hasOwnProperty,Ai=s.unstable_scheduleCallback,Dr=s.unstable_cancelCallback,Zo=s.unstable_shouldYield,Qo=s.unstable_requestPaint,Un=s.unstable_now,ou=s.unstable_getCurrentPriorityLevel,Br=s.unstable_ImmediatePriority,Ua=s.unstable_UserBlockingPriority,Ko=s.unstable_NormalPriority,$y=s.unstable_LowPriority,lu=s.unstable_IdlePriority,Hy=s.log,jy=s.unstable_setDisableYieldValue,Jo=null,is=null;function Ki(a){if(typeof Hy=="function"&&jy(a),is&&typeof is.setStrictMode=="function")try{is.setStrictMode(Jo,a)}catch{}}var rs=Math.clz32?Math.clz32:Xy,qy=Math.log,Wy=Math.LN2;function Xy(a){return a>>>=0,a===0?32:31-(qy(a)/Wy|0)|0}var uu=256,cu=262144,hu=4194304;function Lr(a){var l=a&42;if(l!==0)return l;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function du(a,l,h){var m=a.pendingLanes;if(m===0)return 0;var b=0,_=a.suspendedLanes,E=a.pingedLanes;a=a.warmLanes;var O=m&134217727;return O!==0?(m=O&~_,m!==0?b=Lr(m):(E&=O,E!==0?b=Lr(E):h||(h=O&~a,h!==0&&(b=Lr(h))))):(O=m&~_,O!==0?b=Lr(O):E!==0?b=Lr(E):h||(h=m&~a,h!==0&&(b=Lr(h)))),b===0?0:l!==0&&l!==b&&(l&_)===0&&(_=b&-b,h=l&-l,_>=h||_===32&&(h&4194048)!==0)?l:b}function el(a,l){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&l)===0}function Yy(a,l){switch(a){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Hf(){var a=hu;return hu<<=1,(hu&62914560)===0&&(hu=4194304),a}function ch(a){for(var l=[],h=0;31>h;h++)l.push(a);return l}function tl(a,l){a.pendingLanes|=l,l!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Zy(a,l,h,m,b,_){var E=a.pendingLanes;a.pendingLanes=h,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=h,a.entangledLanes&=h,a.errorRecoveryDisabledLanes&=h,a.shellSuspendCounter=0;var O=a.entanglements,Q=a.expirationTimes,ce=a.hiddenUpdates;for(h=E&~h;0<h;){var be=31-rs(h),Te=1<<be;O[be]=0,Q[be]=-1;var de=ce[be];if(de!==null)for(ce[be]=null,be=0;be<de.length;be++){var ge=de[be];ge!==null&&(ge.lane&=-536870913)}h&=~Te}m!==0&&jf(a,m,0),_!==0&&b===0&&a.tag!==0&&(a.suspendedLanes|=_&~(E&~l))}function jf(a,l,h){a.pendingLanes|=l,a.suspendedLanes&=~l;var m=31-rs(l);a.entangledLanes|=l,a.entanglements[m]=a.entanglements[m]|1073741824|h&261930}function qf(a,l){var h=a.entangledLanes|=l;for(a=a.entanglements;h;){var m=31-rs(h),b=1<<m;b&l|a[m]&l&&(a[m]|=l),h&=~b}}function Wf(a,l){var h=l&-l;return h=(h&42)!==0?1:hh(h),(h&(a.suspendedLanes|l))!==0?0:h}function hh(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function dh(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function Xf(){var a=k.p;return a!==0?a:(a=window.event,a===void 0?32:OA(a.type))}function Yf(a,l){var h=k.p;try{return k.p=a,l()}finally{k.p=h}}var Ji=Math.random().toString(36).slice(2),Nn="__reactFiber$"+Ji,Xn="__reactProps$"+Ji,Fr="__reactContainer$"+Ji,fu="__reactEvents$"+Ji,Zf="__reactListeners$"+Ji,Qy="__reactHandles$"+Ji,Qf="__reactResources$"+Ji,nl="__reactMarker$"+Ji;function fh(a){delete a[Nn],delete a[Xn],delete a[fu],delete a[Zf],delete a[Qy]}function za(a){var l=a[Nn];if(l)return l;for(var h=a.parentNode;h;){if(l=h[Fr]||h[Nn]){if(h=l.alternate,l.child!==null||h!==null&&h.child!==null)for(a=bA(a);a!==null;){if(h=a[Nn])return h;a=bA(a)}return l}a=h,h=a.parentNode}return null}function Va(a){if(a=a[Nn]||a[Fr]){var l=a.tag;if(l===5||l===6||l===13||l===31||l===26||l===27||l===3)return a}return null}function Pa(a){var l=a.tag;if(l===5||l===26||l===27||l===6)return a.stateNode;throw Error(n(33))}function Ia(a){var l=a[Qf];return l||(l=a[Qf]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function mn(a){a[nl]=!0}var Kf=new Set,Jf={};function Or(a,l){ka(a,l),ka(a+"Capture",l)}function ka(a,l){for(Jf[a]=l,a=0;a<l.length;a++)Kf.add(l[a])}var Ky=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ph={},ep={};function Jy(a){return Os.call(ep,a)?!0:Os.call(ph,a)?!1:Ky.test(a)?ep[a]=!0:(ph[a]=!0,!1)}function pu(a,l,h){if(Jy(l))if(h===null)a.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":a.removeAttribute(l);return;case"boolean":var m=l.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){a.removeAttribute(l);return}}a.setAttribute(l,""+h)}}function mu(a,l,h){if(h===null)a.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(l);return}a.setAttribute(l,""+h)}}function Ei(a,l,h,m){if(m===null)a.removeAttribute(h);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(h);return}a.setAttributeNS(l,h,""+m)}}function gs(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function tp(a){var l=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function ex(a,l,h){var m=Object.getOwnPropertyDescriptor(a.constructor.prototype,l);if(!a.hasOwnProperty(l)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var b=m.get,_=m.set;return Object.defineProperty(a,l,{configurable:!0,get:function(){return b.call(this)},set:function(E){h=""+E,_.call(this,E)}}),Object.defineProperty(a,l,{enumerable:m.enumerable}),{getValue:function(){return h},setValue:function(E){h=""+E},stopTracking:function(){a._valueTracker=null,delete a[l]}}}}function Ga(a){if(!a._valueTracker){var l=tp(a)?"checked":"value";a._valueTracker=ex(a,l,""+a[l])}}function np(a){if(!a)return!1;var l=a._valueTracker;if(!l)return!0;var h=l.getValue(),m="";return a&&(m=tp(a)?a.checked?"true":"false":a.value),a=m,a!==h?(l.setValue(a),!0):!1}function sl(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var tx=/[\n"\\]/g;function ys(a){return a.replace(tx,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function il(a,l,h,m,b,_,E,O){a.name="",E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?a.type=E:a.removeAttribute("type"),l!=null?E==="number"?(l===0&&a.value===""||a.value!=l)&&(a.value=""+gs(l)):a.value!==""+gs(l)&&(a.value=""+gs(l)):E!=="submit"&&E!=="reset"||a.removeAttribute("value"),l!=null?mh(a,E,gs(l)):h!=null?mh(a,E,gs(h)):m!=null&&a.removeAttribute("value"),b==null&&_!=null&&(a.defaultChecked=!!_),b!=null&&(a.checked=b&&typeof b!="function"&&typeof b!="symbol"),O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"?a.name=""+gs(O):a.removeAttribute("name")}function sp(a,l,h,m,b,_,E,O){if(_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(a.type=_),l!=null||h!=null){if(!(_!=="submit"&&_!=="reset"||l!=null)){Ga(a);return}h=h!=null?""+gs(h):"",l=l!=null?""+gs(l):h,O||l===a.value||(a.value=l),a.defaultValue=l}m=m??b,m=typeof m!="function"&&typeof m!="symbol"&&!!m,a.checked=O?a.checked:!!m,a.defaultChecked=!!m,E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(a.name=E),Ga(a)}function mh(a,l,h){l==="number"&&sl(a.ownerDocument)===a||a.defaultValue===""+h||(a.defaultValue=""+h)}function Ur(a,l,h,m){if(a=a.options,l){l={};for(var b=0;b<h.length;b++)l["$"+h[b]]=!0;for(h=0;h<a.length;h++)b=l.hasOwnProperty("$"+a[h].value),a[h].selected!==b&&(a[h].selected=b),b&&m&&(a[h].defaultSelected=!0)}else{for(h=""+gs(h),l=null,b=0;b<a.length;b++){if(a[b].value===h){a[b].selected=!0,m&&(a[b].defaultSelected=!0);return}l!==null||a[b].disabled||(l=a[b])}l!==null&&(l.selected=!0)}}function aw(a,l,h){if(l!=null&&(l=""+gs(l),l!==a.value&&(a.value=l),h==null)){a.defaultValue!==l&&(a.defaultValue=l);return}a.defaultValue=h!=null?""+gs(h):""}function ow(a,l,h,m){if(l==null){if(m!=null){if(h!=null)throw Error(n(92));if(Y(m)){if(1<m.length)throw Error(n(93));m=m[0]}h=m}h==null&&(h=""),l=h}h=gs(l),a.defaultValue=h,m=a.textContent,m===h&&m!==""&&m!==null&&(a.value=m),Ga(a)}function gu(a,l){if(l){var h=a.firstChild;if(h&&h===a.lastChild&&h.nodeType===3){h.nodeValue=l;return}}a.textContent=l}var bz=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function lw(a,l,h){var m=l.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?m?a.setProperty(l,""):l==="float"?a.cssFloat="":a[l]="":m?a.setProperty(l,h):typeof h!="number"||h===0||bz.has(l)?l==="float"?a.cssFloat=h:a[l]=(""+h).trim():a[l]=h+"px"}function uw(a,l,h){if(l!=null&&typeof l!="object")throw Error(n(62));if(a=a.style,h!=null){for(var m in h)!h.hasOwnProperty(m)||l!=null&&l.hasOwnProperty(m)||(m.indexOf("--")===0?a.setProperty(m,""):m==="float"?a.cssFloat="":a[m]="");for(var b in l)m=l[b],l.hasOwnProperty(b)&&h[b]!==m&&lw(a,b,m)}else for(var _ in l)l.hasOwnProperty(_)&&lw(a,_,l[_])}function nx(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _z=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),vz=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ip(a){return vz.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function zr(){}var sx=null;function ix(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var yu=null,xu=null;function cw(a){var l=Va(a);if(l&&(a=l.stateNode)){var h=a[Xn]||null;e:switch(a=l.stateNode,l.type){case"input":if(il(a,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),l=h.name,h.type==="radio"&&l!=null){for(h=a;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+ys(""+l)+'"][type="radio"]'),l=0;l<h.length;l++){var m=h[l];if(m!==a&&m.form===a.form){var b=m[Xn]||null;if(!b)throw Error(n(90));il(m,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(l=0;l<h.length;l++)m=h[l],m.form===a.form&&np(m)}break e;case"textarea":aw(a,h.value,h.defaultValue);break e;case"select":l=h.value,l!=null&&Ur(a,!!h.multiple,l,!1)}}}var rx=!1;function hw(a,l,h){if(rx)return a(l,h);rx=!0;try{var m=a(l);return m}finally{if(rx=!1,(yu!==null||xu!==null)&&(jp(),yu&&(l=yu,a=xu,xu=yu=null,cw(l),a)))for(l=0;l<a.length;l++)cw(a[l])}}function gh(a,l){var h=a.stateNode;if(h===null)return null;var m=h[Xn]||null;if(m===null)return null;h=m[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(a=a.type,m=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!m;break e;default:a=!1}if(a)return null;if(h&&typeof h!="function")throw Error(n(231,l,typeof h));return h}var Vr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ax=!1;if(Vr)try{var yh={};Object.defineProperty(yh,"passive",{get:function(){ax=!0}}),window.addEventListener("test",yh,yh),window.removeEventListener("test",yh,yh)}catch{ax=!1}var $a=null,ox=null,rp=null;function dw(){if(rp)return rp;var a,l=ox,h=l.length,m,b="value"in $a?$a.value:$a.textContent,_=b.length;for(a=0;a<h&&l[a]===b[a];a++);var E=h-a;for(m=1;m<=E&&l[h-m]===b[_-m];m++);return rp=b.slice(a,1<m?1-m:void 0)}function ap(a){var l=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&l===13&&(a=13)):a=l,a===10&&(a=13),32<=a||a===13?a:0}function op(){return!0}function fw(){return!1}function xs(a){function l(h,m,b,_,E){this._reactName=h,this._targetInst=b,this.type=m,this.nativeEvent=_,this.target=E,this.currentTarget=null;for(var O in a)a.hasOwnProperty(O)&&(h=a[O],this[O]=h?h(_):_[O]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?op:fw,this.isPropagationStopped=fw,this}return p(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=op)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=op)},persist:function(){},isPersistent:op}),l}var rl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lp=xs(rl),xh=p({},rl,{view:0,detail:0}),Tz=xs(xh),lx,ux,bh,up=p({},xh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hx,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==bh&&(bh&&a.type==="mousemove"?(lx=a.screenX-bh.screenX,ux=a.screenY-bh.screenY):ux=lx=0,bh=a),lx)},movementY:function(a){return"movementY"in a?a.movementY:ux}}),pw=xs(up),Sz=p({},up,{dataTransfer:0}),wz=xs(Sz),Mz=p({},xh,{relatedTarget:0}),cx=xs(Mz),Nz=p({},rl,{animationName:0,elapsedTime:0,pseudoElement:0}),Az=xs(Nz),Ez=p({},rl,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Rz=xs(Ez),Cz=p({},rl,{data:0}),mw=xs(Cz),Dz={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bz={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Lz={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Fz(a){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(a):(a=Lz[a])?!!l[a]:!1}function hx(){return Fz}var Oz=p({},xh,{key:function(a){if(a.key){var l=Dz[a.key]||a.key;if(l!=="Unidentified")return l}return a.type==="keypress"?(a=ap(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Bz[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hx,charCode:function(a){return a.type==="keypress"?ap(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?ap(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Uz=xs(Oz),zz=p({},up,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),gw=xs(zz),Vz=p({},xh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hx}),Pz=xs(Vz),Iz=p({},rl,{propertyName:0,elapsedTime:0,pseudoElement:0}),kz=xs(Iz),Gz=p({},up,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),$z=xs(Gz),Hz=p({},rl,{newState:0,oldState:0}),jz=xs(Hz),qz=[9,13,27,32],dx=Vr&&"CompositionEvent"in window,_h=null;Vr&&"documentMode"in document&&(_h=document.documentMode);var Wz=Vr&&"TextEvent"in window&&!_h,yw=Vr&&(!dx||_h&&8<_h&&11>=_h),xw=" ",bw=!1;function _w(a,l){switch(a){case"keyup":return qz.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vw(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var bu=!1;function Xz(a,l){switch(a){case"compositionend":return vw(l);case"keypress":return l.which!==32?null:(bw=!0,xw);case"textInput":return a=l.data,a===xw&&bw?null:a;default:return null}}function Yz(a,l){if(bu)return a==="compositionend"||!dx&&_w(a,l)?(a=dw(),rp=ox=$a=null,bu=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return yw&&l.locale!=="ko"?null:l.data;default:return null}}var Zz={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Tw(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l==="input"?!!Zz[a.type]:l==="textarea"}function Sw(a,l,h,m){yu?xu?xu.push(m):xu=[m]:yu=m,l=Kp(l,"onChange"),0<l.length&&(h=new lp("onChange","change",null,h,m),a.push({event:h,listeners:l}))}var vh=null,Th=null;function Qz(a){rA(a,0)}function cp(a){var l=Pa(a);if(np(l))return a}function ww(a,l){if(a==="change")return l}var Mw=!1;if(Vr){var fx;if(Vr){var px="oninput"in document;if(!px){var Nw=document.createElement("div");Nw.setAttribute("oninput","return;"),px=typeof Nw.oninput=="function"}fx=px}else fx=!1;Mw=fx&&(!document.documentMode||9<document.documentMode)}function Aw(){vh&&(vh.detachEvent("onpropertychange",Ew),Th=vh=null)}function Ew(a){if(a.propertyName==="value"&&cp(Th)){var l=[];Sw(l,Th,a,ix(a)),hw(Qz,l)}}function Kz(a,l,h){a==="focusin"?(Aw(),vh=l,Th=h,vh.attachEvent("onpropertychange",Ew)):a==="focusout"&&Aw()}function Jz(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return cp(Th)}function eV(a,l){if(a==="click")return cp(l)}function tV(a,l){if(a==="input"||a==="change")return cp(l)}function nV(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}var Us=typeof Object.is=="function"?Object.is:nV;function Sh(a,l){if(Us(a,l))return!0;if(typeof a!="object"||a===null||typeof l!="object"||l===null)return!1;var h=Object.keys(a),m=Object.keys(l);if(h.length!==m.length)return!1;for(m=0;m<h.length;m++){var b=h[m];if(!Os.call(l,b)||!Us(a[b],l[b]))return!1}return!0}function Rw(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Cw(a,l){var h=Rw(a);a=0;for(var m;h;){if(h.nodeType===3){if(m=a+h.textContent.length,a<=l&&m>=l)return{node:h,offset:l-a};a=m}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=Rw(h)}}function Dw(a,l){return a&&l?a===l?!0:a&&a.nodeType===3?!1:l&&l.nodeType===3?Dw(a,l.parentNode):"contains"in a?a.contains(l):a.compareDocumentPosition?!!(a.compareDocumentPosition(l)&16):!1:!1}function Bw(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var l=sl(a.document);l instanceof a.HTMLIFrameElement;){try{var h=typeof l.contentWindow.location.href=="string"}catch{h=!1}if(h)a=l.contentWindow;else break;l=sl(a.document)}return l}function mx(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l&&(l==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||l==="textarea"||a.contentEditable==="true")}var sV=Vr&&"documentMode"in document&&11>=document.documentMode,_u=null,gx=null,wh=null,yx=!1;function Lw(a,l,h){var m=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;yx||_u==null||_u!==sl(m)||(m=_u,"selectionStart"in m&&mx(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),wh&&Sh(wh,m)||(wh=m,m=Kp(gx,"onSelect"),0<m.length&&(l=new lp("onSelect","select",null,l,h),a.push({event:l,listeners:m}),l.target=_u)))}function al(a,l){var h={};return h[a.toLowerCase()]=l.toLowerCase(),h["Webkit"+a]="webkit"+l,h["Moz"+a]="moz"+l,h}var vu={animationend:al("Animation","AnimationEnd"),animationiteration:al("Animation","AnimationIteration"),animationstart:al("Animation","AnimationStart"),transitionrun:al("Transition","TransitionRun"),transitionstart:al("Transition","TransitionStart"),transitioncancel:al("Transition","TransitionCancel"),transitionend:al("Transition","TransitionEnd")},xx={},Fw={};Vr&&(Fw=document.createElement("div").style,"AnimationEvent"in window||(delete vu.animationend.animation,delete vu.animationiteration.animation,delete vu.animationstart.animation),"TransitionEvent"in window||delete vu.transitionend.transition);function ol(a){if(xx[a])return xx[a];if(!vu[a])return a;var l=vu[a],h;for(h in l)if(l.hasOwnProperty(h)&&h in Fw)return xx[a]=l[h];return a}var Ow=ol("animationend"),Uw=ol("animationiteration"),zw=ol("animationstart"),iV=ol("transitionrun"),rV=ol("transitionstart"),aV=ol("transitioncancel"),Vw=ol("transitionend"),Pw=new Map,bx="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");bx.push("scrollEnd");function Ri(a,l){Pw.set(a,l),Or(l,[a])}var hp=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},ni=[],Tu=0,_x=0;function dp(){for(var a=Tu,l=_x=Tu=0;l<a;){var h=ni[l];ni[l++]=null;var m=ni[l];ni[l++]=null;var b=ni[l];ni[l++]=null;var _=ni[l];if(ni[l++]=null,m!==null&&b!==null){var E=m.pending;E===null?b.next=b:(b.next=E.next,E.next=b),m.pending=b}_!==0&&Iw(h,b,_)}}function fp(a,l,h,m){ni[Tu++]=a,ni[Tu++]=l,ni[Tu++]=h,ni[Tu++]=m,_x|=m,a.lanes|=m,a=a.alternate,a!==null&&(a.lanes|=m)}function vx(a,l,h,m){return fp(a,l,h,m),pp(a)}function ll(a,l){return fp(a,null,null,l),pp(a)}function Iw(a,l,h){a.lanes|=h;var m=a.alternate;m!==null&&(m.lanes|=h);for(var b=!1,_=a.return;_!==null;)_.childLanes|=h,m=_.alternate,m!==null&&(m.childLanes|=h),_.tag===22&&(a=_.stateNode,a===null||a._visibility&1||(b=!0)),a=_,_=_.return;return a.tag===3?(_=a.stateNode,b&&l!==null&&(b=31-rs(h),a=_.hiddenUpdates,m=a[b],m===null?a[b]=[l]:m.push(l),l.lane=h|536870912),_):null}function pp(a){if(50<qh)throw qh=0,Cb=null,Error(n(185));for(var l=a.return;l!==null;)a=l,l=a.return;return a.tag===3?a.stateNode:null}var Su={};function oV(a,l,h,m){this.tag=a,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zs(a,l,h,m){return new oV(a,l,h,m)}function Tx(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Pr(a,l){var h=a.alternate;return h===null?(h=zs(a.tag,l,a.key,a.mode),h.elementType=a.elementType,h.type=a.type,h.stateNode=a.stateNode,h.alternate=a,a.alternate=h):(h.pendingProps=l,h.type=a.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=a.flags&65011712,h.childLanes=a.childLanes,h.lanes=a.lanes,h.child=a.child,h.memoizedProps=a.memoizedProps,h.memoizedState=a.memoizedState,h.updateQueue=a.updateQueue,l=a.dependencies,h.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},h.sibling=a.sibling,h.index=a.index,h.ref=a.ref,h.refCleanup=a.refCleanup,h}function kw(a,l){a.flags&=65011714;var h=a.alternate;return h===null?(a.childLanes=0,a.lanes=l,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=h.childLanes,a.lanes=h.lanes,a.child=h.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=h.memoizedProps,a.memoizedState=h.memoizedState,a.updateQueue=h.updateQueue,a.type=h.type,l=h.dependencies,a.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),a}function mp(a,l,h,m,b,_){var E=0;if(m=a,typeof a=="function")Tx(a)&&(E=1);else if(typeof a=="string")E=dP(a,h,fe.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case L:return a=zs(31,h,l,b),a.elementType=L,a.lanes=_,a;case v:return ul(h.children,b,_,l);case S:E=8,b|=24;break;case w:return a=zs(12,h,l,b|2),a.elementType=w,a.lanes=_,a;case C:return a=zs(13,h,l,b),a.elementType=C,a.lanes=_,a;case D:return a=zs(19,h,l,b),a.elementType=D,a.lanes=_,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case T:E=10;break e;case M:E=9;break e;case A:E=11;break e;case R:E=14;break e;case B:E=16,m=null;break e}E=29,h=Error(n(130,a===null?"null":typeof a,"")),m=null}return l=zs(E,h,l,b),l.elementType=a,l.type=m,l.lanes=_,l}function ul(a,l,h,m){return a=zs(7,a,m,l),a.lanes=h,a}function Sx(a,l,h){return a=zs(6,a,null,l),a.lanes=h,a}function Gw(a){var l=zs(18,null,null,0);return l.stateNode=a,l}function wx(a,l,h){return l=zs(4,a.children!==null?a.children:[],a.key,l),l.lanes=h,l.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},l}var $w=new WeakMap;function si(a,l){if(typeof a=="object"&&a!==null){var h=$w.get(a);return h!==void 0?h:(l={value:a,source:l,stack:Ni(l)},$w.set(a,l),l)}return{value:a,source:l,stack:Ni(l)}}var wu=[],Mu=0,gp=null,Mh=0,ii=[],ri=0,Ha=null,er=1,tr="";function Ir(a,l){wu[Mu++]=Mh,wu[Mu++]=gp,gp=a,Mh=l}function Hw(a,l,h){ii[ri++]=er,ii[ri++]=tr,ii[ri++]=Ha,Ha=a;var m=er;a=tr;var b=32-rs(m)-1;m&=~(1<<b),h+=1;var _=32-rs(l)+b;if(30<_){var E=b-b%5;_=(m&(1<<E)-1).toString(32),m>>=E,b-=E,er=1<<32-rs(l)+b|h<<b|m,tr=_+a}else er=1<<_|h<<b|m,tr=a}function Mx(a){a.return!==null&&(Ir(a,1),Hw(a,1,0))}function Nx(a){for(;a===gp;)gp=wu[--Mu],wu[Mu]=null,Mh=wu[--Mu],wu[Mu]=null;for(;a===Ha;)Ha=ii[--ri],ii[ri]=null,tr=ii[--ri],ii[ri]=null,er=ii[--ri],ii[ri]=null}function jw(a,l){ii[ri++]=er,ii[ri++]=tr,ii[ri++]=Ha,er=l.id,tr=l.overflow,Ha=a}var zn=null,qt=null,xt=!1,ja=null,ai=!1,Ax=Error(n(519));function qa(a){var l=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Nh(si(l,a)),Ax}function qw(a){var l=a.stateNode,h=a.type,m=a.memoizedProps;switch(l[Nn]=a,l[Xn]=m,h){case"dialog":ut("cancel",l),ut("close",l);break;case"iframe":case"object":case"embed":ut("load",l);break;case"video":case"audio":for(h=0;h<Xh.length;h++)ut(Xh[h],l);break;case"source":ut("error",l);break;case"img":case"image":case"link":ut("error",l),ut("load",l);break;case"details":ut("toggle",l);break;case"input":ut("invalid",l),sp(l,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":ut("invalid",l);break;case"textarea":ut("invalid",l),ow(l,m.value,m.defaultValue,m.children)}h=m.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||l.textContent===""+h||m.suppressHydrationWarning===!0||uA(l.textContent,h)?(m.popover!=null&&(ut("beforetoggle",l),ut("toggle",l)),m.onScroll!=null&&ut("scroll",l),m.onScrollEnd!=null&&ut("scrollend",l),m.onClick!=null&&(l.onclick=zr),l=!0):l=!1,l||qa(a,!0)}function Ww(a){for(zn=a.return;zn;)switch(zn.tag){case 5:case 31:case 13:ai=!1;return;case 27:case 3:ai=!0;return;default:zn=zn.return}}function Nu(a){if(a!==zn)return!1;if(!xt)return Ww(a),xt=!0,!1;var l=a.tag,h;if((h=l!==3&&l!==27)&&((h=l===5)&&(h=a.type,h=!(h!=="form"&&h!=="button")||jb(a.type,a.memoizedProps)),h=!h),h&&qt&&qa(a),Ww(a),l===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));qt=xA(a)}else if(l===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));qt=xA(a)}else l===27?(l=qt,ao(a.type)?(a=Zb,Zb=null,qt=a):qt=l):qt=zn?li(a.stateNode.nextSibling):null;return!0}function cl(){qt=zn=null,xt=!1}function Ex(){var a=ja;return a!==null&&(Ts===null?Ts=a:Ts.push.apply(Ts,a),ja=null),a}function Nh(a){ja===null?ja=[a]:ja.push(a)}var Rx=V(null),hl=null,kr=null;function Wa(a,l,h){he(Rx,l._currentValue),l._currentValue=h}function Gr(a){a._currentValue=Rx.current,q(Rx)}function Cx(a,l,h){for(;a!==null;){var m=a.alternate;if((a.childLanes&l)!==l?(a.childLanes|=l,m!==null&&(m.childLanes|=l)):m!==null&&(m.childLanes&l)!==l&&(m.childLanes|=l),a===h)break;a=a.return}}function Dx(a,l,h,m){var b=a.child;for(b!==null&&(b.return=a);b!==null;){var _=b.dependencies;if(_!==null){var E=b.child;_=_.firstContext;e:for(;_!==null;){var O=_;_=b;for(var Q=0;Q<l.length;Q++)if(O.context===l[Q]){_.lanes|=h,O=_.alternate,O!==null&&(O.lanes|=h),Cx(_.return,h,a),m||(E=null);break e}_=O.next}}else if(b.tag===18){if(E=b.return,E===null)throw Error(n(341));E.lanes|=h,_=E.alternate,_!==null&&(_.lanes|=h),Cx(E,h,a),E=null}else E=b.child;if(E!==null)E.return=b;else for(E=b;E!==null;){if(E===a){E=null;break}if(b=E.sibling,b!==null){b.return=E.return,E=b;break}E=E.return}b=E}}function Au(a,l,h,m){a=null;for(var b=l,_=!1;b!==null;){if(!_){if((b.flags&524288)!==0)_=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var E=b.alternate;if(E===null)throw Error(n(387));if(E=E.memoizedProps,E!==null){var O=b.type;Us(b.pendingProps.value,E.value)||(a!==null?a.push(O):a=[O])}}else if(b===pe.current){if(E=b.alternate,E===null)throw Error(n(387));E.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(a!==null?a.push(Jh):a=[Jh])}b=b.return}a!==null&&Dx(l,a,h,m),l.flags|=262144}function yp(a){for(a=a.firstContext;a!==null;){if(!Us(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function dl(a){hl=a,kr=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Vn(a){return Xw(hl,a)}function xp(a,l){return hl===null&&dl(a),Xw(a,l)}function Xw(a,l){var h=l._currentValue;if(l={context:l,memoizedValue:h,next:null},kr===null){if(a===null)throw Error(n(308));kr=l,a.dependencies={lanes:0,firstContext:l},a.flags|=524288}else kr=kr.next=l;return h}var lV=typeof AbortController<"u"?AbortController:function(){var a=[],l=this.signal={aborted:!1,addEventListener:function(h,m){a.push(m)}};this.abort=function(){l.aborted=!0,a.forEach(function(h){return h()})}},uV=s.unstable_scheduleCallback,cV=s.unstable_NormalPriority,gn={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Bx(){return{controller:new lV,data:new Map,refCount:0}}function Ah(a){a.refCount--,a.refCount===0&&uV(cV,function(){a.controller.abort()})}var Eh=null,Lx=0,Eu=0,Ru=null;function hV(a,l){if(Eh===null){var h=Eh=[];Lx=0,Eu=Ub(),Ru={status:"pending",value:void 0,then:function(m){h.push(m)}}}return Lx++,l.then(Yw,Yw),l}function Yw(){if(--Lx===0&&Eh!==null){Ru!==null&&(Ru.status="fulfilled");var a=Eh;Eh=null,Eu=0,Ru=null;for(var l=0;l<a.length;l++)(0,a[l])()}}function dV(a,l){var h=[],m={status:"pending",value:null,reason:null,then:function(b){h.push(b)}};return a.then(function(){m.status="fulfilled",m.value=l;for(var b=0;b<h.length;b++)(0,h[b])(l)},function(b){for(m.status="rejected",m.reason=b,b=0;b<h.length;b++)(0,h[b])(void 0)}),m}var Zw=F.S;F.S=function(a,l){LN=Un(),typeof l=="object"&&l!==null&&typeof l.then=="function"&&hV(a,l),Zw!==null&&Zw(a,l)};var fl=V(null);function Fx(){var a=fl.current;return a!==null?a:kt.pooledCache}function bp(a,l){l===null?he(fl,fl.current):he(fl,l.pool)}function Qw(){var a=Fx();return a===null?null:{parent:gn._currentValue,pool:a}}var Cu=Error(n(460)),Ox=Error(n(474)),_p=Error(n(542)),vp={then:function(){}};function Kw(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Jw(a,l,h){switch(h=a[h],h===void 0?a.push(l):h!==l&&(l.then(zr,zr),l=h),l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,tM(a),a;default:if(typeof l.status=="string")l.then(zr,zr);else{if(a=kt,a!==null&&100<a.shellSuspendCounter)throw Error(n(482));a=l,a.status="pending",a.then(function(m){if(l.status==="pending"){var b=l;b.status="fulfilled",b.value=m}},function(m){if(l.status==="pending"){var b=l;b.status="rejected",b.reason=m}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw a=l.reason,tM(a),a}throw ml=l,Cu}}function pl(a){try{var l=a._init;return l(a._payload)}catch(h){throw h!==null&&typeof h=="object"&&typeof h.then=="function"?(ml=h,Cu):h}}var ml=null;function eM(){if(ml===null)throw Error(n(459));var a=ml;return ml=null,a}function tM(a){if(a===Cu||a===_p)throw Error(n(483))}var Du=null,Rh=0;function Tp(a){var l=Rh;return Rh+=1,Du===null&&(Du=[]),Jw(Du,a,l)}function Ch(a,l){l=l.props.ref,a.ref=l!==void 0?l:null}function Sp(a,l){throw l.$$typeof===g?Error(n(525)):(a=Object.prototype.toString.call(l),Error(n(31,a==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":a)))}function nM(a){function l(ae,ne){if(a){var ue=ae.deletions;ue===null?(ae.deletions=[ne],ae.flags|=16):ue.push(ne)}}function h(ae,ne){if(!a)return null;for(;ne!==null;)l(ae,ne),ne=ne.sibling;return null}function m(ae){for(var ne=new Map;ae!==null;)ae.key!==null?ne.set(ae.key,ae):ne.set(ae.index,ae),ae=ae.sibling;return ne}function b(ae,ne){return ae=Pr(ae,ne),ae.index=0,ae.sibling=null,ae}function _(ae,ne,ue){return ae.index=ue,a?(ue=ae.alternate,ue!==null?(ue=ue.index,ue<ne?(ae.flags|=67108866,ne):ue):(ae.flags|=67108866,ne)):(ae.flags|=1048576,ne)}function E(ae){return a&&ae.alternate===null&&(ae.flags|=67108866),ae}function O(ae,ne,ue,_e){return ne===null||ne.tag!==6?(ne=Sx(ue,ae.mode,_e),ne.return=ae,ne):(ne=b(ne,ue),ne.return=ae,ne)}function Q(ae,ne,ue,_e){var je=ue.type;return je===v?be(ae,ne,ue.props.children,_e,ue.key):ne!==null&&(ne.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===B&&pl(je)===ne.type)?(ne=b(ne,ue.props),Ch(ne,ue),ne.return=ae,ne):(ne=mp(ue.type,ue.key,ue.props,null,ae.mode,_e),Ch(ne,ue),ne.return=ae,ne)}function ce(ae,ne,ue,_e){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==ue.containerInfo||ne.stateNode.implementation!==ue.implementation?(ne=wx(ue,ae.mode,_e),ne.return=ae,ne):(ne=b(ne,ue.children||[]),ne.return=ae,ne)}function be(ae,ne,ue,_e,je){return ne===null||ne.tag!==7?(ne=ul(ue,ae.mode,_e,je),ne.return=ae,ne):(ne=b(ne,ue),ne.return=ae,ne)}function Te(ae,ne,ue){if(typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint")return ne=Sx(""+ne,ae.mode,ue),ne.return=ae,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case y:return ue=mp(ne.type,ne.key,ne.props,null,ae.mode,ue),Ch(ue,ne),ue.return=ae,ue;case x:return ne=wx(ne,ae.mode,ue),ne.return=ae,ne;case B:return ne=pl(ne),Te(ae,ne,ue)}if(Y(ne)||j(ne))return ne=ul(ne,ae.mode,ue,null),ne.return=ae,ne;if(typeof ne.then=="function")return Te(ae,Tp(ne),ue);if(ne.$$typeof===T)return Te(ae,xp(ae,ne),ue);Sp(ae,ne)}return null}function de(ae,ne,ue,_e){var je=ne!==null?ne.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint")return je!==null?null:O(ae,ne,""+ue,_e);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case y:return ue.key===je?Q(ae,ne,ue,_e):null;case x:return ue.key===je?ce(ae,ne,ue,_e):null;case B:return ue=pl(ue),de(ae,ne,ue,_e)}if(Y(ue)||j(ue))return je!==null?null:be(ae,ne,ue,_e,null);if(typeof ue.then=="function")return de(ae,ne,Tp(ue),_e);if(ue.$$typeof===T)return de(ae,ne,xp(ae,ue),_e);Sp(ae,ue)}return null}function ge(ae,ne,ue,_e,je){if(typeof _e=="string"&&_e!==""||typeof _e=="number"||typeof _e=="bigint")return ae=ae.get(ue)||null,O(ne,ae,""+_e,je);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case y:return ae=ae.get(_e.key===null?ue:_e.key)||null,Q(ne,ae,_e,je);case x:return ae=ae.get(_e.key===null?ue:_e.key)||null,ce(ne,ae,_e,je);case B:return _e=pl(_e),ge(ae,ne,ue,_e,je)}if(Y(_e)||j(_e))return ae=ae.get(ue)||null,be(ne,ae,_e,je,null);if(typeof _e.then=="function")return ge(ae,ne,ue,Tp(_e),je);if(_e.$$typeof===T)return ge(ae,ne,ue,xp(ne,_e),je);Sp(ne,_e)}return null}function Pe(ae,ne,ue,_e){for(var je=null,Tt=null,$e=ne,st=ne=0,pt=null;$e!==null&&st<ue.length;st++){$e.index>st?(pt=$e,$e=null):pt=$e.sibling;var St=de(ae,$e,ue[st],_e);if(St===null){$e===null&&($e=pt);break}a&&$e&&St.alternate===null&&l(ae,$e),ne=_(St,ne,st),Tt===null?je=St:Tt.sibling=St,Tt=St,$e=pt}if(st===ue.length)return h(ae,$e),xt&&Ir(ae,st),je;if($e===null){for(;st<ue.length;st++)$e=Te(ae,ue[st],_e),$e!==null&&(ne=_($e,ne,st),Tt===null?je=$e:Tt.sibling=$e,Tt=$e);return xt&&Ir(ae,st),je}for($e=m($e);st<ue.length;st++)pt=ge($e,ae,st,ue[st],_e),pt!==null&&(a&&pt.alternate!==null&&$e.delete(pt.key===null?st:pt.key),ne=_(pt,ne,st),Tt===null?je=pt:Tt.sibling=pt,Tt=pt);return a&&$e.forEach(function(ho){return l(ae,ho)}),xt&&Ir(ae,st),je}function Xe(ae,ne,ue,_e){if(ue==null)throw Error(n(151));for(var je=null,Tt=null,$e=ne,st=ne=0,pt=null,St=ue.next();$e!==null&&!St.done;st++,St=ue.next()){$e.index>st?(pt=$e,$e=null):pt=$e.sibling;var ho=de(ae,$e,St.value,_e);if(ho===null){$e===null&&($e=pt);break}a&&$e&&ho.alternate===null&&l(ae,$e),ne=_(ho,ne,st),Tt===null?je=ho:Tt.sibling=ho,Tt=ho,$e=pt}if(St.done)return h(ae,$e),xt&&Ir(ae,st),je;if($e===null){for(;!St.done;st++,St=ue.next())St=Te(ae,St.value,_e),St!==null&&(ne=_(St,ne,st),Tt===null?je=St:Tt.sibling=St,Tt=St);return xt&&Ir(ae,st),je}for($e=m($e);!St.done;st++,St=ue.next())St=ge($e,ae,st,St.value,_e),St!==null&&(a&&St.alternate!==null&&$e.delete(St.key===null?st:St.key),ne=_(St,ne,st),Tt===null?je=St:Tt.sibling=St,Tt=St);return a&&$e.forEach(function(SP){return l(ae,SP)}),xt&&Ir(ae,st),je}function Vt(ae,ne,ue,_e){if(typeof ue=="object"&&ue!==null&&ue.type===v&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case y:e:{for(var je=ue.key;ne!==null;){if(ne.key===je){if(je=ue.type,je===v){if(ne.tag===7){h(ae,ne.sibling),_e=b(ne,ue.props.children),_e.return=ae,ae=_e;break e}}else if(ne.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===B&&pl(je)===ne.type){h(ae,ne.sibling),_e=b(ne,ue.props),Ch(_e,ue),_e.return=ae,ae=_e;break e}h(ae,ne);break}else l(ae,ne);ne=ne.sibling}ue.type===v?(_e=ul(ue.props.children,ae.mode,_e,ue.key),_e.return=ae,ae=_e):(_e=mp(ue.type,ue.key,ue.props,null,ae.mode,_e),Ch(_e,ue),_e.return=ae,ae=_e)}return E(ae);case x:e:{for(je=ue.key;ne!==null;){if(ne.key===je)if(ne.tag===4&&ne.stateNode.containerInfo===ue.containerInfo&&ne.stateNode.implementation===ue.implementation){h(ae,ne.sibling),_e=b(ne,ue.children||[]),_e.return=ae,ae=_e;break e}else{h(ae,ne);break}else l(ae,ne);ne=ne.sibling}_e=wx(ue,ae.mode,_e),_e.return=ae,ae=_e}return E(ae);case B:return ue=pl(ue),Vt(ae,ne,ue,_e)}if(Y(ue))return Pe(ae,ne,ue,_e);if(j(ue)){if(je=j(ue),typeof je!="function")throw Error(n(150));return ue=je.call(ue),Xe(ae,ne,ue,_e)}if(typeof ue.then=="function")return Vt(ae,ne,Tp(ue),_e);if(ue.$$typeof===T)return Vt(ae,ne,xp(ae,ue),_e);Sp(ae,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint"?(ue=""+ue,ne!==null&&ne.tag===6?(h(ae,ne.sibling),_e=b(ne,ue),_e.return=ae,ae=_e):(h(ae,ne),_e=Sx(ue,ae.mode,_e),_e.return=ae,ae=_e),E(ae)):h(ae,ne)}return function(ae,ne,ue,_e){try{Rh=0;var je=Vt(ae,ne,ue,_e);return Du=null,je}catch($e){if($e===Cu||$e===_p)throw $e;var Tt=zs(29,$e,null,ae.mode);return Tt.lanes=_e,Tt.return=ae,Tt}finally{}}}var gl=nM(!0),sM=nM(!1),Xa=!1;function Ux(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function zx(a,l){a=a.updateQueue,l.updateQueue===a&&(l.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Ya(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Za(a,l,h){var m=a.updateQueue;if(m===null)return null;if(m=m.shared,(wt&2)!==0){var b=m.pending;return b===null?l.next=l:(l.next=b.next,b.next=l),m.pending=l,l=pp(a),Iw(a,null,h),l}return fp(a,m,l,h),pp(a)}function Dh(a,l,h){if(l=l.updateQueue,l!==null&&(l=l.shared,(h&4194048)!==0)){var m=l.lanes;m&=a.pendingLanes,h|=m,l.lanes=h,qf(a,h)}}function Vx(a,l){var h=a.updateQueue,m=a.alternate;if(m!==null&&(m=m.updateQueue,h===m)){var b=null,_=null;if(h=h.firstBaseUpdate,h!==null){do{var E={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};_===null?b=_=E:_=_.next=E,h=h.next}while(h!==null);_===null?b=_=l:_=_.next=l}else b=_=l;h={baseState:m.baseState,firstBaseUpdate:b,lastBaseUpdate:_,shared:m.shared,callbacks:m.callbacks},a.updateQueue=h;return}a=h.lastBaseUpdate,a===null?h.firstBaseUpdate=l:a.next=l,h.lastBaseUpdate=l}var Px=!1;function Bh(){if(Px){var a=Ru;if(a!==null)throw a}}function Lh(a,l,h,m){Px=!1;var b=a.updateQueue;Xa=!1;var _=b.firstBaseUpdate,E=b.lastBaseUpdate,O=b.shared.pending;if(O!==null){b.shared.pending=null;var Q=O,ce=Q.next;Q.next=null,E===null?_=ce:E.next=ce,E=Q;var be=a.alternate;be!==null&&(be=be.updateQueue,O=be.lastBaseUpdate,O!==E&&(O===null?be.firstBaseUpdate=ce:O.next=ce,be.lastBaseUpdate=Q))}if(_!==null){var Te=b.baseState;E=0,be=ce=Q=null,O=_;do{var de=O.lane&-536870913,ge=de!==O.lane;if(ge?(ft&de)===de:(m&de)===de){de!==0&&de===Eu&&(Px=!0),be!==null&&(be=be.next={lane:0,tag:O.tag,payload:O.payload,callback:null,next:null});e:{var Pe=a,Xe=O;de=l;var Vt=h;switch(Xe.tag){case 1:if(Pe=Xe.payload,typeof Pe=="function"){Te=Pe.call(Vt,Te,de);break e}Te=Pe;break e;case 3:Pe.flags=Pe.flags&-65537|128;case 0:if(Pe=Xe.payload,de=typeof Pe=="function"?Pe.call(Vt,Te,de):Pe,de==null)break e;Te=p({},Te,de);break e;case 2:Xa=!0}}de=O.callback,de!==null&&(a.flags|=64,ge&&(a.flags|=8192),ge=b.callbacks,ge===null?b.callbacks=[de]:ge.push(de))}else ge={lane:de,tag:O.tag,payload:O.payload,callback:O.callback,next:null},be===null?(ce=be=ge,Q=Te):be=be.next=ge,E|=de;if(O=O.next,O===null){if(O=b.shared.pending,O===null)break;ge=O,O=ge.next,ge.next=null,b.lastBaseUpdate=ge,b.shared.pending=null}}while(!0);be===null&&(Q=Te),b.baseState=Q,b.firstBaseUpdate=ce,b.lastBaseUpdate=be,_===null&&(b.shared.lanes=0),to|=E,a.lanes=E,a.memoizedState=Te}}function iM(a,l){if(typeof a!="function")throw Error(n(191,a));a.call(l)}function rM(a,l){var h=a.callbacks;if(h!==null)for(a.callbacks=null,a=0;a<h.length;a++)iM(h[a],l)}var Bu=V(null),wp=V(0);function aM(a,l){a=Qr,he(wp,a),he(Bu,l),Qr=a|l.baseLanes}function Ix(){he(wp,Qr),he(Bu,Bu.current)}function kx(){Qr=wp.current,q(Bu),q(wp)}var Vs=V(null),oi=null;function Qa(a){var l=a.alternate;he(un,un.current&1),he(Vs,a),oi===null&&(l===null||Bu.current!==null||l.memoizedState!==null)&&(oi=a)}function Gx(a){he(un,un.current),he(Vs,a),oi===null&&(oi=a)}function oM(a){a.tag===22?(he(un,un.current),he(Vs,a),oi===null&&(oi=a)):Ka()}function Ka(){he(un,un.current),he(Vs,Vs.current)}function Ps(a){q(Vs),oi===a&&(oi=null),q(un)}var un=V(0);function Mp(a){for(var l=a;l!==null;){if(l.tag===13){var h=l.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||Xb(h)||Yb(h)))return l}else if(l.tag===19&&(l.memoizedProps.revealOrder==="forwards"||l.memoizedProps.revealOrder==="backwards"||l.memoizedProps.revealOrder==="unstable_legacy-backwards"||l.memoizedProps.revealOrder==="together")){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var $r=0,et=null,Ut=null,yn=null,Np=!1,Lu=!1,yl=!1,Ap=0,Fh=0,Fu=null,fV=0;function an(){throw Error(n(321))}function $x(a,l){if(l===null)return!1;for(var h=0;h<l.length&&h<a.length;h++)if(!Us(a[h],l[h]))return!1;return!0}function Hx(a,l,h,m,b,_){return $r=_,et=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,F.H=a===null||a.memoizedState===null?HM:rb,yl=!1,_=h(m,b),yl=!1,Lu&&(_=uM(l,h,m,b)),lM(a),_}function lM(a){F.H=zh;var l=Ut!==null&&Ut.next!==null;if($r=0,yn=Ut=et=null,Np=!1,Fh=0,Fu=null,l)throw Error(n(300));a===null||xn||(a=a.dependencies,a!==null&&yp(a)&&(xn=!0))}function uM(a,l,h,m){et=a;var b=0;do{if(Lu&&(Fu=null),Fh=0,Lu=!1,25<=b)throw Error(n(301));if(b+=1,yn=Ut=null,a.updateQueue!=null){var _=a.updateQueue;_.lastEffect=null,_.events=null,_.stores=null,_.memoCache!=null&&(_.memoCache.index=0)}F.H=jM,_=l(h,m)}while(Lu);return _}function pV(){var a=F.H,l=a.useState()[0];return l=typeof l.then=="function"?Oh(l):l,a=a.useState()[0],(Ut!==null?Ut.memoizedState:null)!==a&&(et.flags|=1024),l}function jx(){var a=Ap!==0;return Ap=0,a}function qx(a,l,h){l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~h}function Wx(a){if(Np){for(a=a.memoizedState;a!==null;){var l=a.queue;l!==null&&(l.pending=null),a=a.next}Np=!1}$r=0,yn=Ut=et=null,Lu=!1,Fh=Ap=0,Fu=null}function as(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yn===null?et.memoizedState=yn=a:yn=yn.next=a,yn}function cn(){if(Ut===null){var a=et.alternate;a=a!==null?a.memoizedState:null}else a=Ut.next;var l=yn===null?et.memoizedState:yn.next;if(l!==null)yn=l,Ut=a;else{if(a===null)throw et.alternate===null?Error(n(467)):Error(n(310));Ut=a,a={memoizedState:Ut.memoizedState,baseState:Ut.baseState,baseQueue:Ut.baseQueue,queue:Ut.queue,next:null},yn===null?et.memoizedState=yn=a:yn=yn.next=a}return yn}function Ep(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Oh(a){var l=Fh;return Fh+=1,Fu===null&&(Fu=[]),a=Jw(Fu,a,l),l=et,(yn===null?l.memoizedState:yn.next)===null&&(l=l.alternate,F.H=l===null||l.memoizedState===null?HM:rb),a}function Rp(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Oh(a);if(a.$$typeof===T)return Vn(a)}throw Error(n(438,String(a)))}function Xx(a){var l=null,h=et.updateQueue;if(h!==null&&(l=h.memoCache),l==null){var m=et.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(l={data:m.data.map(function(b){return b.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),h===null&&(h=Ep(),et.updateQueue=h),h.memoCache=l,h=l.data[l.index],h===void 0)for(h=l.data[l.index]=Array(a),m=0;m<a;m++)h[m]=X;return l.index++,h}function Hr(a,l){return typeof l=="function"?l(a):l}function Cp(a){var l=cn();return Yx(l,Ut,a)}function Yx(a,l,h){var m=a.queue;if(m===null)throw Error(n(311));m.lastRenderedReducer=h;var b=a.baseQueue,_=m.pending;if(_!==null){if(b!==null){var E=b.next;b.next=_.next,_.next=E}l.baseQueue=b=_,m.pending=null}if(_=a.baseState,b===null)a.memoizedState=_;else{l=b.next;var O=E=null,Q=null,ce=l,be=!1;do{var Te=ce.lane&-536870913;if(Te!==ce.lane?(ft&Te)===Te:($r&Te)===Te){var de=ce.revertLane;if(de===0)Q!==null&&(Q=Q.next={lane:0,revertLane:0,gesture:null,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null}),Te===Eu&&(be=!0);else if(($r&de)===de){ce=ce.next,de===Eu&&(be=!0);continue}else Te={lane:0,revertLane:ce.revertLane,gesture:null,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},Q===null?(O=Q=Te,E=_):Q=Q.next=Te,et.lanes|=de,to|=de;Te=ce.action,yl&&h(_,Te),_=ce.hasEagerState?ce.eagerState:h(_,Te)}else de={lane:Te,revertLane:ce.revertLane,gesture:ce.gesture,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},Q===null?(O=Q=de,E=_):Q=Q.next=de,et.lanes|=Te,to|=Te;ce=ce.next}while(ce!==null&&ce!==l);if(Q===null?E=_:Q.next=O,!Us(_,a.memoizedState)&&(xn=!0,be&&(h=Ru,h!==null)))throw h;a.memoizedState=_,a.baseState=E,a.baseQueue=Q,m.lastRenderedState=_}return b===null&&(m.lanes=0),[a.memoizedState,m.dispatch]}function Zx(a){var l=cn(),h=l.queue;if(h===null)throw Error(n(311));h.lastRenderedReducer=a;var m=h.dispatch,b=h.pending,_=l.memoizedState;if(b!==null){h.pending=null;var E=b=b.next;do _=a(_,E.action),E=E.next;while(E!==b);Us(_,l.memoizedState)||(xn=!0),l.memoizedState=_,l.baseQueue===null&&(l.baseState=_),h.lastRenderedState=_}return[_,m]}function cM(a,l,h){var m=et,b=cn(),_=xt;if(_){if(h===void 0)throw Error(n(407));h=h()}else h=l();var E=!Us((Ut||b).memoizedState,h);if(E&&(b.memoizedState=h,xn=!0),b=b.queue,Jx(fM.bind(null,m,b,a),[a]),b.getSnapshot!==l||E||yn!==null&&yn.memoizedState.tag&1){if(m.flags|=2048,Ou(9,{destroy:void 0},dM.bind(null,m,b,h,l),null),kt===null)throw Error(n(349));_||($r&127)!==0||hM(m,l,h)}return h}function hM(a,l,h){a.flags|=16384,a={getSnapshot:l,value:h},l=et.updateQueue,l===null?(l=Ep(),et.updateQueue=l,l.stores=[a]):(h=l.stores,h===null?l.stores=[a]:h.push(a))}function dM(a,l,h,m){l.value=h,l.getSnapshot=m,pM(l)&&mM(a)}function fM(a,l,h){return h(function(){pM(l)&&mM(a)})}function pM(a){var l=a.getSnapshot;a=a.value;try{var h=l();return!Us(a,h)}catch{return!0}}function mM(a){var l=ll(a,2);l!==null&&Ss(l,a,2)}function Qx(a){var l=as();if(typeof a=="function"){var h=a;if(a=h(),yl){Ki(!0);try{h()}finally{Ki(!1)}}}return l.memoizedState=l.baseState=a,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hr,lastRenderedState:a},l}function gM(a,l,h,m){return a.baseState=h,Yx(a,Ut,typeof m=="function"?m:Hr)}function mV(a,l,h,m,b){if(Lp(a))throw Error(n(485));if(a=l.action,a!==null){var _={payload:b,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(E){_.listeners.push(E)}};F.T!==null?h(!0):_.isTransition=!1,m(_),h=l.pending,h===null?(_.next=l.pending=_,yM(l,_)):(_.next=h.next,l.pending=h.next=_)}}function yM(a,l){var h=l.action,m=l.payload,b=a.state;if(l.isTransition){var _=F.T,E={};F.T=E;try{var O=h(b,m),Q=F.S;Q!==null&&Q(E,O),xM(a,l,O)}catch(ce){Kx(a,l,ce)}finally{_!==null&&E.types!==null&&(_.types=E.types),F.T=_}}else try{_=h(b,m),xM(a,l,_)}catch(ce){Kx(a,l,ce)}}function xM(a,l,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(m){bM(a,l,m)},function(m){return Kx(a,l,m)}):bM(a,l,h)}function bM(a,l,h){l.status="fulfilled",l.value=h,_M(l),a.state=h,l=a.pending,l!==null&&(h=l.next,h===l?a.pending=null:(h=h.next,l.next=h,yM(a,h)))}function Kx(a,l,h){var m=a.pending;if(a.pending=null,m!==null){m=m.next;do l.status="rejected",l.reason=h,_M(l),l=l.next;while(l!==m)}a.action=null}function _M(a){a=a.listeners;for(var l=0;l<a.length;l++)(0,a[l])()}function vM(a,l){return l}function TM(a,l){if(xt){var h=kt.formState;if(h!==null){e:{var m=et;if(xt){if(qt){t:{for(var b=qt,_=ai;b.nodeType!==8;){if(!_){b=null;break t}if(b=li(b.nextSibling),b===null){b=null;break t}}_=b.data,b=_==="F!"||_==="F"?b:null}if(b){qt=li(b.nextSibling),m=b.data==="F!";break e}}qa(m)}m=!1}m&&(l=h[0])}}return h=as(),h.memoizedState=h.baseState=l,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:vM,lastRenderedState:l},h.queue=m,h=kM.bind(null,et,m),m.dispatch=h,m=Qx(!1),_=ib.bind(null,et,!1,m.queue),m=as(),b={state:l,dispatch:null,action:a,pending:null},m.queue=b,h=mV.bind(null,et,b,_,h),b.dispatch=h,m.memoizedState=a,[l,h,!1]}function SM(a){var l=cn();return wM(l,Ut,a)}function wM(a,l,h){if(l=Yx(a,l,vM)[0],a=Cp(Hr)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var m=Oh(l)}catch(E){throw E===Cu?_p:E}else m=l;l=cn();var b=l.queue,_=b.dispatch;return h!==l.memoizedState&&(et.flags|=2048,Ou(9,{destroy:void 0},gV.bind(null,b,h),null)),[m,_,a]}function gV(a,l){a.action=l}function MM(a){var l=cn(),h=Ut;if(h!==null)return wM(l,h,a);cn(),l=l.memoizedState,h=cn();var m=h.queue.dispatch;return h.memoizedState=a,[l,m,!1]}function Ou(a,l,h,m){return a={tag:a,create:h,deps:m,inst:l,next:null},l=et.updateQueue,l===null&&(l=Ep(),et.updateQueue=l),h=l.lastEffect,h===null?l.lastEffect=a.next=a:(m=h.next,h.next=a,a.next=m,l.lastEffect=a),a}function NM(){return cn().memoizedState}function Dp(a,l,h,m){var b=as();et.flags|=a,b.memoizedState=Ou(1|l,{destroy:void 0},h,m===void 0?null:m)}function Bp(a,l,h,m){var b=cn();m=m===void 0?null:m;var _=b.memoizedState.inst;Ut!==null&&m!==null&&$x(m,Ut.memoizedState.deps)?b.memoizedState=Ou(l,_,h,m):(et.flags|=a,b.memoizedState=Ou(1|l,_,h,m))}function AM(a,l){Dp(8390656,8,a,l)}function Jx(a,l){Bp(2048,8,a,l)}function yV(a){et.flags|=4;var l=et.updateQueue;if(l===null)l=Ep(),et.updateQueue=l,l.events=[a];else{var h=l.events;h===null?l.events=[a]:h.push(a)}}function EM(a){var l=cn().memoizedState;return yV({ref:l,nextImpl:a}),function(){if((wt&2)!==0)throw Error(n(440));return l.impl.apply(void 0,arguments)}}function RM(a,l){return Bp(4,2,a,l)}function CM(a,l){return Bp(4,4,a,l)}function DM(a,l){if(typeof l=="function"){a=a();var h=l(a);return function(){typeof h=="function"?h():l(null)}}if(l!=null)return a=a(),l.current=a,function(){l.current=null}}function BM(a,l,h){h=h!=null?h.concat([a]):null,Bp(4,4,DM.bind(null,l,a),h)}function eb(){}function LM(a,l){var h=cn();l=l===void 0?null:l;var m=h.memoizedState;return l!==null&&$x(l,m[1])?m[0]:(h.memoizedState=[a,l],a)}function FM(a,l){var h=cn();l=l===void 0?null:l;var m=h.memoizedState;if(l!==null&&$x(l,m[1]))return m[0];if(m=a(),yl){Ki(!0);try{a()}finally{Ki(!1)}}return h.memoizedState=[m,l],m}function tb(a,l,h){return h===void 0||($r&1073741824)!==0&&(ft&261930)===0?a.memoizedState=l:(a.memoizedState=h,a=ON(),et.lanes|=a,to|=a,h)}function OM(a,l,h,m){return Us(h,l)?h:Bu.current!==null?(a=tb(a,h,m),Us(a,l)||(xn=!0),a):($r&42)===0||($r&1073741824)!==0&&(ft&261930)===0?(xn=!0,a.memoizedState=h):(a=ON(),et.lanes|=a,to|=a,l)}function UM(a,l,h,m,b){var _=k.p;k.p=_!==0&&8>_?_:8;var E=F.T,O={};F.T=O,ib(a,!1,l,h);try{var Q=b(),ce=F.S;if(ce!==null&&ce(O,Q),Q!==null&&typeof Q=="object"&&typeof Q.then=="function"){var be=dV(Q,m);Uh(a,l,be,Gs(a))}else Uh(a,l,m,Gs(a))}catch(Te){Uh(a,l,{then:function(){},status:"rejected",reason:Te},Gs())}finally{k.p=_,E!==null&&O.types!==null&&(E.types=O.types),F.T=E}}function xV(){}function nb(a,l,h,m){if(a.tag!==5)throw Error(n(476));var b=zM(a).queue;UM(a,b,l,I,h===null?xV:function(){return VM(a),h(m)})}function zM(a){var l=a.memoizedState;if(l!==null)return l;l={memoizedState:I,baseState:I,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hr,lastRenderedState:I},next:null};var h={};return l.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hr,lastRenderedState:h},next:null},a.memoizedState=l,a=a.alternate,a!==null&&(a.memoizedState=l),l}function VM(a){var l=zM(a);l.next===null&&(l=a.alternate.memoizedState),Uh(a,l.next.queue,{},Gs())}function sb(){return Vn(Jh)}function PM(){return cn().memoizedState}function IM(){return cn().memoizedState}function bV(a){for(var l=a.return;l!==null;){switch(l.tag){case 24:case 3:var h=Gs();a=Ya(h);var m=Za(l,a,h);m!==null&&(Ss(m,l,h),Dh(m,l,h)),l={cache:Bx()},a.payload=l;return}l=l.return}}function _V(a,l,h){var m=Gs();h={lane:m,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},Lp(a)?GM(l,h):(h=vx(a,l,h,m),h!==null&&(Ss(h,a,m),$M(h,l,m)))}function kM(a,l,h){var m=Gs();Uh(a,l,h,m)}function Uh(a,l,h,m){var b={lane:m,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null};if(Lp(a))GM(l,b);else{var _=a.alternate;if(a.lanes===0&&(_===null||_.lanes===0)&&(_=l.lastRenderedReducer,_!==null))try{var E=l.lastRenderedState,O=_(E,h);if(b.hasEagerState=!0,b.eagerState=O,Us(O,E))return fp(a,l,b,0),kt===null&&dp(),!1}catch{}finally{}if(h=vx(a,l,b,m),h!==null)return Ss(h,a,m),$M(h,l,m),!0}return!1}function ib(a,l,h,m){if(m={lane:2,revertLane:Ub(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},Lp(a)){if(l)throw Error(n(479))}else l=vx(a,h,m,2),l!==null&&Ss(l,a,2)}function Lp(a){var l=a.alternate;return a===et||l!==null&&l===et}function GM(a,l){Lu=Np=!0;var h=a.pending;h===null?l.next=l:(l.next=h.next,h.next=l),a.pending=l}function $M(a,l,h){if((h&4194048)!==0){var m=l.lanes;m&=a.pendingLanes,h|=m,l.lanes=h,qf(a,h)}}var zh={readContext:Vn,use:Rp,useCallback:an,useContext:an,useEffect:an,useImperativeHandle:an,useLayoutEffect:an,useInsertionEffect:an,useMemo:an,useReducer:an,useRef:an,useState:an,useDebugValue:an,useDeferredValue:an,useTransition:an,useSyncExternalStore:an,useId:an,useHostTransitionStatus:an,useFormState:an,useActionState:an,useOptimistic:an,useMemoCache:an,useCacheRefresh:an};zh.useEffectEvent=an;var HM={readContext:Vn,use:Rp,useCallback:function(a,l){return as().memoizedState=[a,l===void 0?null:l],a},useContext:Vn,useEffect:AM,useImperativeHandle:function(a,l,h){h=h!=null?h.concat([a]):null,Dp(4194308,4,DM.bind(null,l,a),h)},useLayoutEffect:function(a,l){return Dp(4194308,4,a,l)},useInsertionEffect:function(a,l){Dp(4,2,a,l)},useMemo:function(a,l){var h=as();l=l===void 0?null:l;var m=a();if(yl){Ki(!0);try{a()}finally{Ki(!1)}}return h.memoizedState=[m,l],m},useReducer:function(a,l,h){var m=as();if(h!==void 0){var b=h(l);if(yl){Ki(!0);try{h(l)}finally{Ki(!1)}}}else b=l;return m.memoizedState=m.baseState=b,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:b},m.queue=a,a=a.dispatch=_V.bind(null,et,a),[m.memoizedState,a]},useRef:function(a){var l=as();return a={current:a},l.memoizedState=a},useState:function(a){a=Qx(a);var l=a.queue,h=kM.bind(null,et,l);return l.dispatch=h,[a.memoizedState,h]},useDebugValue:eb,useDeferredValue:function(a,l){var h=as();return tb(h,a,l)},useTransition:function(){var a=Qx(!1);return a=UM.bind(null,et,a.queue,!0,!1),as().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,l,h){var m=et,b=as();if(xt){if(h===void 0)throw Error(n(407));h=h()}else{if(h=l(),kt===null)throw Error(n(349));(ft&127)!==0||hM(m,l,h)}b.memoizedState=h;var _={value:h,getSnapshot:l};return b.queue=_,AM(fM.bind(null,m,_,a),[a]),m.flags|=2048,Ou(9,{destroy:void 0},dM.bind(null,m,_,h,l),null),h},useId:function(){var a=as(),l=kt.identifierPrefix;if(xt){var h=tr,m=er;h=(m&~(1<<32-rs(m)-1)).toString(32)+h,l="_"+l+"R_"+h,h=Ap++,0<h&&(l+="H"+h.toString(32)),l+="_"}else h=fV++,l="_"+l+"r_"+h.toString(32)+"_";return a.memoizedState=l},useHostTransitionStatus:sb,useFormState:TM,useActionState:TM,useOptimistic:function(a){var l=as();l.memoizedState=l.baseState=a;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=h,l=ib.bind(null,et,!0,h),h.dispatch=l,[a,l]},useMemoCache:Xx,useCacheRefresh:function(){return as().memoizedState=bV.bind(null,et)},useEffectEvent:function(a){var l=as(),h={impl:a};return l.memoizedState=h,function(){if((wt&2)!==0)throw Error(n(440));return h.impl.apply(void 0,arguments)}}},rb={readContext:Vn,use:Rp,useCallback:LM,useContext:Vn,useEffect:Jx,useImperativeHandle:BM,useInsertionEffect:RM,useLayoutEffect:CM,useMemo:FM,useReducer:Cp,useRef:NM,useState:function(){return Cp(Hr)},useDebugValue:eb,useDeferredValue:function(a,l){var h=cn();return OM(h,Ut.memoizedState,a,l)},useTransition:function(){var a=Cp(Hr)[0],l=cn().memoizedState;return[typeof a=="boolean"?a:Oh(a),l]},useSyncExternalStore:cM,useId:PM,useHostTransitionStatus:sb,useFormState:SM,useActionState:SM,useOptimistic:function(a,l){var h=cn();return gM(h,Ut,a,l)},useMemoCache:Xx,useCacheRefresh:IM};rb.useEffectEvent=EM;var jM={readContext:Vn,use:Rp,useCallback:LM,useContext:Vn,useEffect:Jx,useImperativeHandle:BM,useInsertionEffect:RM,useLayoutEffect:CM,useMemo:FM,useReducer:Zx,useRef:NM,useState:function(){return Zx(Hr)},useDebugValue:eb,useDeferredValue:function(a,l){var h=cn();return Ut===null?tb(h,a,l):OM(h,Ut.memoizedState,a,l)},useTransition:function(){var a=Zx(Hr)[0],l=cn().memoizedState;return[typeof a=="boolean"?a:Oh(a),l]},useSyncExternalStore:cM,useId:PM,useHostTransitionStatus:sb,useFormState:MM,useActionState:MM,useOptimistic:function(a,l){var h=cn();return Ut!==null?gM(h,Ut,a,l):(h.baseState=a,[a,h.queue.dispatch])},useMemoCache:Xx,useCacheRefresh:IM};jM.useEffectEvent=EM;function ab(a,l,h,m){l=a.memoizedState,h=h(m,l),h=h==null?l:p({},l,h),a.memoizedState=h,a.lanes===0&&(a.updateQueue.baseState=h)}var ob={enqueueSetState:function(a,l,h){a=a._reactInternals;var m=Gs(),b=Ya(m);b.payload=l,h!=null&&(b.callback=h),l=Za(a,b,m),l!==null&&(Ss(l,a,m),Dh(l,a,m))},enqueueReplaceState:function(a,l,h){a=a._reactInternals;var m=Gs(),b=Ya(m);b.tag=1,b.payload=l,h!=null&&(b.callback=h),l=Za(a,b,m),l!==null&&(Ss(l,a,m),Dh(l,a,m))},enqueueForceUpdate:function(a,l){a=a._reactInternals;var h=Gs(),m=Ya(h);m.tag=2,l!=null&&(m.callback=l),l=Za(a,m,h),l!==null&&(Ss(l,a,h),Dh(l,a,h))}};function qM(a,l,h,m,b,_,E){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(m,_,E):l.prototype&&l.prototype.isPureReactComponent?!Sh(h,m)||!Sh(b,_):!0}function WM(a,l,h,m){a=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(h,m),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(h,m),l.state!==a&&ob.enqueueReplaceState(l,l.state,null)}function xl(a,l){var h=l;if("ref"in l){h={};for(var m in l)m!=="ref"&&(h[m]=l[m])}if(a=a.defaultProps){h===l&&(h=p({},h));for(var b in a)h[b]===void 0&&(h[b]=a[b])}return h}function XM(a){hp(a)}function YM(a){console.error(a)}function ZM(a){hp(a)}function Fp(a,l){try{var h=a.onUncaughtError;h(l.value,{componentStack:l.stack})}catch(m){setTimeout(function(){throw m})}}function QM(a,l,h){try{var m=a.onCaughtError;m(h.value,{componentStack:h.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function lb(a,l,h){return h=Ya(h),h.tag=3,h.payload={element:null},h.callback=function(){Fp(a,l)},h}function KM(a){return a=Ya(a),a.tag=3,a}function JM(a,l,h,m){var b=h.type.getDerivedStateFromError;if(typeof b=="function"){var _=m.value;a.payload=function(){return b(_)},a.callback=function(){QM(l,h,m)}}var E=h.stateNode;E!==null&&typeof E.componentDidCatch=="function"&&(a.callback=function(){QM(l,h,m),typeof b!="function"&&(no===null?no=new Set([this]):no.add(this));var O=m.stack;this.componentDidCatch(m.value,{componentStack:O!==null?O:""})})}function vV(a,l,h,m,b){if(h.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(l=h.alternate,l!==null&&Au(l,h,b,!0),h=Vs.current,h!==null){switch(h.tag){case 31:case 13:return oi===null?qp():h.alternate===null&&on===0&&(on=3),h.flags&=-257,h.flags|=65536,h.lanes=b,m===vp?h.flags|=16384:(l=h.updateQueue,l===null?h.updateQueue=new Set([m]):l.add(m),Lb(a,m,b)),!1;case 22:return h.flags|=65536,m===vp?h.flags|=16384:(l=h.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([m])},h.updateQueue=l):(h=l.retryQueue,h===null?l.retryQueue=new Set([m]):h.add(m)),Lb(a,m,b)),!1}throw Error(n(435,h.tag))}return Lb(a,m,b),qp(),!1}if(xt)return l=Vs.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=b,m!==Ax&&(a=Error(n(422),{cause:m}),Nh(si(a,h)))):(m!==Ax&&(l=Error(n(423),{cause:m}),Nh(si(l,h))),a=a.current.alternate,a.flags|=65536,b&=-b,a.lanes|=b,m=si(m,h),b=lb(a.stateNode,m,b),Vx(a,b),on!==4&&(on=2)),!1;var _=Error(n(520),{cause:m});if(_=si(_,h),jh===null?jh=[_]:jh.push(_),on!==4&&(on=2),l===null)return!0;m=si(m,h),h=l;do{switch(h.tag){case 3:return h.flags|=65536,a=b&-b,h.lanes|=a,a=lb(h.stateNode,m,a),Vx(h,a),!1;case 1:if(l=h.type,_=h.stateNode,(h.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(no===null||!no.has(_))))return h.flags|=65536,b&=-b,h.lanes|=b,b=KM(b),JM(b,a,h,m),Vx(h,b),!1}h=h.return}while(h!==null);return!1}var ub=Error(n(461)),xn=!1;function Pn(a,l,h,m){l.child=a===null?sM(l,null,h,m):gl(l,a.child,h,m)}function eN(a,l,h,m,b){h=h.render;var _=l.ref;if("ref"in m){var E={};for(var O in m)O!=="ref"&&(E[O]=m[O])}else E=m;return dl(l),m=Hx(a,l,h,E,_,b),O=jx(),a!==null&&!xn?(qx(a,l,b),jr(a,l,b)):(xt&&O&&Mx(l),l.flags|=1,Pn(a,l,m,b),l.child)}function tN(a,l,h,m,b){if(a===null){var _=h.type;return typeof _=="function"&&!Tx(_)&&_.defaultProps===void 0&&h.compare===null?(l.tag=15,l.type=_,nN(a,l,_,m,b)):(a=mp(h.type,null,m,l,l.mode,b),a.ref=l.ref,a.return=l,l.child=a)}if(_=a.child,!yb(a,b)){var E=_.memoizedProps;if(h=h.compare,h=h!==null?h:Sh,h(E,m)&&a.ref===l.ref)return jr(a,l,b)}return l.flags|=1,a=Pr(_,m),a.ref=l.ref,a.return=l,l.child=a}function nN(a,l,h,m,b){if(a!==null){var _=a.memoizedProps;if(Sh(_,m)&&a.ref===l.ref)if(xn=!1,l.pendingProps=m=_,yb(a,b))(a.flags&131072)!==0&&(xn=!0);else return l.lanes=a.lanes,jr(a,l,b)}return cb(a,l,h,m,b)}function sN(a,l,h,m){var b=m.children,_=a!==null?a.memoizedState:null;if(a===null&&l.stateNode===null&&(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((l.flags&128)!==0){if(_=_!==null?_.baseLanes|h:h,a!==null){for(m=l.child=a.child,b=0;m!==null;)b=b|m.lanes|m.childLanes,m=m.sibling;m=b&~_}else m=0,l.child=null;return iN(a,l,_,h,m)}if((h&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},a!==null&&bp(l,_!==null?_.cachePool:null),_!==null?aM(l,_):Ix(),oM(l);else return m=l.lanes=536870912,iN(a,l,_!==null?_.baseLanes|h:h,h,m)}else _!==null?(bp(l,_.cachePool),aM(l,_),Ka(),l.memoizedState=null):(a!==null&&bp(l,null),Ix(),Ka());return Pn(a,l,b,h),l.child}function Vh(a,l){return a!==null&&a.tag===22||l.stateNode!==null||(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.sibling}function iN(a,l,h,m,b){var _=Fx();return _=_===null?null:{parent:gn._currentValue,pool:_},l.memoizedState={baseLanes:h,cachePool:_},a!==null&&bp(l,null),Ix(),oM(l),a!==null&&Au(a,l,m,!0),l.childLanes=b,null}function Op(a,l){return l=zp({mode:l.mode,children:l.children},a.mode),l.ref=a.ref,a.child=l,l.return=a,l}function rN(a,l,h){return gl(l,a.child,null,h),a=Op(l,l.pendingProps),a.flags|=2,Ps(l),l.memoizedState=null,a}function TV(a,l,h){var m=l.pendingProps,b=(l.flags&128)!==0;if(l.flags&=-129,a===null){if(xt){if(m.mode==="hidden")return a=Op(l,m),l.lanes=536870912,Vh(null,a);if(Gx(l),(a=qt)?(a=yA(a,ai),a=a!==null&&a.data==="&"?a:null,a!==null&&(l.memoizedState={dehydrated:a,treeContext:Ha!==null?{id:er,overflow:tr}:null,retryLane:536870912,hydrationErrors:null},h=Gw(a),h.return=l,l.child=h,zn=l,qt=null)):a=null,a===null)throw qa(l);return l.lanes=536870912,null}return Op(l,m)}var _=a.memoizedState;if(_!==null){var E=_.dehydrated;if(Gx(l),b)if(l.flags&256)l.flags&=-257,l=rN(a,l,h);else if(l.memoizedState!==null)l.child=a.child,l.flags|=128,l=null;else throw Error(n(558));else if(xn||Au(a,l,h,!1),b=(h&a.childLanes)!==0,xn||b){if(m=kt,m!==null&&(E=Wf(m,h),E!==0&&E!==_.retryLane))throw _.retryLane=E,ll(a,E),Ss(m,a,E),ub;qp(),l=rN(a,l,h)}else a=_.treeContext,qt=li(E.nextSibling),zn=l,xt=!0,ja=null,ai=!1,a!==null&&jw(l,a),l=Op(l,m),l.flags|=4096;return l}return a=Pr(a.child,{mode:m.mode,children:m.children}),a.ref=l.ref,l.child=a,a.return=l,a}function Up(a,l){var h=l.ref;if(h===null)a!==null&&a.ref!==null&&(l.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(n(284));(a===null||a.ref!==h)&&(l.flags|=4194816)}}function cb(a,l,h,m,b){return dl(l),h=Hx(a,l,h,m,void 0,b),m=jx(),a!==null&&!xn?(qx(a,l,b),jr(a,l,b)):(xt&&m&&Mx(l),l.flags|=1,Pn(a,l,h,b),l.child)}function aN(a,l,h,m,b,_){return dl(l),l.updateQueue=null,h=uM(l,m,h,b),lM(a),m=jx(),a!==null&&!xn?(qx(a,l,_),jr(a,l,_)):(xt&&m&&Mx(l),l.flags|=1,Pn(a,l,h,_),l.child)}function oN(a,l,h,m,b){if(dl(l),l.stateNode===null){var _=Su,E=h.contextType;typeof E=="object"&&E!==null&&(_=Vn(E)),_=new h(m,_),l.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=ob,l.stateNode=_,_._reactInternals=l,_=l.stateNode,_.props=m,_.state=l.memoizedState,_.refs={},Ux(l),E=h.contextType,_.context=typeof E=="object"&&E!==null?Vn(E):Su,_.state=l.memoizedState,E=h.getDerivedStateFromProps,typeof E=="function"&&(ab(l,h,E,m),_.state=l.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(E=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),E!==_.state&&ob.enqueueReplaceState(_,_.state,null),Lh(l,m,_,b),Bh(),_.state=l.memoizedState),typeof _.componentDidMount=="function"&&(l.flags|=4194308),m=!0}else if(a===null){_=l.stateNode;var O=l.memoizedProps,Q=xl(h,O);_.props=Q;var ce=_.context,be=h.contextType;E=Su,typeof be=="object"&&be!==null&&(E=Vn(be));var Te=h.getDerivedStateFromProps;be=typeof Te=="function"||typeof _.getSnapshotBeforeUpdate=="function",O=l.pendingProps!==O,be||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(O||ce!==E)&&WM(l,_,m,E),Xa=!1;var de=l.memoizedState;_.state=de,Lh(l,m,_,b),Bh(),ce=l.memoizedState,O||de!==ce||Xa?(typeof Te=="function"&&(ab(l,h,Te,m),ce=l.memoizedState),(Q=Xa||qM(l,h,Q,m,de,ce,E))?(be||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(l.flags|=4194308)):(typeof _.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=m,l.memoizedState=ce),_.props=m,_.state=ce,_.context=E,m=Q):(typeof _.componentDidMount=="function"&&(l.flags|=4194308),m=!1)}else{_=l.stateNode,zx(a,l),E=l.memoizedProps,be=xl(h,E),_.props=be,Te=l.pendingProps,de=_.context,ce=h.contextType,Q=Su,typeof ce=="object"&&ce!==null&&(Q=Vn(ce)),O=h.getDerivedStateFromProps,(ce=typeof O=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(E!==Te||de!==Q)&&WM(l,_,m,Q),Xa=!1,de=l.memoizedState,_.state=de,Lh(l,m,_,b),Bh();var ge=l.memoizedState;E!==Te||de!==ge||Xa||a!==null&&a.dependencies!==null&&yp(a.dependencies)?(typeof O=="function"&&(ab(l,h,O,m),ge=l.memoizedState),(be=Xa||qM(l,h,be,m,de,ge,Q)||a!==null&&a.dependencies!==null&&yp(a.dependencies))?(ce||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(m,ge,Q),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(m,ge,Q)),typeof _.componentDidUpdate=="function"&&(l.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof _.componentDidUpdate!="function"||E===a.memoizedProps&&de===a.memoizedState||(l.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||E===a.memoizedProps&&de===a.memoizedState||(l.flags|=1024),l.memoizedProps=m,l.memoizedState=ge),_.props=m,_.state=ge,_.context=Q,m=be):(typeof _.componentDidUpdate!="function"||E===a.memoizedProps&&de===a.memoizedState||(l.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||E===a.memoizedProps&&de===a.memoizedState||(l.flags|=1024),m=!1)}return _=m,Up(a,l),m=(l.flags&128)!==0,_||m?(_=l.stateNode,h=m&&typeof h.getDerivedStateFromError!="function"?null:_.render(),l.flags|=1,a!==null&&m?(l.child=gl(l,a.child,null,b),l.child=gl(l,null,h,b)):Pn(a,l,h,b),l.memoizedState=_.state,a=l.child):a=jr(a,l,b),a}function lN(a,l,h,m){return cl(),l.flags|=256,Pn(a,l,h,m),l.child}var hb={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function db(a){return{baseLanes:a,cachePool:Qw()}}function fb(a,l,h){return a=a!==null?a.childLanes&~h:0,l&&(a|=ks),a}function uN(a,l,h){var m=l.pendingProps,b=!1,_=(l.flags&128)!==0,E;if((E=_)||(E=a!==null&&a.memoizedState===null?!1:(un.current&2)!==0),E&&(b=!0,l.flags&=-129),E=(l.flags&32)!==0,l.flags&=-33,a===null){if(xt){if(b?Qa(l):Ka(),(a=qt)?(a=yA(a,ai),a=a!==null&&a.data!=="&"?a:null,a!==null&&(l.memoizedState={dehydrated:a,treeContext:Ha!==null?{id:er,overflow:tr}:null,retryLane:536870912,hydrationErrors:null},h=Gw(a),h.return=l,l.child=h,zn=l,qt=null)):a=null,a===null)throw qa(l);return Yb(a)?l.lanes=32:l.lanes=536870912,null}var O=m.children;return m=m.fallback,b?(Ka(),b=l.mode,O=zp({mode:"hidden",children:O},b),m=ul(m,b,h,null),O.return=l,m.return=l,O.sibling=m,l.child=O,m=l.child,m.memoizedState=db(h),m.childLanes=fb(a,E,h),l.memoizedState=hb,Vh(null,m)):(Qa(l),pb(l,O))}var Q=a.memoizedState;if(Q!==null&&(O=Q.dehydrated,O!==null)){if(_)l.flags&256?(Qa(l),l.flags&=-257,l=mb(a,l,h)):l.memoizedState!==null?(Ka(),l.child=a.child,l.flags|=128,l=null):(Ka(),O=m.fallback,b=l.mode,m=zp({mode:"visible",children:m.children},b),O=ul(O,b,h,null),O.flags|=2,m.return=l,O.return=l,m.sibling=O,l.child=m,gl(l,a.child,null,h),m=l.child,m.memoizedState=db(h),m.childLanes=fb(a,E,h),l.memoizedState=hb,l=Vh(null,m));else if(Qa(l),Yb(O)){if(E=O.nextSibling&&O.nextSibling.dataset,E)var ce=E.dgst;E=ce,m=Error(n(419)),m.stack="",m.digest=E,Nh({value:m,source:null,stack:null}),l=mb(a,l,h)}else if(xn||Au(a,l,h,!1),E=(h&a.childLanes)!==0,xn||E){if(E=kt,E!==null&&(m=Wf(E,h),m!==0&&m!==Q.retryLane))throw Q.retryLane=m,ll(a,m),Ss(E,a,m),ub;Xb(O)||qp(),l=mb(a,l,h)}else Xb(O)?(l.flags|=192,l.child=a.child,l=null):(a=Q.treeContext,qt=li(O.nextSibling),zn=l,xt=!0,ja=null,ai=!1,a!==null&&jw(l,a),l=pb(l,m.children),l.flags|=4096);return l}return b?(Ka(),O=m.fallback,b=l.mode,Q=a.child,ce=Q.sibling,m=Pr(Q,{mode:"hidden",children:m.children}),m.subtreeFlags=Q.subtreeFlags&65011712,ce!==null?O=Pr(ce,O):(O=ul(O,b,h,null),O.flags|=2),O.return=l,m.return=l,m.sibling=O,l.child=m,Vh(null,m),m=l.child,O=a.child.memoizedState,O===null?O=db(h):(b=O.cachePool,b!==null?(Q=gn._currentValue,b=b.parent!==Q?{parent:Q,pool:Q}:b):b=Qw(),O={baseLanes:O.baseLanes|h,cachePool:b}),m.memoizedState=O,m.childLanes=fb(a,E,h),l.memoizedState=hb,Vh(a.child,m)):(Qa(l),h=a.child,a=h.sibling,h=Pr(h,{mode:"visible",children:m.children}),h.return=l,h.sibling=null,a!==null&&(E=l.deletions,E===null?(l.deletions=[a],l.flags|=16):E.push(a)),l.child=h,l.memoizedState=null,h)}function pb(a,l){return l=zp({mode:"visible",children:l},a.mode),l.return=a,a.child=l}function zp(a,l){return a=zs(22,a,null,l),a.lanes=0,a}function mb(a,l,h){return gl(l,a.child,null,h),a=pb(l,l.pendingProps.children),a.flags|=2,l.memoizedState=null,a}function cN(a,l,h){a.lanes|=l;var m=a.alternate;m!==null&&(m.lanes|=l),Cx(a.return,l,h)}function gb(a,l,h,m,b,_){var E=a.memoizedState;E===null?a.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:m,tail:h,tailMode:b,treeForkCount:_}:(E.isBackwards=l,E.rendering=null,E.renderingStartTime=0,E.last=m,E.tail=h,E.tailMode=b,E.treeForkCount=_)}function hN(a,l,h){var m=l.pendingProps,b=m.revealOrder,_=m.tail;m=m.children;var E=un.current,O=(E&2)!==0;if(O?(E=E&1|2,l.flags|=128):E&=1,he(un,E),Pn(a,l,m,h),m=xt?Mh:0,!O&&a!==null&&(a.flags&128)!==0)e:for(a=l.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&cN(a,h,l);else if(a.tag===19)cN(a,h,l);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(b){case"forwards":for(h=l.child,b=null;h!==null;)a=h.alternate,a!==null&&Mp(a)===null&&(b=h),h=h.sibling;h=b,h===null?(b=l.child,l.child=null):(b=h.sibling,h.sibling=null),gb(l,!1,b,h,_,m);break;case"backwards":case"unstable_legacy-backwards":for(h=null,b=l.child,l.child=null;b!==null;){if(a=b.alternate,a!==null&&Mp(a)===null){l.child=b;break}a=b.sibling,b.sibling=h,h=b,b=a}gb(l,!0,h,null,_,m);break;case"together":gb(l,!1,null,null,void 0,m);break;default:l.memoizedState=null}return l.child}function jr(a,l,h){if(a!==null&&(l.dependencies=a.dependencies),to|=l.lanes,(h&l.childLanes)===0)if(a!==null){if(Au(a,l,h,!1),(h&l.childLanes)===0)return null}else return null;if(a!==null&&l.child!==a.child)throw Error(n(153));if(l.child!==null){for(a=l.child,h=Pr(a,a.pendingProps),l.child=h,h.return=l;a.sibling!==null;)a=a.sibling,h=h.sibling=Pr(a,a.pendingProps),h.return=l;h.sibling=null}return l.child}function yb(a,l){return(a.lanes&l)!==0?!0:(a=a.dependencies,!!(a!==null&&yp(a)))}function SV(a,l,h){switch(l.tag){case 3:xe(l,l.stateNode.containerInfo),Wa(l,gn,a.memoizedState.cache),cl();break;case 27:case 5:Fe(l);break;case 4:xe(l,l.stateNode.containerInfo);break;case 10:Wa(l,l.type,l.memoizedProps.value);break;case 31:if(l.memoizedState!==null)return l.flags|=128,Gx(l),null;break;case 13:var m=l.memoizedState;if(m!==null)return m.dehydrated!==null?(Qa(l),l.flags|=128,null):(h&l.child.childLanes)!==0?uN(a,l,h):(Qa(l),a=jr(a,l,h),a!==null?a.sibling:null);Qa(l);break;case 19:var b=(a.flags&128)!==0;if(m=(h&l.childLanes)!==0,m||(Au(a,l,h,!1),m=(h&l.childLanes)!==0),b){if(m)return hN(a,l,h);l.flags|=128}if(b=l.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),he(un,un.current),m)break;return null;case 22:return l.lanes=0,sN(a,l,h,l.pendingProps);case 24:Wa(l,gn,a.memoizedState.cache)}return jr(a,l,h)}function dN(a,l,h){if(a!==null)if(a.memoizedProps!==l.pendingProps)xn=!0;else{if(!yb(a,h)&&(l.flags&128)===0)return xn=!1,SV(a,l,h);xn=(a.flags&131072)!==0}else xn=!1,xt&&(l.flags&1048576)!==0&&Hw(l,Mh,l.index);switch(l.lanes=0,l.tag){case 16:e:{var m=l.pendingProps;if(a=pl(l.elementType),l.type=a,typeof a=="function")Tx(a)?(m=xl(a,m),l.tag=1,l=oN(null,l,a,m,h)):(l.tag=0,l=cb(null,l,a,m,h));else{if(a!=null){var b=a.$$typeof;if(b===A){l.tag=11,l=eN(null,l,a,m,h);break e}else if(b===R){l.tag=14,l=tN(null,l,a,m,h);break e}}throw l=P(a)||a,Error(n(306,l,""))}}return l;case 0:return cb(a,l,l.type,l.pendingProps,h);case 1:return m=l.type,b=xl(m,l.pendingProps),oN(a,l,m,b,h);case 3:e:{if(xe(l,l.stateNode.containerInfo),a===null)throw Error(n(387));m=l.pendingProps;var _=l.memoizedState;b=_.element,zx(a,l),Lh(l,m,null,h);var E=l.memoizedState;if(m=E.cache,Wa(l,gn,m),m!==_.cache&&Dx(l,[gn],h,!0),Bh(),m=E.element,_.isDehydrated)if(_={element:m,isDehydrated:!1,cache:E.cache},l.updateQueue.baseState=_,l.memoizedState=_,l.flags&256){l=lN(a,l,m,h);break e}else if(m!==b){b=si(Error(n(424)),l),Nh(b),l=lN(a,l,m,h);break e}else{switch(a=l.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(qt=li(a.firstChild),zn=l,xt=!0,ja=null,ai=!0,h=sM(l,null,m,h),l.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling}else{if(cl(),m===b){l=jr(a,l,h);break e}Pn(a,l,m,h)}l=l.child}return l;case 26:return Up(a,l),a===null?(h=SA(l.type,null,l.pendingProps,null))?l.memoizedState=h:xt||(h=l.type,a=l.pendingProps,m=Jp(le.current).createElement(h),m[Nn]=l,m[Xn]=a,In(m,h,a),mn(m),l.stateNode=m):l.memoizedState=SA(l.type,a.memoizedProps,l.pendingProps,a.memoizedState),null;case 27:return Fe(l),a===null&&xt&&(m=l.stateNode=_A(l.type,l.pendingProps,le.current),zn=l,ai=!0,b=qt,ao(l.type)?(Zb=b,qt=li(m.firstChild)):qt=b),Pn(a,l,l.pendingProps.children,h),Up(a,l),a===null&&(l.flags|=4194304),l.child;case 5:return a===null&&xt&&((b=m=qt)&&(m=JV(m,l.type,l.pendingProps,ai),m!==null?(l.stateNode=m,zn=l,qt=li(m.firstChild),ai=!1,b=!0):b=!1),b||qa(l)),Fe(l),b=l.type,_=l.pendingProps,E=a!==null?a.memoizedProps:null,m=_.children,jb(b,_)?m=null:E!==null&&jb(b,E)&&(l.flags|=32),l.memoizedState!==null&&(b=Hx(a,l,pV,null,null,h),Jh._currentValue=b),Up(a,l),Pn(a,l,m,h),l.child;case 6:return a===null&&xt&&((a=h=qt)&&(h=eP(h,l.pendingProps,ai),h!==null?(l.stateNode=h,zn=l,qt=null,a=!0):a=!1),a||qa(l)),null;case 13:return uN(a,l,h);case 4:return xe(l,l.stateNode.containerInfo),m=l.pendingProps,a===null?l.child=gl(l,null,m,h):Pn(a,l,m,h),l.child;case 11:return eN(a,l,l.type,l.pendingProps,h);case 7:return Pn(a,l,l.pendingProps,h),l.child;case 8:return Pn(a,l,l.pendingProps.children,h),l.child;case 12:return Pn(a,l,l.pendingProps.children,h),l.child;case 10:return m=l.pendingProps,Wa(l,l.type,m.value),Pn(a,l,m.children,h),l.child;case 9:return b=l.type._context,m=l.pendingProps.children,dl(l),b=Vn(b),m=m(b),l.flags|=1,Pn(a,l,m,h),l.child;case 14:return tN(a,l,l.type,l.pendingProps,h);case 15:return nN(a,l,l.type,l.pendingProps,h);case 19:return hN(a,l,h);case 31:return TV(a,l,h);case 22:return sN(a,l,h,l.pendingProps);case 24:return dl(l),m=Vn(gn),a===null?(b=Fx(),b===null&&(b=kt,_=Bx(),b.pooledCache=_,_.refCount++,_!==null&&(b.pooledCacheLanes|=h),b=_),l.memoizedState={parent:m,cache:b},Ux(l),Wa(l,gn,b)):((a.lanes&h)!==0&&(zx(a,l),Lh(l,null,null,h),Bh()),b=a.memoizedState,_=l.memoizedState,b.parent!==m?(b={parent:m,cache:m},l.memoizedState=b,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=b),Wa(l,gn,m)):(m=_.cache,Wa(l,gn,m),m!==b.cache&&Dx(l,[gn],h,!0))),Pn(a,l,l.pendingProps.children,h),l.child;case 29:throw l.pendingProps}throw Error(n(156,l.tag))}function qr(a){a.flags|=4}function xb(a,l,h,m,b){if((l=(a.mode&32)!==0)&&(l=!1),l){if(a.flags|=16777216,(b&335544128)===b)if(a.stateNode.complete)a.flags|=8192;else if(PN())a.flags|=8192;else throw ml=vp,Ox}else a.flags&=-16777217}function fN(a,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!EA(l))if(PN())a.flags|=8192;else throw ml=vp,Ox}function Vp(a,l){l!==null&&(a.flags|=4),a.flags&16384&&(l=a.tag!==22?Hf():536870912,a.lanes|=l,Pu|=l)}function Ph(a,l){if(!xt)switch(a.tailMode){case"hidden":l=a.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?a.tail=null:h.sibling=null;break;case"collapsed":h=a.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?l||a.tail===null?a.tail=null:a.tail.sibling=null:m.sibling=null}}function Wt(a){var l=a.alternate!==null&&a.alternate.child===a.child,h=0,m=0;if(l)for(var b=a.child;b!==null;)h|=b.lanes|b.childLanes,m|=b.subtreeFlags&65011712,m|=b.flags&65011712,b.return=a,b=b.sibling;else for(b=a.child;b!==null;)h|=b.lanes|b.childLanes,m|=b.subtreeFlags,m|=b.flags,b.return=a,b=b.sibling;return a.subtreeFlags|=m,a.childLanes=h,l}function wV(a,l,h){var m=l.pendingProps;switch(Nx(l),l.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wt(l),null;case 1:return Wt(l),null;case 3:return h=l.stateNode,m=null,a!==null&&(m=a.memoizedState.cache),l.memoizedState.cache!==m&&(l.flags|=2048),Gr(gn),Me(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(a===null||a.child===null)&&(Nu(l)?qr(l):a===null||a.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,Ex())),Wt(l),null;case 26:var b=l.type,_=l.memoizedState;return a===null?(qr(l),_!==null?(Wt(l),fN(l,_)):(Wt(l),xb(l,b,null,m,h))):_?_!==a.memoizedState?(qr(l),Wt(l),fN(l,_)):(Wt(l),l.flags&=-16777217):(a=a.memoizedProps,a!==m&&qr(l),Wt(l),xb(l,b,a,m,h)),null;case 27:if(De(l),h=le.current,b=l.type,a!==null&&l.stateNode!=null)a.memoizedProps!==m&&qr(l);else{if(!m){if(l.stateNode===null)throw Error(n(166));return Wt(l),null}a=fe.current,Nu(l)?qw(l):(a=_A(b,m,h),l.stateNode=a,qr(l))}return Wt(l),null;case 5:if(De(l),b=l.type,a!==null&&l.stateNode!=null)a.memoizedProps!==m&&qr(l);else{if(!m){if(l.stateNode===null)throw Error(n(166));return Wt(l),null}if(_=fe.current,Nu(l))qw(l);else{var E=Jp(le.current);switch(_){case 1:_=E.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:_=E.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":_=E.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":_=E.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":_=E.createElement("div"),_.innerHTML="<script><\/script>",_=_.removeChild(_.firstChild);break;case"select":_=typeof m.is=="string"?E.createElement("select",{is:m.is}):E.createElement("select"),m.multiple?_.multiple=!0:m.size&&(_.size=m.size);break;default:_=typeof m.is=="string"?E.createElement(b,{is:m.is}):E.createElement(b)}}_[Nn]=l,_[Xn]=m;e:for(E=l.child;E!==null;){if(E.tag===5||E.tag===6)_.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===l)break e;for(;E.sibling===null;){if(E.return===null||E.return===l)break e;E=E.return}E.sibling.return=E.return,E=E.sibling}l.stateNode=_;e:switch(In(_,b,m),b){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&qr(l)}}return Wt(l),xb(l,l.type,a===null?null:a.memoizedProps,l.pendingProps,h),null;case 6:if(a&&l.stateNode!=null)a.memoizedProps!==m&&qr(l);else{if(typeof m!="string"&&l.stateNode===null)throw Error(n(166));if(a=le.current,Nu(l)){if(a=l.stateNode,h=l.memoizedProps,m=null,b=zn,b!==null)switch(b.tag){case 27:case 5:m=b.memoizedProps}a[Nn]=l,a=!!(a.nodeValue===h||m!==null&&m.suppressHydrationWarning===!0||uA(a.nodeValue,h)),a||qa(l,!0)}else a=Jp(a).createTextNode(m),a[Nn]=l,l.stateNode=a}return Wt(l),null;case 31:if(h=l.memoizedState,a===null||a.memoizedState!==null){if(m=Nu(l),h!==null){if(a===null){if(!m)throw Error(n(318));if(a=l.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(557));a[Nn]=l}else cl(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Wt(l),a=!1}else h=Ex(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=h),a=!0;if(!a)return l.flags&256?(Ps(l),l):(Ps(l),null);if((l.flags&128)!==0)throw Error(n(558))}return Wt(l),null;case 13:if(m=l.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(b=Nu(l),m!==null&&m.dehydrated!==null){if(a===null){if(!b)throw Error(n(318));if(b=l.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(n(317));b[Nn]=l}else cl(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Wt(l),b=!1}else b=Ex(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=b),b=!0;if(!b)return l.flags&256?(Ps(l),l):(Ps(l),null)}return Ps(l),(l.flags&128)!==0?(l.lanes=h,l):(h=m!==null,a=a!==null&&a.memoizedState!==null,h&&(m=l.child,b=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(b=m.alternate.memoizedState.cachePool.pool),_=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(_=m.memoizedState.cachePool.pool),_!==b&&(m.flags|=2048)),h!==a&&h&&(l.child.flags|=8192),Vp(l,l.updateQueue),Wt(l),null);case 4:return Me(),a===null&&Ib(l.stateNode.containerInfo),Wt(l),null;case 10:return Gr(l.type),Wt(l),null;case 19:if(q(un),m=l.memoizedState,m===null)return Wt(l),null;if(b=(l.flags&128)!==0,_=m.rendering,_===null)if(b)Ph(m,!1);else{if(on!==0||a!==null&&(a.flags&128)!==0)for(a=l.child;a!==null;){if(_=Mp(a),_!==null){for(l.flags|=128,Ph(m,!1),a=_.updateQueue,l.updateQueue=a,Vp(l,a),l.subtreeFlags=0,a=h,h=l.child;h!==null;)kw(h,a),h=h.sibling;return he(un,un.current&1|2),xt&&Ir(l,m.treeForkCount),l.child}a=a.sibling}m.tail!==null&&Un()>$p&&(l.flags|=128,b=!0,Ph(m,!1),l.lanes=4194304)}else{if(!b)if(a=Mp(_),a!==null){if(l.flags|=128,b=!0,a=a.updateQueue,l.updateQueue=a,Vp(l,a),Ph(m,!0),m.tail===null&&m.tailMode==="hidden"&&!_.alternate&&!xt)return Wt(l),null}else 2*Un()-m.renderingStartTime>$p&&h!==536870912&&(l.flags|=128,b=!0,Ph(m,!1),l.lanes=4194304);m.isBackwards?(_.sibling=l.child,l.child=_):(a=m.last,a!==null?a.sibling=_:l.child=_,m.last=_)}return m.tail!==null?(a=m.tail,m.rendering=a,m.tail=a.sibling,m.renderingStartTime=Un(),a.sibling=null,h=un.current,he(un,b?h&1|2:h&1),xt&&Ir(l,m.treeForkCount),a):(Wt(l),null);case 22:case 23:return Ps(l),kx(),m=l.memoizedState!==null,a!==null?a.memoizedState!==null!==m&&(l.flags|=8192):m&&(l.flags|=8192),m?(h&536870912)!==0&&(l.flags&128)===0&&(Wt(l),l.subtreeFlags&6&&(l.flags|=8192)):Wt(l),h=l.updateQueue,h!==null&&Vp(l,h.retryQueue),h=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(h=a.memoizedState.cachePool.pool),m=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(m=l.memoizedState.cachePool.pool),m!==h&&(l.flags|=2048),a!==null&&q(fl),null;case 24:return h=null,a!==null&&(h=a.memoizedState.cache),l.memoizedState.cache!==h&&(l.flags|=2048),Gr(gn),Wt(l),null;case 25:return null;case 30:return null}throw Error(n(156,l.tag))}function MV(a,l){switch(Nx(l),l.tag){case 1:return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 3:return Gr(gn),Me(),a=l.flags,(a&65536)!==0&&(a&128)===0?(l.flags=a&-65537|128,l):null;case 26:case 27:case 5:return De(l),null;case 31:if(l.memoizedState!==null){if(Ps(l),l.alternate===null)throw Error(n(340));cl()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 13:if(Ps(l),a=l.memoizedState,a!==null&&a.dehydrated!==null){if(l.alternate===null)throw Error(n(340));cl()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 19:return q(un),null;case 4:return Me(),null;case 10:return Gr(l.type),null;case 22:case 23:return Ps(l),kx(),a!==null&&q(fl),a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 24:return Gr(gn),null;case 25:return null;default:return null}}function pN(a,l){switch(Nx(l),l.tag){case 3:Gr(gn),Me();break;case 26:case 27:case 5:De(l);break;case 4:Me();break;case 31:l.memoizedState!==null&&Ps(l);break;case 13:Ps(l);break;case 19:q(un);break;case 10:Gr(l.type);break;case 22:case 23:Ps(l),kx(),a!==null&&q(fl);break;case 24:Gr(gn)}}function Ih(a,l){try{var h=l.updateQueue,m=h!==null?h.lastEffect:null;if(m!==null){var b=m.next;h=b;do{if((h.tag&a)===a){m=void 0;var _=h.create,E=h.inst;m=_(),E.destroy=m}h=h.next}while(h!==b)}}catch(O){Lt(l,l.return,O)}}function Ja(a,l,h){try{var m=l.updateQueue,b=m!==null?m.lastEffect:null;if(b!==null){var _=b.next;m=_;do{if((m.tag&a)===a){var E=m.inst,O=E.destroy;if(O!==void 0){E.destroy=void 0,b=l;var Q=h,ce=O;try{ce()}catch(be){Lt(b,Q,be)}}}m=m.next}while(m!==_)}}catch(be){Lt(l,l.return,be)}}function mN(a){var l=a.updateQueue;if(l!==null){var h=a.stateNode;try{rM(l,h)}catch(m){Lt(a,a.return,m)}}}function gN(a,l,h){h.props=xl(a.type,a.memoizedProps),h.state=a.memoizedState;try{h.componentWillUnmount()}catch(m){Lt(a,l,m)}}function kh(a,l){try{var h=a.ref;if(h!==null){switch(a.tag){case 26:case 27:case 5:var m=a.stateNode;break;case 30:m=a.stateNode;break;default:m=a.stateNode}typeof h=="function"?a.refCleanup=h(m):h.current=m}}catch(b){Lt(a,l,b)}}function nr(a,l){var h=a.ref,m=a.refCleanup;if(h!==null)if(typeof m=="function")try{m()}catch(b){Lt(a,l,b)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(b){Lt(a,l,b)}else h.current=null}function yN(a){var l=a.type,h=a.memoizedProps,m=a.stateNode;try{e:switch(l){case"button":case"input":case"select":case"textarea":h.autoFocus&&m.focus();break e;case"img":h.src?m.src=h.src:h.srcSet&&(m.srcset=h.srcSet)}}catch(b){Lt(a,a.return,b)}}function bb(a,l,h){try{var m=a.stateNode;WV(m,a.type,h,l),m[Xn]=l}catch(b){Lt(a,a.return,b)}}function xN(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&ao(a.type)||a.tag===4}function _b(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||xN(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&ao(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function vb(a,l,h){var m=a.tag;if(m===5||m===6)a=a.stateNode,l?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(a,l):(l=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,l.appendChild(a),h=h._reactRootContainer,h!=null||l.onclick!==null||(l.onclick=zr));else if(m!==4&&(m===27&&ao(a.type)&&(h=a.stateNode,l=null),a=a.child,a!==null))for(vb(a,l,h),a=a.sibling;a!==null;)vb(a,l,h),a=a.sibling}function Pp(a,l,h){var m=a.tag;if(m===5||m===6)a=a.stateNode,l?h.insertBefore(a,l):h.appendChild(a);else if(m!==4&&(m===27&&ao(a.type)&&(h=a.stateNode),a=a.child,a!==null))for(Pp(a,l,h),a=a.sibling;a!==null;)Pp(a,l,h),a=a.sibling}function bN(a){var l=a.stateNode,h=a.memoizedProps;try{for(var m=a.type,b=l.attributes;b.length;)l.removeAttributeNode(b[0]);In(l,m,h),l[Nn]=a,l[Xn]=h}catch(_){Lt(a,a.return,_)}}var Wr=!1,bn=!1,Tb=!1,_N=typeof WeakSet=="function"?WeakSet:Set,Bn=null;function NV(a,l){if(a=a.containerInfo,$b=am,a=Bw(a),mx(a)){if("selectionStart"in a)var h={start:a.selectionStart,end:a.selectionEnd};else e:{h=(h=a.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&m.rangeCount!==0){h=m.anchorNode;var b=m.anchorOffset,_=m.focusNode;m=m.focusOffset;try{h.nodeType,_.nodeType}catch{h=null;break e}var E=0,O=-1,Q=-1,ce=0,be=0,Te=a,de=null;t:for(;;){for(var ge;Te!==h||b!==0&&Te.nodeType!==3||(O=E+b),Te!==_||m!==0&&Te.nodeType!==3||(Q=E+m),Te.nodeType===3&&(E+=Te.nodeValue.length),(ge=Te.firstChild)!==null;)de=Te,Te=ge;for(;;){if(Te===a)break t;if(de===h&&++ce===b&&(O=E),de===_&&++be===m&&(Q=E),(ge=Te.nextSibling)!==null)break;Te=de,de=Te.parentNode}Te=ge}h=O===-1||Q===-1?null:{start:O,end:Q}}else h=null}h=h||{start:0,end:0}}else h=null;for(Hb={focusedElem:a,selectionRange:h},am=!1,Bn=l;Bn!==null;)if(l=Bn,a=l.child,(l.subtreeFlags&1028)!==0&&a!==null)a.return=l,Bn=a;else for(;Bn!==null;){switch(l=Bn,_=l.alternate,a=l.flags,l.tag){case 0:if((a&4)!==0&&(a=l.updateQueue,a=a!==null?a.events:null,a!==null))for(h=0;h<a.length;h++)b=a[h],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&_!==null){a=void 0,h=l,b=_.memoizedProps,_=_.memoizedState,m=h.stateNode;try{var Pe=xl(h.type,b);a=m.getSnapshotBeforeUpdate(Pe,_),m.__reactInternalSnapshotBeforeUpdate=a}catch(Xe){Lt(h,h.return,Xe)}}break;case 3:if((a&1024)!==0){if(a=l.stateNode.containerInfo,h=a.nodeType,h===9)Wb(a);else if(h===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Wb(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(n(163))}if(a=l.sibling,a!==null){a.return=l.return,Bn=a;break}Bn=l.return}}function vN(a,l,h){var m=h.flags;switch(h.tag){case 0:case 11:case 15:Yr(a,h),m&4&&Ih(5,h);break;case 1:if(Yr(a,h),m&4)if(a=h.stateNode,l===null)try{a.componentDidMount()}catch(E){Lt(h,h.return,E)}else{var b=xl(h.type,l.memoizedProps);l=l.memoizedState;try{a.componentDidUpdate(b,l,a.__reactInternalSnapshotBeforeUpdate)}catch(E){Lt(h,h.return,E)}}m&64&&mN(h),m&512&&kh(h,h.return);break;case 3:if(Yr(a,h),m&64&&(a=h.updateQueue,a!==null)){if(l=null,h.child!==null)switch(h.child.tag){case 27:case 5:l=h.child.stateNode;break;case 1:l=h.child.stateNode}try{rM(a,l)}catch(E){Lt(h,h.return,E)}}break;case 27:l===null&&m&4&&bN(h);case 26:case 5:Yr(a,h),l===null&&m&4&&yN(h),m&512&&kh(h,h.return);break;case 12:Yr(a,h);break;case 31:Yr(a,h),m&4&&wN(a,h);break;case 13:Yr(a,h),m&4&&MN(a,h),m&64&&(a=h.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(h=OV.bind(null,h),tP(a,h))));break;case 22:if(m=h.memoizedState!==null||Wr,!m){l=l!==null&&l.memoizedState!==null||bn,b=Wr;var _=bn;Wr=m,(bn=l)&&!_?Zr(a,h,(h.subtreeFlags&8772)!==0):Yr(a,h),Wr=b,bn=_}break;case 30:break;default:Yr(a,h)}}function TN(a){var l=a.alternate;l!==null&&(a.alternate=null,TN(l)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(l=a.stateNode,l!==null&&fh(l)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Zt=null,bs=!1;function Xr(a,l,h){for(h=h.child;h!==null;)SN(a,l,h),h=h.sibling}function SN(a,l,h){if(is&&typeof is.onCommitFiberUnmount=="function")try{is.onCommitFiberUnmount(Jo,h)}catch{}switch(h.tag){case 26:bn||nr(h,l),Xr(a,l,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:bn||nr(h,l);var m=Zt,b=bs;ao(h.type)&&(Zt=h.stateNode,bs=!1),Xr(a,l,h),Zh(h.stateNode),Zt=m,bs=b;break;case 5:bn||nr(h,l);case 6:if(m=Zt,b=bs,Zt=null,Xr(a,l,h),Zt=m,bs=b,Zt!==null)if(bs)try{(Zt.nodeType===9?Zt.body:Zt.nodeName==="HTML"?Zt.ownerDocument.body:Zt).removeChild(h.stateNode)}catch(_){Lt(h,l,_)}else try{Zt.removeChild(h.stateNode)}catch(_){Lt(h,l,_)}break;case 18:Zt!==null&&(bs?(a=Zt,mA(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,h.stateNode),Wu(a)):mA(Zt,h.stateNode));break;case 4:m=Zt,b=bs,Zt=h.stateNode.containerInfo,bs=!0,Xr(a,l,h),Zt=m,bs=b;break;case 0:case 11:case 14:case 15:Ja(2,h,l),bn||Ja(4,h,l),Xr(a,l,h);break;case 1:bn||(nr(h,l),m=h.stateNode,typeof m.componentWillUnmount=="function"&&gN(h,l,m)),Xr(a,l,h);break;case 21:Xr(a,l,h);break;case 22:bn=(m=bn)||h.memoizedState!==null,Xr(a,l,h),bn=m;break;default:Xr(a,l,h)}}function wN(a,l){if(l.memoizedState===null&&(a=l.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{Wu(a)}catch(h){Lt(l,l.return,h)}}}function MN(a,l){if(l.memoizedState===null&&(a=l.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Wu(a)}catch(h){Lt(l,l.return,h)}}function AV(a){switch(a.tag){case 31:case 13:case 19:var l=a.stateNode;return l===null&&(l=a.stateNode=new _N),l;case 22:return a=a.stateNode,l=a._retryCache,l===null&&(l=a._retryCache=new _N),l;default:throw Error(n(435,a.tag))}}function Ip(a,l){var h=AV(a);l.forEach(function(m){if(!h.has(m)){h.add(m);var b=UV.bind(null,a,m);m.then(b,b)}})}function _s(a,l){var h=l.deletions;if(h!==null)for(var m=0;m<h.length;m++){var b=h[m],_=a,E=l,O=E;e:for(;O!==null;){switch(O.tag){case 27:if(ao(O.type)){Zt=O.stateNode,bs=!1;break e}break;case 5:Zt=O.stateNode,bs=!1;break e;case 3:case 4:Zt=O.stateNode.containerInfo,bs=!0;break e}O=O.return}if(Zt===null)throw Error(n(160));SN(_,E,b),Zt=null,bs=!1,_=b.alternate,_!==null&&(_.return=null),b.return=null}if(l.subtreeFlags&13886)for(l=l.child;l!==null;)NN(l,a),l=l.sibling}var Ci=null;function NN(a,l){var h=a.alternate,m=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:_s(l,a),vs(a),m&4&&(Ja(3,a,a.return),Ih(3,a),Ja(5,a,a.return));break;case 1:_s(l,a),vs(a),m&512&&(bn||h===null||nr(h,h.return)),m&64&&Wr&&(a=a.updateQueue,a!==null&&(m=a.callbacks,m!==null&&(h=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=h===null?m:h.concat(m))));break;case 26:var b=Ci;if(_s(l,a),vs(a),m&512&&(bn||h===null||nr(h,h.return)),m&4){var _=h!==null?h.memoizedState:null;if(m=a.memoizedState,h===null)if(m===null)if(a.stateNode===null){e:{m=a.type,h=a.memoizedProps,b=b.ownerDocument||b;t:switch(m){case"title":_=b.getElementsByTagName("title")[0],(!_||_[nl]||_[Nn]||_.namespaceURI==="http://www.w3.org/2000/svg"||_.hasAttribute("itemprop"))&&(_=b.createElement(m),b.head.insertBefore(_,b.querySelector("head > title"))),In(_,m,h),_[Nn]=a,mn(_),m=_;break e;case"link":var E=NA("link","href",b).get(m+(h.href||""));if(E){for(var O=0;O<E.length;O++)if(_=E[O],_.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&_.getAttribute("rel")===(h.rel==null?null:h.rel)&&_.getAttribute("title")===(h.title==null?null:h.title)&&_.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){E.splice(O,1);break t}}_=b.createElement(m),In(_,m,h),b.head.appendChild(_);break;case"meta":if(E=NA("meta","content",b).get(m+(h.content||""))){for(O=0;O<E.length;O++)if(_=E[O],_.getAttribute("content")===(h.content==null?null:""+h.content)&&_.getAttribute("name")===(h.name==null?null:h.name)&&_.getAttribute("property")===(h.property==null?null:h.property)&&_.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&_.getAttribute("charset")===(h.charSet==null?null:h.charSet)){E.splice(O,1);break t}}_=b.createElement(m),In(_,m,h),b.head.appendChild(_);break;default:throw Error(n(468,m))}_[Nn]=a,mn(_),m=_}a.stateNode=m}else AA(b,a.type,a.stateNode);else a.stateNode=MA(b,m,a.memoizedProps);else _!==m?(_===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):_.count--,m===null?AA(b,a.type,a.stateNode):MA(b,m,a.memoizedProps)):m===null&&a.stateNode!==null&&bb(a,a.memoizedProps,h.memoizedProps)}break;case 27:_s(l,a),vs(a),m&512&&(bn||h===null||nr(h,h.return)),h!==null&&m&4&&bb(a,a.memoizedProps,h.memoizedProps);break;case 5:if(_s(l,a),vs(a),m&512&&(bn||h===null||nr(h,h.return)),a.flags&32){b=a.stateNode;try{gu(b,"")}catch(Pe){Lt(a,a.return,Pe)}}m&4&&a.stateNode!=null&&(b=a.memoizedProps,bb(a,b,h!==null?h.memoizedProps:b)),m&1024&&(Tb=!0);break;case 6:if(_s(l,a),vs(a),m&4){if(a.stateNode===null)throw Error(n(162));m=a.memoizedProps,h=a.stateNode;try{h.nodeValue=m}catch(Pe){Lt(a,a.return,Pe)}}break;case 3:if(nm=null,b=Ci,Ci=em(l.containerInfo),_s(l,a),Ci=b,vs(a),m&4&&h!==null&&h.memoizedState.isDehydrated)try{Wu(l.containerInfo)}catch(Pe){Lt(a,a.return,Pe)}Tb&&(Tb=!1,AN(a));break;case 4:m=Ci,Ci=em(a.stateNode.containerInfo),_s(l,a),vs(a),Ci=m;break;case 12:_s(l,a),vs(a);break;case 31:_s(l,a),vs(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Ip(a,m)));break;case 13:_s(l,a),vs(a),a.child.flags&8192&&a.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(Gp=Un()),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Ip(a,m)));break;case 22:b=a.memoizedState!==null;var Q=h!==null&&h.memoizedState!==null,ce=Wr,be=bn;if(Wr=ce||b,bn=be||Q,_s(l,a),bn=be,Wr=ce,vs(a),m&8192)e:for(l=a.stateNode,l._visibility=b?l._visibility&-2:l._visibility|1,b&&(h===null||Q||Wr||bn||bl(a)),h=null,l=a;;){if(l.tag===5||l.tag===26){if(h===null){Q=h=l;try{if(_=Q.stateNode,b)E=_.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none";else{O=Q.stateNode;var Te=Q.memoizedProps.style,de=Te!=null&&Te.hasOwnProperty("display")?Te.display:null;O.style.display=de==null||typeof de=="boolean"?"":(""+de).trim()}}catch(Pe){Lt(Q,Q.return,Pe)}}}else if(l.tag===6){if(h===null){Q=l;try{Q.stateNode.nodeValue=b?"":Q.memoizedProps}catch(Pe){Lt(Q,Q.return,Pe)}}}else if(l.tag===18){if(h===null){Q=l;try{var ge=Q.stateNode;b?gA(ge,!0):gA(Q.stateNode,!1)}catch(Pe){Lt(Q,Q.return,Pe)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===a)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break e;for(;l.sibling===null;){if(l.return===null||l.return===a)break e;h===l&&(h=null),l=l.return}h===l&&(h=null),l.sibling.return=l.return,l=l.sibling}m&4&&(m=a.updateQueue,m!==null&&(h=m.retryQueue,h!==null&&(m.retryQueue=null,Ip(a,h))));break;case 19:_s(l,a),vs(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Ip(a,m)));break;case 30:break;case 21:break;default:_s(l,a),vs(a)}}function vs(a){var l=a.flags;if(l&2){try{for(var h,m=a.return;m!==null;){if(xN(m)){h=m;break}m=m.return}if(h==null)throw Error(n(160));switch(h.tag){case 27:var b=h.stateNode,_=_b(a);Pp(a,_,b);break;case 5:var E=h.stateNode;h.flags&32&&(gu(E,""),h.flags&=-33);var O=_b(a);Pp(a,O,E);break;case 3:case 4:var Q=h.stateNode.containerInfo,ce=_b(a);vb(a,ce,Q);break;default:throw Error(n(161))}}catch(be){Lt(a,a.return,be)}a.flags&=-3}l&4096&&(a.flags&=-4097)}function AN(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var l=a;AN(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),a=a.sibling}}function Yr(a,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)vN(a,l.alternate,l),l=l.sibling}function bl(a){for(a=a.child;a!==null;){var l=a;switch(l.tag){case 0:case 11:case 14:case 15:Ja(4,l,l.return),bl(l);break;case 1:nr(l,l.return);var h=l.stateNode;typeof h.componentWillUnmount=="function"&&gN(l,l.return,h),bl(l);break;case 27:Zh(l.stateNode);case 26:case 5:nr(l,l.return),bl(l);break;case 22:l.memoizedState===null&&bl(l);break;case 30:bl(l);break;default:bl(l)}a=a.sibling}}function Zr(a,l,h){for(h=h&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var m=l.alternate,b=a,_=l,E=_.flags;switch(_.tag){case 0:case 11:case 15:Zr(b,_,h),Ih(4,_);break;case 1:if(Zr(b,_,h),m=_,b=m.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(ce){Lt(m,m.return,ce)}if(m=_,b=m.updateQueue,b!==null){var O=m.stateNode;try{var Q=b.shared.hiddenCallbacks;if(Q!==null)for(b.shared.hiddenCallbacks=null,b=0;b<Q.length;b++)iM(Q[b],O)}catch(ce){Lt(m,m.return,ce)}}h&&E&64&&mN(_),kh(_,_.return);break;case 27:bN(_);case 26:case 5:Zr(b,_,h),h&&m===null&&E&4&&yN(_),kh(_,_.return);break;case 12:Zr(b,_,h);break;case 31:Zr(b,_,h),h&&E&4&&wN(b,_);break;case 13:Zr(b,_,h),h&&E&4&&MN(b,_);break;case 22:_.memoizedState===null&&Zr(b,_,h),kh(_,_.return);break;case 30:break;default:Zr(b,_,h)}l=l.sibling}}function Sb(a,l){var h=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(h=a.memoizedState.cachePool.pool),a=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(a=l.memoizedState.cachePool.pool),a!==h&&(a!=null&&a.refCount++,h!=null&&Ah(h))}function wb(a,l){a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&Ah(a))}function Di(a,l,h,m){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)EN(a,l,h,m),l=l.sibling}function EN(a,l,h,m){var b=l.flags;switch(l.tag){case 0:case 11:case 15:Di(a,l,h,m),b&2048&&Ih(9,l);break;case 1:Di(a,l,h,m);break;case 3:Di(a,l,h,m),b&2048&&(a=null,l.alternate!==null&&(a=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==a&&(l.refCount++,a!=null&&Ah(a)));break;case 12:if(b&2048){Di(a,l,h,m),a=l.stateNode;try{var _=l.memoizedProps,E=_.id,O=_.onPostCommit;typeof O=="function"&&O(E,l.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(Q){Lt(l,l.return,Q)}}else Di(a,l,h,m);break;case 31:Di(a,l,h,m);break;case 13:Di(a,l,h,m);break;case 23:break;case 22:_=l.stateNode,E=l.alternate,l.memoizedState!==null?_._visibility&2?Di(a,l,h,m):Gh(a,l):_._visibility&2?Di(a,l,h,m):(_._visibility|=2,Uu(a,l,h,m,(l.subtreeFlags&10256)!==0||!1)),b&2048&&Sb(E,l);break;case 24:Di(a,l,h,m),b&2048&&wb(l.alternate,l);break;default:Di(a,l,h,m)}}function Uu(a,l,h,m,b){for(b=b&&((l.subtreeFlags&10256)!==0||!1),l=l.child;l!==null;){var _=a,E=l,O=h,Q=m,ce=E.flags;switch(E.tag){case 0:case 11:case 15:Uu(_,E,O,Q,b),Ih(8,E);break;case 23:break;case 22:var be=E.stateNode;E.memoizedState!==null?be._visibility&2?Uu(_,E,O,Q,b):Gh(_,E):(be._visibility|=2,Uu(_,E,O,Q,b)),b&&ce&2048&&Sb(E.alternate,E);break;case 24:Uu(_,E,O,Q,b),b&&ce&2048&&wb(E.alternate,E);break;default:Uu(_,E,O,Q,b)}l=l.sibling}}function Gh(a,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var h=a,m=l,b=m.flags;switch(m.tag){case 22:Gh(h,m),b&2048&&Sb(m.alternate,m);break;case 24:Gh(h,m),b&2048&&wb(m.alternate,m);break;default:Gh(h,m)}l=l.sibling}}var $h=8192;function zu(a,l,h){if(a.subtreeFlags&$h)for(a=a.child;a!==null;)RN(a,l,h),a=a.sibling}function RN(a,l,h){switch(a.tag){case 26:zu(a,l,h),a.flags&$h&&a.memoizedState!==null&&fP(h,Ci,a.memoizedState,a.memoizedProps);break;case 5:zu(a,l,h);break;case 3:case 4:var m=Ci;Ci=em(a.stateNode.containerInfo),zu(a,l,h),Ci=m;break;case 22:a.memoizedState===null&&(m=a.alternate,m!==null&&m.memoizedState!==null?(m=$h,$h=16777216,zu(a,l,h),$h=m):zu(a,l,h));break;default:zu(a,l,h)}}function CN(a){var l=a.alternate;if(l!==null&&(a=l.child,a!==null)){l.child=null;do l=a.sibling,a.sibling=null,a=l;while(a!==null)}}function Hh(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var h=0;h<l.length;h++){var m=l[h];Bn=m,BN(m,a)}CN(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)DN(a),a=a.sibling}function DN(a){switch(a.tag){case 0:case 11:case 15:Hh(a),a.flags&2048&&Ja(9,a,a.return);break;case 3:Hh(a);break;case 12:Hh(a);break;case 22:var l=a.stateNode;a.memoizedState!==null&&l._visibility&2&&(a.return===null||a.return.tag!==13)?(l._visibility&=-3,kp(a)):Hh(a);break;default:Hh(a)}}function kp(a){var l=a.deletions;if((a.flags&16)!==0){if(l!==null)for(var h=0;h<l.length;h++){var m=l[h];Bn=m,BN(m,a)}CN(a)}for(a=a.child;a!==null;){switch(l=a,l.tag){case 0:case 11:case 15:Ja(8,l,l.return),kp(l);break;case 22:h=l.stateNode,h._visibility&2&&(h._visibility&=-3,kp(l));break;default:kp(l)}a=a.sibling}}function BN(a,l){for(;Bn!==null;){var h=Bn;switch(h.tag){case 0:case 11:case 15:Ja(8,h,l);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var m=h.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Ah(h.memoizedState.cache)}if(m=h.child,m!==null)m.return=h,Bn=m;else e:for(h=a;Bn!==null;){m=Bn;var b=m.sibling,_=m.return;if(TN(m),m===h){Bn=null;break e}if(b!==null){b.return=_,Bn=b;break e}Bn=_}}}var EV={getCacheForType:function(a){var l=Vn(gn),h=l.data.get(a);return h===void 0&&(h=a(),l.data.set(a,h)),h},cacheSignal:function(){return Vn(gn).controller.signal}},RV=typeof WeakMap=="function"?WeakMap:Map,wt=0,kt=null,lt=null,ft=0,Bt=0,Is=null,eo=!1,Vu=!1,Mb=!1,Qr=0,on=0,to=0,_l=0,Nb=0,ks=0,Pu=0,jh=null,Ts=null,Ab=!1,Gp=0,LN=0,$p=1/0,Hp=null,no=null,An=0,so=null,Iu=null,Kr=0,Eb=0,Rb=null,FN=null,qh=0,Cb=null;function Gs(){return(wt&2)!==0&&ft!==0?ft&-ft:F.T!==null?Ub():Xf()}function ON(){if(ks===0)if((ft&536870912)===0||xt){var a=cu;cu<<=1,(cu&3932160)===0&&(cu=262144),ks=a}else ks=536870912;return a=Vs.current,a!==null&&(a.flags|=32),ks}function Ss(a,l,h){(a===kt&&(Bt===2||Bt===9)||a.cancelPendingCommit!==null)&&(ku(a,0),io(a,ft,ks,!1)),tl(a,h),((wt&2)===0||a!==kt)&&(a===kt&&((wt&2)===0&&(_l|=h),on===4&&io(a,ft,ks,!1)),sr(a))}function UN(a,l,h){if((wt&6)!==0)throw Error(n(327));var m=!h&&(l&127)===0&&(l&a.expiredLanes)===0||el(a,l),b=m?BV(a,l):Bb(a,l,!0),_=m;do{if(b===0){Vu&&!m&&io(a,l,0,!1);break}else{if(h=a.current.alternate,_&&!CV(h)){b=Bb(a,l,!1),_=!1;continue}if(b===2){if(_=l,a.errorRecoveryDisabledLanes&_)var E=0;else E=a.pendingLanes&-536870913,E=E!==0?E:E&536870912?536870912:0;if(E!==0){l=E;e:{var O=a;b=jh;var Q=O.current.memoizedState.isDehydrated;if(Q&&(ku(O,E).flags|=256),E=Bb(O,E,!1),E!==2){if(Mb&&!Q){O.errorRecoveryDisabledLanes|=_,_l|=_,b=4;break e}_=Ts,Ts=b,_!==null&&(Ts===null?Ts=_:Ts.push.apply(Ts,_))}b=E}if(_=!1,b!==2)continue}}if(b===1){ku(a,0),io(a,l,0,!0);break}e:{switch(m=a,_=b,_){case 0:case 1:throw Error(n(345));case 4:if((l&4194048)!==l)break;case 6:io(m,l,ks,!eo);break e;case 2:Ts=null;break;case 3:case 5:break;default:throw Error(n(329))}if((l&62914560)===l&&(b=Gp+300-Un(),10<b)){if(io(m,l,ks,!eo),du(m,0,!0)!==0)break e;Kr=l,m.timeoutHandle=fA(zN.bind(null,m,h,Ts,Hp,Ab,l,ks,_l,Pu,eo,_,"Throttled",-0,0),b);break e}zN(m,h,Ts,Hp,Ab,l,ks,_l,Pu,eo,_,null,-0,0)}}break}while(!0);sr(a)}function zN(a,l,h,m,b,_,E,O,Q,ce,be,Te,de,ge){if(a.timeoutHandle=-1,Te=l.subtreeFlags,Te&8192||(Te&16785408)===16785408){Te={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:zr},RN(l,_,Te);var Pe=(_&62914560)===_?Gp-Un():(_&4194048)===_?LN-Un():0;if(Pe=pP(Te,Pe),Pe!==null){Kr=_,a.cancelPendingCommit=Pe(jN.bind(null,a,l,_,h,m,b,E,O,Q,be,Te,null,de,ge)),io(a,_,E,!ce);return}}jN(a,l,_,h,m,b,E,O,Q)}function CV(a){for(var l=a;;){var h=l.tag;if((h===0||h===11||h===15)&&l.flags&16384&&(h=l.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var m=0;m<h.length;m++){var b=h[m],_=b.getSnapshot;b=b.value;try{if(!Us(_(),b))return!1}catch{return!1}}if(h=l.child,l.subtreeFlags&16384&&h!==null)h.return=l,l=h;else{if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function io(a,l,h,m){l&=~Nb,l&=~_l,a.suspendedLanes|=l,a.pingedLanes&=~l,m&&(a.warmLanes|=l),m=a.expirationTimes;for(var b=l;0<b;){var _=31-rs(b),E=1<<_;m[_]=-1,b&=~E}h!==0&&jf(a,h,l)}function jp(){return(wt&6)===0?(Wh(0),!1):!0}function Db(){if(lt!==null){if(Bt===0)var a=lt.return;else a=lt,kr=hl=null,Wx(a),Du=null,Rh=0,a=lt;for(;a!==null;)pN(a.alternate,a),a=a.return;lt=null}}function ku(a,l){var h=a.timeoutHandle;h!==-1&&(a.timeoutHandle=-1,ZV(h)),h=a.cancelPendingCommit,h!==null&&(a.cancelPendingCommit=null,h()),Kr=0,Db(),kt=a,lt=h=Pr(a.current,null),ft=l,Bt=0,Is=null,eo=!1,Vu=el(a,l),Mb=!1,Pu=ks=Nb=_l=to=on=0,Ts=jh=null,Ab=!1,(l&8)!==0&&(l|=l&32);var m=a.entangledLanes;if(m!==0)for(a=a.entanglements,m&=l;0<m;){var b=31-rs(m),_=1<<b;l|=a[b],m&=~_}return Qr=l,dp(),h}function VN(a,l){et=null,F.H=zh,l===Cu||l===_p?(l=eM(),Bt=3):l===Ox?(l=eM(),Bt=4):Bt=l===ub?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,Is=l,lt===null&&(on=1,Fp(a,si(l,a.current)))}function PN(){var a=Vs.current;return a===null?!0:(ft&4194048)===ft?oi===null:(ft&62914560)===ft||(ft&536870912)!==0?a===oi:!1}function IN(){var a=F.H;return F.H=zh,a===null?zh:a}function kN(){var a=F.A;return F.A=EV,a}function qp(){on=4,eo||(ft&4194048)!==ft&&Vs.current!==null||(Vu=!0),(to&134217727)===0&&(_l&134217727)===0||kt===null||io(kt,ft,ks,!1)}function Bb(a,l,h){var m=wt;wt|=2;var b=IN(),_=kN();(kt!==a||ft!==l)&&(Hp=null,ku(a,l)),l=!1;var E=on;e:do try{if(Bt!==0&&lt!==null){var O=lt,Q=Is;switch(Bt){case 8:Db(),E=6;break e;case 3:case 2:case 9:case 6:Vs.current===null&&(l=!0);var ce=Bt;if(Bt=0,Is=null,Gu(a,O,Q,ce),h&&Vu){E=0;break e}break;default:ce=Bt,Bt=0,Is=null,Gu(a,O,Q,ce)}}DV(),E=on;break}catch(be){VN(a,be)}while(!0);return l&&a.shellSuspendCounter++,kr=hl=null,wt=m,F.H=b,F.A=_,lt===null&&(kt=null,ft=0,dp()),E}function DV(){for(;lt!==null;)GN(lt)}function BV(a,l){var h=wt;wt|=2;var m=IN(),b=kN();kt!==a||ft!==l?(Hp=null,$p=Un()+500,ku(a,l)):Vu=el(a,l);e:do try{if(Bt!==0&&lt!==null){l=lt;var _=Is;t:switch(Bt){case 1:Bt=0,Is=null,Gu(a,l,_,1);break;case 2:case 9:if(Kw(_)){Bt=0,Is=null,$N(l);break}l=function(){Bt!==2&&Bt!==9||kt!==a||(Bt=7),sr(a)},_.then(l,l);break e;case 3:Bt=7;break e;case 4:Bt=5;break e;case 7:Kw(_)?(Bt=0,Is=null,$N(l)):(Bt=0,Is=null,Gu(a,l,_,7));break;case 5:var E=null;switch(lt.tag){case 26:E=lt.memoizedState;case 5:case 27:var O=lt;if(E?EA(E):O.stateNode.complete){Bt=0,Is=null;var Q=O.sibling;if(Q!==null)lt=Q;else{var ce=O.return;ce!==null?(lt=ce,Wp(ce)):lt=null}break t}}Bt=0,Is=null,Gu(a,l,_,5);break;case 6:Bt=0,Is=null,Gu(a,l,_,6);break;case 8:Db(),on=6;break e;default:throw Error(n(462))}}LV();break}catch(be){VN(a,be)}while(!0);return kr=hl=null,F.H=m,F.A=b,wt=h,lt!==null?0:(kt=null,ft=0,dp(),on)}function LV(){for(;lt!==null&&!Zo();)GN(lt)}function GN(a){var l=dN(a.alternate,a,Qr);a.memoizedProps=a.pendingProps,l===null?Wp(a):lt=l}function $N(a){var l=a,h=l.alternate;switch(l.tag){case 15:case 0:l=aN(h,l,l.pendingProps,l.type,void 0,ft);break;case 11:l=aN(h,l,l.pendingProps,l.type.render,l.ref,ft);break;case 5:Wx(l);default:pN(h,l),l=lt=kw(l,Qr),l=dN(h,l,Qr)}a.memoizedProps=a.pendingProps,l===null?Wp(a):lt=l}function Gu(a,l,h,m){kr=hl=null,Wx(l),Du=null,Rh=0;var b=l.return;try{if(vV(a,b,l,h,ft)){on=1,Fp(a,si(h,a.current)),lt=null;return}}catch(_){if(b!==null)throw lt=b,_;on=1,Fp(a,si(h,a.current)),lt=null;return}l.flags&32768?(xt||m===1?a=!0:Vu||(ft&536870912)!==0?a=!1:(eo=a=!0,(m===2||m===9||m===3||m===6)&&(m=Vs.current,m!==null&&m.tag===13&&(m.flags|=16384))),HN(l,a)):Wp(l)}function Wp(a){var l=a;do{if((l.flags&32768)!==0){HN(l,eo);return}a=l.return;var h=wV(l.alternate,l,Qr);if(h!==null){lt=h;return}if(l=l.sibling,l!==null){lt=l;return}lt=l=a}while(l!==null);on===0&&(on=5)}function HN(a,l){do{var h=MV(a.alternate,a);if(h!==null){h.flags&=32767,lt=h;return}if(h=a.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!l&&(a=a.sibling,a!==null)){lt=a;return}lt=a=h}while(a!==null);on=6,lt=null}function jN(a,l,h,m,b,_,E,O,Q){a.cancelPendingCommit=null;do Xp();while(An!==0);if((wt&6)!==0)throw Error(n(327));if(l!==null){if(l===a.current)throw Error(n(177));if(_=l.lanes|l.childLanes,_|=_x,Zy(a,h,_,E,O,Q),a===kt&&(lt=kt=null,ft=0),Iu=l,so=a,Kr=h,Eb=_,Rb=b,FN=m,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,zV(Ko,function(){return ZN(),null})):(a.callbackNode=null,a.callbackPriority=0),m=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||m){m=F.T,F.T=null,b=k.p,k.p=2,E=wt,wt|=4;try{NV(a,l,h)}finally{wt=E,k.p=b,F.T=m}}An=1,qN(),WN(),XN()}}function qN(){if(An===1){An=0;var a=so,l=Iu,h=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||h){h=F.T,F.T=null;var m=k.p;k.p=2;var b=wt;wt|=4;try{NN(l,a);var _=Hb,E=Bw(a.containerInfo),O=_.focusedElem,Q=_.selectionRange;if(E!==O&&O&&O.ownerDocument&&Dw(O.ownerDocument.documentElement,O)){if(Q!==null&&mx(O)){var ce=Q.start,be=Q.end;if(be===void 0&&(be=ce),"selectionStart"in O)O.selectionStart=ce,O.selectionEnd=Math.min(be,O.value.length);else{var Te=O.ownerDocument||document,de=Te&&Te.defaultView||window;if(de.getSelection){var ge=de.getSelection(),Pe=O.textContent.length,Xe=Math.min(Q.start,Pe),Vt=Q.end===void 0?Xe:Math.min(Q.end,Pe);!ge.extend&&Xe>Vt&&(E=Vt,Vt=Xe,Xe=E);var ae=Cw(O,Xe),ne=Cw(O,Vt);if(ae&&ne&&(ge.rangeCount!==1||ge.anchorNode!==ae.node||ge.anchorOffset!==ae.offset||ge.focusNode!==ne.node||ge.focusOffset!==ne.offset)){var ue=Te.createRange();ue.setStart(ae.node,ae.offset),ge.removeAllRanges(),Xe>Vt?(ge.addRange(ue),ge.extend(ne.node,ne.offset)):(ue.setEnd(ne.node,ne.offset),ge.addRange(ue))}}}}for(Te=[],ge=O;ge=ge.parentNode;)ge.nodeType===1&&Te.push({element:ge,left:ge.scrollLeft,top:ge.scrollTop});for(typeof O.focus=="function"&&O.focus(),O=0;O<Te.length;O++){var _e=Te[O];_e.element.scrollLeft=_e.left,_e.element.scrollTop=_e.top}}am=!!$b,Hb=$b=null}finally{wt=b,k.p=m,F.T=h}}a.current=l,An=2}}function WN(){if(An===2){An=0;var a=so,l=Iu,h=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||h){h=F.T,F.T=null;var m=k.p;k.p=2;var b=wt;wt|=4;try{vN(a,l.alternate,l)}finally{wt=b,k.p=m,F.T=h}}An=3}}function XN(){if(An===4||An===3){An=0,Qo();var a=so,l=Iu,h=Kr,m=FN;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?An=5:(An=0,Iu=so=null,YN(a,a.pendingLanes));var b=a.pendingLanes;if(b===0&&(no=null),dh(h),l=l.stateNode,is&&typeof is.onCommitFiberRoot=="function")try{is.onCommitFiberRoot(Jo,l,void 0,(l.current.flags&128)===128)}catch{}if(m!==null){l=F.T,b=k.p,k.p=2,F.T=null;try{for(var _=a.onRecoverableError,E=0;E<m.length;E++){var O=m[E];_(O.value,{componentStack:O.stack})}}finally{F.T=l,k.p=b}}(Kr&3)!==0&&Xp(),sr(a),b=a.pendingLanes,(h&261930)!==0&&(b&42)!==0?a===Cb?qh++:(qh=0,Cb=a):qh=0,Wh(0)}}function YN(a,l){(a.pooledCacheLanes&=l)===0&&(l=a.pooledCache,l!=null&&(a.pooledCache=null,Ah(l)))}function Xp(){return qN(),WN(),XN(),ZN()}function ZN(){if(An!==5)return!1;var a=so,l=Eb;Eb=0;var h=dh(Kr),m=F.T,b=k.p;try{k.p=32>h?32:h,F.T=null,h=Rb,Rb=null;var _=so,E=Kr;if(An=0,Iu=so=null,Kr=0,(wt&6)!==0)throw Error(n(331));var O=wt;if(wt|=4,DN(_.current),EN(_,_.current,E,h),wt=O,Wh(0,!1),is&&typeof is.onPostCommitFiberRoot=="function")try{is.onPostCommitFiberRoot(Jo,_)}catch{}return!0}finally{k.p=b,F.T=m,YN(a,l)}}function QN(a,l,h){l=si(h,l),l=lb(a.stateNode,l,2),a=Za(a,l,2),a!==null&&(tl(a,2),sr(a))}function Lt(a,l,h){if(a.tag===3)QN(a,a,h);else for(;l!==null;){if(l.tag===3){QN(l,a,h);break}else if(l.tag===1){var m=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(no===null||!no.has(m))){a=si(h,a),h=KM(2),m=Za(l,h,2),m!==null&&(JM(h,m,l,a),tl(m,2),sr(m));break}}l=l.return}}function Lb(a,l,h){var m=a.pingCache;if(m===null){m=a.pingCache=new RV;var b=new Set;m.set(l,b)}else b=m.get(l),b===void 0&&(b=new Set,m.set(l,b));b.has(h)||(Mb=!0,b.add(h),a=FV.bind(null,a,l,h),l.then(a,a))}function FV(a,l,h){var m=a.pingCache;m!==null&&m.delete(l),a.pingedLanes|=a.suspendedLanes&h,a.warmLanes&=~h,kt===a&&(ft&h)===h&&(on===4||on===3&&(ft&62914560)===ft&&300>Un()-Gp?(wt&2)===0&&ku(a,0):Nb|=h,Pu===ft&&(Pu=0)),sr(a)}function KN(a,l){l===0&&(l=Hf()),a=ll(a,l),a!==null&&(tl(a,l),sr(a))}function OV(a){var l=a.memoizedState,h=0;l!==null&&(h=l.retryLane),KN(a,h)}function UV(a,l){var h=0;switch(a.tag){case 31:case 13:var m=a.stateNode,b=a.memoizedState;b!==null&&(h=b.retryLane);break;case 19:m=a.stateNode;break;case 22:m=a.stateNode._retryCache;break;default:throw Error(n(314))}m!==null&&m.delete(l),KN(a,h)}function zV(a,l){return Ai(a,l)}var Yp=null,$u=null,Fb=!1,Zp=!1,Ob=!1,ro=0;function sr(a){a!==$u&&a.next===null&&($u===null?Yp=$u=a:$u=$u.next=a),Zp=!0,Fb||(Fb=!0,PV())}function Wh(a,l){if(!Ob&&Zp){Ob=!0;do for(var h=!1,m=Yp;m!==null;){if(a!==0){var b=m.pendingLanes;if(b===0)var _=0;else{var E=m.suspendedLanes,O=m.pingedLanes;_=(1<<31-rs(42|a)+1)-1,_&=b&~(E&~O),_=_&201326741?_&201326741|1:_?_|2:0}_!==0&&(h=!0,nA(m,_))}else _=ft,_=du(m,m===kt?_:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(_&3)===0||el(m,_)||(h=!0,nA(m,_));m=m.next}while(h);Ob=!1}}function VV(){JN()}function JN(){Zp=Fb=!1;var a=0;ro!==0&&YV()&&(a=ro);for(var l=Un(),h=null,m=Yp;m!==null;){var b=m.next,_=eA(m,l);_===0?(m.next=null,h===null?Yp=b:h.next=b,b===null&&($u=h)):(h=m,(a!==0||(_&3)!==0)&&(Zp=!0)),m=b}An!==0&&An!==5||Wh(a),ro!==0&&(ro=0)}function eA(a,l){for(var h=a.suspendedLanes,m=a.pingedLanes,b=a.expirationTimes,_=a.pendingLanes&-62914561;0<_;){var E=31-rs(_),O=1<<E,Q=b[E];Q===-1?((O&h)===0||(O&m)!==0)&&(b[E]=Yy(O,l)):Q<=l&&(a.expiredLanes|=O),_&=~O}if(l=kt,h=ft,h=du(a,a===l?h:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m=a.callbackNode,h===0||a===l&&(Bt===2||Bt===9)||a.cancelPendingCommit!==null)return m!==null&&m!==null&&Dr(m),a.callbackNode=null,a.callbackPriority=0;if((h&3)===0||el(a,h)){if(l=h&-h,l===a.callbackPriority)return l;switch(m!==null&&Dr(m),dh(h)){case 2:case 8:h=Ua;break;case 32:h=Ko;break;case 268435456:h=lu;break;default:h=Ko}return m=tA.bind(null,a),h=Ai(h,m),a.callbackPriority=l,a.callbackNode=h,l}return m!==null&&m!==null&&Dr(m),a.callbackPriority=2,a.callbackNode=null,2}function tA(a,l){if(An!==0&&An!==5)return a.callbackNode=null,a.callbackPriority=0,null;var h=a.callbackNode;if(Xp()&&a.callbackNode!==h)return null;var m=ft;return m=du(a,a===kt?m:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m===0?null:(UN(a,m,l),eA(a,Un()),a.callbackNode!=null&&a.callbackNode===h?tA.bind(null,a):null)}function nA(a,l){if(Xp())return null;UN(a,l,!0)}function PV(){QV(function(){(wt&6)!==0?Ai(Br,VV):JN()})}function Ub(){if(ro===0){var a=Eu;a===0&&(a=uu,uu<<=1,(uu&261888)===0&&(uu=256)),ro=a}return ro}function sA(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:ip(""+a)}function iA(a,l){var h=l.ownerDocument.createElement("input");return h.name=l.name,h.value=l.value,a.id&&h.setAttribute("form",a.id),l.parentNode.insertBefore(h,l),a=new FormData(a),h.parentNode.removeChild(h),a}function IV(a,l,h,m,b){if(l==="submit"&&h&&h.stateNode===b){var _=sA((b[Xn]||null).action),E=m.submitter;E&&(l=(l=E[Xn]||null)?sA(l.formAction):E.getAttribute("formAction"),l!==null&&(_=l,E=null));var O=new lp("action","action",null,m,b);a.push({event:O,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(ro!==0){var Q=E?iA(b,E):new FormData(b);nb(h,{pending:!0,data:Q,method:b.method,action:_},null,Q)}}else typeof _=="function"&&(O.preventDefault(),Q=E?iA(b,E):new FormData(b),nb(h,{pending:!0,data:Q,method:b.method,action:_},_,Q))},currentTarget:b}]})}}for(var zb=0;zb<bx.length;zb++){var Vb=bx[zb],kV=Vb.toLowerCase(),GV=Vb[0].toUpperCase()+Vb.slice(1);Ri(kV,"on"+GV)}Ri(Ow,"onAnimationEnd"),Ri(Uw,"onAnimationIteration"),Ri(zw,"onAnimationStart"),Ri("dblclick","onDoubleClick"),Ri("focusin","onFocus"),Ri("focusout","onBlur"),Ri(iV,"onTransitionRun"),Ri(rV,"onTransitionStart"),Ri(aV,"onTransitionCancel"),Ri(Vw,"onTransitionEnd"),ka("onMouseEnter",["mouseout","mouseover"]),ka("onMouseLeave",["mouseout","mouseover"]),ka("onPointerEnter",["pointerout","pointerover"]),ka("onPointerLeave",["pointerout","pointerover"]),Or("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Or("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Or("onBeforeInput",["compositionend","keypress","textInput","paste"]),Or("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Or("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Or("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$V=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Xh));function rA(a,l){l=(l&4)!==0;for(var h=0;h<a.length;h++){var m=a[h],b=m.event;m=m.listeners;e:{var _=void 0;if(l)for(var E=m.length-1;0<=E;E--){var O=m[E],Q=O.instance,ce=O.currentTarget;if(O=O.listener,Q!==_&&b.isPropagationStopped())break e;_=O,b.currentTarget=ce;try{_(b)}catch(be){hp(be)}b.currentTarget=null,_=Q}else for(E=0;E<m.length;E++){if(O=m[E],Q=O.instance,ce=O.currentTarget,O=O.listener,Q!==_&&b.isPropagationStopped())break e;_=O,b.currentTarget=ce;try{_(b)}catch(be){hp(be)}b.currentTarget=null,_=Q}}}}function ut(a,l){var h=l[fu];h===void 0&&(h=l[fu]=new Set);var m=a+"__bubble";h.has(m)||(aA(l,a,2,!1),h.add(m))}function Pb(a,l,h){var m=0;l&&(m|=4),aA(h,a,m,l)}var Qp="_reactListening"+Math.random().toString(36).slice(2);function Ib(a){if(!a[Qp]){a[Qp]=!0,Kf.forEach(function(h){h!=="selectionchange"&&($V.has(h)||Pb(h,!1,a),Pb(h,!0,a))});var l=a.nodeType===9?a:a.ownerDocument;l===null||l[Qp]||(l[Qp]=!0,Pb("selectionchange",!1,l))}}function aA(a,l,h,m){switch(OA(l)){case 2:var b=yP;break;case 8:b=xP;break;default:b=t1}h=b.bind(null,l,h,a),b=void 0,!ax||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(b=!0),m?b!==void 0?a.addEventListener(l,h,{capture:!0,passive:b}):a.addEventListener(l,h,!0):b!==void 0?a.addEventListener(l,h,{passive:b}):a.addEventListener(l,h,!1)}function kb(a,l,h,m,b){var _=m;if((l&1)===0&&(l&2)===0&&m!==null)e:for(;;){if(m===null)return;var E=m.tag;if(E===3||E===4){var O=m.stateNode.containerInfo;if(O===b)break;if(E===4)for(E=m.return;E!==null;){var Q=E.tag;if((Q===3||Q===4)&&E.stateNode.containerInfo===b)return;E=E.return}for(;O!==null;){if(E=za(O),E===null)return;if(Q=E.tag,Q===5||Q===6||Q===26||Q===27){m=_=E;continue e}O=O.parentNode}}m=m.return}hw(function(){var ce=_,be=ix(h),Te=[];e:{var de=Pw.get(a);if(de!==void 0){var ge=lp,Pe=a;switch(a){case"keypress":if(ap(h)===0)break e;case"keydown":case"keyup":ge=Uz;break;case"focusin":Pe="focus",ge=cx;break;case"focusout":Pe="blur",ge=cx;break;case"beforeblur":case"afterblur":ge=cx;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=pw;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=wz;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=Pz;break;case Ow:case Uw:case zw:ge=Az;break;case Vw:ge=kz;break;case"scroll":case"scrollend":ge=Tz;break;case"wheel":ge=$z;break;case"copy":case"cut":case"paste":ge=Rz;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=gw;break;case"toggle":case"beforetoggle":ge=jz}var Xe=(l&4)!==0,Vt=!Xe&&(a==="scroll"||a==="scrollend"),ae=Xe?de!==null?de+"Capture":null:de;Xe=[];for(var ne=ce,ue;ne!==null;){var _e=ne;if(ue=_e.stateNode,_e=_e.tag,_e!==5&&_e!==26&&_e!==27||ue===null||ae===null||(_e=gh(ne,ae),_e!=null&&Xe.push(Yh(ne,_e,ue))),Vt)break;ne=ne.return}0<Xe.length&&(de=new ge(de,Pe,null,h,be),Te.push({event:de,listeners:Xe}))}}if((l&7)===0){e:{if(de=a==="mouseover"||a==="pointerover",ge=a==="mouseout"||a==="pointerout",de&&h!==sx&&(Pe=h.relatedTarget||h.fromElement)&&(za(Pe)||Pe[Fr]))break e;if((ge||de)&&(de=be.window===be?be:(de=be.ownerDocument)?de.defaultView||de.parentWindow:window,ge?(Pe=h.relatedTarget||h.toElement,ge=ce,Pe=Pe?za(Pe):null,Pe!==null&&(Vt=r(Pe),Xe=Pe.tag,Pe!==Vt||Xe!==5&&Xe!==27&&Xe!==6)&&(Pe=null)):(ge=null,Pe=ce),ge!==Pe)){if(Xe=pw,_e="onMouseLeave",ae="onMouseEnter",ne="mouse",(a==="pointerout"||a==="pointerover")&&(Xe=gw,_e="onPointerLeave",ae="onPointerEnter",ne="pointer"),Vt=ge==null?de:Pa(ge),ue=Pe==null?de:Pa(Pe),de=new Xe(_e,ne+"leave",ge,h,be),de.target=Vt,de.relatedTarget=ue,_e=null,za(be)===ce&&(Xe=new Xe(ae,ne+"enter",Pe,h,be),Xe.target=ue,Xe.relatedTarget=Vt,_e=Xe),Vt=_e,ge&&Pe)t:{for(Xe=HV,ae=ge,ne=Pe,ue=0,_e=ae;_e;_e=Xe(_e))ue++;_e=0;for(var je=ne;je;je=Xe(je))_e++;for(;0<ue-_e;)ae=Xe(ae),ue--;for(;0<_e-ue;)ne=Xe(ne),_e--;for(;ue--;){if(ae===ne||ne!==null&&ae===ne.alternate){Xe=ae;break t}ae=Xe(ae),ne=Xe(ne)}Xe=null}else Xe=null;ge!==null&&oA(Te,de,ge,Xe,!1),Pe!==null&&Vt!==null&&oA(Te,Vt,Pe,Xe,!0)}}e:{if(de=ce?Pa(ce):window,ge=de.nodeName&&de.nodeName.toLowerCase(),ge==="select"||ge==="input"&&de.type==="file")var Tt=ww;else if(Tw(de))if(Mw)Tt=tV;else{Tt=Jz;var $e=Kz}else ge=de.nodeName,!ge||ge.toLowerCase()!=="input"||de.type!=="checkbox"&&de.type!=="radio"?ce&&nx(ce.elementType)&&(Tt=ww):Tt=eV;if(Tt&&(Tt=Tt(a,ce))){Sw(Te,Tt,h,be);break e}$e&&$e(a,de,ce),a==="focusout"&&ce&&de.type==="number"&&ce.memoizedProps.value!=null&&mh(de,"number",de.value)}switch($e=ce?Pa(ce):window,a){case"focusin":(Tw($e)||$e.contentEditable==="true")&&(_u=$e,gx=ce,wh=null);break;case"focusout":wh=gx=_u=null;break;case"mousedown":yx=!0;break;case"contextmenu":case"mouseup":case"dragend":yx=!1,Lw(Te,h,be);break;case"selectionchange":if(sV)break;case"keydown":case"keyup":Lw(Te,h,be)}var st;if(dx)e:{switch(a){case"compositionstart":var pt="onCompositionStart";break e;case"compositionend":pt="onCompositionEnd";break e;case"compositionupdate":pt="onCompositionUpdate";break e}pt=void 0}else bu?_w(a,h)&&(pt="onCompositionEnd"):a==="keydown"&&h.keyCode===229&&(pt="onCompositionStart");pt&&(yw&&h.locale!=="ko"&&(bu||pt!=="onCompositionStart"?pt==="onCompositionEnd"&&bu&&(st=dw()):($a=be,ox="value"in $a?$a.value:$a.textContent,bu=!0)),$e=Kp(ce,pt),0<$e.length&&(pt=new mw(pt,a,null,h,be),Te.push({event:pt,listeners:$e}),st?pt.data=st:(st=vw(h),st!==null&&(pt.data=st)))),(st=Wz?Xz(a,h):Yz(a,h))&&(pt=Kp(ce,"onBeforeInput"),0<pt.length&&($e=new mw("onBeforeInput","beforeinput",null,h,be),Te.push({event:$e,listeners:pt}),$e.data=st)),IV(Te,a,ce,h,be)}rA(Te,l)})}function Yh(a,l,h){return{instance:a,listener:l,currentTarget:h}}function Kp(a,l){for(var h=l+"Capture",m=[];a!==null;){var b=a,_=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||_===null||(b=gh(a,h),b!=null&&m.unshift(Yh(a,b,_)),b=gh(a,l),b!=null&&m.push(Yh(a,b,_))),a.tag===3)return m;a=a.return}return[]}function HV(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function oA(a,l,h,m,b){for(var _=l._reactName,E=[];h!==null&&h!==m;){var O=h,Q=O.alternate,ce=O.stateNode;if(O=O.tag,Q!==null&&Q===m)break;O!==5&&O!==26&&O!==27||ce===null||(Q=ce,b?(ce=gh(h,_),ce!=null&&E.unshift(Yh(h,ce,Q))):b||(ce=gh(h,_),ce!=null&&E.push(Yh(h,ce,Q)))),h=h.return}E.length!==0&&a.push({event:l,listeners:E})}var jV=/\r\n?/g,qV=/\u0000|\uFFFD/g;function lA(a){return(typeof a=="string"?a:""+a).replace(jV,`
`).replace(qV,"")}function uA(a,l){return l=lA(l),lA(a)===l}function zt(a,l,h,m,b,_){switch(h){case"children":typeof m=="string"?l==="body"||l==="textarea"&&m===""||gu(a,m):(typeof m=="number"||typeof m=="bigint")&&l!=="body"&&gu(a,""+m);break;case"className":mu(a,"class",m);break;case"tabIndex":mu(a,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":mu(a,h,m);break;case"style":uw(a,m,_);break;case"data":if(l!=="object"){mu(a,"data",m);break}case"src":case"href":if(m===""&&(l!=="a"||h!=="href")){a.removeAttribute(h);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(h);break}m=ip(""+m),a.setAttribute(h,m);break;case"action":case"formAction":if(typeof m=="function"){a.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof _=="function"&&(h==="formAction"?(l!=="input"&&zt(a,l,"name",b.name,b,null),zt(a,l,"formEncType",b.formEncType,b,null),zt(a,l,"formMethod",b.formMethod,b,null),zt(a,l,"formTarget",b.formTarget,b,null)):(zt(a,l,"encType",b.encType,b,null),zt(a,l,"method",b.method,b,null),zt(a,l,"target",b.target,b,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(h);break}m=ip(""+m),a.setAttribute(h,m);break;case"onClick":m!=null&&(a.onclick=zr);break;case"onScroll":m!=null&&ut("scroll",a);break;case"onScrollEnd":m!=null&&ut("scrollend",a);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(h=m.__html,h!=null){if(b.children!=null)throw Error(n(60));a.innerHTML=h}}break;case"multiple":a.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":a.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){a.removeAttribute("xlink:href");break}h=ip(""+m),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(h,""+m):a.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(h,""):a.removeAttribute(h);break;case"capture":case"download":m===!0?a.setAttribute(h,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(h,m):a.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?a.setAttribute(h,m):a.removeAttribute(h);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?a.removeAttribute(h):a.setAttribute(h,m);break;case"popover":ut("beforetoggle",a),ut("toggle",a),pu(a,"popover",m);break;case"xlinkActuate":Ei(a,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":Ei(a,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":Ei(a,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":Ei(a,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":Ei(a,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":Ei(a,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":Ei(a,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":Ei(a,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":Ei(a,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":pu(a,"is",m);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=_z.get(h)||h,pu(a,h,m))}}function Gb(a,l,h,m,b,_){switch(h){case"style":uw(a,m,_);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(h=m.__html,h!=null){if(b.children!=null)throw Error(n(60));a.innerHTML=h}}break;case"children":typeof m=="string"?gu(a,m):(typeof m=="number"||typeof m=="bigint")&&gu(a,""+m);break;case"onScroll":m!=null&&ut("scroll",a);break;case"onScrollEnd":m!=null&&ut("scrollend",a);break;case"onClick":m!=null&&(a.onclick=zr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Jf.hasOwnProperty(h))e:{if(h[0]==="o"&&h[1]==="n"&&(b=h.endsWith("Capture"),l=h.slice(2,b?h.length-7:void 0),_=a[Xn]||null,_=_!=null?_[h]:null,typeof _=="function"&&a.removeEventListener(l,_,b),typeof m=="function")){typeof _!="function"&&_!==null&&(h in a?a[h]=null:a.hasAttribute(h)&&a.removeAttribute(h)),a.addEventListener(l,m,b);break e}h in a?a[h]=m:m===!0?a.setAttribute(h,""):pu(a,h,m)}}}function In(a,l,h){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ut("error",a),ut("load",a);var m=!1,b=!1,_;for(_ in h)if(h.hasOwnProperty(_)){var E=h[_];if(E!=null)switch(_){case"src":m=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:zt(a,l,_,E,h,null)}}b&&zt(a,l,"srcSet",h.srcSet,h,null),m&&zt(a,l,"src",h.src,h,null);return;case"input":ut("invalid",a);var O=_=E=b=null,Q=null,ce=null;for(m in h)if(h.hasOwnProperty(m)){var be=h[m];if(be!=null)switch(m){case"name":b=be;break;case"type":E=be;break;case"checked":Q=be;break;case"defaultChecked":ce=be;break;case"value":_=be;break;case"defaultValue":O=be;break;case"children":case"dangerouslySetInnerHTML":if(be!=null)throw Error(n(137,l));break;default:zt(a,l,m,be,h,null)}}sp(a,_,O,Q,ce,E,b,!1);return;case"select":ut("invalid",a),m=E=_=null;for(b in h)if(h.hasOwnProperty(b)&&(O=h[b],O!=null))switch(b){case"value":_=O;break;case"defaultValue":E=O;break;case"multiple":m=O;default:zt(a,l,b,O,h,null)}l=_,h=E,a.multiple=!!m,l!=null?Ur(a,!!m,l,!1):h!=null&&Ur(a,!!m,h,!0);return;case"textarea":ut("invalid",a),_=b=m=null;for(E in h)if(h.hasOwnProperty(E)&&(O=h[E],O!=null))switch(E){case"value":m=O;break;case"defaultValue":b=O;break;case"children":_=O;break;case"dangerouslySetInnerHTML":if(O!=null)throw Error(n(91));break;default:zt(a,l,E,O,h,null)}ow(a,m,b,_);return;case"option":for(Q in h)if(h.hasOwnProperty(Q)&&(m=h[Q],m!=null))switch(Q){case"selected":a.selected=m&&typeof m!="function"&&typeof m!="symbol";break;default:zt(a,l,Q,m,h,null)}return;case"dialog":ut("beforetoggle",a),ut("toggle",a),ut("cancel",a),ut("close",a);break;case"iframe":case"object":ut("load",a);break;case"video":case"audio":for(m=0;m<Xh.length;m++)ut(Xh[m],a);break;case"image":ut("error",a),ut("load",a);break;case"details":ut("toggle",a);break;case"embed":case"source":case"link":ut("error",a),ut("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ce in h)if(h.hasOwnProperty(ce)&&(m=h[ce],m!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:zt(a,l,ce,m,h,null)}return;default:if(nx(l)){for(be in h)h.hasOwnProperty(be)&&(m=h[be],m!==void 0&&Gb(a,l,be,m,h,void 0));return}}for(O in h)h.hasOwnProperty(O)&&(m=h[O],m!=null&&zt(a,l,O,m,h,null))}function WV(a,l,h,m){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,_=null,E=null,O=null,Q=null,ce=null,be=null;for(ge in h){var Te=h[ge];if(h.hasOwnProperty(ge)&&Te!=null)switch(ge){case"checked":break;case"value":break;case"defaultValue":Q=Te;default:m.hasOwnProperty(ge)||zt(a,l,ge,null,m,Te)}}for(var de in m){var ge=m[de];if(Te=h[de],m.hasOwnProperty(de)&&(ge!=null||Te!=null))switch(de){case"type":_=ge;break;case"name":b=ge;break;case"checked":ce=ge;break;case"defaultChecked":be=ge;break;case"value":E=ge;break;case"defaultValue":O=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(n(137,l));break;default:ge!==Te&&zt(a,l,de,ge,m,Te)}}il(a,E,O,Q,ce,be,_,b);return;case"select":ge=E=O=de=null;for(_ in h)if(Q=h[_],h.hasOwnProperty(_)&&Q!=null)switch(_){case"value":break;case"multiple":ge=Q;default:m.hasOwnProperty(_)||zt(a,l,_,null,m,Q)}for(b in m)if(_=m[b],Q=h[b],m.hasOwnProperty(b)&&(_!=null||Q!=null))switch(b){case"value":de=_;break;case"defaultValue":O=_;break;case"multiple":E=_;default:_!==Q&&zt(a,l,b,_,m,Q)}l=O,h=E,m=ge,de!=null?Ur(a,!!h,de,!1):!!m!=!!h&&(l!=null?Ur(a,!!h,l,!0):Ur(a,!!h,h?[]:"",!1));return;case"textarea":ge=de=null;for(O in h)if(b=h[O],h.hasOwnProperty(O)&&b!=null&&!m.hasOwnProperty(O))switch(O){case"value":break;case"children":break;default:zt(a,l,O,null,m,b)}for(E in m)if(b=m[E],_=h[E],m.hasOwnProperty(E)&&(b!=null||_!=null))switch(E){case"value":de=b;break;case"defaultValue":ge=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(n(91));break;default:b!==_&&zt(a,l,E,b,m,_)}aw(a,de,ge);return;case"option":for(var Pe in h)if(de=h[Pe],h.hasOwnProperty(Pe)&&de!=null&&!m.hasOwnProperty(Pe))switch(Pe){case"selected":a.selected=!1;break;default:zt(a,l,Pe,null,m,de)}for(Q in m)if(de=m[Q],ge=h[Q],m.hasOwnProperty(Q)&&de!==ge&&(de!=null||ge!=null))switch(Q){case"selected":a.selected=de&&typeof de!="function"&&typeof de!="symbol";break;default:zt(a,l,Q,de,m,ge)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Xe in h)de=h[Xe],h.hasOwnProperty(Xe)&&de!=null&&!m.hasOwnProperty(Xe)&&zt(a,l,Xe,null,m,de);for(ce in m)if(de=m[ce],ge=h[ce],m.hasOwnProperty(ce)&&de!==ge&&(de!=null||ge!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(n(137,l));break;default:zt(a,l,ce,de,m,ge)}return;default:if(nx(l)){for(var Vt in h)de=h[Vt],h.hasOwnProperty(Vt)&&de!==void 0&&!m.hasOwnProperty(Vt)&&Gb(a,l,Vt,void 0,m,de);for(be in m)de=m[be],ge=h[be],!m.hasOwnProperty(be)||de===ge||de===void 0&&ge===void 0||Gb(a,l,be,de,m,ge);return}}for(var ae in h)de=h[ae],h.hasOwnProperty(ae)&&de!=null&&!m.hasOwnProperty(ae)&&zt(a,l,ae,null,m,de);for(Te in m)de=m[Te],ge=h[Te],!m.hasOwnProperty(Te)||de===ge||de==null&&ge==null||zt(a,l,Te,de,m,ge)}function cA(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function XV(){if(typeof performance.getEntriesByType=="function"){for(var a=0,l=0,h=performance.getEntriesByType("resource"),m=0;m<h.length;m++){var b=h[m],_=b.transferSize,E=b.initiatorType,O=b.duration;if(_&&O&&cA(E)){for(E=0,O=b.responseEnd,m+=1;m<h.length;m++){var Q=h[m],ce=Q.startTime;if(ce>O)break;var be=Q.transferSize,Te=Q.initiatorType;be&&cA(Te)&&(Q=Q.responseEnd,E+=be*(Q<O?1:(O-ce)/(Q-ce)))}if(--m,l+=8*(_+E)/(b.duration/1e3),a++,10<a)break}}if(0<a)return l/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var $b=null,Hb=null;function Jp(a){return a.nodeType===9?a:a.ownerDocument}function hA(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function dA(a,l){if(a===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&l==="foreignObject"?0:a}function jb(a,l){return a==="textarea"||a==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var qb=null;function YV(){var a=window.event;return a&&a.type==="popstate"?a===qb?!1:(qb=a,!0):(qb=null,!1)}var fA=typeof setTimeout=="function"?setTimeout:void 0,ZV=typeof clearTimeout=="function"?clearTimeout:void 0,pA=typeof Promise=="function"?Promise:void 0,QV=typeof queueMicrotask=="function"?queueMicrotask:typeof pA<"u"?function(a){return pA.resolve(null).then(a).catch(KV)}:fA;function KV(a){setTimeout(function(){throw a})}function ao(a){return a==="head"}function mA(a,l){var h=l,m=0;do{var b=h.nextSibling;if(a.removeChild(h),b&&b.nodeType===8)if(h=b.data,h==="/$"||h==="/&"){if(m===0){a.removeChild(b),Wu(l);return}m--}else if(h==="$"||h==="$?"||h==="$~"||h==="$!"||h==="&")m++;else if(h==="html")Zh(a.ownerDocument.documentElement);else if(h==="head"){h=a.ownerDocument.head,Zh(h);for(var _=h.firstChild;_;){var E=_.nextSibling,O=_.nodeName;_[nl]||O==="SCRIPT"||O==="STYLE"||O==="LINK"&&_.rel.toLowerCase()==="stylesheet"||h.removeChild(_),_=E}}else h==="body"&&Zh(a.ownerDocument.body);h=b}while(h);Wu(l)}function gA(a,l){var h=a;a=0;do{var m=h.nextSibling;if(h.nodeType===1?l?(h._stashedDisplay=h.style.display,h.style.display="none"):(h.style.display=h._stashedDisplay||"",h.getAttribute("style")===""&&h.removeAttribute("style")):h.nodeType===3&&(l?(h._stashedText=h.nodeValue,h.nodeValue=""):h.nodeValue=h._stashedText||""),m&&m.nodeType===8)if(h=m.data,h==="/$"){if(a===0)break;a--}else h!=="$"&&h!=="$?"&&h!=="$~"&&h!=="$!"||a++;h=m}while(h)}function Wb(a){var l=a.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var h=l;switch(l=l.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":Wb(h),fh(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}a.removeChild(h)}}function JV(a,l,h,m){for(;a.nodeType===1;){var b=h;if(a.nodeName.toLowerCase()!==l.toLowerCase()){if(!m&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(m){if(!a[nl])switch(l){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(_=a.getAttribute("rel"),_==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(_!==b.rel||a.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||a.getAttribute("title")!==(b.title==null?null:b.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(_=a.getAttribute("src"),(_!==(b.src==null?null:b.src)||a.getAttribute("type")!==(b.type==null?null:b.type)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&_&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(l==="input"&&a.type==="hidden"){var _=b.name==null?null:""+b.name;if(b.type==="hidden"&&a.getAttribute("name")===_)return a}else return a;if(a=li(a.nextSibling),a===null)break}return null}function eP(a,l,h){if(l==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!h||(a=li(a.nextSibling),a===null))return null;return a}function yA(a,l){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!l||(a=li(a.nextSibling),a===null))return null;return a}function Xb(a){return a.data==="$?"||a.data==="$~"}function Yb(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function tP(a,l){var h=a.ownerDocument;if(a.data==="$~")a._reactRetry=l;else if(a.data!=="$?"||h.readyState!=="loading")l();else{var m=function(){l(),h.removeEventListener("DOMContentLoaded",m)};h.addEventListener("DOMContentLoaded",m),a._reactRetry=m}}function li(a){for(;a!=null;a=a.nextSibling){var l=a.nodeType;if(l===1||l===3)break;if(l===8){if(l=a.data,l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"||l==="F!"||l==="F")break;if(l==="/$"||l==="/&")return null}}return a}var Zb=null;function xA(a){a=a.nextSibling;for(var l=0;a;){if(a.nodeType===8){var h=a.data;if(h==="/$"||h==="/&"){if(l===0)return li(a.nextSibling);l--}else h!=="$"&&h!=="$!"&&h!=="$?"&&h!=="$~"&&h!=="&"||l++}a=a.nextSibling}return null}function bA(a){a=a.previousSibling;for(var l=0;a;){if(a.nodeType===8){var h=a.data;if(h==="$"||h==="$!"||h==="$?"||h==="$~"||h==="&"){if(l===0)return a;l--}else h!=="/$"&&h!=="/&"||l++}a=a.previousSibling}return null}function _A(a,l,h){switch(l=Jp(h),a){case"html":if(a=l.documentElement,!a)throw Error(n(452));return a;case"head":if(a=l.head,!a)throw Error(n(453));return a;case"body":if(a=l.body,!a)throw Error(n(454));return a;default:throw Error(n(451))}}function Zh(a){for(var l=a.attributes;l.length;)a.removeAttributeNode(l[0]);fh(a)}var ui=new Map,vA=new Set;function em(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Jr=k.d;k.d={f:nP,r:sP,D:iP,C:rP,L:aP,m:oP,X:uP,S:lP,M:cP};function nP(){var a=Jr.f(),l=jp();return a||l}function sP(a){var l=Va(a);l!==null&&l.tag===5&&l.type==="form"?VM(l):Jr.r(a)}var Hu=typeof document>"u"?null:document;function TA(a,l,h){var m=Hu;if(m&&typeof l=="string"&&l){var b=ys(l);b='link[rel="'+a+'"][href="'+b+'"]',typeof h=="string"&&(b+='[crossorigin="'+h+'"]'),vA.has(b)||(vA.add(b),a={rel:a,crossOrigin:h,href:l},m.querySelector(b)===null&&(l=m.createElement("link"),In(l,"link",a),mn(l),m.head.appendChild(l)))}}function iP(a){Jr.D(a),TA("dns-prefetch",a,null)}function rP(a,l){Jr.C(a,l),TA("preconnect",a,l)}function aP(a,l,h){Jr.L(a,l,h);var m=Hu;if(m&&a&&l){var b='link[rel="preload"][as="'+ys(l)+'"]';l==="image"&&h&&h.imageSrcSet?(b+='[imagesrcset="'+ys(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(b+='[imagesizes="'+ys(h.imageSizes)+'"]')):b+='[href="'+ys(a)+'"]';var _=b;switch(l){case"style":_=ju(a);break;case"script":_=qu(a)}ui.has(_)||(a=p({rel:"preload",href:l==="image"&&h&&h.imageSrcSet?void 0:a,as:l},h),ui.set(_,a),m.querySelector(b)!==null||l==="style"&&m.querySelector(Qh(_))||l==="script"&&m.querySelector(Kh(_))||(l=m.createElement("link"),In(l,"link",a),mn(l),m.head.appendChild(l)))}}function oP(a,l){Jr.m(a,l);var h=Hu;if(h&&a){var m=l&&typeof l.as=="string"?l.as:"script",b='link[rel="modulepreload"][as="'+ys(m)+'"][href="'+ys(a)+'"]',_=b;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":_=qu(a)}if(!ui.has(_)&&(a=p({rel:"modulepreload",href:a},l),ui.set(_,a),h.querySelector(b)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(Kh(_)))return}m=h.createElement("link"),In(m,"link",a),mn(m),h.head.appendChild(m)}}}function lP(a,l,h){Jr.S(a,l,h);var m=Hu;if(m&&a){var b=Ia(m).hoistableStyles,_=ju(a);l=l||"default";var E=b.get(_);if(!E){var O={loading:0,preload:null};if(E=m.querySelector(Qh(_)))O.loading=5;else{a=p({rel:"stylesheet",href:a,"data-precedence":l},h),(h=ui.get(_))&&Qb(a,h);var Q=E=m.createElement("link");mn(Q),In(Q,"link",a),Q._p=new Promise(function(ce,be){Q.onload=ce,Q.onerror=be}),Q.addEventListener("load",function(){O.loading|=1}),Q.addEventListener("error",function(){O.loading|=2}),O.loading|=4,tm(E,l,m)}E={type:"stylesheet",instance:E,count:1,state:O},b.set(_,E)}}}function uP(a,l){Jr.X(a,l);var h=Hu;if(h&&a){var m=Ia(h).hoistableScripts,b=qu(a),_=m.get(b);_||(_=h.querySelector(Kh(b)),_||(a=p({src:a,async:!0},l),(l=ui.get(b))&&Kb(a,l),_=h.createElement("script"),mn(_),In(_,"link",a),h.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},m.set(b,_))}}function cP(a,l){Jr.M(a,l);var h=Hu;if(h&&a){var m=Ia(h).hoistableScripts,b=qu(a),_=m.get(b);_||(_=h.querySelector(Kh(b)),_||(a=p({src:a,async:!0,type:"module"},l),(l=ui.get(b))&&Kb(a,l),_=h.createElement("script"),mn(_),In(_,"link",a),h.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},m.set(b,_))}}function SA(a,l,h,m){var b=(b=le.current)?em(b):null;if(!b)throw Error(n(446));switch(a){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(l=ju(h.href),h=Ia(b).hoistableStyles,m=h.get(l),m||(m={type:"style",instance:null,count:0,state:null},h.set(l,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){a=ju(h.href);var _=Ia(b).hoistableStyles,E=_.get(a);if(E||(b=b.ownerDocument||b,E={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},_.set(a,E),(_=b.querySelector(Qh(a)))&&!_._p&&(E.instance=_,E.state.loading=5),ui.has(a)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},ui.set(a,h),_||hP(b,a,h,E.state))),l&&m===null)throw Error(n(528,""));return E}if(l&&m!==null)throw Error(n(529,""));return null;case"script":return l=h.async,h=h.src,typeof h=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=qu(h),h=Ia(b).hoistableScripts,m=h.get(l),m||(m={type:"script",instance:null,count:0,state:null},h.set(l,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,a))}}function ju(a){return'href="'+ys(a)+'"'}function Qh(a){return'link[rel="stylesheet"]['+a+"]"}function wA(a){return p({},a,{"data-precedence":a.precedence,precedence:null})}function hP(a,l,h,m){a.querySelector('link[rel="preload"][as="style"]['+l+"]")?m.loading=1:(l=a.createElement("link"),m.preload=l,l.addEventListener("load",function(){return m.loading|=1}),l.addEventListener("error",function(){return m.loading|=2}),In(l,"link",h),mn(l),a.head.appendChild(l))}function qu(a){return'[src="'+ys(a)+'"]'}function Kh(a){return"script[async]"+a}function MA(a,l,h){if(l.count++,l.instance===null)switch(l.type){case"style":var m=a.querySelector('style[data-href~="'+ys(h.href)+'"]');if(m)return l.instance=m,mn(m),m;var b=p({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return m=(a.ownerDocument||a).createElement("style"),mn(m),In(m,"style",b),tm(m,h.precedence,a),l.instance=m;case"stylesheet":b=ju(h.href);var _=a.querySelector(Qh(b));if(_)return l.state.loading|=4,l.instance=_,mn(_),_;m=wA(h),(b=ui.get(b))&&Qb(m,b),_=(a.ownerDocument||a).createElement("link"),mn(_);var E=_;return E._p=new Promise(function(O,Q){E.onload=O,E.onerror=Q}),In(_,"link",m),l.state.loading|=4,tm(_,h.precedence,a),l.instance=_;case"script":return _=qu(h.src),(b=a.querySelector(Kh(_)))?(l.instance=b,mn(b),b):(m=h,(b=ui.get(_))&&(m=p({},h),Kb(m,b)),a=a.ownerDocument||a,b=a.createElement("script"),mn(b),In(b,"link",m),a.head.appendChild(b),l.instance=b);case"void":return null;default:throw Error(n(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(m=l.instance,l.state.loading|=4,tm(m,h.precedence,a));return l.instance}function tm(a,l,h){for(var m=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=m.length?m[m.length-1]:null,_=b,E=0;E<m.length;E++){var O=m[E];if(O.dataset.precedence===l)_=O;else if(_!==b)break}_?_.parentNode.insertBefore(a,_.nextSibling):(l=h.nodeType===9?h.head:h,l.insertBefore(a,l.firstChild))}function Qb(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.title==null&&(a.title=l.title)}function Kb(a,l){a.crossOrigin==null&&(a.crossOrigin=l.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=l.referrerPolicy),a.integrity==null&&(a.integrity=l.integrity)}var nm=null;function NA(a,l,h){if(nm===null){var m=new Map,b=nm=new Map;b.set(h,m)}else b=nm,m=b.get(h),m||(m=new Map,b.set(h,m));if(m.has(a))return m;for(m.set(a,null),h=h.getElementsByTagName(a),b=0;b<h.length;b++){var _=h[b];if(!(_[nl]||_[Nn]||a==="link"&&_.getAttribute("rel")==="stylesheet")&&_.namespaceURI!=="http://www.w3.org/2000/svg"){var E=_.getAttribute(l)||"";E=a+E;var O=m.get(E);O?O.push(_):m.set(E,[_])}}return m}function AA(a,l,h){a=a.ownerDocument||a,a.head.insertBefore(h,l==="title"?a.querySelector("head > title"):null)}function dP(a,l,h){if(h===1||l.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;switch(l.rel){case"stylesheet":return a=l.disabled,typeof l.precedence=="string"&&a==null;default:return!0}case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function EA(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function fP(a,l,h,m){if(h.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var b=ju(m.href),_=l.querySelector(Qh(b));if(_){l=_._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(a.count++,a=sm.bind(a),l.then(a,a)),h.state.loading|=4,h.instance=_,mn(_);return}_=l.ownerDocument||l,m=wA(m),(b=ui.get(b))&&Qb(m,b),_=_.createElement("link"),mn(_);var E=_;E._p=new Promise(function(O,Q){E.onload=O,E.onerror=Q}),In(_,"link",m),h.instance=_}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(h,l),(l=h.state.preload)&&(h.state.loading&3)===0&&(a.count++,h=sm.bind(a),l.addEventListener("load",h),l.addEventListener("error",h))}}var Jb=0;function pP(a,l){return a.stylesheets&&a.count===0&&rm(a,a.stylesheets),0<a.count||0<a.imgCount?function(h){var m=setTimeout(function(){if(a.stylesheets&&rm(a,a.stylesheets),a.unsuspend){var _=a.unsuspend;a.unsuspend=null,_()}},6e4+l);0<a.imgBytes&&Jb===0&&(Jb=62500*XV());var b=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&rm(a,a.stylesheets),a.unsuspend)){var _=a.unsuspend;a.unsuspend=null,_()}},(a.imgBytes>Jb?50:800)+l);return a.unsuspend=h,function(){a.unsuspend=null,clearTimeout(m),clearTimeout(b)}}:null}function sm(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)rm(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var im=null;function rm(a,l){a.stylesheets=null,a.unsuspend!==null&&(a.count++,im=new Map,l.forEach(mP,a),im=null,sm.call(a))}function mP(a,l){if(!(l.state.loading&4)){var h=im.get(a);if(h)var m=h.get(null);else{h=new Map,im.set(a,h);for(var b=a.querySelectorAll("link[data-precedence],style[data-precedence]"),_=0;_<b.length;_++){var E=b[_];(E.nodeName==="LINK"||E.getAttribute("media")!=="not all")&&(h.set(E.dataset.precedence,E),m=E)}m&&h.set(null,m)}b=l.instance,E=b.getAttribute("data-precedence"),_=h.get(E)||m,_===m&&h.set(null,b),h.set(E,b),this.count++,m=sm.bind(this),b.addEventListener("load",m),b.addEventListener("error",m),_?_.parentNode.insertBefore(b,_.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(b,a.firstChild)),l.state.loading|=4}}var Jh={$$typeof:T,Provider:null,Consumer:null,_currentValue:I,_currentValue2:I,_threadCount:0};function gP(a,l,h,m,b,_,E,O,Q){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ch(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ch(0),this.hiddenUpdates=ch(null),this.identifierPrefix=m,this.onUncaughtError=b,this.onCaughtError=_,this.onRecoverableError=E,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Q,this.incompleteTransitions=new Map}function RA(a,l,h,m,b,_,E,O,Q,ce,be,Te){return a=new gP(a,l,h,E,Q,ce,be,Te,O),l=1,_===!0&&(l|=24),_=zs(3,null,null,l),a.current=_,_.stateNode=a,l=Bx(),l.refCount++,a.pooledCache=l,l.refCount++,_.memoizedState={element:m,isDehydrated:h,cache:l},Ux(_),a}function CA(a){return a?(a=Su,a):Su}function DA(a,l,h,m,b,_){b=CA(b),m.context===null?m.context=b:m.pendingContext=b,m=Ya(l),m.payload={element:h},_=_===void 0?null:_,_!==null&&(m.callback=_),h=Za(a,m,l),h!==null&&(Ss(h,a,l),Dh(h,a,l))}function BA(a,l){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var h=a.retryLane;a.retryLane=h!==0&&h<l?h:l}}function e1(a,l){BA(a,l),(a=a.alternate)&&BA(a,l)}function LA(a){if(a.tag===13||a.tag===31){var l=ll(a,67108864);l!==null&&Ss(l,a,67108864),e1(a,67108864)}}function FA(a){if(a.tag===13||a.tag===31){var l=Gs();l=hh(l);var h=ll(a,l);h!==null&&Ss(h,a,l),e1(a,l)}}var am=!0;function yP(a,l,h,m){var b=F.T;F.T=null;var _=k.p;try{k.p=2,t1(a,l,h,m)}finally{k.p=_,F.T=b}}function xP(a,l,h,m){var b=F.T;F.T=null;var _=k.p;try{k.p=8,t1(a,l,h,m)}finally{k.p=_,F.T=b}}function t1(a,l,h,m){if(am){var b=n1(m);if(b===null)kb(a,l,m,om,h),UA(a,m);else if(_P(b,a,l,h,m))m.stopPropagation();else if(UA(a,m),l&4&&-1<bP.indexOf(a)){for(;b!==null;){var _=Va(b);if(_!==null)switch(_.tag){case 3:if(_=_.stateNode,_.current.memoizedState.isDehydrated){var E=Lr(_.pendingLanes);if(E!==0){var O=_;for(O.pendingLanes|=2,O.entangledLanes|=2;E;){var Q=1<<31-rs(E);O.entanglements[1]|=Q,E&=~Q}sr(_),(wt&6)===0&&($p=Un()+500,Wh(0))}}break;case 31:case 13:O=ll(_,2),O!==null&&Ss(O,_,2),jp(),e1(_,2)}if(_=n1(m),_===null&&kb(a,l,m,om,h),_===b)break;b=_}b!==null&&m.stopPropagation()}else kb(a,l,m,null,h)}}function n1(a){return a=ix(a),s1(a)}var om=null;function s1(a){if(om=null,a=za(a),a!==null){var l=r(a);if(l===null)a=null;else{var h=l.tag;if(h===13){if(a=o(l),a!==null)return a;a=null}else if(h===31){if(a=u(l),a!==null)return a;a=null}else if(h===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;a=null}else l!==a&&(a=null)}}return om=a,null}function OA(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ou()){case Br:return 2;case Ua:return 8;case Ko:case $y:return 32;case lu:return 268435456;default:return 32}default:return 32}}var i1=!1,oo=null,lo=null,uo=null,ed=new Map,td=new Map,co=[],bP="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function UA(a,l){switch(a){case"focusin":case"focusout":oo=null;break;case"dragenter":case"dragleave":lo=null;break;case"mouseover":case"mouseout":uo=null;break;case"pointerover":case"pointerout":ed.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":td.delete(l.pointerId)}}function nd(a,l,h,m,b,_){return a===null||a.nativeEvent!==_?(a={blockedOn:l,domEventName:h,eventSystemFlags:m,nativeEvent:_,targetContainers:[b]},l!==null&&(l=Va(l),l!==null&&LA(l)),a):(a.eventSystemFlags|=m,l=a.targetContainers,b!==null&&l.indexOf(b)===-1&&l.push(b),a)}function _P(a,l,h,m,b){switch(l){case"focusin":return oo=nd(oo,a,l,h,m,b),!0;case"dragenter":return lo=nd(lo,a,l,h,m,b),!0;case"mouseover":return uo=nd(uo,a,l,h,m,b),!0;case"pointerover":var _=b.pointerId;return ed.set(_,nd(ed.get(_)||null,a,l,h,m,b)),!0;case"gotpointercapture":return _=b.pointerId,td.set(_,nd(td.get(_)||null,a,l,h,m,b)),!0}return!1}function zA(a){var l=za(a.target);if(l!==null){var h=r(l);if(h!==null){if(l=h.tag,l===13){if(l=o(h),l!==null){a.blockedOn=l,Yf(a.priority,function(){FA(h)});return}}else if(l===31){if(l=u(h),l!==null){a.blockedOn=l,Yf(a.priority,function(){FA(h)});return}}else if(l===3&&h.stateNode.current.memoizedState.isDehydrated){a.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}a.blockedOn=null}function lm(a){if(a.blockedOn!==null)return!1;for(var l=a.targetContainers;0<l.length;){var h=n1(a.nativeEvent);if(h===null){h=a.nativeEvent;var m=new h.constructor(h.type,h);sx=m,h.target.dispatchEvent(m),sx=null}else return l=Va(h),l!==null&&LA(l),a.blockedOn=h,!1;l.shift()}return!0}function VA(a,l,h){lm(a)&&h.delete(l)}function vP(){i1=!1,oo!==null&&lm(oo)&&(oo=null),lo!==null&&lm(lo)&&(lo=null),uo!==null&&lm(uo)&&(uo=null),ed.forEach(VA),td.forEach(VA)}function um(a,l){a.blockedOn===l&&(a.blockedOn=null,i1||(i1=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,vP)))}var cm=null;function PA(a){cm!==a&&(cm=a,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){cm===a&&(cm=null);for(var l=0;l<a.length;l+=3){var h=a[l],m=a[l+1],b=a[l+2];if(typeof m!="function"){if(s1(m||h)===null)continue;break}var _=Va(h);_!==null&&(a.splice(l,3),l-=3,nb(_,{pending:!0,data:b,method:h.method,action:m},m,b))}}))}function Wu(a){function l(Q){return um(Q,a)}oo!==null&&um(oo,a),lo!==null&&um(lo,a),uo!==null&&um(uo,a),ed.forEach(l),td.forEach(l);for(var h=0;h<co.length;h++){var m=co[h];m.blockedOn===a&&(m.blockedOn=null)}for(;0<co.length&&(h=co[0],h.blockedOn===null);)zA(h),h.blockedOn===null&&co.shift();if(h=(a.ownerDocument||a).$$reactFormReplay,h!=null)for(m=0;m<h.length;m+=3){var b=h[m],_=h[m+1],E=b[Xn]||null;if(typeof _=="function")E||PA(h);else if(E){var O=null;if(_&&_.hasAttribute("formAction")){if(b=_,E=_[Xn]||null)O=E.formAction;else if(s1(b)!==null)continue}else O=E.action;typeof O=="function"?h[m+1]=O:(h.splice(m,3),m-=3),PA(h)}}}function IA(){function a(_){_.canIntercept&&_.info==="react-transition"&&_.intercept({handler:function(){return new Promise(function(E){return b=E})},focusReset:"manual",scroll:"manual"})}function l(){b!==null&&(b(),b=null),m||setTimeout(h,20)}function h(){if(!m&&!navigation.transition){var _=navigation.currentEntry;_&&_.url!=null&&navigation.navigate(_.url,{state:_.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,b=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",l),navigation.addEventListener("navigateerror",l),setTimeout(h,100),function(){m=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",l),navigation.removeEventListener("navigateerror",l),b!==null&&(b(),b=null)}}}function r1(a){this._internalRoot=a}hm.prototype.render=r1.prototype.render=function(a){var l=this._internalRoot;if(l===null)throw Error(n(409));var h=l.current,m=Gs();DA(h,m,a,l,null,null)},hm.prototype.unmount=r1.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var l=a.containerInfo;DA(a.current,2,null,a,null,null),jp(),l[Fr]=null}};function hm(a){this._internalRoot=a}hm.prototype.unstable_scheduleHydration=function(a){if(a){var l=Xf();a={blockedOn:null,target:a,priority:l};for(var h=0;h<co.length&&l!==0&&l<co[h].priority;h++);co.splice(h,0,a),h===0&&zA(a)}};var kA=e.version;if(kA!=="19.2.3")throw Error(n(527,kA,"19.2.3"));k.findDOMNode=function(a){var l=a._reactInternals;if(l===void 0)throw typeof a.render=="function"?Error(n(188)):(a=Object.keys(a).join(","),Error(n(268,a)));return a=d(l),a=a!==null?f(a):null,a=a===null?null:a.stateNode,a};var TP={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dm.isDisabled&&dm.supportsFiber)try{Jo=dm.inject(TP),is=dm}catch{}}return id.createRoot=function(a,l){if(!i(a))throw Error(n(299));var h=!1,m="",b=XM,_=YM,E=ZM;return l!=null&&(l.unstable_strictMode===!0&&(h=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onUncaughtError!==void 0&&(b=l.onUncaughtError),l.onCaughtError!==void 0&&(_=l.onCaughtError),l.onRecoverableError!==void 0&&(E=l.onRecoverableError)),l=RA(a,1,!1,null,null,h,m,null,b,_,E,IA),a[Fr]=l.current,Ib(a),new r1(l)},id.hydrateRoot=function(a,l,h){if(!i(a))throw Error(n(299));var m=!1,b="",_=XM,E=YM,O=ZM,Q=null;return h!=null&&(h.unstable_strictMode===!0&&(m=!0),h.identifierPrefix!==void 0&&(b=h.identifierPrefix),h.onUncaughtError!==void 0&&(_=h.onUncaughtError),h.onCaughtError!==void 0&&(E=h.onCaughtError),h.onRecoverableError!==void 0&&(O=h.onRecoverableError),h.formState!==void 0&&(Q=h.formState)),l=RA(a,1,!0,l,h??null,m,b,Q,_,E,O,IA),l.context=CA(null),h=l.current,m=Gs(),m=hh(m),b=Ya(m),b.callback=null,Za(h,b,m),h=m,l.current.lanes=h,tl(l,h),sr(l),a[Fr]=l.current,Ib(a),new hm(l)},id.version="19.2.3",id}var KA;function DP(){if(KA)return o1.exports;KA=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),o1.exports=CP(),o1.exports}var BP=DP();const LP=z0(BP);var se=vf();const sh=z0(se);function wn(s){if(typeof s=="string"||typeof s=="number")return""+s;let e="";if(Array.isArray(s))for(let t=0,n;t<s.length;t++)(n=wn(s[t]))!==""&&(e+=(e&&" ")+n);else for(let t in s)s[t]&&(e+=(e&&" ")+t);return e}var FP={value:()=>{}};function V0(){for(var s=0,e=arguments.length,t={},n;s<e;++s){if(!(n=arguments[s]+"")||n in t||/[\s.]/.test(n))throw new Error("illegal type: "+n);t[n]=[]}return new cg(t)}function cg(s){this._=s}function OP(s,e){return s.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}cg.prototype=V0.prototype={constructor:cg,on:function(s,e){var t=this._,n=OP(s+"",t),i,r=-1,o=n.length;if(arguments.length<2){for(;++r<o;)if((i=(s=n[r]).type)&&(i=UP(t[i],s.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++r<o;)if(i=(s=n[r]).type)t[i]=JA(t[i],s.name,e);else if(e==null)for(i in t)t[i]=JA(t[i],s.name,null);return this},copy:function(){var s={},e=this._;for(var t in e)s[t]=e[t].slice();return new cg(s)},call:function(s,e){if((i=arguments.length-2)>0)for(var t=new Array(i),n=0,i,r;n<i;++n)t[n]=arguments[n+2];if(!this._.hasOwnProperty(s))throw new Error("unknown type: "+s);for(r=this._[s],n=0,i=r.length;n<i;++n)r[n].value.apply(e,t)},apply:function(s,e,t){if(!this._.hasOwnProperty(s))throw new Error("unknown type: "+s);for(var n=this._[s],i=0,r=n.length;i<r;++i)n[i].value.apply(e,t)}};function UP(s,e){for(var t=0,n=s.length,i;t<n;++t)if((i=s[t]).name===e)return i.value}function JA(s,e,t){for(var n=0,i=s.length;n<i;++n)if(s[n].name===e){s[n]=FP,s=s.slice(0,n).concat(s.slice(n+1));break}return t!=null&&s.push({name:e,value:t}),s}var R_="http://www.w3.org/1999/xhtml";const eE={svg:"http://www.w3.org/2000/svg",xhtml:R_,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function P0(s){var e=s+="",t=e.indexOf(":");return t>=0&&(e=s.slice(0,t))!=="xmlns"&&(s=s.slice(t+1)),eE.hasOwnProperty(e)?{space:eE[e],local:s}:s}function zP(s){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===R_&&e.documentElement.namespaceURI===R_?e.createElement(s):e.createElementNS(t,s)}}function VP(s){return function(){return this.ownerDocument.createElementNS(s.space,s.local)}}function uC(s){var e=P0(s);return(e.local?VP:zP)(e)}function PP(){}function Av(s){return s==null?PP:function(){return this.querySelector(s)}}function IP(s){typeof s!="function"&&(s=Av(s));for(var e=this._groups,t=e.length,n=new Array(t),i=0;i<t;++i)for(var r=e[i],o=r.length,u=n[i]=new Array(o),c,d,f=0;f<o;++f)(c=r[f])&&(d=s.call(c,c.__data__,f,r))&&("__data__"in c&&(d.__data__=c.__data__),u[f]=d);return new ei(n,this._parents)}function kP(s){return s==null?[]:Array.isArray(s)?s:Array.from(s)}function GP(){return[]}function cC(s){return s==null?GP:function(){return this.querySelectorAll(s)}}function $P(s){return function(){return kP(s.apply(this,arguments))}}function HP(s){typeof s=="function"?s=$P(s):s=cC(s);for(var e=this._groups,t=e.length,n=[],i=[],r=0;r<t;++r)for(var o=e[r],u=o.length,c,d=0;d<u;++d)(c=o[d])&&(n.push(s.call(c,c.__data__,d,o)),i.push(c));return new ei(n,i)}function hC(s){return function(){return this.matches(s)}}function dC(s){return function(e){return e.matches(s)}}var jP=Array.prototype.find;function qP(s){return function(){return jP.call(this.children,s)}}function WP(){return this.firstElementChild}function XP(s){return this.select(s==null?WP:qP(typeof s=="function"?s:dC(s)))}var YP=Array.prototype.filter;function ZP(){return Array.from(this.children)}function QP(s){return function(){return YP.call(this.children,s)}}function KP(s){return this.selectAll(s==null?ZP:QP(typeof s=="function"?s:dC(s)))}function JP(s){typeof s!="function"&&(s=hC(s));for(var e=this._groups,t=e.length,n=new Array(t),i=0;i<t;++i)for(var r=e[i],o=r.length,u=n[i]=[],c,d=0;d<o;++d)(c=r[d])&&s.call(c,c.__data__,d,r)&&u.push(c);return new ei(n,this._parents)}function fC(s){return new Array(s.length)}function eI(){return new ei(this._enter||this._groups.map(fC),this._parents)}function Mg(s,e){this.ownerDocument=s.ownerDocument,this.namespaceURI=s.namespaceURI,this._next=null,this._parent=s,this.__data__=e}Mg.prototype={constructor:Mg,appendChild:function(s){return this._parent.insertBefore(s,this._next)},insertBefore:function(s,e){return this._parent.insertBefore(s,e)},querySelector:function(s){return this._parent.querySelector(s)},querySelectorAll:function(s){return this._parent.querySelectorAll(s)}};function tI(s){return function(){return s}}function nI(s,e,t,n,i,r){for(var o=0,u,c=e.length,d=r.length;o<d;++o)(u=e[o])?(u.__data__=r[o],n[o]=u):t[o]=new Mg(s,r[o]);for(;o<c;++o)(u=e[o])&&(i[o]=u)}function sI(s,e,t,n,i,r,o){var u,c,d=new Map,f=e.length,p=r.length,g=new Array(f),y;for(u=0;u<f;++u)(c=e[u])&&(g[u]=y=o.call(c,c.__data__,u,e)+"",d.has(y)?i[u]=c:d.set(y,c));for(u=0;u<p;++u)y=o.call(s,r[u],u,r)+"",(c=d.get(y))?(n[u]=c,c.__data__=r[u],d.delete(y)):t[u]=new Mg(s,r[u]);for(u=0;u<f;++u)(c=e[u])&&d.get(g[u])===c&&(i[u]=c)}function iI(s){return s.__data__}function rI(s,e){if(!arguments.length)return Array.from(this,iI);var t=e?sI:nI,n=this._parents,i=this._groups;typeof s!="function"&&(s=tI(s));for(var r=i.length,o=new Array(r),u=new Array(r),c=new Array(r),d=0;d<r;++d){var f=n[d],p=i[d],g=p.length,y=aI(s.call(f,f&&f.__data__,d,n)),x=y.length,v=u[d]=new Array(x),S=o[d]=new Array(x),w=c[d]=new Array(g);t(f,p,v,S,w,y,e);for(var M=0,T=0,A,C;M<x;++M)if(A=v[M]){for(M>=T&&(T=M+1);!(C=S[T])&&++T<x;);A._next=C||null}}return o=new ei(o,n),o._enter=u,o._exit=c,o}function aI(s){return typeof s=="object"&&"length"in s?s:Array.from(s)}function oI(){return new ei(this._exit||this._groups.map(fC),this._parents)}function lI(s,e,t){var n=this.enter(),i=this,r=this.exit();return typeof s=="function"?(n=s(n),n&&(n=n.selection())):n=n.append(s+""),e!=null&&(i=e(i),i&&(i=i.selection())),t==null?r.remove():t(r),n&&i?n.merge(i).order():i}function uI(s){for(var e=s.selection?s.selection():s,t=this._groups,n=e._groups,i=t.length,r=n.length,o=Math.min(i,r),u=new Array(i),c=0;c<o;++c)for(var d=t[c],f=n[c],p=d.length,g=u[c]=new Array(p),y,x=0;x<p;++x)(y=d[x]||f[x])&&(g[x]=y);for(;c<i;++c)u[c]=t[c];return new ei(u,this._parents)}function cI(){for(var s=this._groups,e=-1,t=s.length;++e<t;)for(var n=s[e],i=n.length-1,r=n[i],o;--i>=0;)(o=n[i])&&(r&&o.compareDocumentPosition(r)^4&&r.parentNode.insertBefore(o,r),r=o);return this}function hI(s){s||(s=dI);function e(p,g){return p&&g?s(p.__data__,g.__data__):!p-!g}for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r){for(var o=t[r],u=o.length,c=i[r]=new Array(u),d,f=0;f<u;++f)(d=o[f])&&(c[f]=d);c.sort(e)}return new ei(i,this._parents).order()}function dI(s,e){return s<e?-1:s>e?1:s>=e?0:NaN}function fI(){var s=arguments[0];return arguments[0]=this,s.apply(null,arguments),this}function pI(){return Array.from(this)}function mI(){for(var s=this._groups,e=0,t=s.length;e<t;++e)for(var n=s[e],i=0,r=n.length;i<r;++i){var o=n[i];if(o)return o}return null}function gI(){let s=0;for(const e of this)++s;return s}function yI(){return!this.node()}function xI(s){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,o=i.length,u;r<o;++r)(u=i[r])&&s.call(u,u.__data__,r,i);return this}function bI(s){return function(){this.removeAttribute(s)}}function _I(s){return function(){this.removeAttributeNS(s.space,s.local)}}function vI(s,e){return function(){this.setAttribute(s,e)}}function TI(s,e){return function(){this.setAttributeNS(s.space,s.local,e)}}function SI(s,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(s):this.setAttribute(s,t)}}function wI(s,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(s.space,s.local):this.setAttributeNS(s.space,s.local,t)}}function MI(s,e){var t=P0(s);if(arguments.length<2){var n=this.node();return t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}return this.each((e==null?t.local?_I:bI:typeof e=="function"?t.local?wI:SI:t.local?TI:vI)(t,e))}function pC(s){return s.ownerDocument&&s.ownerDocument.defaultView||s.document&&s||s.defaultView}function NI(s){return function(){this.style.removeProperty(s)}}function AI(s,e,t){return function(){this.style.setProperty(s,e,t)}}function EI(s,e,t){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(s):this.style.setProperty(s,n,t)}}function RI(s,e,t){return arguments.length>1?this.each((e==null?NI:typeof e=="function"?EI:AI)(s,e,t??"")):Ic(this.node(),s)}function Ic(s,e){return s.style.getPropertyValue(e)||pC(s).getComputedStyle(s,null).getPropertyValue(e)}function CI(s){return function(){delete this[s]}}function DI(s,e){return function(){this[s]=e}}function BI(s,e){return function(){var t=e.apply(this,arguments);t==null?delete this[s]:this[s]=t}}function LI(s,e){return arguments.length>1?this.each((e==null?CI:typeof e=="function"?BI:DI)(s,e)):this.node()[s]}function mC(s){return s.trim().split(/^|\s+/)}function Ev(s){return s.classList||new gC(s)}function gC(s){this._node=s,this._names=mC(s.getAttribute("class")||"")}gC.prototype={add:function(s){var e=this._names.indexOf(s);e<0&&(this._names.push(s),this._node.setAttribute("class",this._names.join(" ")))},remove:function(s){var e=this._names.indexOf(s);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(s){return this._names.indexOf(s)>=0}};function yC(s,e){for(var t=Ev(s),n=-1,i=e.length;++n<i;)t.add(e[n])}function xC(s,e){for(var t=Ev(s),n=-1,i=e.length;++n<i;)t.remove(e[n])}function FI(s){return function(){yC(this,s)}}function OI(s){return function(){xC(this,s)}}function UI(s,e){return function(){(e.apply(this,arguments)?yC:xC)(this,s)}}function zI(s,e){var t=mC(s+"");if(arguments.length<2){for(var n=Ev(this.node()),i=-1,r=t.length;++i<r;)if(!n.contains(t[i]))return!1;return!0}return this.each((typeof e=="function"?UI:e?FI:OI)(t,e))}function VI(){this.textContent=""}function PI(s){return function(){this.textContent=s}}function II(s){return function(){var e=s.apply(this,arguments);this.textContent=e??""}}function kI(s){return arguments.length?this.each(s==null?VI:(typeof s=="function"?II:PI)(s)):this.node().textContent}function GI(){this.innerHTML=""}function $I(s){return function(){this.innerHTML=s}}function HI(s){return function(){var e=s.apply(this,arguments);this.innerHTML=e??""}}function jI(s){return arguments.length?this.each(s==null?GI:(typeof s=="function"?HI:$I)(s)):this.node().innerHTML}function qI(){this.nextSibling&&this.parentNode.appendChild(this)}function WI(){return this.each(qI)}function XI(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function YI(){return this.each(XI)}function ZI(s){var e=typeof s=="function"?s:uC(s);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function QI(){return null}function KI(s,e){var t=typeof s=="function"?s:uC(s),n=e==null?QI:typeof e=="function"?e:Av(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})}function JI(){var s=this.parentNode;s&&s.removeChild(this)}function e4(){return this.each(JI)}function t4(){var s=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(s,this.nextSibling):s}function n4(){var s=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(s,this.nextSibling):s}function s4(s){return this.select(s?n4:t4)}function i4(s){return arguments.length?this.property("__data__",s):this.node().__data__}function r4(s){return function(e){s.call(this,e,this.__data__)}}function a4(s){return s.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function o4(s){return function(){var e=this.__on;if(e){for(var t=0,n=-1,i=e.length,r;t<i;++t)r=e[t],(!s.type||r.type===s.type)&&r.name===s.name?this.removeEventListener(r.type,r.listener,r.options):e[++n]=r;++n?e.length=n:delete this.__on}}}function l4(s,e,t){return function(){var n=this.__on,i,r=r4(e);if(n){for(var o=0,u=n.length;o<u;++o)if((i=n[o]).type===s.type&&i.name===s.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=r,i.options=t),i.value=e;return}}this.addEventListener(s.type,r,t),i={type:s.type,name:s.name,value:e,listener:r,options:t},n?n.push(i):this.__on=[i]}}function u4(s,e,t){var n=a4(s+""),i,r=n.length,o;if(arguments.length<2){var u=this.node().__on;if(u){for(var c=0,d=u.length,f;c<d;++c)for(i=0,f=u[c];i<r;++i)if((o=n[i]).type===f.type&&o.name===f.name)return f.value}return}for(u=e?l4:o4,i=0;i<r;++i)this.each(u(n[i],e,t));return this}function bC(s,e,t){var n=pC(s),i=n.CustomEvent;typeof i=="function"?i=new i(e,t):(i=n.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),s.dispatchEvent(i)}function c4(s,e){return function(){return bC(this,s,e)}}function h4(s,e){return function(){return bC(this,s,e.apply(this,arguments))}}function d4(s,e){return this.each((typeof e=="function"?h4:c4)(s,e))}function*f4(){for(var s=this._groups,e=0,t=s.length;e<t;++e)for(var n=s[e],i=0,r=n.length,o;i<r;++i)(o=n[i])&&(yield o)}var _C=[null];function ei(s,e){this._groups=s,this._parents=e}function Tf(){return new ei([[document.documentElement]],_C)}function p4(){return this}ei.prototype=Tf.prototype={constructor:ei,select:IP,selectAll:HP,selectChild:XP,selectChildren:KP,filter:JP,data:rI,enter:eI,exit:oI,join:lI,merge:uI,selection:p4,order:cI,sort:hI,call:fI,nodes:pI,node:mI,size:gI,empty:yI,each:xI,attr:MI,style:RI,property:LI,classed:zI,text:kI,html:jI,raise:WI,lower:YI,append:ZI,insert:KI,remove:e4,clone:s4,datum:i4,on:u4,dispatch:d4,[Symbol.iterator]:f4};function Ys(s){return typeof s=="string"?new ei([[document.querySelector(s)]],[document.documentElement]):new ei([[s]],_C)}function m4(s){let e;for(;e=s.sourceEvent;)s=e;return s}function Ui(s,e){if(s=m4(s),e===void 0&&(e=s.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var n=t.createSVGPoint();return n.x=s.clientX,n.y=s.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[s.clientX-i.left-e.clientLeft,s.clientY-i.top-e.clientTop]}}return[s.pageX,s.pageY]}const g4={passive:!1},Jd={capture:!0,passive:!1};function d1(s){s.stopImmediatePropagation()}function Nc(s){s.preventDefault(),s.stopImmediatePropagation()}function vC(s){var e=s.document.documentElement,t=Ys(s).on("dragstart.drag",Nc,Jd);"onselectstart"in e?t.on("selectstart.drag",Nc,Jd):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function TC(s,e){var t=s.document.documentElement,n=Ys(s).on("dragstart.drag",null);e&&(n.on("click.drag",Nc,Jd),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in t?n.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const fm=s=>()=>s;function C_(s,{sourceEvent:e,subject:t,target:n,identifier:i,active:r,x:o,y:u,dx:c,dy:d,dispatch:f}){Object.defineProperties(this,{type:{value:s,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:u,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:f}})}C_.prototype.on=function(){var s=this._.on.apply(this._,arguments);return s===this._?this:s};function y4(s){return!s.ctrlKey&&!s.button}function x4(){return this.parentNode}function b4(s,e){return e??{x:s.x,y:s.y}}function _4(){return navigator.maxTouchPoints||"ontouchstart"in this}function SC(){var s=y4,e=x4,t=b4,n=_4,i={},r=V0("start","drag","end"),o=0,u,c,d,f,p=0;function g(A){A.on("mousedown.drag",y).filter(n).on("touchstart.drag",S).on("touchmove.drag",w,g4).on("touchend.drag touchcancel.drag",M).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(A,C){if(!(f||!s.call(this,A,C))){var D=T(this,e.call(this,A,C),A,C,"mouse");D&&(Ys(A.view).on("mousemove.drag",x,Jd).on("mouseup.drag",v,Jd),vC(A.view),d1(A),d=!1,u=A.clientX,c=A.clientY,D("start",A))}}function x(A){if(Nc(A),!d){var C=A.clientX-u,D=A.clientY-c;d=C*C+D*D>p}i.mouse("drag",A)}function v(A){Ys(A.view).on("mousemove.drag mouseup.drag",null),TC(A.view,d),Nc(A),i.mouse("end",A)}function S(A,C){if(s.call(this,A,C)){var D=A.changedTouches,R=e.call(this,A,C),B=D.length,L,X;for(L=0;L<B;++L)(X=T(this,R,A,C,D[L].identifier,D[L]))&&(d1(A),X("start",A,D[L]))}}function w(A){var C=A.changedTouches,D=C.length,R,B;for(R=0;R<D;++R)(B=i[C[R].identifier])&&(Nc(A),B("drag",A,C[R]))}function M(A){var C=A.changedTouches,D=C.length,R,B;for(f&&clearTimeout(f),f=setTimeout(function(){f=null},500),R=0;R<D;++R)(B=i[C[R].identifier])&&(d1(A),B("end",A,C[R]))}function T(A,C,D,R,B,L){var X=r.copy(),G=Ui(L||D,C),j,ee,P;if((P=t.call(A,new C_("beforestart",{sourceEvent:D,target:g,identifier:B,active:o,x:G[0],y:G[1],dx:0,dy:0,dispatch:X}),R))!=null)return j=P.x-G[0]||0,ee=P.y-G[1]||0,function Y(F,k,I){var $=G,re;switch(F){case"start":i[B]=Y,re=o++;break;case"end":delete i[B],--o;case"drag":G=Ui(I||k,C),re=o;break}X.call(F,A,new C_(F,{sourceEvent:k,subject:P,target:g,identifier:B,active:re,x:G[0]+j,y:G[1]+ee,dx:G[0]-$[0],dy:G[1]-$[1],dispatch:X}),R)}}return g.filter=function(A){return arguments.length?(s=typeof A=="function"?A:fm(!!A),g):s},g.container=function(A){return arguments.length?(e=typeof A=="function"?A:fm(A),g):e},g.subject=function(A){return arguments.length?(t=typeof A=="function"?A:fm(A),g):t},g.touchable=function(A){return arguments.length?(n=typeof A=="function"?A:fm(!!A),g):n},g.on=function(){var A=r.on.apply(r,arguments);return A===r?g:A},g.clickDistance=function(A){return arguments.length?(p=(A=+A)*A,g):Math.sqrt(p)},g}function Rv(s,e,t){s.prototype=e.prototype=t,t.constructor=s}function wC(s,e){var t=Object.create(s.prototype);for(var n in e)t[n]=e[n];return t}function Sf(){}var ef=.7,Ng=1/ef,Ac="\\s*([+-]?\\d+)\\s*",tf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",xr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",v4=/^#([0-9a-f]{3,8})$/,T4=new RegExp(`^rgb\\(${Ac},${Ac},${Ac}\\)$`),S4=new RegExp(`^rgb\\(${xr},${xr},${xr}\\)$`),w4=new RegExp(`^rgba\\(${Ac},${Ac},${Ac},${tf}\\)$`),M4=new RegExp(`^rgba\\(${xr},${xr},${xr},${tf}\\)$`),N4=new RegExp(`^hsl\\(${tf},${xr},${xr}\\)$`),A4=new RegExp(`^hsla\\(${tf},${xr},${xr},${tf}\\)$`),tE={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Rv(Sf,Yl,{copy(s){return Object.assign(new this.constructor,this,s)},displayable(){return this.rgb().displayable()},hex:nE,formatHex:nE,formatHex8:E4,formatHsl:R4,formatRgb:sE,toString:sE});function nE(){return this.rgb().formatHex()}function E4(){return this.rgb().formatHex8()}function R4(){return MC(this).formatHsl()}function sE(){return this.rgb().formatRgb()}function Yl(s){var e,t;return s=(s+"").trim().toLowerCase(),(e=v4.exec(s))?(t=e[1].length,e=parseInt(e[1],16),t===6?iE(e):t===3?new As(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?pm(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?pm(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=T4.exec(s))?new As(e[1],e[2],e[3],1):(e=S4.exec(s))?new As(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=w4.exec(s))?pm(e[1],e[2],e[3],e[4]):(e=M4.exec(s))?pm(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=N4.exec(s))?oE(e[1],e[2]/100,e[3]/100,1):(e=A4.exec(s))?oE(e[1],e[2]/100,e[3]/100,e[4]):tE.hasOwnProperty(s)?iE(tE[s]):s==="transparent"?new As(NaN,NaN,NaN,0):null}function iE(s){return new As(s>>16&255,s>>8&255,s&255,1)}function pm(s,e,t,n){return n<=0&&(s=e=t=NaN),new As(s,e,t,n)}function C4(s){return s instanceof Sf||(s=Yl(s)),s?(s=s.rgb(),new As(s.r,s.g,s.b,s.opacity)):new As}function D_(s,e,t,n){return arguments.length===1?C4(s):new As(s,e,t,n??1)}function As(s,e,t,n){this.r=+s,this.g=+e,this.b=+t,this.opacity=+n}Rv(As,D_,wC(Sf,{brighter(s){return s=s==null?Ng:Math.pow(Ng,s),new As(this.r*s,this.g*s,this.b*s,this.opacity)},darker(s){return s=s==null?ef:Math.pow(ef,s),new As(this.r*s,this.g*s,this.b*s,this.opacity)},rgb(){return this},clamp(){return new As(Hl(this.r),Hl(this.g),Hl(this.b),Ag(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rE,formatHex:rE,formatHex8:D4,formatRgb:aE,toString:aE}));function rE(){return`#${Ul(this.r)}${Ul(this.g)}${Ul(this.b)}`}function D4(){return`#${Ul(this.r)}${Ul(this.g)}${Ul(this.b)}${Ul((isNaN(this.opacity)?1:this.opacity)*255)}`}function aE(){const s=Ag(this.opacity);return`${s===1?"rgb(":"rgba("}${Hl(this.r)}, ${Hl(this.g)}, ${Hl(this.b)}${s===1?")":`, ${s})`}`}function Ag(s){return isNaN(s)?1:Math.max(0,Math.min(1,s))}function Hl(s){return Math.max(0,Math.min(255,Math.round(s)||0))}function Ul(s){return s=Hl(s),(s<16?"0":"")+s.toString(16)}function oE(s,e,t,n){return n<=0?s=e=t=NaN:t<=0||t>=1?s=e=NaN:e<=0&&(s=NaN),new Vi(s,e,t,n)}function MC(s){if(s instanceof Vi)return new Vi(s.h,s.s,s.l,s.opacity);if(s instanceof Sf||(s=Yl(s)),!s)return new Vi;if(s instanceof Vi)return s;s=s.rgb();var e=s.r/255,t=s.g/255,n=s.b/255,i=Math.min(e,t,n),r=Math.max(e,t,n),o=NaN,u=r-i,c=(r+i)/2;return u?(e===r?o=(t-n)/u+(t<n)*6:t===r?o=(n-e)/u+2:o=(e-t)/u+4,u/=c<.5?r+i:2-r-i,o*=60):u=c>0&&c<1?0:o,new Vi(o,u,c,s.opacity)}function B4(s,e,t,n){return arguments.length===1?MC(s):new Vi(s,e,t,n??1)}function Vi(s,e,t,n){this.h=+s,this.s=+e,this.l=+t,this.opacity=+n}Rv(Vi,B4,wC(Sf,{brighter(s){return s=s==null?Ng:Math.pow(Ng,s),new Vi(this.h,this.s,this.l*s,this.opacity)},darker(s){return s=s==null?ef:Math.pow(ef,s),new Vi(this.h,this.s,this.l*s,this.opacity)},rgb(){var s=this.h%360+(this.h<0)*360,e=isNaN(s)||isNaN(this.s)?0:this.s,t=this.l,n=t+(t<.5?t:1-t)*e,i=2*t-n;return new As(f1(s>=240?s-240:s+120,i,n),f1(s,i,n),f1(s<120?s+240:s-120,i,n),this.opacity)},clamp(){return new Vi(lE(this.h),mm(this.s),mm(this.l),Ag(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const s=Ag(this.opacity);return`${s===1?"hsl(":"hsla("}${lE(this.h)}, ${mm(this.s)*100}%, ${mm(this.l)*100}%${s===1?")":`, ${s})`}`}}));function lE(s){return s=(s||0)%360,s<0?s+360:s}function mm(s){return Math.max(0,Math.min(1,s||0))}function f1(s,e,t){return(s<60?e+(t-e)*s/60:s<180?t:s<240?e+(t-e)*(240-s)/60:e)*255}const Cv=s=>()=>s;function L4(s,e){return function(t){return s+t*e}}function F4(s,e,t){return s=Math.pow(s,t),e=Math.pow(e,t)-s,t=1/t,function(n){return Math.pow(s+n*e,t)}}function O4(s){return(s=+s)==1?NC:function(e,t){return t-e?F4(e,t,s):Cv(isNaN(e)?t:e)}}function NC(s,e){var t=e-s;return t?L4(s,t):Cv(isNaN(s)?e:s)}const Eg=(function s(e){var t=O4(e);function n(i,r){var o=t((i=D_(i)).r,(r=D_(r)).r),u=t(i.g,r.g),c=t(i.b,r.b),d=NC(i.opacity,r.opacity);return function(f){return i.r=o(f),i.g=u(f),i.b=c(f),i.opacity=d(f),i+""}}return n.gamma=s,n})(1);function U4(s,e){e||(e=[]);var t=s?Math.min(e.length,s.length):0,n=e.slice(),i;return function(r){for(i=0;i<t;++i)n[i]=s[i]*(1-r)+e[i]*r;return n}}function z4(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function V4(s,e){var t=e?e.length:0,n=s?Math.min(t,s.length):0,i=new Array(n),r=new Array(t),o;for(o=0;o<n;++o)i[o]=Fd(s[o],e[o]);for(;o<t;++o)r[o]=e[o];return function(u){for(o=0;o<n;++o)r[o]=i[o](u);return r}}function P4(s,e){var t=new Date;return s=+s,e=+e,function(n){return t.setTime(s*(1-n)+e*n),t}}function fr(s,e){return s=+s,e=+e,function(t){return s*(1-t)+e*t}}function I4(s,e){var t={},n={},i;(s===null||typeof s!="object")&&(s={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in s?t[i]=Fd(s[i],e[i]):n[i]=e[i];return function(r){for(i in t)n[i]=t[i](r);return n}}var B_=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,p1=new RegExp(B_.source,"g");function k4(s){return function(){return s}}function G4(s){return function(e){return s(e)+""}}function AC(s,e){var t=B_.lastIndex=p1.lastIndex=0,n,i,r,o=-1,u=[],c=[];for(s=s+"",e=e+"";(n=B_.exec(s))&&(i=p1.exec(e));)(r=i.index)>t&&(r=e.slice(t,r),u[o]?u[o]+=r:u[++o]=r),(n=n[0])===(i=i[0])?u[o]?u[o]+=i:u[++o]=i:(u[++o]=null,c.push({i:o,x:fr(n,i)})),t=p1.lastIndex;return t<e.length&&(r=e.slice(t),u[o]?u[o]+=r:u[++o]=r),u.length<2?c[0]?G4(c[0].x):k4(e):(e=c.length,function(d){for(var f=0,p;f<e;++f)u[(p=c[f]).i]=p.x(d);return u.join("")})}function Fd(s,e){var t=typeof e,n;return e==null||t==="boolean"?Cv(e):(t==="number"?fr:t==="string"?(n=Yl(e))?(e=n,Eg):AC:e instanceof Yl?Eg:e instanceof Date?P4:z4(e)?U4:Array.isArray(e)?V4:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?I4:fr)(s,e)}var uE=180/Math.PI,L_={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function EC(s,e,t,n,i,r){var o,u,c;return(o=Math.sqrt(s*s+e*e))&&(s/=o,e/=o),(c=s*t+e*n)&&(t-=s*c,n-=e*c),(u=Math.sqrt(t*t+n*n))&&(t/=u,n/=u,c/=u),s*n<e*t&&(s=-s,e=-e,c=-c,o=-o),{translateX:i,translateY:r,rotate:Math.atan2(e,s)*uE,skewX:Math.atan(c)*uE,scaleX:o,scaleY:u}}var gm;function $4(s){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(s+"");return e.isIdentity?L_:EC(e.a,e.b,e.c,e.d,e.e,e.f)}function H4(s){return s==null||(gm||(gm=document.createElementNS("http://www.w3.org/2000/svg","g")),gm.setAttribute("transform",s),!(s=gm.transform.baseVal.consolidate()))?L_:(s=s.matrix,EC(s.a,s.b,s.c,s.d,s.e,s.f))}function RC(s,e,t,n){function i(d){return d.length?d.pop()+" ":""}function r(d,f,p,g,y,x){if(d!==p||f!==g){var v=y.push("translate(",null,e,null,t);x.push({i:v-4,x:fr(d,p)},{i:v-2,x:fr(f,g)})}else(p||g)&&y.push("translate("+p+e+g+t)}function o(d,f,p,g){d!==f?(d-f>180?f+=360:f-d>180&&(d+=360),g.push({i:p.push(i(p)+"rotate(",null,n)-2,x:fr(d,f)})):f&&p.push(i(p)+"rotate("+f+n)}function u(d,f,p,g){d!==f?g.push({i:p.push(i(p)+"skewX(",null,n)-2,x:fr(d,f)}):f&&p.push(i(p)+"skewX("+f+n)}function c(d,f,p,g,y,x){if(d!==p||f!==g){var v=y.push(i(y)+"scale(",null,",",null,")");x.push({i:v-4,x:fr(d,p)},{i:v-2,x:fr(f,g)})}else(p!==1||g!==1)&&y.push(i(y)+"scale("+p+","+g+")")}return function(d,f){var p=[],g=[];return d=s(d),f=s(f),r(d.translateX,d.translateY,f.translateX,f.translateY,p,g),o(d.rotate,f.rotate,p,g),u(d.skewX,f.skewX,p,g),c(d.scaleX,d.scaleY,f.scaleX,f.scaleY,p,g),d=f=null,function(y){for(var x=-1,v=g.length,S;++x<v;)p[(S=g[x]).i]=S.x(y);return p.join("")}}}var j4=RC($4,"px, ","px)","deg)"),q4=RC(H4,", ",")",")"),W4=1e-12;function cE(s){return((s=Math.exp(s))+1/s)/2}function X4(s){return((s=Math.exp(s))-1/s)/2}function Y4(s){return((s=Math.exp(2*s))-1)/(s+1)}const hg=(function s(e,t,n){function i(r,o){var u=r[0],c=r[1],d=r[2],f=o[0],p=o[1],g=o[2],y=f-u,x=p-c,v=y*y+x*x,S,w;if(v<W4)w=Math.log(g/d)/e,S=function(R){return[u+R*y,c+R*x,d*Math.exp(e*R*w)]};else{var M=Math.sqrt(v),T=(g*g-d*d+n*v)/(2*d*t*M),A=(g*g-d*d-n*v)/(2*g*t*M),C=Math.log(Math.sqrt(T*T+1)-T),D=Math.log(Math.sqrt(A*A+1)-A);w=(D-C)/e,S=function(R){var B=R*w,L=cE(C),X=d/(t*M)*(L*Y4(e*B+C)-X4(C));return[u+X*y,c+X*x,d*L/cE(e*B+C)]}}return S.duration=w*1e3*e/Math.SQRT2,S}return i.rho=function(r){var o=Math.max(.001,+r),u=o*o,c=u*u;return s(o,u,c)},i})(Math.SQRT2,2,4);var kc=0,Ed=0,rd=0,CC=1e3,Rg,Rd,Cg=0,Zl=0,I0=0,nf=typeof performance=="object"&&performance.now?performance:Date,DC=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(s){setTimeout(s,17)};function Dv(){return Zl||(DC(Z4),Zl=nf.now()+I0)}function Z4(){Zl=0}function Dg(){this._call=this._time=this._next=null}Dg.prototype=BC.prototype={constructor:Dg,restart:function(s,e,t){if(typeof s!="function")throw new TypeError("callback is not a function");t=(t==null?Dv():+t)+(e==null?0:+e),!this._next&&Rd!==this&&(Rd?Rd._next=this:Rg=this,Rd=this),this._call=s,this._time=t,F_()},stop:function(){this._call&&(this._call=null,this._time=1/0,F_())}};function BC(s,e,t){var n=new Dg;return n.restart(s,e,t),n}function Q4(){Dv(),++kc;for(var s=Rg,e;s;)(e=Zl-s._time)>=0&&s._call.call(void 0,e),s=s._next;--kc}function hE(){Zl=(Cg=nf.now())+I0,kc=Ed=0;try{Q4()}finally{kc=0,J4(),Zl=0}}function K4(){var s=nf.now(),e=s-Cg;e>CC&&(I0-=e,Cg=s)}function J4(){for(var s,e=Rg,t,n=1/0;e;)e._call?(n>e._time&&(n=e._time),s=e,e=e._next):(t=e._next,e._next=null,e=s?s._next=t:Rg=t);Rd=s,F_(n)}function F_(s){if(!kc){Ed&&(Ed=clearTimeout(Ed));var e=s-Zl;e>24?(s<1/0&&(Ed=setTimeout(hE,s-nf.now()-I0)),rd&&(rd=clearInterval(rd))):(rd||(Cg=nf.now(),rd=setInterval(K4,CC)),kc=1,DC(hE))}}function dE(s,e,t){var n=new Dg;return e=e==null?0:+e,n.restart(i=>{n.stop(),s(i+e)},e,t),n}var e5=V0("start","end","cancel","interrupt"),t5=[],LC=0,fE=1,O_=2,dg=3,pE=4,U_=5,fg=6;function k0(s,e,t,n,i,r){var o=s.__transition;if(!o)s.__transition={};else if(t in o)return;n5(s,t,{name:e,index:n,group:i,on:e5,tween:t5,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:LC})}function Bv(s,e){var t=Qi(s,e);if(t.state>LC)throw new Error("too late; already scheduled");return t}function Ar(s,e){var t=Qi(s,e);if(t.state>dg)throw new Error("too late; already running");return t}function Qi(s,e){var t=s.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function n5(s,e,t){var n=s.__transition,i;n[e]=t,t.timer=BC(r,0,t.time);function r(d){t.state=fE,t.timer.restart(o,t.delay,t.time),t.delay<=d&&o(d-t.delay)}function o(d){var f,p,g,y;if(t.state!==fE)return c();for(f in n)if(y=n[f],y.name===t.name){if(y.state===dg)return dE(o);y.state===pE?(y.state=fg,y.timer.stop(),y.on.call("interrupt",s,s.__data__,y.index,y.group),delete n[f]):+f<e&&(y.state=fg,y.timer.stop(),y.on.call("cancel",s,s.__data__,y.index,y.group),delete n[f])}if(dE(function(){t.state===dg&&(t.state=pE,t.timer.restart(u,t.delay,t.time),u(d))}),t.state=O_,t.on.call("start",s,s.__data__,t.index,t.group),t.state===O_){for(t.state=dg,i=new Array(g=t.tween.length),f=0,p=-1;f<g;++f)(y=t.tween[f].value.call(s,s.__data__,t.index,t.group))&&(i[++p]=y);i.length=p+1}}function u(d){for(var f=d<t.duration?t.ease.call(null,d/t.duration):(t.timer.restart(c),t.state=U_,1),p=-1,g=i.length;++p<g;)i[p].call(s,f);t.state===U_&&(t.on.call("end",s,s.__data__,t.index,t.group),c())}function c(){t.state=fg,t.timer.stop(),delete n[e];for(var d in n)return;delete s.__transition}}function pg(s,e){var t=s.__transition,n,i,r=!0,o;if(t){e=e==null?null:e+"";for(o in t){if((n=t[o]).name!==e){r=!1;continue}i=n.state>O_&&n.state<U_,n.state=fg,n.timer.stop(),n.on.call(i?"interrupt":"cancel",s,s.__data__,n.index,n.group),delete t[o]}r&&delete s.__transition}}function s5(s){return this.each(function(){pg(this,s)})}function i5(s,e){var t,n;return function(){var i=Ar(this,s),r=i.tween;if(r!==t){n=t=r;for(var o=0,u=n.length;o<u;++o)if(n[o].name===e){n=n.slice(),n.splice(o,1);break}}i.tween=n}}function r5(s,e,t){var n,i;if(typeof t!="function")throw new Error;return function(){var r=Ar(this,s),o=r.tween;if(o!==n){i=(n=o).slice();for(var u={name:e,value:t},c=0,d=i.length;c<d;++c)if(i[c].name===e){i[c]=u;break}c===d&&i.push(u)}r.tween=i}}function a5(s,e){var t=this._id;if(s+="",arguments.length<2){for(var n=Qi(this.node(),t).tween,i=0,r=n.length,o;i<r;++i)if((o=n[i]).name===s)return o.value;return null}return this.each((e==null?i5:r5)(t,s,e))}function Lv(s,e,t){var n=s._id;return s.each(function(){var i=Ar(this,n);(i.value||(i.value={}))[e]=t.apply(this,arguments)}),function(i){return Qi(i,n).value[e]}}function FC(s,e){var t;return(typeof e=="number"?fr:e instanceof Yl?Eg:(t=Yl(e))?(e=t,Eg):AC)(s,e)}function o5(s){return function(){this.removeAttribute(s)}}function l5(s){return function(){this.removeAttributeNS(s.space,s.local)}}function u5(s,e,t){var n,i=t+"",r;return function(){var o=this.getAttribute(s);return o===i?null:o===n?r:r=e(n=o,t)}}function c5(s,e,t){var n,i=t+"",r;return function(){var o=this.getAttributeNS(s.space,s.local);return o===i?null:o===n?r:r=e(n=o,t)}}function h5(s,e,t){var n,i,r;return function(){var o,u=t(this),c;return u==null?void this.removeAttribute(s):(o=this.getAttribute(s),c=u+"",o===c?null:o===n&&c===i?r:(i=c,r=e(n=o,u)))}}function d5(s,e,t){var n,i,r;return function(){var o,u=t(this),c;return u==null?void this.removeAttributeNS(s.space,s.local):(o=this.getAttributeNS(s.space,s.local),c=u+"",o===c?null:o===n&&c===i?r:(i=c,r=e(n=o,u)))}}function f5(s,e){var t=P0(s),n=t==="transform"?q4:FC;return this.attrTween(s,typeof e=="function"?(t.local?d5:h5)(t,n,Lv(this,"attr."+s,e)):e==null?(t.local?l5:o5)(t):(t.local?c5:u5)(t,n,e))}function p5(s,e){return function(t){this.setAttribute(s,e.call(this,t))}}function m5(s,e){return function(t){this.setAttributeNS(s.space,s.local,e.call(this,t))}}function g5(s,e){var t,n;function i(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&m5(s,r)),t}return i._value=e,i}function y5(s,e){var t,n;function i(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&p5(s,r)),t}return i._value=e,i}function x5(s,e){var t="attr."+s;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var n=P0(s);return this.tween(t,(n.local?g5:y5)(n,e))}function b5(s,e){return function(){Bv(this,s).delay=+e.apply(this,arguments)}}function _5(s,e){return e=+e,function(){Bv(this,s).delay=e}}function v5(s){var e=this._id;return arguments.length?this.each((typeof s=="function"?b5:_5)(e,s)):Qi(this.node(),e).delay}function T5(s,e){return function(){Ar(this,s).duration=+e.apply(this,arguments)}}function S5(s,e){return e=+e,function(){Ar(this,s).duration=e}}function w5(s){var e=this._id;return arguments.length?this.each((typeof s=="function"?T5:S5)(e,s)):Qi(this.node(),e).duration}function M5(s,e){if(typeof e!="function")throw new Error;return function(){Ar(this,s).ease=e}}function N5(s){var e=this._id;return arguments.length?this.each(M5(e,s)):Qi(this.node(),e).ease}function A5(s,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Ar(this,s).ease=t}}function E5(s){if(typeof s!="function")throw new Error;return this.each(A5(this._id,s))}function R5(s){typeof s!="function"&&(s=hC(s));for(var e=this._groups,t=e.length,n=new Array(t),i=0;i<t;++i)for(var r=e[i],o=r.length,u=n[i]=[],c,d=0;d<o;++d)(c=r[d])&&s.call(c,c.__data__,d,r)&&u.push(c);return new Ea(n,this._parents,this._name,this._id)}function C5(s){if(s._id!==this._id)throw new Error;for(var e=this._groups,t=s._groups,n=e.length,i=t.length,r=Math.min(n,i),o=new Array(n),u=0;u<r;++u)for(var c=e[u],d=t[u],f=c.length,p=o[u]=new Array(f),g,y=0;y<f;++y)(g=c[y]||d[y])&&(p[y]=g);for(;u<n;++u)o[u]=e[u];return new Ea(o,this._parents,this._name,this._id)}function D5(s){return(s+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function B5(s,e,t){var n,i,r=D5(e)?Bv:Ar;return function(){var o=r(this,s),u=o.on;u!==n&&(i=(n=u).copy()).on(e,t),o.on=i}}function L5(s,e){var t=this._id;return arguments.length<2?Qi(this.node(),t).on.on(s):this.each(B5(t,s,e))}function F5(s){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==s)return;e&&e.removeChild(this)}}function O5(){return this.on("end.remove",F5(this._id))}function U5(s){var e=this._name,t=this._id;typeof s!="function"&&(s=Av(s));for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o)for(var u=n[o],c=u.length,d=r[o]=new Array(c),f,p,g=0;g<c;++g)(f=u[g])&&(p=s.call(f,f.__data__,g,u))&&("__data__"in f&&(p.__data__=f.__data__),d[g]=p,k0(d[g],e,t,g,d,Qi(f,t)));return new Ea(r,this._parents,e,t)}function z5(s){var e=this._name,t=this._id;typeof s!="function"&&(s=cC(s));for(var n=this._groups,i=n.length,r=[],o=[],u=0;u<i;++u)for(var c=n[u],d=c.length,f,p=0;p<d;++p)if(f=c[p]){for(var g=s.call(f,f.__data__,p,c),y,x=Qi(f,t),v=0,S=g.length;v<S;++v)(y=g[v])&&k0(y,e,t,v,g,x);r.push(g),o.push(f)}return new Ea(r,o,e,t)}var V5=Tf.prototype.constructor;function P5(){return new V5(this._groups,this._parents)}function I5(s,e){var t,n,i;return function(){var r=Ic(this,s),o=(this.style.removeProperty(s),Ic(this,s));return r===o?null:r===t&&o===n?i:i=e(t=r,n=o)}}function OC(s){return function(){this.style.removeProperty(s)}}function k5(s,e,t){var n,i=t+"",r;return function(){var o=Ic(this,s);return o===i?null:o===n?r:r=e(n=o,t)}}function G5(s,e,t){var n,i,r;return function(){var o=Ic(this,s),u=t(this),c=u+"";return u==null&&(c=u=(this.style.removeProperty(s),Ic(this,s))),o===c?null:o===n&&c===i?r:(i=c,r=e(n=o,u))}}function $5(s,e){var t,n,i,r="style."+e,o="end."+r,u;return function(){var c=Ar(this,s),d=c.on,f=c.value[r]==null?u||(u=OC(e)):void 0;(d!==t||i!==f)&&(n=(t=d).copy()).on(o,i=f),c.on=n}}function H5(s,e,t){var n=(s+="")=="transform"?j4:FC;return e==null?this.styleTween(s,I5(s,n)).on("end.style."+s,OC(s)):typeof e=="function"?this.styleTween(s,G5(s,n,Lv(this,"style."+s,e))).each($5(this._id,s)):this.styleTween(s,k5(s,n,e),t).on("end.style."+s,null)}function j5(s,e,t){return function(n){this.style.setProperty(s,e.call(this,n),t)}}function q5(s,e,t){var n,i;function r(){var o=e.apply(this,arguments);return o!==i&&(n=(i=o)&&j5(s,o,t)),n}return r._value=e,r}function W5(s,e,t){var n="style."+(s+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,q5(s,e,t??""))}function X5(s){return function(){this.textContent=s}}function Y5(s){return function(){var e=s(this);this.textContent=e??""}}function Z5(s){return this.tween("text",typeof s=="function"?Y5(Lv(this,"text",s)):X5(s==null?"":s+""))}function Q5(s){return function(e){this.textContent=s.call(this,e)}}function K5(s){var e,t;function n(){var i=s.apply(this,arguments);return i!==t&&(e=(t=i)&&Q5(i)),e}return n._value=s,n}function J5(s){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(s==null)return this.tween(e,null);if(typeof s!="function")throw new Error;return this.tween(e,K5(s))}function ek(){for(var s=this._name,e=this._id,t=UC(),n=this._groups,i=n.length,r=0;r<i;++r)for(var o=n[r],u=o.length,c,d=0;d<u;++d)if(c=o[d]){var f=Qi(c,e);k0(c,s,t,d,o,{time:f.time+f.delay+f.duration,delay:0,duration:f.duration,ease:f.ease})}return new Ea(n,this._parents,s,t)}function tk(){var s,e,t=this,n=t._id,i=t.size();return new Promise(function(r,o){var u={value:o},c={value:function(){--i===0&&r()}};t.each(function(){var d=Ar(this,n),f=d.on;f!==s&&(e=(s=f).copy(),e._.cancel.push(u),e._.interrupt.push(u),e._.end.push(c)),d.on=e}),i===0&&r()})}var nk=0;function Ea(s,e,t,n){this._groups=s,this._parents=e,this._name=t,this._id=n}function UC(){return++nk}var ea=Tf.prototype;Ea.prototype={constructor:Ea,select:U5,selectAll:z5,selectChild:ea.selectChild,selectChildren:ea.selectChildren,filter:R5,merge:C5,selection:P5,transition:ek,call:ea.call,nodes:ea.nodes,node:ea.node,size:ea.size,empty:ea.empty,each:ea.each,on:L5,attr:f5,attrTween:x5,style:H5,styleTween:W5,text:Z5,textTween:J5,remove:O5,tween:a5,delay:v5,duration:w5,ease:N5,easeVarying:E5,end:tk,[Symbol.iterator]:ea[Symbol.iterator]};function sk(s){return((s*=2)<=1?s*s*s:(s-=2)*s*s+2)/2}var ik={time:null,delay:0,duration:250,ease:sk};function rk(s,e){for(var t;!(t=s.__transition)||!(t=t[e]);)if(!(s=s.parentNode))throw new Error(`transition ${e} not found`);return t}function ak(s){var e,t;s instanceof Ea?(e=s._id,s=s._name):(e=UC(),(t=ik).time=Dv(),s=s==null?null:s+"");for(var n=this._groups,i=n.length,r=0;r<i;++r)for(var o=n[r],u=o.length,c,d=0;d<u;++d)(c=o[d])&&k0(c,s,e,d,o,t||rk(c,e));return new Ea(n,this._parents,s,e)}Tf.prototype.interrupt=s5;Tf.prototype.transition=ak;const ym=s=>()=>s;function ok(s,{sourceEvent:e,target:t,transform:n,dispatch:i}){Object.defineProperties(this,{type:{value:s,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:i}})}function ma(s,e,t){this.k=s,this.x=e,this.y=t}ma.prototype={constructor:ma,scale:function(s){return s===1?this:new ma(this.k*s,this.x,this.y)},translate:function(s,e){return s===0&e===0?this:new ma(this.k,this.x+this.k*s,this.y+this.k*e)},apply:function(s){return[s[0]*this.k+this.x,s[1]*this.k+this.y]},applyX:function(s){return s*this.k+this.x},applyY:function(s){return s*this.k+this.y},invert:function(s){return[(s[0]-this.x)/this.k,(s[1]-this.y)/this.k]},invertX:function(s){return(s-this.x)/this.k},invertY:function(s){return(s-this.y)/this.k},rescaleX:function(s){return s.copy().domain(s.range().map(this.invertX,this).map(s.invert,s))},rescaleY:function(s){return s.copy().domain(s.range().map(this.invertY,this).map(s.invert,s))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var G0=new ma(1,0,0);zC.prototype=ma.prototype;function zC(s){for(;!s.__zoom;)if(!(s=s.parentNode))return G0;return s.__zoom}function m1(s){s.stopImmediatePropagation()}function ad(s){s.preventDefault(),s.stopImmediatePropagation()}function lk(s){return(!s.ctrlKey||s.type==="wheel")&&!s.button}function uk(){var s=this;return s instanceof SVGElement?(s=s.ownerSVGElement||s,s.hasAttribute("viewBox")?(s=s.viewBox.baseVal,[[s.x,s.y],[s.x+s.width,s.y+s.height]]):[[0,0],[s.width.baseVal.value,s.height.baseVal.value]]):[[0,0],[s.clientWidth,s.clientHeight]]}function mE(){return this.__zoom||G0}function ck(s){return-s.deltaY*(s.deltaMode===1?.05:s.deltaMode?1:.002)*(s.ctrlKey?10:1)}function hk(){return navigator.maxTouchPoints||"ontouchstart"in this}function dk(s,e,t){var n=s.invertX(e[0][0])-t[0][0],i=s.invertX(e[1][0])-t[1][0],r=s.invertY(e[0][1])-t[0][1],o=s.invertY(e[1][1])-t[1][1];return s.translate(i>n?(n+i)/2:Math.min(0,n)||Math.max(0,i),o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o))}function VC(){var s=lk,e=uk,t=dk,n=ck,i=hk,r=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],u=250,c=hg,d=V0("start","zoom","end"),f,p,g,y=500,x=150,v=0,S=10;function w(P){P.property("__zoom",mE).on("wheel.zoom",B,{passive:!1}).on("mousedown.zoom",L).on("dblclick.zoom",X).filter(i).on("touchstart.zoom",G).on("touchmove.zoom",j).on("touchend.zoom touchcancel.zoom",ee).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}w.transform=function(P,Y,F,k){var I=P.selection?P.selection():P;I.property("__zoom",mE),P!==I?C(P,Y,F,k):I.interrupt().each(function(){D(this,arguments).event(k).start().zoom(null,typeof Y=="function"?Y.apply(this,arguments):Y).end()})},w.scaleBy=function(P,Y,F,k){w.scaleTo(P,function(){var I=this.__zoom.k,$=typeof Y=="function"?Y.apply(this,arguments):Y;return I*$},F,k)},w.scaleTo=function(P,Y,F,k){w.transform(P,function(){var I=e.apply(this,arguments),$=this.__zoom,re=F==null?A(I):typeof F=="function"?F.apply(this,arguments):F,V=$.invert(re),q=typeof Y=="function"?Y.apply(this,arguments):Y;return t(T(M($,q),re,V),I,o)},F,k)},w.translateBy=function(P,Y,F,k){w.transform(P,function(){return t(this.__zoom.translate(typeof Y=="function"?Y.apply(this,arguments):Y,typeof F=="function"?F.apply(this,arguments):F),e.apply(this,arguments),o)},null,k)},w.translateTo=function(P,Y,F,k,I){w.transform(P,function(){var $=e.apply(this,arguments),re=this.__zoom,V=k==null?A($):typeof k=="function"?k.apply(this,arguments):k;return t(G0.translate(V[0],V[1]).scale(re.k).translate(typeof Y=="function"?-Y.apply(this,arguments):-Y,typeof F=="function"?-F.apply(this,arguments):-F),$,o)},k,I)};function M(P,Y){return Y=Math.max(r[0],Math.min(r[1],Y)),Y===P.k?P:new ma(Y,P.x,P.y)}function T(P,Y,F){var k=Y[0]-F[0]*P.k,I=Y[1]-F[1]*P.k;return k===P.x&&I===P.y?P:new ma(P.k,k,I)}function A(P){return[(+P[0][0]+ +P[1][0])/2,(+P[0][1]+ +P[1][1])/2]}function C(P,Y,F,k){P.on("start.zoom",function(){D(this,arguments).event(k).start()}).on("interrupt.zoom end.zoom",function(){D(this,arguments).event(k).end()}).tween("zoom",function(){var I=this,$=arguments,re=D(I,$).event(k),V=e.apply(I,$),q=F==null?A(V):typeof F=="function"?F.apply(I,$):F,he=Math.max(V[1][0]-V[0][0],V[1][1]-V[0][1]),fe=I.__zoom,W=typeof Y=="function"?Y.apply(I,$):Y,le=c(fe.invert(q).concat(he/fe.k),W.invert(q).concat(he/W.k));return function(pe){if(pe===1)pe=W;else{var xe=le(pe),Me=he/xe[2];pe=new ma(Me,q[0]-xe[0]*Me,q[1]-xe[1]*Me)}re.zoom(null,pe)}})}function D(P,Y,F){return!F&&P.__zooming||new R(P,Y)}function R(P,Y){this.that=P,this.args=Y,this.active=0,this.sourceEvent=null,this.extent=e.apply(P,Y),this.taps=0}R.prototype={event:function(P){return P&&(this.sourceEvent=P),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(P,Y){return this.mouse&&P!=="mouse"&&(this.mouse[1]=Y.invert(this.mouse[0])),this.touch0&&P!=="touch"&&(this.touch0[1]=Y.invert(this.touch0[0])),this.touch1&&P!=="touch"&&(this.touch1[1]=Y.invert(this.touch1[0])),this.that.__zoom=Y,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(P){var Y=Ys(this.that).datum();d.call(P,this.that,new ok(P,{sourceEvent:this.sourceEvent,target:w,transform:this.that.__zoom,dispatch:d}),Y)}};function B(P,...Y){if(!s.apply(this,arguments))return;var F=D(this,Y).event(P),k=this.__zoom,I=Math.max(r[0],Math.min(r[1],k.k*Math.pow(2,n.apply(this,arguments)))),$=Ui(P);if(F.wheel)(F.mouse[0][0]!==$[0]||F.mouse[0][1]!==$[1])&&(F.mouse[1]=k.invert(F.mouse[0]=$)),clearTimeout(F.wheel);else{if(k.k===I)return;F.mouse=[$,k.invert($)],pg(this),F.start()}ad(P),F.wheel=setTimeout(re,x),F.zoom("mouse",t(T(M(k,I),F.mouse[0],F.mouse[1]),F.extent,o));function re(){F.wheel=null,F.end()}}function L(P,...Y){if(g||!s.apply(this,arguments))return;var F=P.currentTarget,k=D(this,Y,!0).event(P),I=Ys(P.view).on("mousemove.zoom",q,!0).on("mouseup.zoom",he,!0),$=Ui(P,F),re=P.clientX,V=P.clientY;vC(P.view),m1(P),k.mouse=[$,this.__zoom.invert($)],pg(this),k.start();function q(fe){if(ad(fe),!k.moved){var W=fe.clientX-re,le=fe.clientY-V;k.moved=W*W+le*le>v}k.event(fe).zoom("mouse",t(T(k.that.__zoom,k.mouse[0]=Ui(fe,F),k.mouse[1]),k.extent,o))}function he(fe){I.on("mousemove.zoom mouseup.zoom",null),TC(fe.view,k.moved),ad(fe),k.event(fe).end()}}function X(P,...Y){if(s.apply(this,arguments)){var F=this.__zoom,k=Ui(P.changedTouches?P.changedTouches[0]:P,this),I=F.invert(k),$=F.k*(P.shiftKey?.5:2),re=t(T(M(F,$),k,I),e.apply(this,Y),o);ad(P),u>0?Ys(this).transition().duration(u).call(C,re,k,P):Ys(this).call(w.transform,re,k,P)}}function G(P,...Y){if(s.apply(this,arguments)){var F=P.touches,k=F.length,I=D(this,Y,P.changedTouches.length===k).event(P),$,re,V,q;for(m1(P),re=0;re<k;++re)V=F[re],q=Ui(V,this),q=[q,this.__zoom.invert(q),V.identifier],I.touch0?!I.touch1&&I.touch0[2]!==q[2]&&(I.touch1=q,I.taps=0):(I.touch0=q,$=!0,I.taps=1+!!f);f&&(f=clearTimeout(f)),$&&(I.taps<2&&(p=q[0],f=setTimeout(function(){f=null},y)),pg(this),I.start())}}function j(P,...Y){if(this.__zooming){var F=D(this,Y).event(P),k=P.changedTouches,I=k.length,$,re,V,q;for(ad(P),$=0;$<I;++$)re=k[$],V=Ui(re,this),F.touch0&&F.touch0[2]===re.identifier?F.touch0[0]=V:F.touch1&&F.touch1[2]===re.identifier&&(F.touch1[0]=V);if(re=F.that.__zoom,F.touch1){var he=F.touch0[0],fe=F.touch0[1],W=F.touch1[0],le=F.touch1[1],pe=(pe=W[0]-he[0])*pe+(pe=W[1]-he[1])*pe,xe=(xe=le[0]-fe[0])*xe+(xe=le[1]-fe[1])*xe;re=M(re,Math.sqrt(pe/xe)),V=[(he[0]+W[0])/2,(he[1]+W[1])/2],q=[(fe[0]+le[0])/2,(fe[1]+le[1])/2]}else if(F.touch0)V=F.touch0[0],q=F.touch0[1];else return;F.zoom("touch",t(T(re,V,q),F.extent,o))}}function ee(P,...Y){if(this.__zooming){var F=D(this,Y).event(P),k=P.changedTouches,I=k.length,$,re;for(m1(P),g&&clearTimeout(g),g=setTimeout(function(){g=null},y),$=0;$<I;++$)re=k[$],F.touch0&&F.touch0[2]===re.identifier?delete F.touch0:F.touch1&&F.touch1[2]===re.identifier&&delete F.touch1;if(F.touch1&&!F.touch0&&(F.touch0=F.touch1,delete F.touch1),F.touch0)F.touch0[1]=this.__zoom.invert(F.touch0[0]);else if(F.end(),F.taps===2&&(re=Ui(re,this),Math.hypot(p[0]-re[0],p[1]-re[1])<S)){var V=Ys(this).on("dblclick.zoom");V&&V.apply(this,arguments)}}}return w.wheelDelta=function(P){return arguments.length?(n=typeof P=="function"?P:ym(+P),w):n},w.filter=function(P){return arguments.length?(s=typeof P=="function"?P:ym(!!P),w):s},w.touchable=function(P){return arguments.length?(i=typeof P=="function"?P:ym(!!P),w):i},w.extent=function(P){return arguments.length?(e=typeof P=="function"?P:ym([[+P[0][0],+P[0][1]],[+P[1][0],+P[1][1]]]),w):e},w.scaleExtent=function(P){return arguments.length?(r[0]=+P[0],r[1]=+P[1],w):[r[0],r[1]]},w.translateExtent=function(P){return arguments.length?(o[0][0]=+P[0][0],o[1][0]=+P[1][0],o[0][1]=+P[0][1],o[1][1]=+P[1][1],w):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},w.constrain=function(P){return arguments.length?(t=P,w):t},w.duration=function(P){return arguments.length?(u=+P,w):u},w.interpolate=function(P){return arguments.length?(c=P,w):c},w.on=function(){var P=d.on.apply(d,arguments);return P===d?w:P},w.clickDistance=function(P){return arguments.length?(v=(P=+P)*P,w):Math.sqrt(v)},w.tapDistance=function(P){return arguments.length?(S=+P,w):S},w}const ji={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:s=>`Node type "${s}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:s=>`The old edge with id=${s} does not exist.`,error009:s=>`Marker type "${s}" doesn't exist.`,error008:(s,{id:e,sourceHandle:t,targetHandle:n})=>`Couldn't create edge for ${s} handle id: "${s==="source"?t:n}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:s=>`Edge type "${s}" not found. Using fallback type "default".`,error012:s=>`Node with id "${s}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(s="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${s}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},sf=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],PC=["Enter"," ","Escape"],IC={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:s,x:e,y:t})=>`Moved selected node ${s}. New position, x: ${e}, y: ${t}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Gc;(function(s){s.Strict="strict",s.Loose="loose"})(Gc||(Gc={}));var jl;(function(s){s.Free="free",s.Vertical="vertical",s.Horizontal="horizontal"})(jl||(jl={}));var rf;(function(s){s.Partial="partial",s.Full="full"})(rf||(rf={}));const kC={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Ao;(function(s){s.Bezier="default",s.Straight="straight",s.Step="step",s.SmoothStep="smoothstep",s.SimpleBezier="simplebezier"})(Ao||(Ao={}));var Bg;(function(s){s.Arrow="arrow",s.ArrowClosed="arrowclosed"})(Bg||(Bg={}));var He;(function(s){s.Left="left",s.Top="top",s.Right="right",s.Bottom="bottom"})(He||(He={}));const gE={[He.Left]:He.Right,[He.Right]:He.Left,[He.Top]:He.Bottom,[He.Bottom]:He.Top};function fk(s,e){if(!s&&!e)return!0;if(!s||!e||s.size!==e.size)return!1;if(!s.size&&!e.size)return!0;for(const t of s.keys())if(!e.has(t))return!1;return!0}function yE(s,e,t){if(!t)return;const n=[];s.forEach((i,r)=>{e!=null&&e.has(r)||n.push(i)}),n.length&&t(n)}function GC(s){return s===null?null:s?"valid":"invalid"}const $C=s=>"id"in s&&"source"in s&&"target"in s,pk=s=>"id"in s&&"position"in s&&!("source"in s)&&!("target"in s),Fv=s=>"id"in s&&"internals"in s&&!("source"in s)&&!("target"in s),wf=(s,e=[0,0])=>{const{width:t,height:n}=Ba(s),i=s.origin??e,r=t*i[0],o=n*i[1];return{x:s.position.x-r,y:s.position.y-o}},mk=(s,e={nodeOrigin:[0,0]})=>{if(s.length===0)return{x:0,y:0,width:0,height:0};const t=s.reduce((n,i)=>{const r=typeof i=="string";let o=!e.nodeLookup&&!r?i:void 0;e.nodeLookup&&(o=r?e.nodeLookup.get(i):Fv(i)?i:e.nodeLookup.get(i.id));const u=o?Lg(o,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return $0(n,u)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return H0(t)},Mf=(s,e={})=>{let t={x:1/0,y:1/0,x2:-1/0,y2:-1/0},n=!1;return s.forEach(i=>{(e.filter===void 0||e.filter(i))&&(t=$0(t,Lg(i)),n=!0)}),n?H0(t):{x:0,y:0,width:0,height:0}},Ov=(s,e,[t,n,i]=[0,0,1],r=!1,o=!1)=>{const u={...Af(e,[t,n,i]),width:e.width/i,height:e.height/i},c=[];for(const d of s.values()){const{measured:f,selectable:p=!0,hidden:g=!1}=d;if(o&&!p||g)continue;const y=f.width??d.width??d.initialWidth??null,x=f.height??d.height??d.initialHeight??null,v=af(u,Hc(d)),S=(y??0)*(x??0),w=r&&v>0;(!d.internals.handleBounds||w||v>=S||d.dragging)&&c.push(d)}return c},gk=(s,e)=>{const t=new Set;return s.forEach(n=>{t.add(n.id)}),e.filter(n=>t.has(n.source)||t.has(n.target))};function yk(s,e){const t=new Map,n=e!=null&&e.nodes?new Set(e.nodes.map(i=>i.id)):null;return s.forEach(i=>{i.measured.width&&i.measured.height&&((e==null?void 0:e.includeHiddenNodes)||!i.hidden)&&(!n||n.has(i.id))&&t.set(i.id,i)}),t}async function xk({nodes:s,width:e,height:t,panZoom:n,minZoom:i,maxZoom:r},o){if(s.size===0)return Promise.resolve(!0);const u=yk(s,o),c=Mf(u),d=Uv(c,e,t,(o==null?void 0:o.minZoom)??i,(o==null?void 0:o.maxZoom)??r,(o==null?void 0:o.padding)??.1);return await n.setViewport(d,{duration:o==null?void 0:o.duration,ease:o==null?void 0:o.ease,interpolate:o==null?void 0:o.interpolate}),Promise.resolve(!0)}function HC({nodeId:s,nextPosition:e,nodeLookup:t,nodeOrigin:n=[0,0],nodeExtent:i,onError:r}){const o=t.get(s),u=o.parentId?t.get(o.parentId):void 0,{x:c,y:d}=u?u.internals.positionAbsolute:{x:0,y:0},f=o.origin??n;let p=o.extent||i;if(o.extent==="parent"&&!o.expandParent)if(!u)r==null||r("005",ji.error005());else{const y=u.measured.width,x=u.measured.height;y&&x&&(p=[[c,d],[c+y,d+x]])}else u&&jc(o.extent)&&(p=[[o.extent[0][0]+c,o.extent[0][1]+d],[o.extent[1][0]+c,o.extent[1][1]+d]]);const g=jc(p)?Ql(e,p,o.measured):e;return(o.measured.width===void 0||o.measured.height===void 0)&&(r==null||r("015",ji.error015())),{position:{x:g.x-c+(o.measured.width??0)*f[0],y:g.y-d+(o.measured.height??0)*f[1]},positionAbsolute:g}}async function bk({nodesToRemove:s=[],edgesToRemove:e=[],nodes:t,edges:n,onBeforeDelete:i}){const r=new Set(s.map(g=>g.id)),o=[];for(const g of t){if(g.deletable===!1)continue;const y=r.has(g.id),x=!y&&g.parentId&&o.find(v=>v.id===g.parentId);(y||x)&&o.push(g)}const u=new Set(e.map(g=>g.id)),c=n.filter(g=>g.deletable!==!1),f=gk(o,c);for(const g of c)u.has(g.id)&&!f.find(x=>x.id===g.id)&&f.push(g);if(!i)return{edges:f,nodes:o};const p=await i({nodes:o,edges:f});return typeof p=="boolean"?p?{edges:f,nodes:o}:{edges:[],nodes:[]}:p}const $c=(s,e=0,t=1)=>Math.min(Math.max(s,e),t),Ql=(s={x:0,y:0},e,t)=>({x:$c(s.x,e[0][0],e[1][0]-((t==null?void 0:t.width)??0)),y:$c(s.y,e[0][1],e[1][1]-((t==null?void 0:t.height)??0))});function jC(s,e,t){const{width:n,height:i}=Ba(t),{x:r,y:o}=t.internals.positionAbsolute;return Ql(s,[[r,o],[r+n,o+i]],e)}const xE=(s,e,t)=>s<e?$c(Math.abs(s-e),1,e)/e:s>t?-$c(Math.abs(s-t),1,e)/e:0,qC=(s,e,t=15,n=40)=>{const i=xE(s.x,n,e.width-n)*t,r=xE(s.y,n,e.height-n)*t;return[i,r]},$0=(s,e)=>({x:Math.min(s.x,e.x),y:Math.min(s.y,e.y),x2:Math.max(s.x2,e.x2),y2:Math.max(s.y2,e.y2)}),z_=({x:s,y:e,width:t,height:n})=>({x:s,y:e,x2:s+t,y2:e+n}),H0=({x:s,y:e,x2:t,y2:n})=>({x:s,y:e,width:t-s,height:n-e}),Hc=(s,e=[0,0])=>{var i,r;const{x:t,y:n}=Fv(s)?s.internals.positionAbsolute:wf(s,e);return{x:t,y:n,width:((i=s.measured)==null?void 0:i.width)??s.width??s.initialWidth??0,height:((r=s.measured)==null?void 0:r.height)??s.height??s.initialHeight??0}},Lg=(s,e=[0,0])=>{var i,r;const{x:t,y:n}=Fv(s)?s.internals.positionAbsolute:wf(s,e);return{x:t,y:n,x2:t+(((i=s.measured)==null?void 0:i.width)??s.width??s.initialWidth??0),y2:n+(((r=s.measured)==null?void 0:r.height)??s.height??s.initialHeight??0)}},WC=(s,e)=>H0($0(z_(s),z_(e))),af=(s,e)=>{const t=Math.max(0,Math.min(s.x+s.width,e.x+e.width)-Math.max(s.x,e.x)),n=Math.max(0,Math.min(s.y+s.height,e.y+e.height)-Math.max(s.y,e.y));return Math.ceil(t*n)},bE=s=>Gi(s.width)&&Gi(s.height)&&Gi(s.x)&&Gi(s.y),Gi=s=>!isNaN(s)&&isFinite(s),_k=(s,e)=>{},Nf=(s,e=[1,1])=>({x:e[0]*Math.round(s.x/e[0]),y:e[1]*Math.round(s.y/e[1])}),Af=({x:s,y:e},[t,n,i],r=!1,o=[1,1])=>{const u={x:(s-t)/i,y:(e-n)/i};return r?Nf(u,o):u},Fg=({x:s,y:e},[t,n,i])=>({x:s*i+t,y:e*i+n});function Xu(s,e){if(typeof s=="number")return Math.floor((e-e/(1+s))*.5);if(typeof s=="string"&&s.endsWith("px")){const t=parseFloat(s);if(!Number.isNaN(t))return Math.floor(t)}if(typeof s=="string"&&s.endsWith("%")){const t=parseFloat(s);if(!Number.isNaN(t))return Math.floor(e*t*.01)}return console.error(`[React Flow] The padding value "${s}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function vk(s,e,t){if(typeof s=="string"||typeof s=="number"){const n=Xu(s,t),i=Xu(s,e);return{top:n,right:i,bottom:n,left:i,x:i*2,y:n*2}}if(typeof s=="object"){const n=Xu(s.top??s.y??0,t),i=Xu(s.bottom??s.y??0,t),r=Xu(s.left??s.x??0,e),o=Xu(s.right??s.x??0,e);return{top:n,right:o,bottom:i,left:r,x:r+o,y:n+i}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Tk(s,e,t,n,i,r){const{x:o,y:u}=Fg(s,[e,t,n]),{x:c,y:d}=Fg({x:s.x+s.width,y:s.y+s.height},[e,t,n]),f=i-c,p=r-d;return{left:Math.floor(o),top:Math.floor(u),right:Math.floor(f),bottom:Math.floor(p)}}const Uv=(s,e,t,n,i,r)=>{const o=vk(r,e,t),u=(e-o.x)/s.width,c=(t-o.y)/s.height,d=Math.min(u,c),f=$c(d,n,i),p=s.x+s.width/2,g=s.y+s.height/2,y=e/2-p*f,x=t/2-g*f,v=Tk(s,y,x,f,e,t),S={left:Math.min(v.left-o.left,0),top:Math.min(v.top-o.top,0),right:Math.min(v.right-o.right,0),bottom:Math.min(v.bottom-o.bottom,0)};return{x:y-S.left+S.right,y:x-S.top+S.bottom,zoom:f}},of=()=>{var s;return typeof navigator<"u"&&((s=navigator==null?void 0:navigator.userAgent)==null?void 0:s.indexOf("Mac"))>=0};function jc(s){return s!=null&&s!=="parent"}function Ba(s){var e,t;return{width:((e=s.measured)==null?void 0:e.width)??s.width??s.initialWidth??0,height:((t=s.measured)==null?void 0:t.height)??s.height??s.initialHeight??0}}function XC(s){var e,t;return(((e=s.measured)==null?void 0:e.width)??s.width??s.initialWidth)!==void 0&&(((t=s.measured)==null?void 0:t.height)??s.height??s.initialHeight)!==void 0}function YC(s,e={width:0,height:0},t,n,i){const r={...s},o=n.get(t);if(o){const u=o.origin||i;r.x+=o.internals.positionAbsolute.x-(e.width??0)*u[0],r.y+=o.internals.positionAbsolute.y-(e.height??0)*u[1]}return r}function _E(s,e){if(s.size!==e.size)return!1;for(const t of s)if(!e.has(t))return!1;return!0}function Sk(){let s,e;return{promise:new Promise((n,i)=>{s=n,e=i}),resolve:s,reject:e}}function wk(s){return{...IC,...s||{}}}function Od(s,{snapGrid:e=[0,0],snapToGrid:t=!1,transform:n,containerBounds:i}){const{x:r,y:o}=$i(s),u=Af({x:r-((i==null?void 0:i.left)??0),y:o-((i==null?void 0:i.top)??0)},n),{x:c,y:d}=t?Nf(u,e):u;return{xSnapped:c,ySnapped:d,...u}}const zv=s=>({width:s.offsetWidth,height:s.offsetHeight}),ZC=s=>{var e;return((e=s==null?void 0:s.getRootNode)==null?void 0:e.call(s))||(window==null?void 0:window.document)},Mk=["INPUT","SELECT","TEXTAREA"];function QC(s){var n,i;const e=((i=(n=s.composedPath)==null?void 0:n.call(s))==null?void 0:i[0])||s.target;return(e==null?void 0:e.nodeType)!==1?!1:Mk.includes(e.nodeName)||e.hasAttribute("contenteditable")||!!e.closest(".nokey")}const KC=s=>"clientX"in s,$i=(s,e)=>{var r,o;const t=KC(s),n=t?s.clientX:(r=s.touches)==null?void 0:r[0].clientX,i=t?s.clientY:(o=s.touches)==null?void 0:o[0].clientY;return{x:n-((e==null?void 0:e.left)??0),y:i-((e==null?void 0:e.top)??0)}},vE=(s,e,t,n,i)=>{const r=e.querySelectorAll(`.${s}`);return!r||!r.length?null:Array.from(r).map(o=>{const u=o.getBoundingClientRect();return{id:o.getAttribute("data-handleid"),type:s,nodeId:i,position:o.getAttribute("data-handlepos"),x:(u.left-t.left)/n,y:(u.top-t.top)/n,...zv(o)}})};function JC({sourceX:s,sourceY:e,targetX:t,targetY:n,sourceControlX:i,sourceControlY:r,targetControlX:o,targetControlY:u}){const c=s*.125+i*.375+o*.375+t*.125,d=e*.125+r*.375+u*.375+n*.125,f=Math.abs(c-s),p=Math.abs(d-e);return[c,d,f,p]}function xm(s,e){return s>=0?.5*s:e*25*Math.sqrt(-s)}function TE({pos:s,x1:e,y1:t,x2:n,y2:i,c:r}){switch(s){case He.Left:return[e-xm(e-n,r),t];case He.Right:return[e+xm(n-e,r),t];case He.Top:return[e,t-xm(t-i,r)];case He.Bottom:return[e,t+xm(i-t,r)]}}function e3({sourceX:s,sourceY:e,sourcePosition:t=He.Bottom,targetX:n,targetY:i,targetPosition:r=He.Top,curvature:o=.25}){const[u,c]=TE({pos:t,x1:s,y1:e,x2:n,y2:i,c:o}),[d,f]=TE({pos:r,x1:n,y1:i,x2:s,y2:e,c:o}),[p,g,y,x]=JC({sourceX:s,sourceY:e,targetX:n,targetY:i,sourceControlX:u,sourceControlY:c,targetControlX:d,targetControlY:f});return[`M${s},${e} C${u},${c} ${d},${f} ${n},${i}`,p,g,y,x]}function t3({sourceX:s,sourceY:e,targetX:t,targetY:n}){const i=Math.abs(t-s)/2,r=t<s?t+i:t-i,o=Math.abs(n-e)/2,u=n<e?n+o:n-o;return[r,u,i,o]}function Nk({sourceNode:s,targetNode:e,selected:t=!1,zIndex:n=0,elevateOnSelect:i=!1,zIndexMode:r="basic"}){if(r==="manual")return n;const o=i&&t?n+1e3:n,u=Math.max(s.parentId||i&&s.selected?s.internals.z:0,e.parentId||i&&e.selected?e.internals.z:0);return o+u}function Ak({sourceNode:s,targetNode:e,width:t,height:n,transform:i}){const r=$0(Lg(s),Lg(e));r.x===r.x2&&(r.x2+=1),r.y===r.y2&&(r.y2+=1);const o={x:-i[0]/i[2],y:-i[1]/i[2],width:t/i[2],height:n/i[2]};return af(o,H0(r))>0}const Ek=({source:s,sourceHandle:e,target:t,targetHandle:n})=>`xy-edge__${s}${e||""}-${t}${n||""}`,Rk=(s,e)=>e.some(t=>t.source===s.source&&t.target===s.target&&(t.sourceHandle===s.sourceHandle||!t.sourceHandle&&!s.sourceHandle)&&(t.targetHandle===s.targetHandle||!t.targetHandle&&!s.targetHandle)),n3=(s,e,t={})=>{if(!s.source||!s.target)return e;const n=t.getEdgeId||Ek;let i;return $C(s)?i={...s}:i={...s,id:n(s)},Rk(i,e)?e:(i.sourceHandle===null&&delete i.sourceHandle,i.targetHandle===null&&delete i.targetHandle,e.concat(i))};function s3({sourceX:s,sourceY:e,targetX:t,targetY:n}){const[i,r,o,u]=t3({sourceX:s,sourceY:e,targetX:t,targetY:n});return[`M ${s},${e}L ${t},${n}`,i,r,o,u]}const SE={[He.Left]:{x:-1,y:0},[He.Right]:{x:1,y:0},[He.Top]:{x:0,y:-1},[He.Bottom]:{x:0,y:1}},Ck=({source:s,sourcePosition:e=He.Bottom,target:t})=>e===He.Left||e===He.Right?s.x<t.x?{x:1,y:0}:{x:-1,y:0}:s.y<t.y?{x:0,y:1}:{x:0,y:-1},wE=(s,e)=>Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2));function Dk({source:s,sourcePosition:e=He.Bottom,target:t,targetPosition:n=He.Top,center:i,offset:r,stepPosition:o}){const u=SE[e],c=SE[n],d={x:s.x+u.x*r,y:s.y+u.y*r},f={x:t.x+c.x*r,y:t.y+c.y*r},p=Ck({source:d,sourcePosition:e,target:f}),g=p.x!==0?"x":"y",y=p[g];let x=[],v,S;const w={x:0,y:0},M={x:0,y:0},[,,T,A]=t3({sourceX:s.x,sourceY:s.y,targetX:t.x,targetY:t.y});if(u[g]*c[g]===-1){g==="x"?(v=i.x??d.x+(f.x-d.x)*o,S=i.y??(d.y+f.y)/2):(v=i.x??(d.x+f.x)/2,S=i.y??d.y+(f.y-d.y)*o);const D=[{x:v,y:d.y},{x:v,y:f.y}],R=[{x:d.x,y:S},{x:f.x,y:S}];u[g]===y?x=g==="x"?D:R:x=g==="x"?R:D}else{const D=[{x:d.x,y:f.y}],R=[{x:f.x,y:d.y}];if(g==="x"?x=u.x===y?R:D:x=u.y===y?D:R,e===n){const j=Math.abs(s[g]-t[g]);if(j<=r){const ee=Math.min(r-1,r-j);u[g]===y?w[g]=(d[g]>s[g]?-1:1)*ee:M[g]=(f[g]>t[g]?-1:1)*ee}}if(e!==n){const j=g==="x"?"y":"x",ee=u[g]===c[j],P=d[j]>f[j],Y=d[j]<f[j];(u[g]===1&&(!ee&&P||ee&&Y)||u[g]!==1&&(!ee&&Y||ee&&P))&&(x=g==="x"?D:R)}const B={x:d.x+w.x,y:d.y+w.y},L={x:f.x+M.x,y:f.y+M.y},X=Math.max(Math.abs(B.x-x[0].x),Math.abs(L.x-x[0].x)),G=Math.max(Math.abs(B.y-x[0].y),Math.abs(L.y-x[0].y));X>=G?(v=(B.x+L.x)/2,S=x[0].y):(v=x[0].x,S=(B.y+L.y)/2)}return[[s,{x:d.x+w.x,y:d.y+w.y},...x,{x:f.x+M.x,y:f.y+M.y},t],v,S,T,A]}function Bk(s,e,t,n){const i=Math.min(wE(s,e)/2,wE(e,t)/2,n),{x:r,y:o}=e;if(s.x===r&&r===t.x||s.y===o&&o===t.y)return`L${r} ${o}`;if(s.y===o){const d=s.x<t.x?-1:1,f=s.y<t.y?1:-1;return`L ${r+i*d},${o}Q ${r},${o} ${r},${o+i*f}`}const u=s.x<t.x?1:-1,c=s.y<t.y?-1:1;return`L ${r},${o+i*c}Q ${r},${o} ${r+i*u},${o}`}function V_({sourceX:s,sourceY:e,sourcePosition:t=He.Bottom,targetX:n,targetY:i,targetPosition:r=He.Top,borderRadius:o=5,centerX:u,centerY:c,offset:d=20,stepPosition:f=.5}){const[p,g,y,x,v]=Dk({source:{x:s,y:e},sourcePosition:t,target:{x:n,y:i},targetPosition:r,center:{x:u,y:c},offset:d,stepPosition:f});return[p.reduce((w,M,T)=>{let A="";return T>0&&T<p.length-1?A=Bk(p[T-1],M,p[T+1],o):A=`${T===0?"M":"L"}${M.x} ${M.y}`,w+=A,w},""),g,y,x,v]}function ME(s){var e;return s&&!!(s.internals.handleBounds||(e=s.handles)!=null&&e.length)&&!!(s.measured.width||s.width||s.initialWidth)}function Lk(s){var p;const{sourceNode:e,targetNode:t}=s;if(!ME(e)||!ME(t))return null;const n=e.internals.handleBounds||NE(e.handles),i=t.internals.handleBounds||NE(t.handles),r=AE((n==null?void 0:n.source)??[],s.sourceHandle),o=AE(s.connectionMode===Gc.Strict?(i==null?void 0:i.target)??[]:((i==null?void 0:i.target)??[]).concat((i==null?void 0:i.source)??[]),s.targetHandle);if(!r||!o)return(p=s.onError)==null||p.call(s,"008",ji.error008(r?"target":"source",{id:s.id,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle})),null;const u=(r==null?void 0:r.position)||He.Bottom,c=(o==null?void 0:o.position)||He.Top,d=Kl(e,r,u),f=Kl(t,o,c);return{sourceX:d.x,sourceY:d.y,targetX:f.x,targetY:f.y,sourcePosition:u,targetPosition:c}}function NE(s){if(!s)return null;const e=[],t=[];for(const n of s)n.width=n.width??1,n.height=n.height??1,n.type==="source"?e.push(n):n.type==="target"&&t.push(n);return{source:e,target:t}}function Kl(s,e,t=He.Left,n=!1){const i=((e==null?void 0:e.x)??0)+s.internals.positionAbsolute.x,r=((e==null?void 0:e.y)??0)+s.internals.positionAbsolute.y,{width:o,height:u}=e??Ba(s);if(n)return{x:i+o/2,y:r+u/2};switch((e==null?void 0:e.position)??t){case He.Top:return{x:i+o/2,y:r};case He.Right:return{x:i+o,y:r+u/2};case He.Bottom:return{x:i+o/2,y:r+u};case He.Left:return{x:i,y:r+u/2}}}function AE(s,e){return s&&(e?s.find(t=>t.id===e):s[0])||null}function P_(s,e){return s?typeof s=="string"?s:`${e?`${e}__`:""}${Object.keys(s).sort().map(n=>`${n}=${s[n]}`).join("&")}`:""}function Fk(s,{id:e,defaultColor:t,defaultMarkerStart:n,defaultMarkerEnd:i}){const r=new Set;return s.reduce((o,u)=>([u.markerStart||n,u.markerEnd||i].forEach(c=>{if(c&&typeof c=="object"){const d=P_(c,e);r.has(d)||(o.push({id:d,color:c.color||t,...c}),r.add(d))}}),o),[]).sort((o,u)=>o.id.localeCompare(u.id))}const i3=1e3,Ok=10,Vv={nodeOrigin:[0,0],nodeExtent:sf,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},Uk={...Vv,checkEquality:!0};function Pv(s,e){const t={...s};for(const n in e)e[n]!==void 0&&(t[n]=e[n]);return t}function zk(s,e,t){const n=Pv(Vv,t);for(const i of s.values())if(i.parentId)kv(i,s,e,n);else{const r=wf(i,n.nodeOrigin),o=jc(i.extent)?i.extent:n.nodeExtent,u=Ql(r,o,Ba(i));i.internals.positionAbsolute=u}}function Vk(s,e){if(!s.handles)return s.measured?e==null?void 0:e.internals.handleBounds:void 0;const t=[],n=[];for(const i of s.handles){const r={id:i.id,width:i.width??1,height:i.height??1,nodeId:s.id,x:i.x,y:i.y,position:i.position,type:i.type};i.type==="source"?t.push(r):i.type==="target"&&n.push(r)}return{source:t,target:n}}function Iv(s){return s==="manual"}function I_(s,e,t,n={}){var d,f;const i=Pv(Uk,n),r={i:0},o=new Map(e),u=i!=null&&i.elevateNodesOnSelect&&!Iv(i.zIndexMode)?i3:0;let c=s.length>0;e.clear(),t.clear();for(const p of s){let g=o.get(p.id);if(i.checkEquality&&p===(g==null?void 0:g.internals.userNode))e.set(p.id,g);else{const y=wf(p,i.nodeOrigin),x=jc(p.extent)?p.extent:i.nodeExtent,v=Ql(y,x,Ba(p));g={...i.defaults,...p,measured:{width:(d=p.measured)==null?void 0:d.width,height:(f=p.measured)==null?void 0:f.height},internals:{positionAbsolute:v,handleBounds:Vk(p,g),z:r3(p,u,i.zIndexMode),userNode:p}},e.set(p.id,g)}(g.measured===void 0||g.measured.width===void 0||g.measured.height===void 0)&&!g.hidden&&(c=!1),p.parentId&&kv(g,e,t,n,r)}return c}function Pk(s,e){if(!s.parentId)return;const t=e.get(s.parentId);t?t.set(s.id,s):e.set(s.parentId,new Map([[s.id,s]]))}function kv(s,e,t,n,i){const{elevateNodesOnSelect:r,nodeOrigin:o,nodeExtent:u,zIndexMode:c}=Pv(Vv,n),d=s.parentId,f=e.get(d);if(!f){console.warn(`Parent node ${d} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}Pk(s,t),i&&!f.parentId&&f.internals.rootParentIndex===void 0&&c==="auto"&&(f.internals.rootParentIndex=++i.i,f.internals.z=f.internals.z+i.i*Ok),i&&f.internals.rootParentIndex!==void 0&&(i.i=f.internals.rootParentIndex);const p=r&&!Iv(c)?i3:0,{x:g,y,z:x}=Ik(s,f,o,u,p,c),{positionAbsolute:v}=s.internals,S=g!==v.x||y!==v.y;(S||x!==s.internals.z)&&e.set(s.id,{...s,internals:{...s.internals,positionAbsolute:S?{x:g,y}:v,z:x}})}function r3(s,e,t){const n=Gi(s.zIndex)?s.zIndex:0;return Iv(t)?n:n+(s.selected?e:0)}function Ik(s,e,t,n,i,r){const{x:o,y:u}=e.internals.positionAbsolute,c=Ba(s),d=wf(s,t),f=jc(s.extent)?Ql(d,s.extent,c):d;let p=Ql({x:o+f.x,y:u+f.y},n,c);s.extent==="parent"&&(p=jC(p,c,e));const g=r3(s,i,r),y=e.internals.z??0;return{x:p.x,y:p.y,z:y>=g?y+1:g}}function Gv(s,e,t,n=[0,0]){var o;const i=[],r=new Map;for(const u of s){const c=e.get(u.parentId);if(!c)continue;const d=((o=r.get(u.parentId))==null?void 0:o.expandedRect)??Hc(c),f=WC(d,u.rect);r.set(u.parentId,{expandedRect:f,parent:c})}return r.size>0&&r.forEach(({expandedRect:u,parent:c},d)=>{var T;const f=c.internals.positionAbsolute,p=Ba(c),g=c.origin??n,y=u.x<f.x?Math.round(Math.abs(f.x-u.x)):0,x=u.y<f.y?Math.round(Math.abs(f.y-u.y)):0,v=Math.max(p.width,Math.round(u.width)),S=Math.max(p.height,Math.round(u.height)),w=(v-p.width)*g[0],M=(S-p.height)*g[1];(y>0||x>0||w||M)&&(i.push({id:d,type:"position",position:{x:c.position.x-y+w,y:c.position.y-x+M}}),(T=t.get(d))==null||T.forEach(A=>{s.some(C=>C.id===A.id)||i.push({id:A.id,type:"position",position:{x:A.position.x+y,y:A.position.y+x}})})),(p.width<u.width||p.height<u.height||y||x)&&i.push({id:d,type:"dimensions",setAttributes:!0,dimensions:{width:v+(y?g[0]*y-w:0),height:S+(x?g[1]*x-M:0)}})}),i}function kk(s,e,t,n,i,r,o){const u=n==null?void 0:n.querySelector(".xyflow__viewport");let c=!1;if(!u)return{changes:[],updatedInternals:c};const d=[],f=window.getComputedStyle(u),{m22:p}=new window.DOMMatrixReadOnly(f.transform),g=[];for(const y of s.values()){const x=e.get(y.id);if(!x)continue;if(x.hidden){e.set(x.id,{...x,internals:{...x.internals,handleBounds:void 0}}),c=!0;continue}const v=zv(y.nodeElement),S=x.measured.width!==v.width||x.measured.height!==v.height;if(!!(v.width&&v.height&&(S||!x.internals.handleBounds||y.force))){const M=y.nodeElement.getBoundingClientRect(),T=jc(x.extent)?x.extent:r;let{positionAbsolute:A}=x.internals;x.parentId&&x.extent==="parent"?A=jC(A,v,e.get(x.parentId)):T&&(A=Ql(A,T,v));const C={...x,measured:v,internals:{...x.internals,positionAbsolute:A,handleBounds:{source:vE("source",y.nodeElement,M,p,x.id),target:vE("target",y.nodeElement,M,p,x.id)}}};e.set(x.id,C),x.parentId&&kv(C,e,t,{nodeOrigin:i,zIndexMode:o}),c=!0,S&&(d.push({id:x.id,type:"dimensions",dimensions:v}),x.expandParent&&x.parentId&&g.push({id:x.id,parentId:x.parentId,rect:Hc(C,i)}))}}if(g.length>0){const y=Gv(g,e,t,i);d.push(...y)}return{changes:d,updatedInternals:c}}async function Gk({delta:s,panZoom:e,transform:t,translateExtent:n,width:i,height:r}){if(!e||!s.x&&!s.y)return Promise.resolve(!1);const o=await e.setViewportConstrained({x:t[0]+s.x,y:t[1]+s.y,zoom:t[2]},[[0,0],[i,r]],n),u=!!o&&(o.x!==t[0]||o.y!==t[1]||o.k!==t[2]);return Promise.resolve(u)}function EE(s,e,t,n,i,r){let o=i;const u=n.get(o)||new Map;n.set(o,u.set(t,e)),o=`${i}-${s}`;const c=n.get(o)||new Map;if(n.set(o,c.set(t,e)),r){o=`${i}-${s}-${r}`;const d=n.get(o)||new Map;n.set(o,d.set(t,e))}}function a3(s,e,t){s.clear(),e.clear();for(const n of t){const{source:i,target:r,sourceHandle:o=null,targetHandle:u=null}=n,c={edgeId:n.id,source:i,target:r,sourceHandle:o,targetHandle:u},d=`${i}-${o}--${r}-${u}`,f=`${r}-${u}--${i}-${o}`;EE("source",c,f,s,i,o),EE("target",c,d,s,r,u),e.set(n.id,n)}}function o3(s,e){if(!s.parentId)return!1;const t=e.get(s.parentId);return t?t.selected?!0:o3(t,e):!1}function RE(s,e,t){var i;let n=s;do{if((i=n==null?void 0:n.matches)!=null&&i.call(n,e))return!0;if(n===t)return!1;n=n==null?void 0:n.parentElement}while(n);return!1}function $k(s,e,t,n){const i=new Map;for(const[r,o]of s)if((o.selected||o.id===n)&&(!o.parentId||!o3(o,s))&&(o.draggable||e&&typeof o.draggable>"u")){const u=s.get(r);u&&i.set(r,{id:r,position:u.position||{x:0,y:0},distance:{x:t.x-u.internals.positionAbsolute.x,y:t.y-u.internals.positionAbsolute.y},extent:u.extent,parentId:u.parentId,origin:u.origin,expandParent:u.expandParent,internals:{positionAbsolute:u.internals.positionAbsolute||{x:0,y:0}},measured:{width:u.measured.width??0,height:u.measured.height??0}})}return i}function g1({nodeId:s,dragItems:e,nodeLookup:t,dragging:n=!0}){var o,u,c;const i=[];for(const[d,f]of e){const p=(o=t.get(d))==null?void 0:o.internals.userNode;p&&i.push({...p,position:f.position,dragging:n})}if(!s)return[i[0],i];const r=(u=t.get(s))==null?void 0:u.internals.userNode;return[r?{...r,position:((c=e.get(s))==null?void 0:c.position)||r.position,dragging:n}:i[0],i]}function Hk({dragItems:s,snapGrid:e,x:t,y:n}){const i=s.values().next().value;if(!i)return null;const r={x:t-i.distance.x,y:n-i.distance.y},o=Nf(r,e);return{x:o.x-r.x,y:o.y-r.y}}function jk({onNodeMouseDown:s,getStoreItems:e,onDragStart:t,onDrag:n,onDragStop:i}){let r={x:null,y:null},o=0,u=new Map,c=!1,d={x:0,y:0},f=null,p=!1,g=null,y=!1,x=!1,v=null;function S({noDragClassName:M,handleSelector:T,domNode:A,isSelectable:C,nodeId:D,nodeClickDistance:R=0}){g=Ys(A);function B({x:j,y:ee}){const{nodeLookup:P,nodeExtent:Y,snapGrid:F,snapToGrid:k,nodeOrigin:I,onNodeDrag:$,onSelectionDrag:re,onError:V,updateNodePositions:q}=e();r={x:j,y:ee};let he=!1;const fe=u.size>1,W=fe&&Y?z_(Mf(u)):null,le=fe&&k?Hk({dragItems:u,snapGrid:F,x:j,y:ee}):null;for(const[pe,xe]of u){if(!P.has(pe))continue;let Me={x:j-xe.distance.x,y:ee-xe.distance.y};k&&(Me=le?{x:Math.round(Me.x+le.x),y:Math.round(Me.y+le.y)}:Nf(Me,F));let Fe=null;if(fe&&Y&&!xe.extent&&W){const{positionAbsolute:Ve}=xe.internals,nt=Ve.x-W.x+Y[0][0],Dt=Ve.x+xe.measured.width-W.x2+Y[1][0],dt=Ve.y-W.y+Y[0][1],Dn=Ve.y+xe.measured.height-W.y2+Y[1][1];Fe=[[nt,dt],[Dt,Dn]]}const{position:De,positionAbsolute:Le}=HC({nodeId:pe,nextPosition:Me,nodeLookup:P,nodeExtent:Fe||Y,nodeOrigin:I,onError:V});he=he||xe.position.x!==De.x||xe.position.y!==De.y,xe.position=De,xe.internals.positionAbsolute=Le}if(x=x||he,!!he&&(q(u,!0),v&&(n||$||!D&&re))){const[pe,xe]=g1({nodeId:D,dragItems:u,nodeLookup:P});n==null||n(v,u,pe,xe),$==null||$(v,pe,xe),D||re==null||re(v,xe)}}async function L(){if(!f)return;const{transform:j,panBy:ee,autoPanSpeed:P,autoPanOnNodeDrag:Y}=e();if(!Y){c=!1,cancelAnimationFrame(o);return}const[F,k]=qC(d,f,P);(F!==0||k!==0)&&(r.x=(r.x??0)-F/j[2],r.y=(r.y??0)-k/j[2],await ee({x:F,y:k})&&B(r)),o=requestAnimationFrame(L)}function X(j){var fe;const{nodeLookup:ee,multiSelectionActive:P,nodesDraggable:Y,transform:F,snapGrid:k,snapToGrid:I,selectNodesOnDrag:$,onNodeDragStart:re,onSelectionDragStart:V,unselectNodesAndEdges:q}=e();p=!0,(!$||!C)&&!P&&D&&((fe=ee.get(D))!=null&&fe.selected||q()),C&&$&&D&&(s==null||s(D));const he=Od(j.sourceEvent,{transform:F,snapGrid:k,snapToGrid:I,containerBounds:f});if(r=he,u=$k(ee,Y,he,D),u.size>0&&(t||re||!D&&V)){const[W,le]=g1({nodeId:D,dragItems:u,nodeLookup:ee});t==null||t(j.sourceEvent,u,W,le),re==null||re(j.sourceEvent,W,le),D||V==null||V(j.sourceEvent,le)}}const G=SC().clickDistance(R).on("start",j=>{const{domNode:ee,nodeDragThreshold:P,transform:Y,snapGrid:F,snapToGrid:k}=e();f=(ee==null?void 0:ee.getBoundingClientRect())||null,y=!1,x=!1,v=j.sourceEvent,P===0&&X(j),r=Od(j.sourceEvent,{transform:Y,snapGrid:F,snapToGrid:k,containerBounds:f}),d=$i(j.sourceEvent,f)}).on("drag",j=>{const{autoPanOnNodeDrag:ee,transform:P,snapGrid:Y,snapToGrid:F,nodeDragThreshold:k,nodeLookup:I}=e(),$=Od(j.sourceEvent,{transform:P,snapGrid:Y,snapToGrid:F,containerBounds:f});if(v=j.sourceEvent,(j.sourceEvent.type==="touchmove"&&j.sourceEvent.touches.length>1||D&&!I.has(D))&&(y=!0),!y){if(!c&&ee&&p&&(c=!0,L()),!p){const re=$i(j.sourceEvent,f),V=re.x-d.x,q=re.y-d.y;Math.sqrt(V*V+q*q)>k&&X(j)}(r.x!==$.xSnapped||r.y!==$.ySnapped)&&u&&p&&(d=$i(j.sourceEvent,f),B($))}}).on("end",j=>{if(!(!p||y)&&(c=!1,p=!1,cancelAnimationFrame(o),u.size>0)){const{nodeLookup:ee,updateNodePositions:P,onNodeDragStop:Y,onSelectionDragStop:F}=e();if(x&&(P(u,!1),x=!1),i||Y||!D&&F){const[k,I]=g1({nodeId:D,dragItems:u,nodeLookup:ee,dragging:!1});i==null||i(j.sourceEvent,u,k,I),Y==null||Y(j.sourceEvent,k,I),D||F==null||F(j.sourceEvent,I)}}}).filter(j=>{const ee=j.target;return!j.button&&(!M||!RE(ee,`.${M}`,A))&&(!T||RE(ee,T,A))});g.call(G)}function w(){g==null||g.on(".drag",null)}return{update:S,destroy:w}}function qk(s,e,t){const n=[],i={x:s.x-t,y:s.y-t,width:t*2,height:t*2};for(const r of e.values())af(i,Hc(r))>0&&n.push(r);return n}const Wk=250;function Xk(s,e,t,n){var u,c;let i=[],r=1/0;const o=qk(s,t,e+Wk);for(const d of o){const f=[...((u=d.internals.handleBounds)==null?void 0:u.source)??[],...((c=d.internals.handleBounds)==null?void 0:c.target)??[]];for(const p of f){if(n.nodeId===p.nodeId&&n.type===p.type&&n.id===p.id)continue;const{x:g,y}=Kl(d,p,p.position,!0),x=Math.sqrt(Math.pow(g-s.x,2)+Math.pow(y-s.y,2));x>e||(x<r?(i=[{...p,x:g,y}],r=x):x===r&&i.push({...p,x:g,y}))}}if(!i.length)return null;if(i.length>1){const d=n.type==="source"?"target":"source";return i.find(f=>f.type===d)??i[0]}return i[0]}function l3(s,e,t,n,i,r=!1){var d,f,p;const o=n.get(s);if(!o)return null;const u=i==="strict"?(d=o.internals.handleBounds)==null?void 0:d[e]:[...((f=o.internals.handleBounds)==null?void 0:f.source)??[],...((p=o.internals.handleBounds)==null?void 0:p.target)??[]],c=(t?u==null?void 0:u.find(g=>g.id===t):u==null?void 0:u[0])??null;return c&&r?{...c,...Kl(o,c,c.position,!0)}:c}function u3(s,e){return s||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function Yk(s,e){let t=null;return e?t=!0:s&&!e&&(t=!1),t}const c3=()=>!0;function Zk(s,{connectionMode:e,connectionRadius:t,handleId:n,nodeId:i,edgeUpdaterType:r,isTarget:o,domNode:u,nodeLookup:c,lib:d,autoPanOnConnect:f,flowId:p,panBy:g,cancelConnection:y,onConnectStart:x,onConnect:v,onConnectEnd:S,isValidConnection:w=c3,onReconnectEnd:M,updateConnection:T,getTransform:A,getFromHandle:C,autoPanSpeed:D,dragThreshold:R=1,handleDomNode:B}){const L=ZC(s.target);let X=0,G;const{x:j,y:ee}=$i(s),P=u3(r,B),Y=u==null?void 0:u.getBoundingClientRect();let F=!1;if(!Y||!P)return;const k=l3(i,P,n,c,e);if(!k)return;let I=$i(s,Y),$=!1,re=null,V=!1,q=null;function he(){if(!f||!Y)return;const[De,Le]=qC(I,Y,D);g({x:De,y:Le}),X=requestAnimationFrame(he)}const fe={...k,nodeId:i,type:P,position:k.position},W=c.get(i);let pe={inProgress:!0,isValid:null,from:Kl(W,fe,He.Left,!0),fromHandle:fe,fromPosition:fe.position,fromNode:W,to:I,toHandle:null,toPosition:gE[fe.position],toNode:null,pointer:I};function xe(){F=!0,T(pe),x==null||x(s,{nodeId:i,handleId:n,handleType:P})}R===0&&xe();function Me(De){if(!F){const{x:Dn,y:Ni}=$i(De),Os=Dn-j,Ai=Ni-ee;if(!(Os*Os+Ai*Ai>R*R))return;xe()}if(!C()||!fe){Fe(De);return}const Le=A();I=$i(De,Y),G=Xk(Af(I,Le,!1,[1,1]),t,c,fe),$||(he(),$=!0);const Ve=h3(De,{handle:G,connectionMode:e,fromNodeId:i,fromHandleId:n,fromType:o?"target":"source",isValidConnection:w,doc:L,lib:d,flowId:p,nodeLookup:c});q=Ve.handleDomNode,re=Ve.connection,V=Yk(!!G,Ve.isValid);const nt=c.get(i),Dt=nt?Kl(nt,fe,He.Left,!0):pe.from,dt={...pe,from:Dt,isValid:V,to:Ve.toHandle&&V?Fg({x:Ve.toHandle.x,y:Ve.toHandle.y},Le):I,toHandle:Ve.toHandle,toPosition:V&&Ve.toHandle?Ve.toHandle.position:gE[fe.position],toNode:Ve.toHandle?c.get(Ve.toHandle.nodeId):null,pointer:I};T(dt),pe=dt}function Fe(De){if(!("touches"in De&&De.touches.length>0)){if(F){(G||q)&&re&&V&&(v==null||v(re));const{inProgress:Le,...Ve}=pe,nt={...Ve,toPosition:pe.toHandle?pe.toPosition:null};S==null||S(De,nt),r&&(M==null||M(De,nt))}y(),cancelAnimationFrame(X),$=!1,V=!1,re=null,q=null,L.removeEventListener("mousemove",Me),L.removeEventListener("mouseup",Fe),L.removeEventListener("touchmove",Me),L.removeEventListener("touchend",Fe)}}L.addEventListener("mousemove",Me),L.addEventListener("mouseup",Fe),L.addEventListener("touchmove",Me),L.addEventListener("touchend",Fe)}function h3(s,{handle:e,connectionMode:t,fromNodeId:n,fromHandleId:i,fromType:r,doc:o,lib:u,flowId:c,isValidConnection:d=c3,nodeLookup:f}){const p=r==="target",g=e?o.querySelector(`.${u}-flow__handle[data-id="${c}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:y,y:x}=$i(s),v=o.elementFromPoint(y,x),S=v!=null&&v.classList.contains(`${u}-flow__handle`)?v:g,w={handleDomNode:S,isValid:!1,connection:null,toHandle:null};if(S){const M=u3(void 0,S),T=S.getAttribute("data-nodeid"),A=S.getAttribute("data-handleid"),C=S.classList.contains("connectable"),D=S.classList.contains("connectableend");if(!T||!M)return w;const R={source:p?T:n,sourceHandle:p?A:i,target:p?n:T,targetHandle:p?i:A};w.connection=R;const L=C&&D&&(t===Gc.Strict?p&&M==="source"||!p&&M==="target":T!==n||A!==i);w.isValid=L&&d(R),w.toHandle=l3(T,M,A,f,t,!0)}return w}const k_={onPointerDown:Zk,isValid:h3};function Qk({domNode:s,panZoom:e,getTransform:t,getViewScale:n}){const i=Ys(s);function r({translateExtent:u,width:c,height:d,zoomStep:f=1,pannable:p=!0,zoomable:g=!0,inversePan:y=!1}){const x=T=>{if(T.sourceEvent.type!=="wheel"||!e)return;const A=t(),C=T.sourceEvent.ctrlKey&&of()?10:1,D=-T.sourceEvent.deltaY*(T.sourceEvent.deltaMode===1?.05:T.sourceEvent.deltaMode?1:.002)*f,R=A[2]*Math.pow(2,D*C);e.scaleTo(R)};let v=[0,0];const S=T=>{(T.sourceEvent.type==="mousedown"||T.sourceEvent.type==="touchstart")&&(v=[T.sourceEvent.clientX??T.sourceEvent.touches[0].clientX,T.sourceEvent.clientY??T.sourceEvent.touches[0].clientY])},w=T=>{const A=t();if(T.sourceEvent.type!=="mousemove"&&T.sourceEvent.type!=="touchmove"||!e)return;const C=[T.sourceEvent.clientX??T.sourceEvent.touches[0].clientX,T.sourceEvent.clientY??T.sourceEvent.touches[0].clientY],D=[C[0]-v[0],C[1]-v[1]];v=C;const R=n()*Math.max(A[2],Math.log(A[2]))*(y?-1:1),B={x:A[0]-D[0]*R,y:A[1]-D[1]*R},L=[[0,0],[c,d]];e.setViewportConstrained({x:B.x,y:B.y,zoom:A[2]},L,u)},M=VC().on("start",S).on("zoom",p?w:null).on("zoom.wheel",g?x:null);i.call(M,{})}function o(){i.on("zoom",null)}return{update:r,destroy:o,pointer:Ui}}const j0=s=>({x:s.x,y:s.y,zoom:s.k}),y1=({x:s,y:e,zoom:t})=>G0.translate(s,e).scale(t),bc=(s,e)=>s.target.closest(`.${e}`),d3=(s,e)=>e===2&&Array.isArray(s)&&s.includes(2),Kk=s=>((s*=2)<=1?s*s*s:(s-=2)*s*s+2)/2,x1=(s,e=0,t=Kk,n=()=>{})=>{const i=typeof e=="number"&&e>0;return i||n(),i?s.transition().duration(e).ease(t).on("end",n):s},f3=s=>{const e=s.ctrlKey&&of()?10:1;return-s.deltaY*(s.deltaMode===1?.05:s.deltaMode?1:.002)*e};function Jk({zoomPanValues:s,noWheelClassName:e,d3Selection:t,d3Zoom:n,panOnScrollMode:i,panOnScrollSpeed:r,zoomOnPinch:o,onPanZoomStart:u,onPanZoom:c,onPanZoomEnd:d}){return f=>{if(bc(f,e))return f.ctrlKey&&f.preventDefault(),!1;f.preventDefault(),f.stopImmediatePropagation();const p=t.property("__zoom").k||1;if(f.ctrlKey&&o){const S=Ui(f),w=f3(f),M=p*Math.pow(2,w);n.scaleTo(t,M,S,f);return}const g=f.deltaMode===1?20:1;let y=i===jl.Vertical?0:f.deltaX*g,x=i===jl.Horizontal?0:f.deltaY*g;!of()&&f.shiftKey&&i!==jl.Vertical&&(y=f.deltaY*g,x=0),n.translateBy(t,-(y/p)*r,-(x/p)*r,{internal:!0});const v=j0(t.property("__zoom"));clearTimeout(s.panScrollTimeout),s.isPanScrolling?(c==null||c(f,v),s.panScrollTimeout=setTimeout(()=>{d==null||d(f,v),s.isPanScrolling=!1},150)):(s.isPanScrolling=!0,u==null||u(f,v))}}function eG({noWheelClassName:s,preventScrolling:e,d3ZoomHandler:t}){return function(n,i){const r=n.type==="wheel",o=!e&&r&&!n.ctrlKey,u=bc(n,s);if(n.ctrlKey&&r&&u&&n.preventDefault(),o||u)return null;n.preventDefault(),t.call(this,n,i)}}function tG({zoomPanValues:s,onDraggingChange:e,onPanZoomStart:t}){return n=>{var r,o,u;if((r=n.sourceEvent)!=null&&r.internal)return;const i=j0(n.transform);s.mouseButton=((o=n.sourceEvent)==null?void 0:o.button)||0,s.isZoomingOrPanning=!0,s.prevViewport=i,((u=n.sourceEvent)==null?void 0:u.type)==="mousedown"&&e(!0),t&&(t==null||t(n.sourceEvent,i))}}function nG({zoomPanValues:s,panOnDrag:e,onPaneContextMenu:t,onTransformChange:n,onPanZoom:i}){return r=>{var o,u;s.usedRightMouseButton=!!(t&&d3(e,s.mouseButton??0)),(o=r.sourceEvent)!=null&&o.sync||n([r.transform.x,r.transform.y,r.transform.k]),i&&!((u=r.sourceEvent)!=null&&u.internal)&&(i==null||i(r.sourceEvent,j0(r.transform)))}}function sG({zoomPanValues:s,panOnDrag:e,panOnScroll:t,onDraggingChange:n,onPanZoomEnd:i,onPaneContextMenu:r}){return o=>{var u;if(!((u=o.sourceEvent)!=null&&u.internal)&&(s.isZoomingOrPanning=!1,r&&d3(e,s.mouseButton??0)&&!s.usedRightMouseButton&&o.sourceEvent&&r(o.sourceEvent),s.usedRightMouseButton=!1,n(!1),i)){const c=j0(o.transform);s.prevViewport=c,clearTimeout(s.timerId),s.timerId=setTimeout(()=>{i==null||i(o.sourceEvent,c)},t?150:0)}}}function iG({zoomActivationKeyPressed:s,zoomOnScroll:e,zoomOnPinch:t,panOnDrag:n,panOnScroll:i,zoomOnDoubleClick:r,userSelectionActive:o,noWheelClassName:u,noPanClassName:c,lib:d,connectionInProgress:f}){return p=>{var S;const g=s||e,y=t&&p.ctrlKey,x=p.type==="wheel";if(p.button===1&&p.type==="mousedown"&&(bc(p,`${d}-flow__node`)||bc(p,`${d}-flow__edge`)))return!0;if(!n&&!g&&!i&&!r&&!t||o||f&&!x||bc(p,u)&&x||bc(p,c)&&(!x||i&&x&&!s)||!t&&p.ctrlKey&&x)return!1;if(!t&&p.type==="touchstart"&&((S=p.touches)==null?void 0:S.length)>1)return p.preventDefault(),!1;if(!g&&!i&&!y&&x||!n&&(p.type==="mousedown"||p.type==="touchstart")||Array.isArray(n)&&!n.includes(p.button)&&p.type==="mousedown")return!1;const v=Array.isArray(n)&&n.includes(p.button)||!p.button||p.button<=1;return(!p.ctrlKey||x)&&v}}function rG({domNode:s,minZoom:e,maxZoom:t,translateExtent:n,viewport:i,onPanZoom:r,onPanZoomStart:o,onPanZoomEnd:u,onDraggingChange:c}){const d={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},f=s.getBoundingClientRect(),p=VC().scaleExtent([e,t]).translateExtent(n),g=Ys(s).call(p);M({x:i.x,y:i.y,zoom:$c(i.zoom,e,t)},[[0,0],[f.width,f.height]],n);const y=g.on("wheel.zoom"),x=g.on("dblclick.zoom");p.wheelDelta(f3);function v(G,j){return g?new Promise(ee=>{p==null||p.interpolate((j==null?void 0:j.interpolate)==="linear"?Fd:hg).transform(x1(g,j==null?void 0:j.duration,j==null?void 0:j.ease,()=>ee(!0)),G)}):Promise.resolve(!1)}function S({noWheelClassName:G,noPanClassName:j,onPaneContextMenu:ee,userSelectionActive:P,panOnScroll:Y,panOnDrag:F,panOnScrollMode:k,panOnScrollSpeed:I,preventScrolling:$,zoomOnPinch:re,zoomOnScroll:V,zoomOnDoubleClick:q,zoomActivationKeyPressed:he,lib:fe,onTransformChange:W,connectionInProgress:le,paneClickDistance:pe,selectionOnDrag:xe}){P&&!d.isZoomingOrPanning&&w();const Me=Y&&!he&&!P;p.clickDistance(xe?1/0:!Gi(pe)||pe<0?0:pe);const Fe=Me?Jk({zoomPanValues:d,noWheelClassName:G,d3Selection:g,d3Zoom:p,panOnScrollMode:k,panOnScrollSpeed:I,zoomOnPinch:re,onPanZoomStart:o,onPanZoom:r,onPanZoomEnd:u}):eG({noWheelClassName:G,preventScrolling:$,d3ZoomHandler:y});if(g.on("wheel.zoom",Fe,{passive:!1}),!P){const Le=tG({zoomPanValues:d,onDraggingChange:c,onPanZoomStart:o});p.on("start",Le);const Ve=nG({zoomPanValues:d,panOnDrag:F,onPaneContextMenu:!!ee,onPanZoom:r,onTransformChange:W});p.on("zoom",Ve);const nt=sG({zoomPanValues:d,panOnDrag:F,panOnScroll:Y,onPaneContextMenu:ee,onPanZoomEnd:u,onDraggingChange:c});p.on("end",nt)}const De=iG({zoomActivationKeyPressed:he,panOnDrag:F,zoomOnScroll:V,panOnScroll:Y,zoomOnDoubleClick:q,zoomOnPinch:re,userSelectionActive:P,noPanClassName:j,noWheelClassName:G,lib:fe,connectionInProgress:le});p.filter(De),q?g.on("dblclick.zoom",x):g.on("dblclick.zoom",null)}function w(){p.on("zoom",null)}async function M(G,j,ee){const P=y1(G),Y=p==null?void 0:p.constrain()(P,j,ee);return Y&&await v(Y),new Promise(F=>F(Y))}async function T(G,j){const ee=y1(G);return await v(ee,j),new Promise(P=>P(ee))}function A(G){if(g){const j=y1(G),ee=g.property("__zoom");(ee.k!==G.zoom||ee.x!==G.x||ee.y!==G.y)&&(p==null||p.transform(g,j,null,{sync:!0}))}}function C(){const G=g?zC(g.node()):{x:0,y:0,k:1};return{x:G.x,y:G.y,zoom:G.k}}function D(G,j){return g?new Promise(ee=>{p==null||p.interpolate((j==null?void 0:j.interpolate)==="linear"?Fd:hg).scaleTo(x1(g,j==null?void 0:j.duration,j==null?void 0:j.ease,()=>ee(!0)),G)}):Promise.resolve(!1)}function R(G,j){return g?new Promise(ee=>{p==null||p.interpolate((j==null?void 0:j.interpolate)==="linear"?Fd:hg).scaleBy(x1(g,j==null?void 0:j.duration,j==null?void 0:j.ease,()=>ee(!0)),G)}):Promise.resolve(!1)}function B(G){p==null||p.scaleExtent(G)}function L(G){p==null||p.translateExtent(G)}function X(G){const j=!Gi(G)||G<0?0:G;p==null||p.clickDistance(j)}return{update:S,destroy:w,setViewport:T,setViewportConstrained:M,getViewport:C,scaleTo:D,scaleBy:R,setScaleExtent:B,setTranslateExtent:L,syncViewport:A,setClickDistance:X}}var qc;(function(s){s.Line="line",s.Handle="handle"})(qc||(qc={}));function aG({width:s,prevWidth:e,height:t,prevHeight:n,affectsX:i,affectsY:r}){const o=s-e,u=t-n,c=[o>0?1:o<0?-1:0,u>0?1:u<0?-1:0];return o&&i&&(c[0]=c[0]*-1),u&&r&&(c[1]=c[1]*-1),c}function CE(s){const e=s.includes("right")||s.includes("left"),t=s.includes("bottom")||s.includes("top"),n=s.includes("left"),i=s.includes("top");return{isHorizontal:e,isVertical:t,affectsX:n,affectsY:i}}function fo(s,e){return Math.max(0,e-s)}function po(s,e){return Math.max(0,s-e)}function bm(s,e,t){return Math.max(0,e-s,s-t)}function DE(s,e){return s?!e:e}function oG(s,e,t,n,i,r,o,u){let{affectsX:c,affectsY:d}=e;const{isHorizontal:f,isVertical:p}=e,g=f&&p,{xSnapped:y,ySnapped:x}=t,{minWidth:v,maxWidth:S,minHeight:w,maxHeight:M}=n,{x:T,y:A,width:C,height:D,aspectRatio:R}=s;let B=Math.floor(f?y-s.pointerX:0),L=Math.floor(p?x-s.pointerY:0);const X=C+(c?-B:B),G=D+(d?-L:L),j=-r[0]*C,ee=-r[1]*D;let P=bm(X,v,S),Y=bm(G,w,M);if(o){let I=0,$=0;c&&B<0?I=fo(T+B+j,o[0][0]):!c&&B>0&&(I=po(T+X+j,o[1][0])),d&&L<0?$=fo(A+L+ee,o[0][1]):!d&&L>0&&($=po(A+G+ee,o[1][1])),P=Math.max(P,I),Y=Math.max(Y,$)}if(u){let I=0,$=0;c&&B>0?I=po(T+B,u[0][0]):!c&&B<0&&(I=fo(T+X,u[1][0])),d&&L>0?$=po(A+L,u[0][1]):!d&&L<0&&($=fo(A+G,u[1][1])),P=Math.max(P,I),Y=Math.max(Y,$)}if(i){if(f){const I=bm(X/R,w,M)*R;if(P=Math.max(P,I),o){let $=0;!c&&!d||c&&!d&&g?$=po(A+ee+X/R,o[1][1])*R:$=fo(A+ee+(c?B:-B)/R,o[0][1])*R,P=Math.max(P,$)}if(u){let $=0;!c&&!d||c&&!d&&g?$=fo(A+X/R,u[1][1])*R:$=po(A+(c?B:-B)/R,u[0][1])*R,P=Math.max(P,$)}}if(p){const I=bm(G*R,v,S)/R;if(Y=Math.max(Y,I),o){let $=0;!c&&!d||d&&!c&&g?$=po(T+G*R+j,o[1][0])/R:$=fo(T+(d?L:-L)*R+j,o[0][0])/R,Y=Math.max(Y,$)}if(u){let $=0;!c&&!d||d&&!c&&g?$=fo(T+G*R,u[1][0])/R:$=po(T+(d?L:-L)*R,u[0][0])/R,Y=Math.max(Y,$)}}}L=L+(L<0?Y:-Y),B=B+(B<0?P:-P),i&&(g?X>G*R?L=(DE(c,d)?-B:B)/R:B=(DE(c,d)?-L:L)*R:f?(L=B/R,d=c):(B=L*R,c=d));const F=c?T+B:T,k=d?A+L:A;return{width:C+(c?-B:B),height:D+(d?-L:L),x:r[0]*B*(c?-1:1)+F,y:r[1]*L*(d?-1:1)+k}}const p3={width:0,height:0,x:0,y:0},lG={...p3,pointerX:0,pointerY:0,aspectRatio:1};function uG(s){return[[0,0],[s.measured.width,s.measured.height]]}function cG(s,e,t){const n=e.position.x+s.position.x,i=e.position.y+s.position.y,r=s.measured.width??0,o=s.measured.height??0,u=t[0]*r,c=t[1]*o;return[[n-u,i-c],[n+r-u,i+o-c]]}function hG({domNode:s,nodeId:e,getStoreItems:t,onChange:n,onEnd:i}){const r=Ys(s);let o={controlDirection:CE("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function u({controlPosition:d,boundaries:f,keepAspectRatio:p,resizeDirection:g,onResizeStart:y,onResize:x,onResizeEnd:v,shouldResize:S}){let w={...p3},M={...lG};o={boundaries:f,resizeDirection:g,keepAspectRatio:p,controlDirection:CE(d)};let T,A=null,C=[],D,R,B,L=!1;const X=SC().on("start",G=>{const{nodeLookup:j,transform:ee,snapGrid:P,snapToGrid:Y,nodeOrigin:F,paneDomNode:k}=t();if(T=j.get(e),!T)return;A=(k==null?void 0:k.getBoundingClientRect())??null;const{xSnapped:I,ySnapped:$}=Od(G.sourceEvent,{transform:ee,snapGrid:P,snapToGrid:Y,containerBounds:A});w={width:T.measured.width??0,height:T.measured.height??0,x:T.position.x??0,y:T.position.y??0},M={...w,pointerX:I,pointerY:$,aspectRatio:w.width/w.height},D=void 0,T.parentId&&(T.extent==="parent"||T.expandParent)&&(D=j.get(T.parentId),R=D&&T.extent==="parent"?uG(D):void 0),C=[],B=void 0;for(const[re,V]of j)if(V.parentId===e&&(C.push({id:re,position:{...V.position},extent:V.extent}),V.extent==="parent"||V.expandParent)){const q=cG(V,T,V.origin??F);B?B=[[Math.min(q[0][0],B[0][0]),Math.min(q[0][1],B[0][1])],[Math.max(q[1][0],B[1][0]),Math.max(q[1][1],B[1][1])]]:B=q}y==null||y(G,{...w})}).on("drag",G=>{const{transform:j,snapGrid:ee,snapToGrid:P,nodeOrigin:Y}=t(),F=Od(G.sourceEvent,{transform:j,snapGrid:ee,snapToGrid:P,containerBounds:A}),k=[];if(!T)return;const{x:I,y:$,width:re,height:V}=w,q={},he=T.origin??Y,{width:fe,height:W,x:le,y:pe}=oG(M,o.controlDirection,F,o.boundaries,o.keepAspectRatio,he,R,B),xe=fe!==re,Me=W!==V,Fe=le!==I&&xe,De=pe!==$&&Me;if(!Fe&&!De&&!xe&&!Me)return;if((Fe||De||he[0]===1||he[1]===1)&&(q.x=Fe?le:w.x,q.y=De?pe:w.y,w.x=q.x,w.y=q.y,C.length>0)){const Dt=le-I,dt=pe-$;for(const Dn of C)Dn.position={x:Dn.position.x-Dt+he[0]*(fe-re),y:Dn.position.y-dt+he[1]*(W-V)},k.push(Dn)}if((xe||Me)&&(q.width=xe&&(!o.resizeDirection||o.resizeDirection==="horizontal")?fe:w.width,q.height=Me&&(!o.resizeDirection||o.resizeDirection==="vertical")?W:w.height,w.width=q.width,w.height=q.height),D&&T.expandParent){const Dt=he[0]*(q.width??0);q.x&&q.x<Dt&&(w.x=Dt,M.x=M.x-(q.x-Dt));const dt=he[1]*(q.height??0);q.y&&q.y<dt&&(w.y=dt,M.y=M.y-(q.y-dt))}const Le=aG({width:w.width,prevWidth:re,height:w.height,prevHeight:V,affectsX:o.controlDirection.affectsX,affectsY:o.controlDirection.affectsY}),Ve={...w,direction:Le};(S==null?void 0:S(G,Ve))!==!1&&(L=!0,x==null||x(G,Ve),n(q,k))}).on("end",G=>{L&&(v==null||v(G,{...w}),i==null||i({...w}),L=!1)});r.call(X)}function c(){r.on(".drag",null)}return{update:u,destroy:c}}var b1={exports:{}},_1={},v1={exports:{}},T1={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BE;function dG(){if(BE)return T1;BE=1;var s=vf();function e(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var t=typeof Object.is=="function"?Object.is:e,n=s.useState,i=s.useEffect,r=s.useLayoutEffect,o=s.useDebugValue;function u(p,g){var y=g(),x=n({inst:{value:y,getSnapshot:g}}),v=x[0].inst,S=x[1];return r(function(){v.value=y,v.getSnapshot=g,c(v)&&S({inst:v})},[p,y,g]),i(function(){return c(v)&&S({inst:v}),p(function(){c(v)&&S({inst:v})})},[p]),o(y),y}function c(p){var g=p.getSnapshot;p=p.value;try{var y=g();return!t(p,y)}catch{return!0}}function d(p,g){return g()}var f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:u;return T1.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:f,T1}var LE;function fG(){return LE||(LE=1,v1.exports=dG()),v1.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FE;function pG(){if(FE)return _1;FE=1;var s=vf(),e=fG();function t(d,f){return d===f&&(d!==0||1/d===1/f)||d!==d&&f!==f}var n=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,r=s.useRef,o=s.useEffect,u=s.useMemo,c=s.useDebugValue;return _1.useSyncExternalStoreWithSelector=function(d,f,p,g,y){var x=r(null);if(x.current===null){var v={hasValue:!1,value:null};x.current=v}else v=x.current;x=u(function(){function w(D){if(!M){if(M=!0,T=D,D=g(D),y!==void 0&&v.hasValue){var R=v.value;if(y(R,D))return A=R}return A=D}if(R=A,n(T,D))return R;var B=g(D);return y!==void 0&&y(R,B)?(T=D,R):(T=D,A=B)}var M=!1,T,A,C=p===void 0?null:p;return[function(){return w(f())},C===null?void 0:function(){return w(C())}]},[f,p,g,y]);var S=i(d,x[0],x[1]);return o(function(){v.hasValue=!0,v.value=S},[S]),c(S),S},_1}var OE;function mG(){return OE||(OE=1,b1.exports=pG()),b1.exports}var gG=mG();const yG=z0(gG),xG={},UE=s=>{let e;const t=new Set,n=(f,p)=>{const g=typeof f=="function"?f(e):f;if(!Object.is(g,e)){const y=e;e=p??(typeof g!="object"||g===null)?g:Object.assign({},e,g),t.forEach(x=>x(e,y))}},i=()=>e,c={setState:n,getState:i,getInitialState:()=>d,subscribe:f=>(t.add(f),()=>t.delete(f)),destroy:()=>{(xG?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},d=e=s(n,i,c);return c},bG=s=>s?UE(s):UE,{useDebugValue:_G}=sh,{useSyncExternalStoreWithSelector:vG}=yG,TG=s=>s;function m3(s,e=TG,t){const n=vG(s.subscribe,s.getState,s.getServerState||s.getInitialState,e,t);return _G(n),n}const zE=(s,e)=>{const t=bG(s),n=(i,r=e)=>m3(t,i,r);return Object.assign(n,t),n},SG=(s,e)=>s?zE(s,e):zE;function jt(s,e){if(Object.is(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;if(s instanceof Map&&e instanceof Map){if(s.size!==e.size)return!1;for(const[n,i]of s)if(!Object.is(i,e.get(n)))return!1;return!0}if(s instanceof Set&&e instanceof Set){if(s.size!==e.size)return!1;for(const n of s)if(!e.has(n))return!1;return!0}const t=Object.keys(s);if(t.length!==Object.keys(e).length)return!1;for(const n of t)if(!Object.prototype.hasOwnProperty.call(e,n)||!Object.is(s[n],e[n]))return!1;return!0}lC();const q0=se.createContext(null),wG=q0.Provider,g3=ji.error001();function ht(s,e){const t=se.useContext(q0);if(t===null)throw new Error(g3);return m3(t,s,e)}function tn(){const s=se.useContext(q0);if(s===null)throw new Error(g3);return se.useMemo(()=>({getState:s.getState,setState:s.setState,subscribe:s.subscribe}),[s])}const VE={display:"none"},MG={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},y3="react-flow__node-desc",x3="react-flow__edge-desc",NG="react-flow__aria-live",AG=s=>s.ariaLiveMessage,EG=s=>s.ariaLabelConfig;function RG({rfId:s}){const e=ht(AG);return U.jsx("div",{id:`${NG}-${s}`,"aria-live":"assertive","aria-atomic":"true",style:MG,children:e})}function CG({rfId:s,disableKeyboardA11y:e}){const t=ht(EG);return U.jsxs(U.Fragment,{children:[U.jsx("div",{id:`${y3}-${s}`,style:VE,children:e?t["node.a11yDescription.default"]:t["node.a11yDescription.keyboardDisabled"]}),U.jsx("div",{id:`${x3}-${s}`,style:VE,children:t["edge.a11yDescription.default"]}),!e&&U.jsx(RG,{rfId:s})]})}const Wc=se.forwardRef(({position:s="top-left",children:e,className:t,style:n,...i},r)=>{const o=`${s}`.split("-");return U.jsx("div",{className:wn(["react-flow__panel",t,...o]),style:n,ref:r,...i,children:e})});Wc.displayName="Panel";function DG({proOptions:s,position:e="bottom-right"}){return s!=null&&s.hideAttribution?null:U.jsx(Wc,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:U.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const BG=s=>{const e=[],t=[];for(const[,n]of s.nodeLookup)n.selected&&e.push(n.internals.userNode);for(const[,n]of s.edgeLookup)n.selected&&t.push(n);return{selectedNodes:e,selectedEdges:t}},_m=s=>s.id;function LG(s,e){return jt(s.selectedNodes.map(_m),e.selectedNodes.map(_m))&&jt(s.selectedEdges.map(_m),e.selectedEdges.map(_m))}function FG({onSelectionChange:s}){const e=tn(),{selectedNodes:t,selectedEdges:n}=ht(BG,LG);return se.useEffect(()=>{const i={nodes:t,edges:n};s==null||s(i),e.getState().onSelectionChangeHandlers.forEach(r=>r(i))},[t,n,s]),null}const OG=s=>!!s.onSelectionChangeHandlers;function UG({onSelectionChange:s}){const e=ht(OG);return s||e?U.jsx(FG,{onSelectionChange:s}):null}const b3=[0,0],zG={x:0,y:0,zoom:1},VG=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],PE=[...VG,"rfId"],PG=s=>({setNodes:s.setNodes,setEdges:s.setEdges,setMinZoom:s.setMinZoom,setMaxZoom:s.setMaxZoom,setTranslateExtent:s.setTranslateExtent,setNodeExtent:s.setNodeExtent,reset:s.reset,setDefaultNodesAndEdges:s.setDefaultNodesAndEdges}),IE={translateExtent:sf,nodeOrigin:b3,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function IG(s){const{setNodes:e,setEdges:t,setMinZoom:n,setMaxZoom:i,setTranslateExtent:r,setNodeExtent:o,reset:u,setDefaultNodesAndEdges:c}=ht(PG,jt),d=tn();se.useEffect(()=>(c(s.defaultNodes,s.defaultEdges),()=>{f.current=IE,u()}),[]);const f=se.useRef(IE);return se.useEffect(()=>{for(const p of PE){const g=s[p],y=f.current[p];g!==y&&(typeof s[p]>"u"||(p==="nodes"?e(g):p==="edges"?t(g):p==="minZoom"?n(g):p==="maxZoom"?i(g):p==="translateExtent"?r(g):p==="nodeExtent"?o(g):p==="ariaLabelConfig"?d.setState({ariaLabelConfig:wk(g)}):p==="fitView"?d.setState({fitViewQueued:g}):p==="fitViewOptions"?d.setState({fitViewOptions:g}):d.setState({[p]:g})))}f.current=s},PE.map(p=>s[p])),null}function kE(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function kG(s){var n;const[e,t]=se.useState(s==="system"?null:s);return se.useEffect(()=>{if(s!=="system"){t(s);return}const i=kE(),r=()=>t(i!=null&&i.matches?"dark":"light");return r(),i==null||i.addEventListener("change",r),()=>{i==null||i.removeEventListener("change",r)}},[s]),e!==null?e:(n=kE())!=null&&n.matches?"dark":"light"}const GE=typeof document<"u"?document:null;function lf(s=null,e={target:GE,actInsideInputWithModifier:!0}){const[t,n]=se.useState(!1),i=se.useRef(!1),r=se.useRef(new Set([])),[o,u]=se.useMemo(()=>{if(s!==null){const d=(Array.isArray(s)?s:[s]).filter(p=>typeof p=="string").map(p=>p.replace("+",`
`).replace(`

`,`
+`).split(`
`)),f=d.reduce((p,g)=>p.concat(...g),[]);return[d,f]}return[[],[]]},[s]);return se.useEffect(()=>{const c=(e==null?void 0:e.target)??GE,d=(e==null?void 0:e.actInsideInputWithModifier)??!0;if(s!==null){const f=y=>{var S,w;if(i.current=y.ctrlKey||y.metaKey||y.shiftKey||y.altKey,(!i.current||i.current&&!d)&&QC(y))return!1;const v=HE(y.code,u);if(r.current.add(y[v]),$E(o,r.current,!1)){const M=((w=(S=y.composedPath)==null?void 0:S.call(y))==null?void 0:w[0])||y.target,T=(M==null?void 0:M.nodeName)==="BUTTON"||(M==null?void 0:M.nodeName)==="A";e.preventDefault!==!1&&(i.current||!T)&&y.preventDefault(),n(!0)}},p=y=>{const x=HE(y.code,u);$E(o,r.current,!0)?(n(!1),r.current.clear()):r.current.delete(y[x]),y.key==="Meta"&&r.current.clear(),i.current=!1},g=()=>{r.current.clear(),n(!1)};return c==null||c.addEventListener("keydown",f),c==null||c.addEventListener("keyup",p),window.addEventListener("blur",g),window.addEventListener("contextmenu",g),()=>{c==null||c.removeEventListener("keydown",f),c==null||c.removeEventListener("keyup",p),window.removeEventListener("blur",g),window.removeEventListener("contextmenu",g)}}},[s,n]),t}function $E(s,e,t){return s.filter(n=>t||n.length===e.size).some(n=>n.every(i=>e.has(i)))}function HE(s,e){return e.includes(s)?"code":"key"}const GG=()=>{const s=tn();return se.useMemo(()=>({zoomIn:e=>{const{panZoom:t}=s.getState();return t?t.scaleBy(1.2,{duration:e==null?void 0:e.duration}):Promise.resolve(!1)},zoomOut:e=>{const{panZoom:t}=s.getState();return t?t.scaleBy(1/1.2,{duration:e==null?void 0:e.duration}):Promise.resolve(!1)},zoomTo:(e,t)=>{const{panZoom:n}=s.getState();return n?n.scaleTo(e,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},getZoom:()=>s.getState().transform[2],setViewport:async(e,t)=>{const{transform:[n,i,r],panZoom:o}=s.getState();return o?(await o.setViewport({x:e.x??n,y:e.y??i,zoom:e.zoom??r},t),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[e,t,n]=s.getState().transform;return{x:e,y:t,zoom:n}},setCenter:async(e,t,n)=>s.getState().setCenter(e,t,n),fitBounds:async(e,t)=>{const{width:n,height:i,minZoom:r,maxZoom:o,panZoom:u}=s.getState(),c=Uv(e,n,i,r,o,(t==null?void 0:t.padding)??.1);return u?(await u.setViewport(c,{duration:t==null?void 0:t.duration,ease:t==null?void 0:t.ease,interpolate:t==null?void 0:t.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(e,t={})=>{const{transform:n,snapGrid:i,snapToGrid:r,domNode:o}=s.getState();if(!o)return e;const{x:u,y:c}=o.getBoundingClientRect(),d={x:e.x-u,y:e.y-c},f=t.snapGrid??i,p=t.snapToGrid??r;return Af(d,n,p,f)},flowToScreenPosition:e=>{const{transform:t,domNode:n}=s.getState();if(!n)return e;const{x:i,y:r}=n.getBoundingClientRect(),o=Fg(e,t);return{x:o.x+i,y:o.y+r}}}),[])};function _3(s,e){const t=[],n=new Map,i=[];for(const r of s)if(r.type==="add"){i.push(r);continue}else if(r.type==="remove"||r.type==="replace")n.set(r.id,[r]);else{const o=n.get(r.id);o?o.push(r):n.set(r.id,[r])}for(const r of e){const o=n.get(r.id);if(!o){t.push(r);continue}if(o[0].type==="remove")continue;if(o[0].type==="replace"){t.push({...o[0].item});continue}const u={...r};for(const c of o)$G(c,u);t.push(u)}return i.length&&i.forEach(r=>{r.index!==void 0?t.splice(r.index,0,{...r.item}):t.push({...r.item})}),t}function $G(s,e){switch(s.type){case"select":{e.selected=s.selected;break}case"position":{typeof s.position<"u"&&(e.position=s.position),typeof s.dragging<"u"&&(e.dragging=s.dragging);break}case"dimensions":{typeof s.dimensions<"u"&&(e.measured={...s.dimensions},s.setAttributes&&((s.setAttributes===!0||s.setAttributes==="width")&&(e.width=s.dimensions.width),(s.setAttributes===!0||s.setAttributes==="height")&&(e.height=s.dimensions.height))),typeof s.resizing=="boolean"&&(e.resizing=s.resizing);break}}}function v3(s,e){return _3(s,e)}function T3(s,e){return _3(s,e)}function Dl(s,e){return{id:s,type:"select",selected:e}}function _c(s,e=new Set,t=!1){const n=[];for(const[i,r]of s){const o=e.has(i);!(r.selected===void 0&&!o)&&r.selected!==o&&(t&&(r.selected=o),n.push(Dl(r.id,o)))}return n}function jE({items:s=[],lookup:e}){var i;const t=[],n=new Map(s.map(r=>[r.id,r]));for(const[r,o]of s.entries()){const u=e.get(o.id),c=((i=u==null?void 0:u.internals)==null?void 0:i.userNode)??u;c!==void 0&&c!==o&&t.push({id:o.id,item:o,type:"replace"}),c===void 0&&t.push({item:o,type:"add",index:r})}for(const[r]of e)n.get(r)===void 0&&t.push({id:r,type:"remove"});return t}function qE(s){return{id:s.id,type:"remove"}}const WE=s=>pk(s),HG=s=>$C(s);function S3(s){return se.forwardRef(s)}const jG=typeof window<"u"?se.useLayoutEffect:se.useEffect;function XE(s){const[e,t]=se.useState(BigInt(0)),[n]=se.useState(()=>qG(()=>t(i=>i+BigInt(1))));return jG(()=>{const i=n.get();i.length&&(s(i),n.reset())},[e]),n}function qG(s){let e=[];return{get:()=>e,reset:()=>{e=[]},push:t=>{e.push(t),s()}}}const w3=se.createContext(null);function WG({children:s}){const e=tn(),t=se.useCallback(u=>{const{nodes:c=[],setNodes:d,hasDefaultNodes:f,onNodesChange:p,nodeLookup:g,fitViewQueued:y,onNodesChangeMiddlewareMap:x}=e.getState();let v=c;for(const w of u)v=typeof w=="function"?w(v):w;let S=jE({items:v,lookup:g});for(const w of x.values())S=w(S);f&&d(v),S.length>0?p==null||p(S):y&&window.requestAnimationFrame(()=>{const{fitViewQueued:w,nodes:M,setNodes:T}=e.getState();w&&T(M)})},[]),n=XE(t),i=se.useCallback(u=>{const{edges:c=[],setEdges:d,hasDefaultEdges:f,onEdgesChange:p,edgeLookup:g}=e.getState();let y=c;for(const x of u)y=typeof x=="function"?x(y):x;f?d(y):p&&p(jE({items:y,lookup:g}))},[]),r=XE(i),o=se.useMemo(()=>({nodeQueue:n,edgeQueue:r}),[]);return U.jsx(w3.Provider,{value:o,children:s})}function XG(){const s=se.useContext(w3);if(!s)throw new Error("useBatchContext must be used within a BatchProvider");return s}const YG=s=>!!s.panZoom;function Ef(){const s=GG(),e=tn(),t=XG(),n=ht(YG),i=se.useMemo(()=>{const r=p=>e.getState().nodeLookup.get(p),o=p=>{t.nodeQueue.push(p)},u=p=>{t.edgeQueue.push(p)},c=p=>{var w,M;const{nodeLookup:g,nodeOrigin:y}=e.getState(),x=WE(p)?p:g.get(p.id),v=x.parentId?YC(x.position,x.measured,x.parentId,g,y):x.position,S={...x,position:v,width:((w=x.measured)==null?void 0:w.width)??x.width,height:((M=x.measured)==null?void 0:M.height)??x.height};return Hc(S)},d=(p,g,y={replace:!1})=>{o(x=>x.map(v=>{if(v.id===p){const S=typeof g=="function"?g(v):g;return y.replace&&WE(S)?S:{...v,...S}}return v}))},f=(p,g,y={replace:!1})=>{u(x=>x.map(v=>{if(v.id===p){const S=typeof g=="function"?g(v):g;return y.replace&&HG(S)?S:{...v,...S}}return v}))};return{getNodes:()=>e.getState().nodes.map(p=>({...p})),getNode:p=>{var g;return(g=r(p))==null?void 0:g.internals.userNode},getInternalNode:r,getEdges:()=>{const{edges:p=[]}=e.getState();return p.map(g=>({...g}))},getEdge:p=>e.getState().edgeLookup.get(p),setNodes:o,setEdges:u,addNodes:p=>{const g=Array.isArray(p)?p:[p];t.nodeQueue.push(y=>[...y,...g])},addEdges:p=>{const g=Array.isArray(p)?p:[p];t.edgeQueue.push(y=>[...y,...g])},toObject:()=>{const{nodes:p=[],edges:g=[],transform:y}=e.getState(),[x,v,S]=y;return{nodes:p.map(w=>({...w})),edges:g.map(w=>({...w})),viewport:{x,y:v,zoom:S}}},deleteElements:async({nodes:p=[],edges:g=[]})=>{const{nodes:y,edges:x,onNodesDelete:v,onEdgesDelete:S,triggerNodeChanges:w,triggerEdgeChanges:M,onDelete:T,onBeforeDelete:A}=e.getState(),{nodes:C,edges:D}=await bk({nodesToRemove:p,edgesToRemove:g,nodes:y,edges:x,onBeforeDelete:A}),R=D.length>0,B=C.length>0;if(R){const L=D.map(qE);S==null||S(D),M(L)}if(B){const L=C.map(qE);v==null||v(C),w(L)}return(B||R)&&(T==null||T({nodes:C,edges:D})),{deletedNodes:C,deletedEdges:D}},getIntersectingNodes:(p,g=!0,y)=>{const x=bE(p),v=x?p:c(p),S=y!==void 0;return v?(y||e.getState().nodes).filter(w=>{const M=e.getState().nodeLookup.get(w.id);if(M&&!x&&(w.id===p.id||!M.internals.positionAbsolute))return!1;const T=Hc(S?w:M),A=af(T,v);return g&&A>0||A>=T.width*T.height||A>=v.width*v.height}):[]},isNodeIntersecting:(p,g,y=!0)=>{const v=bE(p)?p:c(p);if(!v)return!1;const S=af(v,g);return y&&S>0||S>=g.width*g.height||S>=v.width*v.height},updateNode:d,updateNodeData:(p,g,y={replace:!1})=>{d(p,x=>{const v=typeof g=="function"?g(x):g;return y.replace?{...x,data:v}:{...x,data:{...x.data,...v}}},y)},updateEdge:f,updateEdgeData:(p,g,y={replace:!1})=>{f(p,x=>{const v=typeof g=="function"?g(x):g;return y.replace?{...x,data:v}:{...x,data:{...x.data,...v}}},y)},getNodesBounds:p=>{const{nodeLookup:g,nodeOrigin:y}=e.getState();return mk(p,{nodeLookup:g,nodeOrigin:y})},getHandleConnections:({type:p,id:g,nodeId:y})=>{var x;return Array.from(((x=e.getState().connectionLookup.get(`${y}-${p}${g?`-${g}`:""}`))==null?void 0:x.values())??[])},getNodeConnections:({type:p,handleId:g,nodeId:y})=>{var x;return Array.from(((x=e.getState().connectionLookup.get(`${y}${p?g?`-${p}-${g}`:`-${p}`:""}`))==null?void 0:x.values())??[])},fitView:async p=>{const g=e.getState().fitViewResolver??Sk();return e.setState({fitViewQueued:!0,fitViewOptions:p,fitViewResolver:g}),t.nodeQueue.push(y=>[...y]),g.promise}}},[]);return se.useMemo(()=>({...i,...s,viewportInitialized:n}),[n])}const YE=s=>s.selected,ZG=typeof window<"u"?window:void 0;function QG({deleteKeyCode:s,multiSelectionKeyCode:e}){const t=tn(),{deleteElements:n}=Ef(),i=lf(s,{actInsideInputWithModifier:!1}),r=lf(e,{target:ZG});se.useEffect(()=>{if(i){const{edges:o,nodes:u}=t.getState();n({nodes:u.filter(YE),edges:o.filter(YE)}),t.setState({nodesSelectionActive:!1})}},[i]),se.useEffect(()=>{t.setState({multiSelectionActive:r})},[r])}function KG(s){const e=tn();se.useEffect(()=>{const t=()=>{var i,r,o,u;if(!s.current||!(((r=(i=s.current).checkVisibility)==null?void 0:r.call(i))??!0))return!1;const n=zv(s.current);(n.height===0||n.width===0)&&((u=(o=e.getState()).onError)==null||u.call(o,"004",ji.error004())),e.setState({width:n.width||500,height:n.height||500})};if(s.current){t(),window.addEventListener("resize",t);const n=new ResizeObserver(()=>t());return n.observe(s.current),()=>{window.removeEventListener("resize",t),n&&s.current&&n.unobserve(s.current)}}},[])}const W0={position:"absolute",width:"100%",height:"100%",top:0,left:0},JG=s=>({userSelectionActive:s.userSelectionActive,lib:s.lib,connectionInProgress:s.connection.inProgress});function e$({onPaneContextMenu:s,zoomOnScroll:e=!0,zoomOnPinch:t=!0,panOnScroll:n=!1,panOnScrollSpeed:i=.5,panOnScrollMode:r=jl.Free,zoomOnDoubleClick:o=!0,panOnDrag:u=!0,defaultViewport:c,translateExtent:d,minZoom:f,maxZoom:p,zoomActivationKeyCode:g,preventScrolling:y=!0,children:x,noWheelClassName:v,noPanClassName:S,onViewportChange:w,isControlledViewport:M,paneClickDistance:T,selectionOnDrag:A}){const C=tn(),D=se.useRef(null),{userSelectionActive:R,lib:B,connectionInProgress:L}=ht(JG,jt),X=lf(g),G=se.useRef();KG(D);const j=se.useCallback(ee=>{w==null||w({x:ee[0],y:ee[1],zoom:ee[2]}),M||C.setState({transform:ee})},[w,M]);return se.useEffect(()=>{if(D.current){G.current=rG({domNode:D.current,minZoom:f,maxZoom:p,translateExtent:d,viewport:c,onDraggingChange:F=>C.setState({paneDragging:F}),onPanZoomStart:(F,k)=>{const{onViewportChangeStart:I,onMoveStart:$}=C.getState();$==null||$(F,k),I==null||I(k)},onPanZoom:(F,k)=>{const{onViewportChange:I,onMove:$}=C.getState();$==null||$(F,k),I==null||I(k)},onPanZoomEnd:(F,k)=>{const{onViewportChangeEnd:I,onMoveEnd:$}=C.getState();$==null||$(F,k),I==null||I(k)}});const{x:ee,y:P,zoom:Y}=G.current.getViewport();return C.setState({panZoom:G.current,transform:[ee,P,Y],domNode:D.current.closest(".react-flow")}),()=>{var F;(F=G.current)==null||F.destroy()}}},[]),se.useEffect(()=>{var ee;(ee=G.current)==null||ee.update({onPaneContextMenu:s,zoomOnScroll:e,zoomOnPinch:t,panOnScroll:n,panOnScrollSpeed:i,panOnScrollMode:r,zoomOnDoubleClick:o,panOnDrag:u,zoomActivationKeyPressed:X,preventScrolling:y,noPanClassName:S,userSelectionActive:R,noWheelClassName:v,lib:B,onTransformChange:j,connectionInProgress:L,selectionOnDrag:A,paneClickDistance:T})},[s,e,t,n,i,r,o,u,X,y,S,R,v,B,j,L,A,T]),U.jsx("div",{className:"react-flow__renderer",ref:D,style:W0,children:x})}const t$=s=>({userSelectionActive:s.userSelectionActive,userSelectionRect:s.userSelectionRect});function n$(){const{userSelectionActive:s,userSelectionRect:e}=ht(t$,jt);return s&&e?U.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}const S1=(s,e)=>t=>{t.target===e.current&&(s==null||s(t))},s$=s=>({userSelectionActive:s.userSelectionActive,elementsSelectable:s.elementsSelectable,connectionInProgress:s.connection.inProgress,dragging:s.paneDragging});function i$({isSelecting:s,selectionKeyPressed:e,selectionMode:t=rf.Full,panOnDrag:n,paneClickDistance:i,selectionOnDrag:r,onSelectionStart:o,onSelectionEnd:u,onPaneClick:c,onPaneContextMenu:d,onPaneScroll:f,onPaneMouseEnter:p,onPaneMouseMove:g,onPaneMouseLeave:y,children:x}){const v=tn(),{userSelectionActive:S,elementsSelectable:w,dragging:M,connectionInProgress:T}=ht(s$,jt),A=w&&(s||S),C=se.useRef(null),D=se.useRef(),R=se.useRef(new Set),B=se.useRef(new Set),L=se.useRef(!1),X=I=>{if(L.current||T){L.current=!1;return}c==null||c(I),v.getState().resetSelectedElements(),v.setState({nodesSelectionActive:!1})},G=I=>{if(Array.isArray(n)&&(n!=null&&n.includes(2))){I.preventDefault();return}d==null||d(I)},j=f?I=>f(I):void 0,ee=I=>{L.current&&(I.stopPropagation(),L.current=!1)},P=I=>{var W,le;const{domNode:$}=v.getState();if(D.current=$==null?void 0:$.getBoundingClientRect(),!D.current)return;const re=I.target===C.current;if(!re&&!!I.target.closest(".nokey")||!s||!(r&&re||e)||I.button!==0||!I.isPrimary)return;(le=(W=I.target)==null?void 0:W.setPointerCapture)==null||le.call(W,I.pointerId),L.current=!1;const{x:he,y:fe}=$i(I.nativeEvent,D.current);v.setState({userSelectionRect:{width:0,height:0,startX:he,startY:fe,x:he,y:fe}}),re||(I.stopPropagation(),I.preventDefault())},Y=I=>{const{userSelectionRect:$,transform:re,nodeLookup:V,edgeLookup:q,connectionLookup:he,triggerNodeChanges:fe,triggerEdgeChanges:W,defaultEdgeOptions:le,resetSelectedElements:pe}=v.getState();if(!D.current||!$)return;const{x:xe,y:Me}=$i(I.nativeEvent,D.current),{startX:Fe,startY:De}=$;if(!L.current){const dt=e?0:i;if(Math.hypot(xe-Fe,Me-De)<=dt)return;pe(),o==null||o(I)}L.current=!0;const Le={startX:Fe,startY:De,x:xe<Fe?xe:Fe,y:Me<De?Me:De,width:Math.abs(xe-Fe),height:Math.abs(Me-De)},Ve=R.current,nt=B.current;R.current=new Set(Ov(V,Le,re,t===rf.Partial,!0).map(dt=>dt.id)),B.current=new Set;const Dt=(le==null?void 0:le.selectable)??!0;for(const dt of R.current){const Dn=he.get(dt);if(Dn)for(const{edgeId:Ni}of Dn.values()){const Os=q.get(Ni);Os&&(Os.selectable??Dt)&&B.current.add(Ni)}}if(!_E(Ve,R.current)){const dt=_c(V,R.current,!0);fe(dt)}if(!_E(nt,B.current)){const dt=_c(q,B.current);W(dt)}v.setState({userSelectionRect:Le,userSelectionActive:!0,nodesSelectionActive:!1})},F=I=>{var $,re;I.button===0&&((re=($=I.target)==null?void 0:$.releasePointerCapture)==null||re.call($,I.pointerId),!S&&I.target===C.current&&v.getState().userSelectionRect&&(X==null||X(I)),v.setState({userSelectionActive:!1,userSelectionRect:null}),L.current&&(u==null||u(I),v.setState({nodesSelectionActive:R.current.size>0})))},k=n===!0||Array.isArray(n)&&n.includes(0);return U.jsxs("div",{className:wn(["react-flow__pane",{draggable:k,dragging:M,selection:s}]),onClick:A?void 0:S1(X,C),onContextMenu:S1(G,C),onWheel:S1(j,C),onPointerEnter:A?void 0:p,onPointerMove:A?Y:g,onPointerUp:A?F:void 0,onPointerDownCapture:A?P:void 0,onClickCapture:A?ee:void 0,onPointerLeave:y,ref:C,style:W0,children:[x,U.jsx(n$,{})]})}function G_({id:s,store:e,unselect:t=!1,nodeRef:n}){const{addSelectedNodes:i,unselectNodesAndEdges:r,multiSelectionActive:o,nodeLookup:u,onError:c}=e.getState(),d=u.get(s);if(!d){c==null||c("012",ji.error012(s));return}e.setState({nodesSelectionActive:!1}),d.selected?(t||d.selected&&o)&&(r({nodes:[d],edges:[]}),requestAnimationFrame(()=>{var f;return(f=n==null?void 0:n.current)==null?void 0:f.blur()})):i([s])}function M3({nodeRef:s,disabled:e=!1,noDragClassName:t,handleSelector:n,nodeId:i,isSelectable:r,nodeClickDistance:o}){const u=tn(),[c,d]=se.useState(!1),f=se.useRef();return se.useEffect(()=>{f.current=jk({getStoreItems:()=>u.getState(),onNodeMouseDown:p=>{G_({id:p,store:u,nodeRef:s})},onDragStart:()=>{d(!0)},onDragStop:()=>{d(!1)}})},[]),se.useEffect(()=>{var p,g;if(e)(p=f.current)==null||p.destroy();else if(s.current)return(g=f.current)==null||g.update({noDragClassName:t,handleSelector:n,domNode:s.current,isSelectable:r,nodeId:i,nodeClickDistance:o}),()=>{var y;(y=f.current)==null||y.destroy()}},[t,n,e,r,s,i]),c}const r$=s=>e=>e.selected&&(e.draggable||s&&typeof e.draggable>"u");function N3(){const s=tn();return se.useCallback(t=>{const{nodeExtent:n,snapToGrid:i,snapGrid:r,nodesDraggable:o,onError:u,updateNodePositions:c,nodeLookup:d,nodeOrigin:f}=s.getState(),p=new Map,g=r$(o),y=i?r[0]:5,x=i?r[1]:5,v=t.direction.x*y*t.factor,S=t.direction.y*x*t.factor;for(const[,w]of d){if(!g(w))continue;let M={x:w.internals.positionAbsolute.x+v,y:w.internals.positionAbsolute.y+S};i&&(M=Nf(M,r));const{position:T,positionAbsolute:A}=HC({nodeId:w.id,nextPosition:M,nodeLookup:d,nodeExtent:n,nodeOrigin:f,onError:u});w.position=T,w.internals.positionAbsolute=A,p.set(w.id,w)}c(p)},[])}const $v=se.createContext(null),a$=$v.Provider;$v.Consumer;const Hv=()=>se.useContext($v),o$=s=>({connectOnClick:s.connectOnClick,noPanClassName:s.noPanClassName,rfId:s.rfId}),l$=(s,e,t)=>n=>{const{connectionClickStartHandle:i,connectionMode:r,connection:o}=n,{fromHandle:u,toHandle:c,isValid:d}=o,f=(c==null?void 0:c.nodeId)===s&&(c==null?void 0:c.id)===e&&(c==null?void 0:c.type)===t;return{connectingFrom:(u==null?void 0:u.nodeId)===s&&(u==null?void 0:u.id)===e&&(u==null?void 0:u.type)===t,connectingTo:f,clickConnecting:(i==null?void 0:i.nodeId)===s&&(i==null?void 0:i.id)===e&&(i==null?void 0:i.type)===t,isPossibleEndHandle:r===Gc.Strict?(u==null?void 0:u.type)!==t:s!==(u==null?void 0:u.nodeId)||e!==(u==null?void 0:u.id),connectionInProcess:!!u,clickConnectionInProcess:!!i,valid:f&&d}};function u$({type:s="source",position:e=He.Top,isValidConnection:t,isConnectable:n=!0,isConnectableStart:i=!0,isConnectableEnd:r=!0,id:o,onConnect:u,children:c,className:d,onMouseDown:f,onTouchStart:p,...g},y){var Y,F;const x=o||null,v=s==="target",S=tn(),w=Hv(),{connectOnClick:M,noPanClassName:T,rfId:A}=ht(o$,jt),{connectingFrom:C,connectingTo:D,clickConnecting:R,isPossibleEndHandle:B,connectionInProcess:L,clickConnectionInProcess:X,valid:G}=ht(l$(w,x,s),jt);w||(F=(Y=S.getState()).onError)==null||F.call(Y,"010",ji.error010());const j=k=>{const{defaultEdgeOptions:I,onConnect:$,hasDefaultEdges:re}=S.getState(),V={...I,...k};if(re){const{edges:q,setEdges:he}=S.getState();he(n3(V,q))}$==null||$(V),u==null||u(V)},ee=k=>{if(!w)return;const I=KC(k.nativeEvent);if(i&&(I&&k.button===0||!I)){const $=S.getState();k_.onPointerDown(k.nativeEvent,{handleDomNode:k.currentTarget,autoPanOnConnect:$.autoPanOnConnect,connectionMode:$.connectionMode,connectionRadius:$.connectionRadius,domNode:$.domNode,nodeLookup:$.nodeLookup,lib:$.lib,isTarget:v,handleId:x,nodeId:w,flowId:$.rfId,panBy:$.panBy,cancelConnection:$.cancelConnection,onConnectStart:$.onConnectStart,onConnectEnd:$.onConnectEnd,updateConnection:$.updateConnection,onConnect:j,isValidConnection:t||$.isValidConnection,getTransform:()=>S.getState().transform,getFromHandle:()=>S.getState().connection.fromHandle,autoPanSpeed:$.autoPanSpeed,dragThreshold:$.connectionDragThreshold})}I?f==null||f(k):p==null||p(k)},P=k=>{const{onClickConnectStart:I,onClickConnectEnd:$,connectionClickStartHandle:re,connectionMode:V,isValidConnection:q,lib:he,rfId:fe,nodeLookup:W,connection:le}=S.getState();if(!w||!re&&!i)return;if(!re){I==null||I(k.nativeEvent,{nodeId:w,handleId:x,handleType:s}),S.setState({connectionClickStartHandle:{nodeId:w,type:s,id:x}});return}const pe=ZC(k.target),xe=t||q,{connection:Me,isValid:Fe}=k_.isValid(k.nativeEvent,{handle:{nodeId:w,id:x,type:s},connectionMode:V,fromNodeId:re.nodeId,fromHandleId:re.id||null,fromType:re.type,isValidConnection:xe,flowId:fe,doc:pe,lib:he,nodeLookup:W});Fe&&Me&&j(Me);const De=structuredClone(le);delete De.inProgress,De.toPosition=De.toHandle?De.toHandle.position:null,$==null||$(k,De),S.setState({connectionClickStartHandle:null})};return U.jsx("div",{"data-handleid":x,"data-nodeid":w,"data-handlepos":e,"data-id":`${A}-${w}-${x}-${s}`,className:wn(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",T,d,{source:!v,target:v,connectable:n,connectablestart:i,connectableend:r,clickconnecting:R,connectingfrom:C,connectingto:D,valid:G,connectionindicator:n&&(!L||B)&&(L||X?r:i)}]),onMouseDown:ee,onTouchStart:ee,onClick:M?P:void 0,ref:y,...g,children:c})}const qi=se.memo(S3(u$));function c$({data:s,isConnectable:e,sourcePosition:t=He.Bottom}){return U.jsxs(U.Fragment,{children:[s==null?void 0:s.label,U.jsx(qi,{type:"source",position:t,isConnectable:e})]})}function h$({data:s,isConnectable:e,targetPosition:t=He.Top,sourcePosition:n=He.Bottom}){return U.jsxs(U.Fragment,{children:[U.jsx(qi,{type:"target",position:t,isConnectable:e}),s==null?void 0:s.label,U.jsx(qi,{type:"source",position:n,isConnectable:e})]})}function d$(){return null}function f$({data:s,isConnectable:e,targetPosition:t=He.Top}){return U.jsxs(U.Fragment,{children:[U.jsx(qi,{type:"target",position:t,isConnectable:e}),s==null?void 0:s.label]})}const Og={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},ZE={input:c$,default:h$,output:f$,group:d$};function p$(s){var e,t,n,i;return s.internals.handleBounds===void 0?{width:s.width??s.initialWidth??((e=s.style)==null?void 0:e.width),height:s.height??s.initialHeight??((t=s.style)==null?void 0:t.height)}:{width:s.width??((n=s.style)==null?void 0:n.width),height:s.height??((i=s.style)==null?void 0:i.height)}}const m$=s=>{const{width:e,height:t,x:n,y:i}=Mf(s.nodeLookup,{filter:r=>!!r.selected});return{width:Gi(e)?e:null,height:Gi(t)?t:null,userSelectionActive:s.userSelectionActive,transformString:`translate(${s.transform[0]}px,${s.transform[1]}px) scale(${s.transform[2]}) translate(${n}px,${i}px)`}};function g$({onSelectionContextMenu:s,noPanClassName:e,disableKeyboardA11y:t}){const n=tn(),{width:i,height:r,transformString:o,userSelectionActive:u}=ht(m$,jt),c=N3(),d=se.useRef(null);if(se.useEffect(()=>{var g;t||(g=d.current)==null||g.focus({preventScroll:!0})},[t]),M3({nodeRef:d}),u||!i||!r)return null;const f=s?g=>{const y=n.getState().nodes.filter(x=>x.selected);s(g,y)}:void 0,p=g=>{Object.prototype.hasOwnProperty.call(Og,g.key)&&(g.preventDefault(),c({direction:Og[g.key],factor:g.shiftKey?4:1}))};return U.jsx("div",{className:wn(["react-flow__nodesselection","react-flow__container",e]),style:{transform:o},children:U.jsx("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:f,tabIndex:t?void 0:-1,onKeyDown:t?void 0:p,style:{width:i,height:r}})})}const QE=typeof window<"u"?window:void 0,y$=s=>({nodesSelectionActive:s.nodesSelectionActive,userSelectionActive:s.userSelectionActive});function A3({children:s,onPaneClick:e,onPaneMouseEnter:t,onPaneMouseMove:n,onPaneMouseLeave:i,onPaneContextMenu:r,onPaneScroll:o,paneClickDistance:u,deleteKeyCode:c,selectionKeyCode:d,selectionOnDrag:f,selectionMode:p,onSelectionStart:g,onSelectionEnd:y,multiSelectionKeyCode:x,panActivationKeyCode:v,zoomActivationKeyCode:S,elementsSelectable:w,zoomOnScroll:M,zoomOnPinch:T,panOnScroll:A,panOnScrollSpeed:C,panOnScrollMode:D,zoomOnDoubleClick:R,panOnDrag:B,defaultViewport:L,translateExtent:X,minZoom:G,maxZoom:j,preventScrolling:ee,onSelectionContextMenu:P,noWheelClassName:Y,noPanClassName:F,disableKeyboardA11y:k,onViewportChange:I,isControlledViewport:$}){const{nodesSelectionActive:re,userSelectionActive:V}=ht(y$,jt),q=lf(d,{target:QE}),he=lf(v,{target:QE}),fe=he||B,W=he||A,le=f&&fe!==!0,pe=q||V||le;return QG({deleteKeyCode:c,multiSelectionKeyCode:x}),U.jsx(e$,{onPaneContextMenu:r,elementsSelectable:w,zoomOnScroll:M,zoomOnPinch:T,panOnScroll:W,panOnScrollSpeed:C,panOnScrollMode:D,zoomOnDoubleClick:R,panOnDrag:!q&&fe,defaultViewport:L,translateExtent:X,minZoom:G,maxZoom:j,zoomActivationKeyCode:S,preventScrolling:ee,noWheelClassName:Y,noPanClassName:F,onViewportChange:I,isControlledViewport:$,paneClickDistance:u,selectionOnDrag:le,children:U.jsxs(i$,{onSelectionStart:g,onSelectionEnd:y,onPaneClick:e,onPaneMouseEnter:t,onPaneMouseMove:n,onPaneMouseLeave:i,onPaneContextMenu:r,onPaneScroll:o,panOnDrag:fe,isSelecting:!!pe,selectionMode:p,selectionKeyPressed:q,paneClickDistance:u,selectionOnDrag:le,children:[s,re&&U.jsx(g$,{onSelectionContextMenu:P,noPanClassName:F,disableKeyboardA11y:k})]})})}A3.displayName="FlowRenderer";const x$=se.memo(A3),b$=s=>e=>s?Ov(e.nodeLookup,{x:0,y:0,width:e.width,height:e.height},e.transform,!0).map(t=>t.id):Array.from(e.nodeLookup.keys());function _$(s){return ht(se.useCallback(b$(s),[s]),jt)}const v$=s=>s.updateNodeInternals;function T$(){const s=ht(v$),[e]=se.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(t=>{const n=new Map;t.forEach(i=>{const r=i.target.getAttribute("data-id");n.set(r,{id:r,nodeElement:i.target,force:!0})}),s(n)}));return se.useEffect(()=>()=>{e==null||e.disconnect()},[e]),e}function S$({node:s,nodeType:e,hasDimensions:t,resizeObserver:n}){const i=tn(),r=se.useRef(null),o=se.useRef(null),u=se.useRef(s.sourcePosition),c=se.useRef(s.targetPosition),d=se.useRef(e),f=t&&!!s.internals.handleBounds;return se.useEffect(()=>{r.current&&!s.hidden&&(!f||o.current!==r.current)&&(o.current&&(n==null||n.unobserve(o.current)),n==null||n.observe(r.current),o.current=r.current)},[f,s.hidden]),se.useEffect(()=>()=>{o.current&&(n==null||n.unobserve(o.current),o.current=null)},[]),se.useEffect(()=>{if(r.current){const p=d.current!==e,g=u.current!==s.sourcePosition,y=c.current!==s.targetPosition;(p||g||y)&&(d.current=e,u.current=s.sourcePosition,c.current=s.targetPosition,i.getState().updateNodeInternals(new Map([[s.id,{id:s.id,nodeElement:r.current,force:!0}]])))}},[s.id,e,s.sourcePosition,s.targetPosition]),r}function w$({id:s,onClick:e,onMouseEnter:t,onMouseMove:n,onMouseLeave:i,onContextMenu:r,onDoubleClick:o,nodesDraggable:u,elementsSelectable:c,nodesConnectable:d,nodesFocusable:f,resizeObserver:p,noDragClassName:g,noPanClassName:y,disableKeyboardA11y:x,rfId:v,nodeTypes:S,nodeClickDistance:w,onError:M}){const{node:T,internals:A,isParent:C}=ht(xe=>{const Me=xe.nodeLookup.get(s),Fe=xe.parentLookup.has(s);return{node:Me,internals:Me.internals,isParent:Fe}},jt);let D=T.type||"default",R=(S==null?void 0:S[D])||ZE[D];R===void 0&&(M==null||M("003",ji.error003(D)),D="default",R=(S==null?void 0:S.default)||ZE.default);const B=!!(T.draggable||u&&typeof T.draggable>"u"),L=!!(T.selectable||c&&typeof T.selectable>"u"),X=!!(T.connectable||d&&typeof T.connectable>"u"),G=!!(T.focusable||f&&typeof T.focusable>"u"),j=tn(),ee=XC(T),P=S$({node:T,nodeType:D,hasDimensions:ee,resizeObserver:p}),Y=M3({nodeRef:P,disabled:T.hidden||!B,noDragClassName:g,handleSelector:T.dragHandle,nodeId:s,isSelectable:L,nodeClickDistance:w}),F=N3();if(T.hidden)return null;const k=Ba(T),I=p$(T),$=L||B||e||t||n||i,re=t?xe=>t(xe,{...A.userNode}):void 0,V=n?xe=>n(xe,{...A.userNode}):void 0,q=i?xe=>i(xe,{...A.userNode}):void 0,he=r?xe=>r(xe,{...A.userNode}):void 0,fe=o?xe=>o(xe,{...A.userNode}):void 0,W=xe=>{const{selectNodesOnDrag:Me,nodeDragThreshold:Fe}=j.getState();L&&(!Me||!B||Fe>0)&&G_({id:s,store:j,nodeRef:P}),e&&e(xe,{...A.userNode})},le=xe=>{if(!(QC(xe.nativeEvent)||x)){if(PC.includes(xe.key)&&L){const Me=xe.key==="Escape";G_({id:s,store:j,unselect:Me,nodeRef:P})}else if(B&&T.selected&&Object.prototype.hasOwnProperty.call(Og,xe.key)){xe.preventDefault();const{ariaLabelConfig:Me}=j.getState();j.setState({ariaLiveMessage:Me["node.a11yDescription.ariaLiveMessage"]({direction:xe.key.replace("Arrow","").toLowerCase(),x:~~A.positionAbsolute.x,y:~~A.positionAbsolute.y})}),F({direction:Og[xe.key],factor:xe.shiftKey?4:1})}}},pe=()=>{var nt;if(x||!((nt=P.current)!=null&&nt.matches(":focus-visible")))return;const{transform:xe,width:Me,height:Fe,autoPanOnNodeFocus:De,setCenter:Le}=j.getState();if(!De)return;Ov(new Map([[s,T]]),{x:0,y:0,width:Me,height:Fe},xe,!0).length>0||Le(T.position.x+k.width/2,T.position.y+k.height/2,{zoom:xe[2]})};return U.jsx("div",{className:wn(["react-flow__node",`react-flow__node-${D}`,{[y]:B},T.className,{selected:T.selected,selectable:L,parent:C,draggable:B,dragging:Y}]),ref:P,style:{zIndex:A.z,transform:`translate(${A.positionAbsolute.x}px,${A.positionAbsolute.y}px)`,pointerEvents:$?"all":"none",visibility:ee?"visible":"hidden",...T.style,...I},"data-id":s,"data-testid":`rf__node-${s}`,onMouseEnter:re,onMouseMove:V,onMouseLeave:q,onContextMenu:he,onClick:W,onDoubleClick:fe,onKeyDown:G?le:void 0,tabIndex:G?0:void 0,onFocus:G?pe:void 0,role:T.ariaRole??(G?"group":void 0),"aria-roledescription":"node","aria-describedby":x?void 0:`${y3}-${v}`,"aria-label":T.ariaLabel,...T.domAttributes,children:U.jsx(a$,{value:s,children:U.jsx(R,{id:s,data:T.data,type:D,positionAbsoluteX:A.positionAbsolute.x,positionAbsoluteY:A.positionAbsolute.y,selected:T.selected??!1,selectable:L,draggable:B,deletable:T.deletable??!0,isConnectable:X,sourcePosition:T.sourcePosition,targetPosition:T.targetPosition,dragging:Y,dragHandle:T.dragHandle,zIndex:A.z,parentId:T.parentId,...k})})})}var M$=se.memo(w$);const N$=s=>({nodesDraggable:s.nodesDraggable,nodesConnectable:s.nodesConnectable,nodesFocusable:s.nodesFocusable,elementsSelectable:s.elementsSelectable,onError:s.onError});function E3(s){const{nodesDraggable:e,nodesConnectable:t,nodesFocusable:n,elementsSelectable:i,onError:r}=ht(N$,jt),o=_$(s.onlyRenderVisibleElements),u=T$();return U.jsx("div",{className:"react-flow__nodes",style:W0,children:o.map(c=>U.jsx(M$,{id:c,nodeTypes:s.nodeTypes,nodeExtent:s.nodeExtent,onClick:s.onNodeClick,onMouseEnter:s.onNodeMouseEnter,onMouseMove:s.onNodeMouseMove,onMouseLeave:s.onNodeMouseLeave,onContextMenu:s.onNodeContextMenu,onDoubleClick:s.onNodeDoubleClick,noDragClassName:s.noDragClassName,noPanClassName:s.noPanClassName,rfId:s.rfId,disableKeyboardA11y:s.disableKeyboardA11y,resizeObserver:u,nodesDraggable:e,nodesConnectable:t,nodesFocusable:n,elementsSelectable:i,nodeClickDistance:s.nodeClickDistance,onError:r},c))})}E3.displayName="NodeRenderer";const A$=se.memo(E3);function E$(s){return ht(se.useCallback(t=>{if(!s)return t.edges.map(i=>i.id);const n=[];if(t.width&&t.height)for(const i of t.edges){const r=t.nodeLookup.get(i.source),o=t.nodeLookup.get(i.target);r&&o&&Ak({sourceNode:r,targetNode:o,width:t.width,height:t.height,transform:t.transform})&&n.push(i.id)}return n},[s]),jt)}const R$=({color:s="none",strokeWidth:e=1})=>{const t={strokeWidth:e,...s&&{stroke:s}};return U.jsx("polyline",{className:"arrow",style:t,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},C$=({color:s="none",strokeWidth:e=1})=>{const t={strokeWidth:e,...s&&{stroke:s,fill:s}};return U.jsx("polyline",{className:"arrowclosed",style:t,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},KE={[Bg.Arrow]:R$,[Bg.ArrowClosed]:C$};function D$(s){const e=tn();return se.useMemo(()=>{var i,r;return Object.prototype.hasOwnProperty.call(KE,s)?KE[s]:((r=(i=e.getState()).onError)==null||r.call(i,"009",ji.error009(s)),null)},[s])}const B$=({id:s,type:e,color:t,width:n=12.5,height:i=12.5,markerUnits:r="strokeWidth",strokeWidth:o,orient:u="auto-start-reverse"})=>{const c=D$(e);return c?U.jsx("marker",{className:"react-flow__arrowhead",id:s,markerWidth:`${n}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:r,orient:u,refX:"0",refY:"0",children:U.jsx(c,{color:t,strokeWidth:o})}):null},R3=({defaultColor:s,rfId:e})=>{const t=ht(r=>r.edges),n=ht(r=>r.defaultEdgeOptions),i=se.useMemo(()=>Fk(t,{id:e,defaultColor:s,defaultMarkerStart:n==null?void 0:n.markerStart,defaultMarkerEnd:n==null?void 0:n.markerEnd}),[t,n,e,s]);return i.length?U.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:U.jsx("defs",{children:i.map(r=>U.jsx(B$,{id:r.id,type:r.type,color:r.color,width:r.width,height:r.height,markerUnits:r.markerUnits,strokeWidth:r.strokeWidth,orient:r.orient},r.id))})}):null};R3.displayName="MarkerDefinitions";var L$=se.memo(R3);function C3({x:s,y:e,label:t,labelStyle:n,labelShowBg:i=!0,labelBgStyle:r,labelBgPadding:o=[2,4],labelBgBorderRadius:u=2,children:c,className:d,...f}){const[p,g]=se.useState({x:1,y:0,width:0,height:0}),y=wn(["react-flow__edge-textwrapper",d]),x=se.useRef(null);return se.useEffect(()=>{if(x.current){const v=x.current.getBBox();g({x:v.x,y:v.y,width:v.width,height:v.height})}},[t]),t?U.jsxs("g",{transform:`translate(${s-p.width/2} ${e-p.height/2})`,className:y,visibility:p.width?"visible":"hidden",...f,children:[i&&U.jsx("rect",{width:p.width+2*o[0],x:-o[0],y:-o[1],height:p.height+2*o[1],className:"react-flow__edge-textbg",style:r,rx:u,ry:u}),U.jsx("text",{className:"react-flow__edge-text",y:p.height/2,dy:"0.3em",ref:x,style:n,children:t}),c]}):null}C3.displayName="EdgeText";const F$=se.memo(C3);function X0({path:s,labelX:e,labelY:t,label:n,labelStyle:i,labelShowBg:r,labelBgStyle:o,labelBgPadding:u,labelBgBorderRadius:c,interactionWidth:d=20,...f}){return U.jsxs(U.Fragment,{children:[U.jsx("path",{...f,d:s,fill:"none",className:wn(["react-flow__edge-path",f.className])}),d?U.jsx("path",{d:s,fill:"none",strokeOpacity:0,strokeWidth:d,className:"react-flow__edge-interaction"}):null,n&&Gi(e)&&Gi(t)?U.jsx(F$,{x:e,y:t,label:n,labelStyle:i,labelShowBg:r,labelBgStyle:o,labelBgPadding:u,labelBgBorderRadius:c}):null]})}function JE({pos:s,x1:e,y1:t,x2:n,y2:i}){return s===He.Left||s===He.Right?[.5*(e+n),t]:[e,.5*(t+i)]}function D3({sourceX:s,sourceY:e,sourcePosition:t=He.Bottom,targetX:n,targetY:i,targetPosition:r=He.Top}){const[o,u]=JE({pos:t,x1:s,y1:e,x2:n,y2:i}),[c,d]=JE({pos:r,x1:n,y1:i,x2:s,y2:e}),[f,p,g,y]=JC({sourceX:s,sourceY:e,targetX:n,targetY:i,sourceControlX:o,sourceControlY:u,targetControlX:c,targetControlY:d});return[`M${s},${e} C${o},${u} ${c},${d} ${n},${i}`,f,p,g,y]}function B3(s){return se.memo(({id:e,sourceX:t,sourceY:n,targetX:i,targetY:r,sourcePosition:o,targetPosition:u,label:c,labelStyle:d,labelShowBg:f,labelBgStyle:p,labelBgPadding:g,labelBgBorderRadius:y,style:x,markerEnd:v,markerStart:S,interactionWidth:w})=>{const[M,T,A]=D3({sourceX:t,sourceY:n,sourcePosition:o,targetX:i,targetY:r,targetPosition:u}),C=s.isInternal?void 0:e;return U.jsx(X0,{id:C,path:M,labelX:T,labelY:A,label:c,labelStyle:d,labelShowBg:f,labelBgStyle:p,labelBgPadding:g,labelBgBorderRadius:y,style:x,markerEnd:v,markerStart:S,interactionWidth:w})})}const O$=B3({isInternal:!1}),L3=B3({isInternal:!0});O$.displayName="SimpleBezierEdge";L3.displayName="SimpleBezierEdgeInternal";function F3(s){return se.memo(({id:e,sourceX:t,sourceY:n,targetX:i,targetY:r,label:o,labelStyle:u,labelShowBg:c,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:p,style:g,sourcePosition:y=He.Bottom,targetPosition:x=He.Top,markerEnd:v,markerStart:S,pathOptions:w,interactionWidth:M})=>{const[T,A,C]=V_({sourceX:t,sourceY:n,sourcePosition:y,targetX:i,targetY:r,targetPosition:x,borderRadius:w==null?void 0:w.borderRadius,offset:w==null?void 0:w.offset,stepPosition:w==null?void 0:w.stepPosition}),D=s.isInternal?void 0:e;return U.jsx(X0,{id:D,path:T,labelX:A,labelY:C,label:o,labelStyle:u,labelShowBg:c,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:p,style:g,markerEnd:v,markerStart:S,interactionWidth:M})})}const O3=F3({isInternal:!1}),U3=F3({isInternal:!0});O3.displayName="SmoothStepEdge";U3.displayName="SmoothStepEdgeInternal";function z3(s){return se.memo(({id:e,...t})=>{var i;const n=s.isInternal?void 0:e;return U.jsx(O3,{...t,id:n,pathOptions:se.useMemo(()=>{var r;return{borderRadius:0,offset:(r=t.pathOptions)==null?void 0:r.offset}},[(i=t.pathOptions)==null?void 0:i.offset])})})}const U$=z3({isInternal:!1}),V3=z3({isInternal:!0});U$.displayName="StepEdge";V3.displayName="StepEdgeInternal";function P3(s){return se.memo(({id:e,sourceX:t,sourceY:n,targetX:i,targetY:r,label:o,labelStyle:u,labelShowBg:c,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:p,style:g,markerEnd:y,markerStart:x,interactionWidth:v})=>{const[S,w,M]=s3({sourceX:t,sourceY:n,targetX:i,targetY:r}),T=s.isInternal?void 0:e;return U.jsx(X0,{id:T,path:S,labelX:w,labelY:M,label:o,labelStyle:u,labelShowBg:c,labelBgStyle:d,labelBgPadding:f,labelBgBorderRadius:p,style:g,markerEnd:y,markerStart:x,interactionWidth:v})})}const z$=P3({isInternal:!1}),I3=P3({isInternal:!0});z$.displayName="StraightEdge";I3.displayName="StraightEdgeInternal";function k3(s){return se.memo(({id:e,sourceX:t,sourceY:n,targetX:i,targetY:r,sourcePosition:o=He.Bottom,targetPosition:u=He.Top,label:c,labelStyle:d,labelShowBg:f,labelBgStyle:p,labelBgPadding:g,labelBgBorderRadius:y,style:x,markerEnd:v,markerStart:S,pathOptions:w,interactionWidth:M})=>{const[T,A,C]=e3({sourceX:t,sourceY:n,sourcePosition:o,targetX:i,targetY:r,targetPosition:u,curvature:w==null?void 0:w.curvature}),D=s.isInternal?void 0:e;return U.jsx(X0,{id:D,path:T,labelX:A,labelY:C,label:c,labelStyle:d,labelShowBg:f,labelBgStyle:p,labelBgPadding:g,labelBgBorderRadius:y,style:x,markerEnd:v,markerStart:S,interactionWidth:M})})}const V$=k3({isInternal:!1}),G3=k3({isInternal:!0});V$.displayName="BezierEdge";G3.displayName="BezierEdgeInternal";const e2={default:G3,straight:I3,step:V3,smoothstep:U3,simplebezier:L3},t2={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},P$=(s,e,t)=>t===He.Left?s-e:t===He.Right?s+e:s,I$=(s,e,t)=>t===He.Top?s-e:t===He.Bottom?s+e:s,n2="react-flow__edgeupdater";function s2({position:s,centerX:e,centerY:t,radius:n=10,onMouseDown:i,onMouseEnter:r,onMouseOut:o,type:u}){return U.jsx("circle",{onMouseDown:i,onMouseEnter:r,onMouseOut:o,className:wn([n2,`${n2}-${u}`]),cx:P$(e,n,s),cy:I$(t,n,s),r:n,stroke:"transparent",fill:"transparent"})}function k$({isReconnectable:s,reconnectRadius:e,edge:t,sourceX:n,sourceY:i,targetX:r,targetY:o,sourcePosition:u,targetPosition:c,onReconnect:d,onReconnectStart:f,onReconnectEnd:p,setReconnecting:g,setUpdateHover:y}){const x=tn(),v=(A,C)=>{if(A.button!==0)return;const{autoPanOnConnect:D,domNode:R,isValidConnection:B,connectionMode:L,connectionRadius:X,lib:G,onConnectStart:j,onConnectEnd:ee,cancelConnection:P,nodeLookup:Y,rfId:F,panBy:k,updateConnection:I}=x.getState(),$=C.type==="target",re=(he,fe)=>{g(!1),p==null||p(he,t,C.type,fe)},V=he=>d==null?void 0:d(t,he),q=(he,fe)=>{g(!0),f==null||f(A,t,C.type),j==null||j(he,fe)};k_.onPointerDown(A.nativeEvent,{autoPanOnConnect:D,connectionMode:L,connectionRadius:X,domNode:R,handleId:C.id,nodeId:C.nodeId,nodeLookup:Y,isTarget:$,edgeUpdaterType:C.type,lib:G,flowId:F,cancelConnection:P,panBy:k,isValidConnection:B,onConnect:V,onConnectStart:q,onConnectEnd:ee,onReconnectEnd:re,updateConnection:I,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,dragThreshold:x.getState().connectionDragThreshold,handleDomNode:A.currentTarget})},S=A=>v(A,{nodeId:t.target,id:t.targetHandle??null,type:"target"}),w=A=>v(A,{nodeId:t.source,id:t.sourceHandle??null,type:"source"}),M=()=>y(!0),T=()=>y(!1);return U.jsxs(U.Fragment,{children:[(s===!0||s==="source")&&U.jsx(s2,{position:u,centerX:n,centerY:i,radius:e,onMouseDown:S,onMouseEnter:M,onMouseOut:T,type:"source"}),(s===!0||s==="target")&&U.jsx(s2,{position:c,centerX:r,centerY:o,radius:e,onMouseDown:w,onMouseEnter:M,onMouseOut:T,type:"target"})]})}function G$({id:s,edgesFocusable:e,edgesReconnectable:t,elementsSelectable:n,onClick:i,onDoubleClick:r,onContextMenu:o,onMouseEnter:u,onMouseMove:c,onMouseLeave:d,reconnectRadius:f,onReconnect:p,onReconnectStart:g,onReconnectEnd:y,rfId:x,edgeTypes:v,noPanClassName:S,onError:w,disableKeyboardA11y:M}){let T=ht(Le=>Le.edgeLookup.get(s));const A=ht(Le=>Le.defaultEdgeOptions);T=A?{...A,...T}:T;let C=T.type||"default",D=(v==null?void 0:v[C])||e2[C];D===void 0&&(w==null||w("011",ji.error011(C)),C="default",D=(v==null?void 0:v.default)||e2.default);const R=!!(T.focusable||e&&typeof T.focusable>"u"),B=typeof p<"u"&&(T.reconnectable||t&&typeof T.reconnectable>"u"),L=!!(T.selectable||n&&typeof T.selectable>"u"),X=se.useRef(null),[G,j]=se.useState(!1),[ee,P]=se.useState(!1),Y=tn(),{zIndex:F,sourceX:k,sourceY:I,targetX:$,targetY:re,sourcePosition:V,targetPosition:q}=ht(se.useCallback(Le=>{const Ve=Le.nodeLookup.get(T.source),nt=Le.nodeLookup.get(T.target);if(!Ve||!nt)return{zIndex:T.zIndex,...t2};const Dt=Lk({id:s,sourceNode:Ve,targetNode:nt,sourceHandle:T.sourceHandle||null,targetHandle:T.targetHandle||null,connectionMode:Le.connectionMode,onError:w});return{zIndex:Nk({selected:T.selected,zIndex:T.zIndex,sourceNode:Ve,targetNode:nt,elevateOnSelect:Le.elevateEdgesOnSelect,zIndexMode:Le.zIndexMode}),...Dt||t2}},[T.source,T.target,T.sourceHandle,T.targetHandle,T.selected,T.zIndex]),jt),he=se.useMemo(()=>T.markerStart?`url('#${P_(T.markerStart,x)}')`:void 0,[T.markerStart,x]),fe=se.useMemo(()=>T.markerEnd?`url('#${P_(T.markerEnd,x)}')`:void 0,[T.markerEnd,x]);if(T.hidden||k===null||I===null||$===null||re===null)return null;const W=Le=>{var dt;const{addSelectedEdges:Ve,unselectNodesAndEdges:nt,multiSelectionActive:Dt}=Y.getState();L&&(Y.setState({nodesSelectionActive:!1}),T.selected&&Dt?(nt({nodes:[],edges:[T]}),(dt=X.current)==null||dt.blur()):Ve([s])),i&&i(Le,T)},le=r?Le=>{r(Le,{...T})}:void 0,pe=o?Le=>{o(Le,{...T})}:void 0,xe=u?Le=>{u(Le,{...T})}:void 0,Me=c?Le=>{c(Le,{...T})}:void 0,Fe=d?Le=>{d(Le,{...T})}:void 0,De=Le=>{var Ve;if(!M&&PC.includes(Le.key)&&L){const{unselectNodesAndEdges:nt,addSelectedEdges:Dt}=Y.getState();Le.key==="Escape"?((Ve=X.current)==null||Ve.blur(),nt({edges:[T]})):Dt([s])}};return U.jsx("svg",{style:{zIndex:F},children:U.jsxs("g",{className:wn(["react-flow__edge",`react-flow__edge-${C}`,T.className,S,{selected:T.selected,animated:T.animated,inactive:!L&&!i,updating:G,selectable:L}]),onClick:W,onDoubleClick:le,onContextMenu:pe,onMouseEnter:xe,onMouseMove:Me,onMouseLeave:Fe,onKeyDown:R?De:void 0,tabIndex:R?0:void 0,role:T.ariaRole??(R?"group":"img"),"aria-roledescription":"edge","data-id":s,"data-testid":`rf__edge-${s}`,"aria-label":T.ariaLabel===null?void 0:T.ariaLabel||`Edge from ${T.source} to ${T.target}`,"aria-describedby":R?`${x3}-${x}`:void 0,ref:X,...T.domAttributes,children:[!ee&&U.jsx(D,{id:s,source:T.source,target:T.target,type:T.type,selected:T.selected,animated:T.animated,selectable:L,deletable:T.deletable??!0,label:T.label,labelStyle:T.labelStyle,labelShowBg:T.labelShowBg,labelBgStyle:T.labelBgStyle,labelBgPadding:T.labelBgPadding,labelBgBorderRadius:T.labelBgBorderRadius,sourceX:k,sourceY:I,targetX:$,targetY:re,sourcePosition:V,targetPosition:q,data:T.data,style:T.style,sourceHandleId:T.sourceHandle,targetHandleId:T.targetHandle,markerStart:he,markerEnd:fe,pathOptions:"pathOptions"in T?T.pathOptions:void 0,interactionWidth:T.interactionWidth}),B&&U.jsx(k$,{edge:T,isReconnectable:B,reconnectRadius:f,onReconnect:p,onReconnectStart:g,onReconnectEnd:y,sourceX:k,sourceY:I,targetX:$,targetY:re,sourcePosition:V,targetPosition:q,setUpdateHover:j,setReconnecting:P})]})})}var $$=se.memo(G$);const H$=s=>({edgesFocusable:s.edgesFocusable,edgesReconnectable:s.edgesReconnectable,elementsSelectable:s.elementsSelectable,connectionMode:s.connectionMode,onError:s.onError});function $3({defaultMarkerColor:s,onlyRenderVisibleElements:e,rfId:t,edgeTypes:n,noPanClassName:i,onReconnect:r,onEdgeContextMenu:o,onEdgeMouseEnter:u,onEdgeMouseMove:c,onEdgeMouseLeave:d,onEdgeClick:f,reconnectRadius:p,onEdgeDoubleClick:g,onReconnectStart:y,onReconnectEnd:x,disableKeyboardA11y:v}){const{edgesFocusable:S,edgesReconnectable:w,elementsSelectable:M,onError:T}=ht(H$,jt),A=E$(e);return U.jsxs("div",{className:"react-flow__edges",children:[U.jsx(L$,{defaultColor:s,rfId:t}),A.map(C=>U.jsx($$,{id:C,edgesFocusable:S,edgesReconnectable:w,elementsSelectable:M,noPanClassName:i,onReconnect:r,onContextMenu:o,onMouseEnter:u,onMouseMove:c,onMouseLeave:d,onClick:f,reconnectRadius:p,onDoubleClick:g,onReconnectStart:y,onReconnectEnd:x,rfId:t,onError:T,edgeTypes:n,disableKeyboardA11y:v},C))]})}$3.displayName="EdgeRenderer";const j$=se.memo($3),q$=s=>`translate(${s.transform[0]}px,${s.transform[1]}px) scale(${s.transform[2]})`;function W$({children:s}){const e=ht(q$);return U.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:e},children:s})}function X$(s){const e=Ef(),t=se.useRef(!1);se.useEffect(()=>{!t.current&&e.viewportInitialized&&s&&(setTimeout(()=>s(e),1),t.current=!0)},[s,e.viewportInitialized])}const Y$=s=>{var e;return(e=s.panZoom)==null?void 0:e.syncViewport};function Z$(s){const e=ht(Y$),t=tn();return se.useEffect(()=>{s&&(e==null||e(s),t.setState({transform:[s.x,s.y,s.zoom]}))},[s,e]),null}function Q$(s){return s.connection.inProgress?{...s.connection,to:Af(s.connection.to,s.transform)}:{...s.connection}}function K$(s){return Q$}function J$(s){const e=K$();return ht(e,jt)}const e6=s=>({nodesConnectable:s.nodesConnectable,isValid:s.connection.isValid,inProgress:s.connection.inProgress,width:s.width,height:s.height});function t6({containerStyle:s,style:e,type:t,component:n}){const{nodesConnectable:i,width:r,height:o,isValid:u,inProgress:c}=ht(e6,jt);return!(r&&i&&c)?null:U.jsx("svg",{style:s,width:r,height:o,className:"react-flow__connectionline react-flow__container",children:U.jsx("g",{className:wn(["react-flow__connection",GC(u)]),children:U.jsx(H3,{style:e,type:t,CustomComponent:n,isValid:u})})})}const H3=({style:s,type:e=Ao.Bezier,CustomComponent:t,isValid:n})=>{const{inProgress:i,from:r,fromNode:o,fromHandle:u,fromPosition:c,to:d,toNode:f,toHandle:p,toPosition:g,pointer:y}=J$();if(!i)return;if(t)return U.jsx(t,{connectionLineType:e,connectionLineStyle:s,fromNode:o,fromHandle:u,fromX:r.x,fromY:r.y,toX:d.x,toY:d.y,fromPosition:c,toPosition:g,connectionStatus:GC(n),toNode:f,toHandle:p,pointer:y});let x="";const v={sourceX:r.x,sourceY:r.y,sourcePosition:c,targetX:d.x,targetY:d.y,targetPosition:g};switch(e){case Ao.Bezier:[x]=e3(v);break;case Ao.SimpleBezier:[x]=D3(v);break;case Ao.Step:[x]=V_({...v,borderRadius:0});break;case Ao.SmoothStep:[x]=V_(v);break;default:[x]=s3(v)}return U.jsx("path",{d:x,fill:"none",className:"react-flow__connection-path",style:s})};H3.displayName="ConnectionLine";const n6={};function i2(s=n6){se.useRef(s),tn(),se.useEffect(()=>{},[s])}function s6(){tn(),se.useRef(!1),se.useEffect(()=>{},[])}function j3({nodeTypes:s,edgeTypes:e,onInit:t,onNodeClick:n,onEdgeClick:i,onNodeDoubleClick:r,onEdgeDoubleClick:o,onNodeMouseEnter:u,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:f,onSelectionContextMenu:p,onSelectionStart:g,onSelectionEnd:y,connectionLineType:x,connectionLineStyle:v,connectionLineComponent:S,connectionLineContainerStyle:w,selectionKeyCode:M,selectionOnDrag:T,selectionMode:A,multiSelectionKeyCode:C,panActivationKeyCode:D,zoomActivationKeyCode:R,deleteKeyCode:B,onlyRenderVisibleElements:L,elementsSelectable:X,defaultViewport:G,translateExtent:j,minZoom:ee,maxZoom:P,preventScrolling:Y,defaultMarkerColor:F,zoomOnScroll:k,zoomOnPinch:I,panOnScroll:$,panOnScrollSpeed:re,panOnScrollMode:V,zoomOnDoubleClick:q,panOnDrag:he,onPaneClick:fe,onPaneMouseEnter:W,onPaneMouseMove:le,onPaneMouseLeave:pe,onPaneScroll:xe,onPaneContextMenu:Me,paneClickDistance:Fe,nodeClickDistance:De,onEdgeContextMenu:Le,onEdgeMouseEnter:Ve,onEdgeMouseMove:nt,onEdgeMouseLeave:Dt,reconnectRadius:dt,onReconnect:Dn,onReconnectStart:Ni,onReconnectEnd:Os,noDragClassName:Ai,noWheelClassName:Dr,noPanClassName:Zo,disableKeyboardA11y:Qo,nodeExtent:Un,rfId:ou,viewport:Br,onViewportChange:Ua}){return i2(s),i2(e),s6(),X$(t),Z$(Br),U.jsx(x$,{onPaneClick:fe,onPaneMouseEnter:W,onPaneMouseMove:le,onPaneMouseLeave:pe,onPaneContextMenu:Me,onPaneScroll:xe,paneClickDistance:Fe,deleteKeyCode:B,selectionKeyCode:M,selectionOnDrag:T,selectionMode:A,onSelectionStart:g,onSelectionEnd:y,multiSelectionKeyCode:C,panActivationKeyCode:D,zoomActivationKeyCode:R,elementsSelectable:X,zoomOnScroll:k,zoomOnPinch:I,zoomOnDoubleClick:q,panOnScroll:$,panOnScrollSpeed:re,panOnScrollMode:V,panOnDrag:he,defaultViewport:G,translateExtent:j,minZoom:ee,maxZoom:P,onSelectionContextMenu:p,preventScrolling:Y,noDragClassName:Ai,noWheelClassName:Dr,noPanClassName:Zo,disableKeyboardA11y:Qo,onViewportChange:Ua,isControlledViewport:!!Br,children:U.jsxs(W$,{children:[U.jsx(j$,{edgeTypes:e,onEdgeClick:i,onEdgeDoubleClick:o,onReconnect:Dn,onReconnectStart:Ni,onReconnectEnd:Os,onlyRenderVisibleElements:L,onEdgeContextMenu:Le,onEdgeMouseEnter:Ve,onEdgeMouseMove:nt,onEdgeMouseLeave:Dt,reconnectRadius:dt,defaultMarkerColor:F,noPanClassName:Zo,disableKeyboardA11y:Qo,rfId:ou}),U.jsx(t6,{style:v,type:x,component:S,containerStyle:w}),U.jsx("div",{className:"react-flow__edgelabel-renderer"}),U.jsx(A$,{nodeTypes:s,onNodeClick:n,onNodeDoubleClick:r,onNodeMouseEnter:u,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:f,nodeClickDistance:De,onlyRenderVisibleElements:L,noPanClassName:Zo,noDragClassName:Ai,disableKeyboardA11y:Qo,nodeExtent:Un,rfId:ou}),U.jsx("div",{className:"react-flow__viewport-portal"})]})})}j3.displayName="GraphView";const i6=se.memo(j3),r2=({nodes:s,edges:e,defaultNodes:t,defaultEdges:n,width:i,height:r,fitView:o,fitViewOptions:u,minZoom:c=.5,maxZoom:d=2,nodeOrigin:f,nodeExtent:p,zIndexMode:g="basic"}={})=>{const y=new Map,x=new Map,v=new Map,S=new Map,w=n??e??[],M=t??s??[],T=f??[0,0],A=p??sf;a3(v,S,w);const C=I_(M,y,x,{nodeOrigin:T,nodeExtent:A,zIndexMode:g});let D=[0,0,1];if(o&&i&&r){const R=Mf(y,{filter:G=>!!((G.width||G.initialWidth)&&(G.height||G.initialHeight))}),{x:B,y:L,zoom:X}=Uv(R,i,r,c,d,(u==null?void 0:u.padding)??.1);D=[B,L,X]}return{rfId:"1",width:i??0,height:r??0,transform:D,nodes:M,nodesInitialized:C,nodeLookup:y,parentLookup:x,edges:w,edgeLookup:S,connectionLookup:v,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:t!==void 0,hasDefaultEdges:n!==void 0,panZoom:null,minZoom:c,maxZoom:d,translateExtent:sf,nodeExtent:A,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Gc.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:T,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:o??!1,fitViewOptions:u,fitViewResolver:null,connection:{...kC},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:_k,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:IC,zIndexMode:g,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},r6=({nodes:s,edges:e,defaultNodes:t,defaultEdges:n,width:i,height:r,fitView:o,fitViewOptions:u,minZoom:c,maxZoom:d,nodeOrigin:f,nodeExtent:p,zIndexMode:g})=>SG((y,x)=>{async function v(){const{nodeLookup:S,panZoom:w,fitViewOptions:M,fitViewResolver:T,width:A,height:C,minZoom:D,maxZoom:R}=x();w&&(await xk({nodes:S,width:A,height:C,panZoom:w,minZoom:D,maxZoom:R},M),T==null||T.resolve(!0),y({fitViewResolver:null}))}return{...r2({nodes:s,edges:e,width:i,height:r,fitView:o,fitViewOptions:u,minZoom:c,maxZoom:d,nodeOrigin:f,nodeExtent:p,defaultNodes:t,defaultEdges:n,zIndexMode:g}),setNodes:S=>{const{nodeLookup:w,parentLookup:M,nodeOrigin:T,elevateNodesOnSelect:A,fitViewQueued:C,zIndexMode:D}=x(),R=I_(S,w,M,{nodeOrigin:T,nodeExtent:p,elevateNodesOnSelect:A,checkEquality:!0,zIndexMode:D});C&&R?(v(),y({nodes:S,nodesInitialized:R,fitViewQueued:!1,fitViewOptions:void 0})):y({nodes:S,nodesInitialized:R})},setEdges:S=>{const{connectionLookup:w,edgeLookup:M}=x();a3(w,M,S),y({edges:S})},setDefaultNodesAndEdges:(S,w)=>{if(S){const{setNodes:M}=x();M(S),y({hasDefaultNodes:!0})}if(w){const{setEdges:M}=x();M(w),y({hasDefaultEdges:!0})}},updateNodeInternals:S=>{const{triggerNodeChanges:w,nodeLookup:M,parentLookup:T,domNode:A,nodeOrigin:C,nodeExtent:D,debug:R,fitViewQueued:B,zIndexMode:L}=x(),{changes:X,updatedInternals:G}=kk(S,M,T,A,C,D,L);G&&(zk(M,T,{nodeOrigin:C,nodeExtent:D,zIndexMode:L}),B?(v(),y({fitViewQueued:!1,fitViewOptions:void 0})):y({}),(X==null?void 0:X.length)>0&&(R&&console.log("React Flow: trigger node changes",X),w==null||w(X)))},updateNodePositions:(S,w=!1)=>{const M=[];let T=[];const{nodeLookup:A,triggerNodeChanges:C,connection:D,updateConnection:R,onNodesChangeMiddlewareMap:B}=x();for(const[L,X]of S){const G=A.get(L),j=!!(G!=null&&G.expandParent&&(G!=null&&G.parentId)&&(X!=null&&X.position)),ee={id:L,type:"position",position:j?{x:Math.max(0,X.position.x),y:Math.max(0,X.position.y)}:X.position,dragging:w};if(G&&D.inProgress&&D.fromNode.id===G.id){const P=Kl(G,D.fromHandle,He.Left,!0);R({...D,from:P})}j&&G.parentId&&M.push({id:L,parentId:G.parentId,rect:{...X.internals.positionAbsolute,width:X.measured.width??0,height:X.measured.height??0}}),T.push(ee)}if(M.length>0){const{parentLookup:L,nodeOrigin:X}=x(),G=Gv(M,A,L,X);T.push(...G)}for(const L of B.values())T=L(T);C(T)},triggerNodeChanges:S=>{const{onNodesChange:w,setNodes:M,nodes:T,hasDefaultNodes:A,debug:C}=x();if(S!=null&&S.length){if(A){const D=v3(S,T);M(D)}C&&console.log("React Flow: trigger node changes",S),w==null||w(S)}},triggerEdgeChanges:S=>{const{onEdgesChange:w,setEdges:M,edges:T,hasDefaultEdges:A,debug:C}=x();if(S!=null&&S.length){if(A){const D=T3(S,T);M(D)}C&&console.log("React Flow: trigger edge changes",S),w==null||w(S)}},addSelectedNodes:S=>{const{multiSelectionActive:w,edgeLookup:M,nodeLookup:T,triggerNodeChanges:A,triggerEdgeChanges:C}=x();if(w){const D=S.map(R=>Dl(R,!0));A(D);return}A(_c(T,new Set([...S]),!0)),C(_c(M))},addSelectedEdges:S=>{const{multiSelectionActive:w,edgeLookup:M,nodeLookup:T,triggerNodeChanges:A,triggerEdgeChanges:C}=x();if(w){const D=S.map(R=>Dl(R,!0));C(D);return}C(_c(M,new Set([...S]))),A(_c(T,new Set,!0))},unselectNodesAndEdges:({nodes:S,edges:w}={})=>{const{edges:M,nodes:T,nodeLookup:A,triggerNodeChanges:C,triggerEdgeChanges:D}=x(),R=S||T,B=w||M,L=R.map(G=>{const j=A.get(G.id);return j&&(j.selected=!1),Dl(G.id,!1)}),X=B.map(G=>Dl(G.id,!1));C(L),D(X)},setMinZoom:S=>{const{panZoom:w,maxZoom:M}=x();w==null||w.setScaleExtent([S,M]),y({minZoom:S})},setMaxZoom:S=>{const{panZoom:w,minZoom:M}=x();w==null||w.setScaleExtent([M,S]),y({maxZoom:S})},setTranslateExtent:S=>{var w;(w=x().panZoom)==null||w.setTranslateExtent(S),y({translateExtent:S})},resetSelectedElements:()=>{const{edges:S,nodes:w,triggerNodeChanges:M,triggerEdgeChanges:T,elementsSelectable:A}=x();if(!A)return;const C=w.reduce((R,B)=>B.selected?[...R,Dl(B.id,!1)]:R,[]),D=S.reduce((R,B)=>B.selected?[...R,Dl(B.id,!1)]:R,[]);M(C),T(D)},setNodeExtent:S=>{const{nodes:w,nodeLookup:M,parentLookup:T,nodeOrigin:A,elevateNodesOnSelect:C,nodeExtent:D,zIndexMode:R}=x();S[0][0]===D[0][0]&&S[0][1]===D[0][1]&&S[1][0]===D[1][0]&&S[1][1]===D[1][1]||(I_(w,M,T,{nodeOrigin:A,nodeExtent:S,elevateNodesOnSelect:C,checkEquality:!1,zIndexMode:R}),y({nodeExtent:S}))},panBy:S=>{const{transform:w,width:M,height:T,panZoom:A,translateExtent:C}=x();return Gk({delta:S,panZoom:A,transform:w,translateExtent:C,width:M,height:T})},setCenter:async(S,w,M)=>{const{width:T,height:A,maxZoom:C,panZoom:D}=x();if(!D)return Promise.resolve(!1);const R=typeof(M==null?void 0:M.zoom)<"u"?M.zoom:C;return await D.setViewport({x:T/2-S*R,y:A/2-w*R,zoom:R},{duration:M==null?void 0:M.duration,ease:M==null?void 0:M.ease,interpolate:M==null?void 0:M.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{y({connection:{...kC}})},updateConnection:S=>{y({connection:S})},reset:()=>y({...r2()})}},Object.is);function q3({initialNodes:s,initialEdges:e,defaultNodes:t,defaultEdges:n,initialWidth:i,initialHeight:r,initialMinZoom:o,initialMaxZoom:u,initialFitViewOptions:c,fitView:d,nodeOrigin:f,nodeExtent:p,zIndexMode:g,children:y}){const[x]=se.useState(()=>r6({nodes:s,edges:e,defaultNodes:t,defaultEdges:n,width:i,height:r,fitView:d,minZoom:o,maxZoom:u,fitViewOptions:c,nodeOrigin:f,nodeExtent:p,zIndexMode:g}));return U.jsx(wG,{value:x,children:U.jsx(WG,{children:y})})}function a6({children:s,nodes:e,edges:t,defaultNodes:n,defaultEdges:i,width:r,height:o,fitView:u,fitViewOptions:c,minZoom:d,maxZoom:f,nodeOrigin:p,nodeExtent:g,zIndexMode:y}){return se.useContext(q0)?U.jsx(U.Fragment,{children:s}):U.jsx(q3,{initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:i,initialWidth:r,initialHeight:o,fitView:u,initialFitViewOptions:c,initialMinZoom:d,initialMaxZoom:f,nodeOrigin:p,nodeExtent:g,zIndexMode:y,children:s})}const o6={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function l6({nodes:s,edges:e,defaultNodes:t,defaultEdges:n,className:i,nodeTypes:r,edgeTypes:o,onNodeClick:u,onEdgeClick:c,onInit:d,onMove:f,onMoveStart:p,onMoveEnd:g,onConnect:y,onConnectStart:x,onConnectEnd:v,onClickConnectStart:S,onClickConnectEnd:w,onNodeMouseEnter:M,onNodeMouseMove:T,onNodeMouseLeave:A,onNodeContextMenu:C,onNodeDoubleClick:D,onNodeDragStart:R,onNodeDrag:B,onNodeDragStop:L,onNodesDelete:X,onEdgesDelete:G,onDelete:j,onSelectionChange:ee,onSelectionDragStart:P,onSelectionDrag:Y,onSelectionDragStop:F,onSelectionContextMenu:k,onSelectionStart:I,onSelectionEnd:$,onBeforeDelete:re,connectionMode:V,connectionLineType:q=Ao.Bezier,connectionLineStyle:he,connectionLineComponent:fe,connectionLineContainerStyle:W,deleteKeyCode:le="Backspace",selectionKeyCode:pe="Shift",selectionOnDrag:xe=!1,selectionMode:Me=rf.Full,panActivationKeyCode:Fe="Space",multiSelectionKeyCode:De=of()?"Meta":"Control",zoomActivationKeyCode:Le=of()?"Meta":"Control",snapToGrid:Ve,snapGrid:nt,onlyRenderVisibleElements:Dt=!1,selectNodesOnDrag:dt,nodesDraggable:Dn,autoPanOnNodeFocus:Ni,nodesConnectable:Os,nodesFocusable:Ai,nodeOrigin:Dr=b3,edgesFocusable:Zo,edgesReconnectable:Qo,elementsSelectable:Un=!0,defaultViewport:ou=zG,minZoom:Br=.5,maxZoom:Ua=2,translateExtent:Ko=sf,preventScrolling:$y=!0,nodeExtent:lu,defaultMarkerColor:Hy="#b1b1b7",zoomOnScroll:jy=!0,zoomOnPinch:Jo=!0,panOnScroll:is=!1,panOnScrollSpeed:Ki=.5,panOnScrollMode:rs=jl.Free,zoomOnDoubleClick:qy=!0,panOnDrag:Wy=!0,onPaneClick:Xy,onPaneMouseEnter:uu,onPaneMouseMove:cu,onPaneMouseLeave:hu,onPaneScroll:Lr,onPaneContextMenu:du,paneClickDistance:el=1,nodeClickDistance:Yy=0,children:Hf,onReconnect:ch,onReconnectStart:tl,onReconnectEnd:Zy,onEdgeContextMenu:jf,onEdgeDoubleClick:qf,onEdgeMouseEnter:Wf,onEdgeMouseMove:hh,onEdgeMouseLeave:dh,reconnectRadius:Xf=10,onNodesChange:Yf,onEdgesChange:Ji,noDragClassName:Nn="nodrag",noWheelClassName:Xn="nowheel",noPanClassName:Fr="nopan",fitView:fu,fitViewOptions:Zf,connectOnClick:Qy,attributionPosition:Qf,proOptions:nl,defaultEdgeOptions:fh,elevateNodesOnSelect:za=!0,elevateEdgesOnSelect:Va=!1,disableKeyboardA11y:Pa=!1,autoPanOnConnect:Ia,autoPanOnNodeDrag:mn,autoPanSpeed:Kf,connectionRadius:Jf,isValidConnection:Or,onError:ka,style:Ky,id:ph,nodeDragThreshold:ep,connectionDragThreshold:Jy,viewport:pu,onViewportChange:mu,width:Ei,height:gs,colorMode:tp="light",debug:ex,onScroll:Ga,ariaLabelConfig:np,zIndexMode:sl="basic",...tx},ys){const il=ph||"1",sp=kG(tp),mh=se.useCallback(Ur=>{Ur.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),Ga==null||Ga(Ur)},[Ga]);return U.jsx("div",{"data-testid":"rf__wrapper",...tx,onScroll:mh,style:{...Ky,...o6},ref:ys,className:wn(["react-flow",i,sp]),id:ph,role:"application",children:U.jsxs(a6,{nodes:s,edges:e,width:Ei,height:gs,fitView:fu,fitViewOptions:Zf,minZoom:Br,maxZoom:Ua,nodeOrigin:Dr,nodeExtent:lu,zIndexMode:sl,children:[U.jsx(i6,{onInit:d,onNodeClick:u,onEdgeClick:c,onNodeMouseEnter:M,onNodeMouseMove:T,onNodeMouseLeave:A,onNodeContextMenu:C,onNodeDoubleClick:D,nodeTypes:r,edgeTypes:o,connectionLineType:q,connectionLineStyle:he,connectionLineComponent:fe,connectionLineContainerStyle:W,selectionKeyCode:pe,selectionOnDrag:xe,selectionMode:Me,deleteKeyCode:le,multiSelectionKeyCode:De,panActivationKeyCode:Fe,zoomActivationKeyCode:Le,onlyRenderVisibleElements:Dt,defaultViewport:ou,translateExtent:Ko,minZoom:Br,maxZoom:Ua,preventScrolling:$y,zoomOnScroll:jy,zoomOnPinch:Jo,zoomOnDoubleClick:qy,panOnScroll:is,panOnScrollSpeed:Ki,panOnScrollMode:rs,panOnDrag:Wy,onPaneClick:Xy,onPaneMouseEnter:uu,onPaneMouseMove:cu,onPaneMouseLeave:hu,onPaneScroll:Lr,onPaneContextMenu:du,paneClickDistance:el,nodeClickDistance:Yy,onSelectionContextMenu:k,onSelectionStart:I,onSelectionEnd:$,onReconnect:ch,onReconnectStart:tl,onReconnectEnd:Zy,onEdgeContextMenu:jf,onEdgeDoubleClick:qf,onEdgeMouseEnter:Wf,onEdgeMouseMove:hh,onEdgeMouseLeave:dh,reconnectRadius:Xf,defaultMarkerColor:Hy,noDragClassName:Nn,noWheelClassName:Xn,noPanClassName:Fr,rfId:il,disableKeyboardA11y:Pa,nodeExtent:lu,viewport:pu,onViewportChange:mu}),U.jsx(IG,{nodes:s,edges:e,defaultNodes:t,defaultEdges:n,onConnect:y,onConnectStart:x,onConnectEnd:v,onClickConnectStart:S,onClickConnectEnd:w,nodesDraggable:Dn,autoPanOnNodeFocus:Ni,nodesConnectable:Os,nodesFocusable:Ai,edgesFocusable:Zo,edgesReconnectable:Qo,elementsSelectable:Un,elevateNodesOnSelect:za,elevateEdgesOnSelect:Va,minZoom:Br,maxZoom:Ua,nodeExtent:lu,onNodesChange:Yf,onEdgesChange:Ji,snapToGrid:Ve,snapGrid:nt,connectionMode:V,translateExtent:Ko,connectOnClick:Qy,defaultEdgeOptions:fh,fitView:fu,fitViewOptions:Zf,onNodesDelete:X,onEdgesDelete:G,onDelete:j,onNodeDragStart:R,onNodeDrag:B,onNodeDragStop:L,onSelectionDrag:Y,onSelectionDragStart:P,onSelectionDragStop:F,onMove:f,onMoveStart:p,onMoveEnd:g,noPanClassName:Fr,nodeOrigin:Dr,rfId:il,autoPanOnConnect:Ia,autoPanOnNodeDrag:mn,autoPanSpeed:Kf,onError:ka,connectionRadius:Jf,isValidConnection:Or,selectNodesOnDrag:dt,nodeDragThreshold:ep,connectionDragThreshold:Jy,onBeforeDelete:re,debug:ex,ariaLabelConfig:np,zIndexMode:sl}),U.jsx(UG,{onSelectionChange:ee}),Hf,U.jsx(DG,{proOptions:nl,position:Qf}),U.jsx(CG,{rfId:il,disableKeyboardA11y:Pa})]})})}var u6=S3(l6);const c6=s=>s.nodes;function h6(){return ht(c6,jt)}const d6=s=>s.edges;function f6(){return ht(d6,jt)}const p6=ji.error014();function jv({id:s,handleType:e,handleId:t,onConnect:n,onDisconnect:i}={}){const r=Hv(),o=s??r;if(!o)throw new Error(p6);const u=se.useRef(null),c=ht(d=>d.connectionLookup.get(`${o}${e?t?`-${e}-${t}`:`-${e}`:""}`),fk);return se.useEffect(()=>{if(u.current&&u.current!==c){const d=c??new Map;yE(u.current,d,i),yE(d,u.current,n)}u.current=c??new Map},[c,n,i]),se.useMemo(()=>Array.from((c==null?void 0:c.values())??[]),[c])}function m6({dimensions:s,lineWidth:e,variant:t,className:n}){return U.jsx("path",{strokeWidth:e,d:`M${s[0]/2} 0 V${s[1]} M0 ${s[1]/2} H${s[0]}`,className:wn(["react-flow__background-pattern",t,n])})}function g6({radius:s,className:e}){return U.jsx("circle",{cx:s,cy:s,r:s,className:wn(["react-flow__background-pattern","dots",e])})}var Uo;(function(s){s.Lines="lines",s.Dots="dots",s.Cross="cross"})(Uo||(Uo={}));const y6={[Uo.Dots]:1,[Uo.Lines]:1,[Uo.Cross]:6},x6=s=>({transform:s.transform,patternId:`pattern-${s.rfId}`});function W3({id:s,variant:e=Uo.Dots,gap:t=20,size:n,lineWidth:i=1,offset:r=0,color:o,bgColor:u,style:c,className:d,patternClassName:f}){const p=se.useRef(null),{transform:g,patternId:y}=ht(x6,jt),x=n||y6[e],v=e===Uo.Dots,S=e===Uo.Cross,w=Array.isArray(t)?t:[t,t],M=[w[0]*g[2]||1,w[1]*g[2]||1],T=x*g[2],A=Array.isArray(r)?r:[r,r],C=S?[T,T]:M,D=[A[0]*g[2]||1+C[0]/2,A[1]*g[2]||1+C[1]/2],R=`${y}${s||""}`;return U.jsxs("svg",{className:wn(["react-flow__background",d]),style:{...c,...W0,"--xy-background-color-props":u,"--xy-background-pattern-color-props":o},ref:p,"data-testid":"rf__background",children:[U.jsx("pattern",{id:R,x:g[0]%M[0],y:g[1]%M[1],width:M[0],height:M[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${D[0]},-${D[1]})`,children:v?U.jsx(g6,{radius:T/2,className:f}):U.jsx(m6,{dimensions:C,lineWidth:i,variant:e,className:f})}),U.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${R})`})]})}W3.displayName="Background";const b6=se.memo(W3);function _6(){return U.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:U.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function v6(){return U.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:U.jsx("path",{d:"M0 0h32v4.2H0z"})})}function T6(){return U.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:U.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function S6(){return U.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:U.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function w6(){return U.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:U.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function vm({children:s,className:e,...t}){return U.jsx("button",{type:"button",className:wn(["react-flow__controls-button",e]),...t,children:s})}const M6=s=>({isInteractive:s.nodesDraggable||s.nodesConnectable||s.elementsSelectable,minZoomReached:s.transform[2]<=s.minZoom,maxZoomReached:s.transform[2]>=s.maxZoom,ariaLabelConfig:s.ariaLabelConfig});function X3({style:s,showZoom:e=!0,showFitView:t=!0,showInteractive:n=!0,fitViewOptions:i,onZoomIn:r,onZoomOut:o,onFitView:u,onInteractiveChange:c,className:d,children:f,position:p="bottom-left",orientation:g="vertical","aria-label":y}){const x=tn(),{isInteractive:v,minZoomReached:S,maxZoomReached:w,ariaLabelConfig:M}=ht(M6,jt),{zoomIn:T,zoomOut:A,fitView:C}=Ef(),D=()=>{T(),r==null||r()},R=()=>{A(),o==null||o()},B=()=>{C(i),u==null||u()},L=()=>{x.setState({nodesDraggable:!v,nodesConnectable:!v,elementsSelectable:!v}),c==null||c(!v)},X=g==="horizontal"?"horizontal":"vertical";return U.jsxs(Wc,{className:wn(["react-flow__controls",X,d]),position:p,style:s,"data-testid":"rf__controls","aria-label":y??M["controls.ariaLabel"],children:[e&&U.jsxs(U.Fragment,{children:[U.jsx(vm,{onClick:D,className:"react-flow__controls-zoomin",title:M["controls.zoomIn.ariaLabel"],"aria-label":M["controls.zoomIn.ariaLabel"],disabled:w,children:U.jsx(_6,{})}),U.jsx(vm,{onClick:R,className:"react-flow__controls-zoomout",title:M["controls.zoomOut.ariaLabel"],"aria-label":M["controls.zoomOut.ariaLabel"],disabled:S,children:U.jsx(v6,{})})]}),t&&U.jsx(vm,{className:"react-flow__controls-fitview",onClick:B,title:M["controls.fitView.ariaLabel"],"aria-label":M["controls.fitView.ariaLabel"],children:U.jsx(T6,{})}),n&&U.jsx(vm,{className:"react-flow__controls-interactive",onClick:L,title:M["controls.interactive.ariaLabel"],"aria-label":M["controls.interactive.ariaLabel"],children:v?U.jsx(w6,{}):U.jsx(S6,{})}),f]})}X3.displayName="Controls";const N6=se.memo(X3);function A6({id:s,x:e,y:t,width:n,height:i,style:r,color:o,strokeColor:u,strokeWidth:c,className:d,borderRadius:f,shapeRendering:p,selected:g,onClick:y}){const{background:x,backgroundColor:v}=r||{},S=o||x||v;return U.jsx("rect",{className:wn(["react-flow__minimap-node",{selected:g},d]),x:e,y:t,rx:f,ry:f,width:n,height:i,style:{fill:S,stroke:u,strokeWidth:c},shapeRendering:p,onClick:y?w=>y(w,s):void 0})}const E6=se.memo(A6),R6=s=>s.nodes.map(e=>e.id),w1=s=>s instanceof Function?s:()=>s;function C6({nodeStrokeColor:s,nodeColor:e,nodeClassName:t="",nodeBorderRadius:n=5,nodeStrokeWidth:i,nodeComponent:r=E6,onClick:o}){const u=ht(R6,jt),c=w1(e),d=w1(s),f=w1(t),p=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return U.jsx(U.Fragment,{children:u.map(g=>U.jsx(B6,{id:g,nodeColorFunc:c,nodeStrokeColorFunc:d,nodeClassNameFunc:f,nodeBorderRadius:n,nodeStrokeWidth:i,NodeComponent:r,onClick:o,shapeRendering:p},g))})}function D6({id:s,nodeColorFunc:e,nodeStrokeColorFunc:t,nodeClassNameFunc:n,nodeBorderRadius:i,nodeStrokeWidth:r,shapeRendering:o,NodeComponent:u,onClick:c}){const{node:d,x:f,y:p,width:g,height:y}=ht(x=>{const{internals:v}=x.nodeLookup.get(s),S=v.userNode,{x:w,y:M}=v.positionAbsolute,{width:T,height:A}=Ba(S);return{node:S,x:w,y:M,width:T,height:A}},jt);return!d||d.hidden||!XC(d)?null:U.jsx(u,{x:f,y:p,width:g,height:y,style:d.style,selected:!!d.selected,className:n(d),color:e(d),borderRadius:i,strokeColor:t(d),strokeWidth:r,shapeRendering:o,onClick:c,id:d.id})}const B6=se.memo(D6);var L6=se.memo(C6);const F6=200,O6=150,U6=s=>!s.hidden,z6=s=>{const e={x:-s.transform[0]/s.transform[2],y:-s.transform[1]/s.transform[2],width:s.width/s.transform[2],height:s.height/s.transform[2]};return{viewBB:e,boundingRect:s.nodeLookup.size>0?WC(Mf(s.nodeLookup,{filter:U6}),e):e,rfId:s.rfId,panZoom:s.panZoom,translateExtent:s.translateExtent,flowWidth:s.width,flowHeight:s.height,ariaLabelConfig:s.ariaLabelConfig}},V6="react-flow__minimap-desc";function Y3({style:s,className:e,nodeStrokeColor:t,nodeColor:n,nodeClassName:i="",nodeBorderRadius:r=5,nodeStrokeWidth:o,nodeComponent:u,bgColor:c,maskColor:d,maskStrokeColor:f,maskStrokeWidth:p,position:g="bottom-right",onClick:y,onNodeClick:x,pannable:v=!1,zoomable:S=!1,ariaLabel:w,inversePan:M,zoomStep:T=1,offsetScale:A=5}){const C=tn(),D=se.useRef(null),{boundingRect:R,viewBB:B,rfId:L,panZoom:X,translateExtent:G,flowWidth:j,flowHeight:ee,ariaLabelConfig:P}=ht(z6,jt),Y=(s==null?void 0:s.width)??F6,F=(s==null?void 0:s.height)??O6,k=R.width/Y,I=R.height/F,$=Math.max(k,I),re=$*Y,V=$*F,q=A*$,he=R.x-(re-R.width)/2-q,fe=R.y-(V-R.height)/2-q,W=re+q*2,le=V+q*2,pe=`${V6}-${L}`,xe=se.useRef(0),Me=se.useRef();xe.current=$,se.useEffect(()=>{if(D.current&&X)return Me.current=Qk({domNode:D.current,panZoom:X,getTransform:()=>C.getState().transform,getViewScale:()=>xe.current}),()=>{var Ve;(Ve=Me.current)==null||Ve.destroy()}},[X]),se.useEffect(()=>{var Ve;(Ve=Me.current)==null||Ve.update({translateExtent:G,width:j,height:ee,inversePan:M,pannable:v,zoomStep:T,zoomable:S})},[v,S,M,T,G,j,ee]);const Fe=y?Ve=>{var dt;const[nt,Dt]=((dt=Me.current)==null?void 0:dt.pointer(Ve))||[0,0];y(Ve,{x:nt,y:Dt})}:void 0,De=x?se.useCallback((Ve,nt)=>{const Dt=C.getState().nodeLookup.get(nt).internals.userNode;x(Ve,Dt)},[]):void 0,Le=w??P["minimap.ariaLabel"];return U.jsx(Wc,{position:g,style:{...s,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-stroke-color-props":typeof f=="string"?f:void 0,"--xy-minimap-mask-stroke-width-props":typeof p=="number"?p*$:void 0,"--xy-minimap-node-background-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-color-props":typeof t=="string"?t:void 0,"--xy-minimap-node-stroke-width-props":typeof o=="number"?o:void 0},className:wn(["react-flow__minimap",e]),"data-testid":"rf__minimap",children:U.jsxs("svg",{width:Y,height:F,viewBox:`${he} ${fe} ${W} ${le}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":pe,ref:D,onClick:Fe,children:[Le&&U.jsx("title",{id:pe,children:Le}),U.jsx(L6,{onClick:De,nodeColor:n,nodeStrokeColor:t,nodeBorderRadius:r,nodeClassName:i,nodeStrokeWidth:o,nodeComponent:u}),U.jsx("path",{className:"react-flow__minimap-mask",d:`M${he-q},${fe-q}h${W+q*2}v${le+q*2}h${-W-q*2}z
        M${B.x},${B.y}h${B.width}v${B.height}h${-B.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}Y3.displayName="MiniMap";se.memo(Y3);const P6=s=>e=>s?`${Math.max(1/e.transform[2],1)}`:void 0,I6={[qc.Line]:"right",[qc.Handle]:"bottom-right"};function k6({nodeId:s,position:e,variant:t=qc.Handle,className:n,style:i=void 0,children:r,color:o,minWidth:u=10,minHeight:c=10,maxWidth:d=Number.MAX_VALUE,maxHeight:f=Number.MAX_VALUE,keepAspectRatio:p=!1,resizeDirection:g,autoScale:y=!0,shouldResize:x,onResizeStart:v,onResize:S,onResizeEnd:w}){const M=Hv(),T=typeof s=="string"?s:M,A=tn(),C=se.useRef(null),D=t===qc.Handle,R=ht(se.useCallback(P6(D&&y),[D,y]),jt),B=se.useRef(null),L=e??I6[t];se.useEffect(()=>{if(!(!C.current||!T))return B.current||(B.current=hG({domNode:C.current,nodeId:T,getStoreItems:()=>{const{nodeLookup:G,transform:j,snapGrid:ee,snapToGrid:P,nodeOrigin:Y,domNode:F}=A.getState();return{nodeLookup:G,transform:j,snapGrid:ee,snapToGrid:P,nodeOrigin:Y,paneDomNode:F}},onChange:(G,j)=>{const{triggerNodeChanges:ee,nodeLookup:P,parentLookup:Y,nodeOrigin:F}=A.getState(),k=[],I={x:G.x,y:G.y},$=P.get(T);if($&&$.expandParent&&$.parentId){const re=$.origin??F,V=G.width??$.measured.width??0,q=G.height??$.measured.height??0,he={id:$.id,parentId:$.parentId,rect:{width:V,height:q,...YC({x:G.x??$.position.x,y:G.y??$.position.y},{width:V,height:q},$.parentId,P,re)}},fe=Gv([he],P,Y,F);k.push(...fe),I.x=G.x?Math.max(re[0]*V,G.x):void 0,I.y=G.y?Math.max(re[1]*q,G.y):void 0}if(I.x!==void 0&&I.y!==void 0){const re={id:T,type:"position",position:{...I}};k.push(re)}if(G.width!==void 0&&G.height!==void 0){const V={id:T,type:"dimensions",resizing:!0,setAttributes:g?g==="horizontal"?"width":"height":!0,dimensions:{width:G.width,height:G.height}};k.push(V)}for(const re of j){const V={...re,type:"position"};k.push(V)}ee(k)},onEnd:({width:G,height:j})=>{const ee={id:T,type:"dimensions",resizing:!1,dimensions:{width:G,height:j}};A.getState().triggerNodeChanges([ee])}})),B.current.update({controlPosition:L,boundaries:{minWidth:u,minHeight:c,maxWidth:d,maxHeight:f},keepAspectRatio:p,resizeDirection:g,onResizeStart:v,onResize:S,onResizeEnd:w,shouldResize:x}),()=>{var G;(G=B.current)==null||G.destroy()}},[L,u,c,d,f,p,v,S,w,x]);const X=L.split("-");return U.jsx("div",{className:wn(["react-flow__resize-control","nodrag",...X,t,n]),ref:C,style:{...i,scale:R,...o&&{[D?"backgroundColor":"borderColor"]:o}},children:r})}se.memo(k6);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G6=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Z3=(...s)=>s.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var $6={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H6=se.forwardRef(({color:s="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:i="",children:r,iconNode:o,...u},c)=>se.createElement("svg",{ref:c,...$6,width:e,height:e,stroke:s,strokeWidth:n?Number(t)*24/Number(e):t,className:Z3("lucide",i),...u},[...o.map(([d,f])=>se.createElement(d,f)),...Array.isArray(r)?r:[r]]));/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=(s,e)=>{const t=se.forwardRef(({className:n,...i},r)=>se.createElement(H6,{ref:r,iconNode:e,className:Z3(`lucide-${G6(s)}`,n),...i}));return t.displayName=`${s}`,t};/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zl=Ze("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wo=Ze("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j6=Ze("ArrowUpLeft",[["path",{d:"M7 17V7h10",key:"11bw93"}],["path",{d:"M17 17 7 7",key:"2786uv"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q6=Ze("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uf=Ze("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W6=Ze("Boxes",[["path",{d:"M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z",key:"lc1i9w"}],["path",{d:"m7 16.5-4.74-2.85",key:"1o9zyk"}],["path",{d:"m7 16.5 5-3",key:"va8pkn"}],["path",{d:"M7 16.5v5.17",key:"jnp8gn"}],["path",{d:"M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z",key:"8zsnat"}],["path",{d:"m17 16.5-5-3",key:"8arw3v"}],["path",{d:"m17 16.5 4.74-2.85",key:"8rfmw"}],["path",{d:"M17 16.5v5.17",key:"k6z78m"}],["path",{d:"M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z",key:"1xygjf"}],["path",{d:"M12 8 7.26 5.15",key:"1vbdud"}],["path",{d:"m12 8 4.74-2.85",key:"3rx089"}],["path",{d:"M12 13.5V8",key:"1io7kd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X6=Ze("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y6=Ze("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qv=Ze("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q3=Ze("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z6=Ze("Combine",[["path",{d:"M10 18H5a3 3 0 0 1-3-3v-1",key:"ru65g8"}],["path",{d:"M14 2a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2",key:"e30een"}],["path",{d:"M20 2a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2",key:"2ahx8o"}],["path",{d:"m7 21 3-3-3-3",key:"127cv2"}],["rect",{x:"14",y:"14",width:"8",height:"8",rx:"2",key:"1b0bso"}],["rect",{x:"2",y:"2",width:"8",height:"8",rx:"2",key:"1x09vl"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q6=Ze("Compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K6=Ze("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J6=Ze("Disc",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a2=Ze("Divide",[["circle",{cx:"12",cy:"6",r:"1",key:"1bh7o1"}],["line",{x1:"5",x2:"19",y1:"12",y2:"12",key:"13b5wn"}],["circle",{cx:"12",cy:"18",r:"1",key:"lqb9t5"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K3=Ze("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e8=Ze("FileCode",[["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t8=Ze("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n8=Ze("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cf=Ze("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s8=Ze("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J3=Ze("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wv=Ze("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i8=Ze("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y0=Ze("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eD=Ze("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rf=Ze("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r8=Ze("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o2=Ze("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l2=Ze("Move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a8=Ze("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tD=Ze("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o8=Ze("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l8=Ze("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u8=Ze("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u2=Ze("Scaling",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M14 15H9v-5",key:"pi4jk9"}],["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M21 3 9 15",key:"15kdhq"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nD=Ze("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c8=Ze("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h8=Ze("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d8=Ze("Split",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f8=Ze("SquareDashed",[["path",{d:"M5 3a2 2 0 0 0-2 2",key:"y57alp"}],["path",{d:"M19 3a2 2 0 0 1 2 2",key:"18rm91"}],["path",{d:"M21 19a2 2 0 0 1-2 2",key:"1j7049"}],["path",{d:"M5 21a2 2 0 0 1-2-2",key:"sbafld"}],["path",{d:"M9 3h1",key:"1yesri"}],["path",{d:"M9 21h1",key:"15o7lz"}],["path",{d:"M14 3h1",key:"1ec4yj"}],["path",{d:"M14 21h1",key:"v9vybs"}],["path",{d:"M3 9v1",key:"1r0deq"}],["path",{d:"M21 9v1",key:"mxsmne"}],["path",{d:"M3 14v1",key:"vnatye"}],["path",{d:"M21 14v1",key:"169vum"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p8=Ze("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m8=Ze("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g8=Ze("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c2=Ze("Triangle",[["path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"14u9p9"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y8=Ze("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x8=Ze("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ec=Ze("Waves",[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xv=Ze("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ug=Ze("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Cf="182",Rc={ROTATE:0,DOLLY:1,PAN:2},vc={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},b8=0,_8=1,v8=2,T8=0,S8=1,w8=2,mg=3,zo=0,ns=1,ql=2,Xc=0,ya=1,zg=2,Vg=3,Pg=4,Ud=5,Pi=100,sD=101,iD=102,M8=103,N8=104,Mo=200,rD=201,aD=202,oD=203,Ig=204,kg=205,lD=206,uD=207,cD=208,hD=209,dD=210,fD=0,pD=1,mD=2,Gg=3,gD=4,yD=5,xD=6,bD=7,Z0=0,A8=1,E8=2,Lo=0,R8=1,_D=2,C8=3,D8=4,B8=6,L8=7,Yv=300,Yc=301,$g=302,Q0=303,Zv=304,$_=306,Io=1e3,mr=1001,Zc=1002,hn=1003,vD=1004,hf=1005,ms=1006,H_=1007,xa=1008,F8=1008,es=1009,Cc=1010,Dc=1011,Vl=1012,Kn=1013,rn=1014,Ns=1015,Gn=1016,TD=1017,SD=1018,Vo=1020,Qv=35902,Kv=35899,wD=1021,K0=1022,Zs=1023,Hi=1026,ba=1027,J0=1028,ey=1029,gr=1030,ty=1031,O8=1032,ny=1033,zd=33776,Vd=33777,Pd=33778,Id=33779,j_=35840,q_=35841,W_=35842,X_=35843,Hg=36196,jg=37492,qg=37496,Wg=37488,Xg=37489,df=37490,Yg=37491,Zg=37808,Qg=37809,Kg=37810,Jg=37811,e0=37812,t0=37813,n0=37814,s0=37815,i0=37816,r0=37817,a0=37818,o0=37819,l0=37820,u0=37821,c0=36492,U8=36494,z8=36495,h0=36283,d0=36284,ff=36285,f0=36286,_a=0,V8=1,ko="",cs="srgb",p0="srgb-linear",m0="linear",Ke="srgb",M1="",MD="rg",P8="ga",I8=0,Bl=7680,k8=7681,G8=7682,$8=7683,H8=34055,j8=34056,q8=5386,W8=512,X8=513,Y8=514,Z8=515,Q8=516,K8=517,J8=518,Y_=519,ND=512,sy=513,AD=514,ED=515,RD=516,CD=517,DD=518,BD=519,Qc=35044,Pl=35048,Qs=2e3,xi=2001,yr={COMPUTE:"compute",RENDER:"render"};function LD(s){for(let e=s.length-1;e>=0;--e)if(s[e]>=65535)return!0;return!1}function g0(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function y0(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}function e9(){const s=y0("canvas");return s.style.display="block",s}const h2={};function Z_(...s){const e="THREE."+s.shift();console.log(e,...s)}function Ne(...s){const e="THREE."+s.shift();console.warn(e,...s)}function Ae(...s){const e="THREE."+s.shift();console.error(e,...s)}function $t(...s){const e=s.join(" ");e in h2||(h2[e]=!0,Ne(...s))}class Er{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const i=n[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,e);e.target=null}}}const Zn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let d2=1234567;const kd=Math.PI/180,Kc=180/Math.PI;function va(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Zn[s&255]+Zn[s>>8&255]+Zn[s>>16&255]+Zn[s>>24&255]+"-"+Zn[e&255]+Zn[e>>8&255]+"-"+Zn[e>>16&15|64]+Zn[e>>24&255]+"-"+Zn[t&63|128]+Zn[t>>8&255]+"-"+Zn[t>>16&255]+Zn[t>>24&255]+Zn[n&255]+Zn[n>>8&255]+Zn[n>>16&255]+Zn[n>>24&255]).toLowerCase()}function it(s,e,t){return Math.max(e,Math.min(t,s))}function Jv(s,e){return(s%e+e)%e}function t9(s,e,t,n,i){return n+(s-e)*(i-n)/(t-e)}function n9(s,e,t){return s!==e?(t-s)/(e-s):0}function Gd(s,e,t){return(1-t)*s+t*e}function s9(s,e,t,n){return Gd(s,e,1-Math.exp(-t*n))}function i9(s,e=1){return e-Math.abs(Jv(s,e*2)-e)}function r9(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function a9(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function o9(s,e){return s+Math.floor(Math.random()*(e-s+1))}function l9(s,e){return s+Math.random()*(e-s)}function u9(s){return s*(.5-Math.random())}function c9(s){s!==void 0&&(d2=s);let e=d2+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function h9(s){return s*kd}function d9(s){return s*Kc}function f9(s){return(s&s-1)===0&&s!==0}function p9(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function m9(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function g9(s,e,t,n,i){const r=Math.cos,o=Math.sin,u=r(t/2),c=o(t/2),d=r((e+n)/2),f=o((e+n)/2),p=r((e-n)/2),g=o((e-n)/2),y=r((n-e)/2),x=o((n-e)/2);switch(i){case"XYX":s.set(u*f,c*p,c*g,u*d);break;case"YZY":s.set(c*g,u*f,c*p,u*d);break;case"ZXZ":s.set(c*p,c*g,u*f,u*d);break;case"XZX":s.set(u*f,c*x,c*y,u*d);break;case"YXY":s.set(c*y,u*f,c*x,u*d);break;case"ZYZ":s.set(c*x,c*y,u*f,u*d);break;default:Ne("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function ds(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function tt(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const eT={DEG2RAD:kd,RAD2DEG:Kc,generateUUID:va,clamp:it,euclideanModulo:Jv,mapLinear:t9,inverseLerp:n9,lerp:Gd,damp:s9,pingpong:i9,smoothstep:r9,smootherstep:a9,randInt:o9,randFloat:l9,randFloatSpread:u9,seededRandom:c9,degToRad:h9,radToDeg:d9,isPowerOfTwo:f9,ceilPowerOfTwo:p9,floorPowerOfTwo:m9,setQuaternionFromProperEuler:g9,normalize:tt,denormalize:ds};class Ge{constructor(e=0,t=0){Ge.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=it(this.x,e.x,t.x),this.y=it(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=it(this.x,e,t),this.y=it(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(it(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(it(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Go{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,o,u){let c=n[i+0],d=n[i+1],f=n[i+2],p=n[i+3],g=r[o+0],y=r[o+1],x=r[o+2],v=r[o+3];if(u<=0){e[t+0]=c,e[t+1]=d,e[t+2]=f,e[t+3]=p;return}if(u>=1){e[t+0]=g,e[t+1]=y,e[t+2]=x,e[t+3]=v;return}if(p!==v||c!==g||d!==y||f!==x){let S=c*g+d*y+f*x+p*v;S<0&&(g=-g,y=-y,x=-x,v=-v,S=-S);let w=1-u;if(S<.9995){const M=Math.acos(S),T=Math.sin(M);w=Math.sin(w*M)/T,u=Math.sin(u*M)/T,c=c*w+g*u,d=d*w+y*u,f=f*w+x*u,p=p*w+v*u}else{c=c*w+g*u,d=d*w+y*u,f=f*w+x*u,p=p*w+v*u;const M=1/Math.sqrt(c*c+d*d+f*f+p*p);c*=M,d*=M,f*=M,p*=M}}e[t]=c,e[t+1]=d,e[t+2]=f,e[t+3]=p}static multiplyQuaternionsFlat(e,t,n,i,r,o){const u=n[i],c=n[i+1],d=n[i+2],f=n[i+3],p=r[o],g=r[o+1],y=r[o+2],x=r[o+3];return e[t]=u*x+f*p+c*y-d*g,e[t+1]=c*x+f*g+d*p-u*y,e[t+2]=d*x+f*y+u*g-c*p,e[t+3]=f*x-u*p-c*g-d*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,r=e._z,o=e._order,u=Math.cos,c=Math.sin,d=u(n/2),f=u(i/2),p=u(r/2),g=c(n/2),y=c(i/2),x=c(r/2);switch(o){case"XYZ":this._x=g*f*p+d*y*x,this._y=d*y*p-g*f*x,this._z=d*f*x+g*y*p,this._w=d*f*p-g*y*x;break;case"YXZ":this._x=g*f*p+d*y*x,this._y=d*y*p-g*f*x,this._z=d*f*x-g*y*p,this._w=d*f*p+g*y*x;break;case"ZXY":this._x=g*f*p-d*y*x,this._y=d*y*p+g*f*x,this._z=d*f*x+g*y*p,this._w=d*f*p-g*y*x;break;case"ZYX":this._x=g*f*p-d*y*x,this._y=d*y*p+g*f*x,this._z=d*f*x-g*y*p,this._w=d*f*p+g*y*x;break;case"YZX":this._x=g*f*p+d*y*x,this._y=d*y*p+g*f*x,this._z=d*f*x-g*y*p,this._w=d*f*p-g*y*x;break;case"XZY":this._x=g*f*p-d*y*x,this._y=d*y*p-g*f*x,this._z=d*f*x+g*y*p,this._w=d*f*p+g*y*x;break;default:Ne("Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],u=t[5],c=t[9],d=t[2],f=t[6],p=t[10],g=n+u+p;if(g>0){const y=.5/Math.sqrt(g+1);this._w=.25/y,this._x=(f-c)*y,this._y=(r-d)*y,this._z=(o-i)*y}else if(n>u&&n>p){const y=2*Math.sqrt(1+n-u-p);this._w=(f-c)/y,this._x=.25*y,this._y=(i+o)/y,this._z=(r+d)/y}else if(u>p){const y=2*Math.sqrt(1+u-n-p);this._w=(r-d)/y,this._x=(i+o)/y,this._y=.25*y,this._z=(c+f)/y}else{const y=2*Math.sqrt(1+p-n-u);this._w=(o-i)/y,this._x=(r+d)/y,this._y=(c+f)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(it(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,u=t._x,c=t._y,d=t._z,f=t._w;return this._x=n*f+o*u+i*d-r*c,this._y=i*f+o*c+r*u-n*d,this._z=r*f+o*d+n*c-i*u,this._w=o*f-n*u-i*c-r*d,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let n=e._x,i=e._y,r=e._z,o=e._w,u=this.dot(e);u<0&&(n=-n,i=-i,r=-r,o=-o,u=-u);let c=1-t;if(u<.9995){const d=Math.acos(u),f=Math.sin(d);c=Math.sin(c*d)/f,t=Math.sin(t*d)/f,this._x=this._x*c+n*t,this._y=this._y*c+i*t,this._z=this._z*c+r*t,this._w=this._w*c+o*t,this._onChangeCallback()}else this._x=this._x*c+n*t,this._y=this._y*c+i*t,this._z=this._z*c+r*t,this._w=this._w*c+o*t,this.normalize();return this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class J{constructor(e=0,t=0,n=0){J.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(f2.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(f2.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,u=e.z,c=e.w,d=2*(o*i-u*n),f=2*(u*t-r*i),p=2*(r*n-o*t);return this.x=t+c*d+o*p-u*f,this.y=n+c*f+u*d-r*p,this.z=i+c*p+r*f-o*d,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=it(this.x,e.x,t.x),this.y=it(this.y,e.y,t.y),this.z=it(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=it(this.x,e,t),this.y=it(this.y,e,t),this.z=it(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(it(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,u=t.y,c=t.z;return this.x=i*c-r*u,this.y=r*o-n*c,this.z=n*u-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return N1.copy(this).projectOnVector(e),this.sub(N1)}reflect(e){return this.sub(N1.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(it(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const N1=new J,f2=new Go;class Fs{constructor(e,t,n,i,r,o,u,c,d){Fs.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,i,r,o,u,c,d)}set(e,t,n,i,r,o,u,c,d){const f=this.elements;return f[0]=e,f[1]=i,f[2]=u,f[3]=t,f[4]=r,f[5]=c,f[6]=n,f[7]=o,f[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],u=n[3],c=n[6],d=n[1],f=n[4],p=n[7],g=n[2],y=n[5],x=n[8],v=i[0],S=i[3],w=i[6],M=i[1],T=i[4],A=i[7],C=i[2],D=i[5],R=i[8];return r[0]=o*v+u*M+c*C,r[3]=o*S+u*T+c*D,r[6]=o*w+u*A+c*R,r[1]=d*v+f*M+p*C,r[4]=d*S+f*T+p*D,r[7]=d*w+f*A+p*R,r[2]=g*v+y*M+x*C,r[5]=g*S+y*T+x*D,r[8]=g*w+y*A+x*R,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],u=e[5],c=e[6],d=e[7],f=e[8];return t*o*f-t*u*d-n*r*f+n*u*c+i*r*d-i*o*c}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],u=e[5],c=e[6],d=e[7],f=e[8],p=f*o-u*d,g=u*c-f*r,y=d*r-o*c,x=t*p+n*g+i*y;if(x===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/x;return e[0]=p*v,e[1]=(i*d-f*n)*v,e[2]=(u*n-i*o)*v,e[3]=g*v,e[4]=(f*t-i*c)*v,e[5]=(i*r-u*t)*v,e[6]=y*v,e[7]=(n*c-d*t)*v,e[8]=(o*t-n*r)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,u){const c=Math.cos(r),d=Math.sin(r);return this.set(n*c,n*d,-n*(c*o+d*u)+o+e,-i*d,i*c,-i*(-d*o+c*u)+u+t,0,0,1),this}scale(e,t){return this.premultiply(A1.makeScale(e,t)),this}rotate(e){return this.premultiply(A1.makeRotation(-e)),this}translate(e,t){return this.premultiply(A1.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const A1=new Fs,p2=new Fs().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),m2=new Fs().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function y9(){const s={enabled:!0,workingColorSpace:p0,spaces:{},convert:function(i,r,o){return this.enabled===!1||r===o||!r||!o||(this.spaces[r].transfer===Ke&&(i.r=Ta(i.r),i.g=Ta(i.g),i.b=Ta(i.b)),this.spaces[r].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[r].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Ke&&(i.r=Bc(i.r),i.g=Bc(i.g),i.b=Bc(i.b))),i},workingToColorSpace:function(i,r){return this.convert(i,this.workingColorSpace,r)},colorSpaceToWorking:function(i,r){return this.convert(i,r,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===ko?m0:this.spaces[i].transfer},getToneMappingMode:function(i){return this.spaces[i].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(i,r=this.workingColorSpace){return i.fromArray(this.spaces[r].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,r,o){return i.copy(this.spaces[r].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,r){return $t("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),s.workingToColorSpace(i,r)},toWorkingColorSpace:function(i,r){return $t("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),s.colorSpaceToWorking(i,r)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return s.define({[p0]:{primaries:e,whitePoint:n,transfer:m0,toXYZ:p2,fromXYZ:m2,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:cs},outputColorSpaceConfig:{drawingBufferColorSpace:cs}},[cs]:{primaries:e,whitePoint:n,transfer:Ke,toXYZ:p2,fromXYZ:m2,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:cs}}}),s}const bt=y9();function Ta(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function Bc(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}let Yu;class x9{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{Yu===void 0&&(Yu=y0("canvas")),Yu.width=e.width,Yu.height=e.height;const i=Yu.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=Yu}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=y0("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let o=0;o<r.length;o++)r[o]=Ta(r[o]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Ta(t[n]/255)*255):t[n]=Ta(t[n]);return{data:t,width:e.width,height:e.height}}else return Ne("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let b9=0;class tT{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:b9++}),this.uuid=va(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):typeof VideoFrame<"u"&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let r;if(Array.isArray(i)){r=[];for(let o=0,u=i.length;o<u;o++)i[o].isDataTexture?r.push(E1(i[o].image)):r.push(E1(i[o]))}else r=E1(i);n.url=r}return t||(e.images[this.uuid]=n),n}}function E1(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?x9.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(Ne("Texture: Unable to serialize Texture."),{})}let _9=0;const R1=new J;class jn extends Er{constructor(e=jn.DEFAULT_IMAGE,t=jn.DEFAULT_MAPPING,n=mr,i=mr,r=ms,o=xa,u=Zs,c=es,d=jn.DEFAULT_ANISOTROPY,f=ko){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_9++}),this.uuid=va(),this.name="",this.source=new tT(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=d,this.format=u,this.internalFormat=null,this.type=c,this.offset=new Ge(0,0),this.repeat=new Ge(1,1),this.center=new Ge(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Fs,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=f,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(R1).x}get height(){return this.source.getSize(R1).y}get depth(){return this.source.getSize(R1).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){Ne(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){Ne(`Texture.setValues(): property '${t}' does not exist.`);continue}i&&n&&i.isVector2&&n.isVector2||i&&n&&i.isVector3&&n.isVector3||i&&n&&i.isMatrix3&&n.isMatrix3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Yv)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Io:e.x=e.x-Math.floor(e.x);break;case mr:e.x=e.x<0?0:1;break;case Zc:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Io:e.y=e.y-Math.floor(e.y);break;case mr:e.y=e.y<0?0:1;break;case Zc:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}jn.DEFAULT_IMAGE=null;jn.DEFAULT_MAPPING=Yv;jn.DEFAULT_ANISOTROPY=1;class yt{constructor(e=0,t=0,n=0,i=1){yt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const c=e.elements,d=c[0],f=c[4],p=c[8],g=c[1],y=c[5],x=c[9],v=c[2],S=c[6],w=c[10];if(Math.abs(f-g)<.01&&Math.abs(p-v)<.01&&Math.abs(x-S)<.01){if(Math.abs(f+g)<.1&&Math.abs(p+v)<.1&&Math.abs(x+S)<.1&&Math.abs(d+y+w-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const T=(d+1)/2,A=(y+1)/2,C=(w+1)/2,D=(f+g)/4,R=(p+v)/4,B=(x+S)/4;return T>A&&T>C?T<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(T),i=D/n,r=R/n):A>C?A<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(A),n=D/i,r=B/i):C<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(C),n=R/r,i=B/r),this.set(n,i,r,t),this}let M=Math.sqrt((S-x)*(S-x)+(p-v)*(p-v)+(g-f)*(g-f));return Math.abs(M)<.001&&(M=1),this.x=(S-x)/M,this.y=(p-v)/M,this.z=(g-f)/M,this.w=Math.acos((d+y+w-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=it(this.x,e.x,t.x),this.y=it(this.y,e.y,t.y),this.z=it(this.z,e.z,t.z),this.w=it(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=it(this.x,e,t),this.y=it(this.y,e,t),this.z=it(this.z,e,t),this.w=it(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(it(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class La extends Er{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ms,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new yt(0,0,e,t),this.scissorTest=!1,this.viewport=new yt(0,0,e,t);const i={width:e,height:t,depth:n.depth},r=new jn(i);this.textures=[];const o=n.count;for(let u=0;u<o;u++)this.textures[u]=r.clone(),this.textures[u].isRenderTargetTexture=!0,this.textures[u].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:ms,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n,this.textures[i].isData3DTexture!==!0&&(this.textures[i].isArrayTexture=this.textures[i].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new tT(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class v9 extends La{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class T9 extends jn{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=hn,this.minFilter=hn,this.wrapR=mr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Df{constructor(e=new J(1/0,1/0,1/0),t=new J(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Bi.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Bi.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Bi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const r=n.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let o=0,u=r.count;o<u;o++)e.isMesh===!0?e.getVertexPosition(o,Bi):Bi.fromBufferAttribute(r,o),Bi.applyMatrix4(e.matrixWorld),this.expandByPoint(Bi);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Tm.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),Tm.copy(n.boundingBox)),Tm.applyMatrix4(e.matrixWorld),this.union(Tm)}const i=e.children;for(let r=0,o=i.length;r<o;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Bi),Bi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(od),Sm.subVectors(this.max,od),Zu.subVectors(e.a,od),Qu.subVectors(e.b,od),Ku.subVectors(e.c,od),mo.subVectors(Qu,Zu),go.subVectors(Ku,Qu),vl.subVectors(Zu,Ku);let t=[0,-mo.z,mo.y,0,-go.z,go.y,0,-vl.z,vl.y,mo.z,0,-mo.x,go.z,0,-go.x,vl.z,0,-vl.x,-mo.y,mo.x,0,-go.y,go.x,0,-vl.y,vl.x,0];return!C1(t,Zu,Qu,Ku,Sm)||(t=[1,0,0,0,1,0,0,0,1],!C1(t,Zu,Qu,Ku,Sm))?!1:(wm.crossVectors(mo,go),t=[wm.x,wm.y,wm.z],C1(t,Zu,Qu,Ku,Sm))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Bi).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Bi).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(ta[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ta[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ta[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ta[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ta[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ta[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ta[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ta[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ta),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const ta=[new J,new J,new J,new J,new J,new J,new J,new J],Bi=new J,Tm=new Df,Zu=new J,Qu=new J,Ku=new J,mo=new J,go=new J,vl=new J,od=new J,Sm=new J,wm=new J,Tl=new J;function C1(s,e,t,n,i){for(let r=0,o=s.length-3;r<=o;r+=3){Tl.fromArray(s,r);const u=i.x*Math.abs(Tl.x)+i.y*Math.abs(Tl.y)+i.z*Math.abs(Tl.z),c=e.dot(Tl),d=t.dot(Tl),f=n.dot(Tl);if(Math.max(-Math.max(c,d,f),Math.min(c,d,f))>u)return!1}return!0}const S9=new Df,ld=new J,D1=new J;class iy{constructor(e=new J,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):S9.setFromPoints(e).getCenter(n);let i=0;for(let r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ld.subVectors(e,this.center);const t=ld.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(ld,i/n),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(D1.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(ld.copy(e.center).add(D1)),this.expandByPoint(ld.copy(e.center).sub(D1))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const na=new J,B1=new J,Mm=new J,yo=new J,L1=new J,Nm=new J,F1=new J;class FD{constructor(e=new J,t=new J(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,na)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=na.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(na.copy(this.origin).addScaledVector(this.direction,t),na.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){B1.copy(e).add(t).multiplyScalar(.5),Mm.copy(t).sub(e).normalize(),yo.copy(this.origin).sub(B1);const r=e.distanceTo(t)*.5,o=-this.direction.dot(Mm),u=yo.dot(this.direction),c=-yo.dot(Mm),d=yo.lengthSq(),f=Math.abs(1-o*o);let p,g,y,x;if(f>0)if(p=o*c-u,g=o*u-c,x=r*f,p>=0)if(g>=-x)if(g<=x){const v=1/f;p*=v,g*=v,y=p*(p+o*g+2*u)+g*(o*p+g+2*c)+d}else g=r,p=Math.max(0,-(o*g+u)),y=-p*p+g*(g+2*c)+d;else g=-r,p=Math.max(0,-(o*g+u)),y=-p*p+g*(g+2*c)+d;else g<=-x?(p=Math.max(0,-(-o*r+u)),g=p>0?-r:Math.min(Math.max(-r,-c),r),y=-p*p+g*(g+2*c)+d):g<=x?(p=0,g=Math.min(Math.max(-r,-c),r),y=g*(g+2*c)+d):(p=Math.max(0,-(o*r+u)),g=p>0?r:Math.min(Math.max(-r,-c),r),y=-p*p+g*(g+2*c)+d);else g=o>0?-r:r,p=Math.max(0,-(o*g+u)),y=-p*p+g*(g+2*c)+d;return n&&n.copy(this.origin).addScaledVector(this.direction,p),i&&i.copy(B1).addScaledVector(Mm,g),y}intersectSphere(e,t){na.subVectors(e.center,this.origin);const n=na.dot(this.direction),i=na.dot(na)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),u=n-o,c=n+o;return c<0?null:u<0?this.at(c,t):this.at(u,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,u,c;const d=1/this.direction.x,f=1/this.direction.y,p=1/this.direction.z,g=this.origin;return d>=0?(n=(e.min.x-g.x)*d,i=(e.max.x-g.x)*d):(n=(e.max.x-g.x)*d,i=(e.min.x-g.x)*d),f>=0?(r=(e.min.y-g.y)*f,o=(e.max.y-g.y)*f):(r=(e.max.y-g.y)*f,o=(e.min.y-g.y)*f),n>o||r>i||((r>n||isNaN(n))&&(n=r),(o<i||isNaN(i))&&(i=o),p>=0?(u=(e.min.z-g.z)*p,c=(e.max.z-g.z)*p):(u=(e.max.z-g.z)*p,c=(e.min.z-g.z)*p),n>c||u>i)||((u>n||n!==n)&&(n=u),(c<i||i!==i)&&(i=c),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,na)!==null}intersectTriangle(e,t,n,i,r){L1.subVectors(t,e),Nm.subVectors(n,e),F1.crossVectors(L1,Nm);let o=this.direction.dot(F1),u;if(o>0){if(i)return null;u=1}else if(o<0)u=-1,o=-o;else return null;yo.subVectors(this.origin,e);const c=u*this.direction.dot(Nm.crossVectors(yo,Nm));if(c<0)return null;const d=u*this.direction.dot(L1.cross(yo));if(d<0||c+d>o)return null;const f=-u*yo.dot(F1);return f<0?null:this.at(f/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class gt{constructor(e,t,n,i,r,o,u,c,d,f,p,g,y,x,v,S){gt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,i,r,o,u,c,d,f,p,g,y,x,v,S)}set(e,t,n,i,r,o,u,c,d,f,p,g,y,x,v,S){const w=this.elements;return w[0]=e,w[4]=t,w[8]=n,w[12]=i,w[1]=r,w[5]=o,w[9]=u,w[13]=c,w[2]=d,w[6]=f,w[10]=p,w[14]=g,w[3]=y,w[7]=x,w[11]=v,w[15]=S,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new gt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return this.determinant()===0?(e.set(1,0,0),t.set(0,1,0),n.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this)}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const t=this.elements,n=e.elements,i=1/Ju.setFromMatrixColumn(e,0).length(),r=1/Ju.setFromMatrixColumn(e,1).length(),o=1/Ju.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),u=Math.sin(n),c=Math.cos(i),d=Math.sin(i),f=Math.cos(r),p=Math.sin(r);if(e.order==="XYZ"){const g=o*f,y=o*p,x=u*f,v=u*p;t[0]=c*f,t[4]=-c*p,t[8]=d,t[1]=y+x*d,t[5]=g-v*d,t[9]=-u*c,t[2]=v-g*d,t[6]=x+y*d,t[10]=o*c}else if(e.order==="YXZ"){const g=c*f,y=c*p,x=d*f,v=d*p;t[0]=g+v*u,t[4]=x*u-y,t[8]=o*d,t[1]=o*p,t[5]=o*f,t[9]=-u,t[2]=y*u-x,t[6]=v+g*u,t[10]=o*c}else if(e.order==="ZXY"){const g=c*f,y=c*p,x=d*f,v=d*p;t[0]=g-v*u,t[4]=-o*p,t[8]=x+y*u,t[1]=y+x*u,t[5]=o*f,t[9]=v-g*u,t[2]=-o*d,t[6]=u,t[10]=o*c}else if(e.order==="ZYX"){const g=o*f,y=o*p,x=u*f,v=u*p;t[0]=c*f,t[4]=x*d-y,t[8]=g*d+v,t[1]=c*p,t[5]=v*d+g,t[9]=y*d-x,t[2]=-d,t[6]=u*c,t[10]=o*c}else if(e.order==="YZX"){const g=o*c,y=o*d,x=u*c,v=u*d;t[0]=c*f,t[4]=v-g*p,t[8]=x*p+y,t[1]=p,t[5]=o*f,t[9]=-u*f,t[2]=-d*f,t[6]=y*p+x,t[10]=g-v*p}else if(e.order==="XZY"){const g=o*c,y=o*d,x=u*c,v=u*d;t[0]=c*f,t[4]=-p,t[8]=d*f,t[1]=g*p+v,t[5]=o*f,t[9]=y*p-x,t[2]=x*p-y,t[6]=u*f,t[10]=v*p+g}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(w9,e,M9)}lookAt(e,t,n){const i=this.elements;return $s.subVectors(e,t),$s.lengthSq()===0&&($s.z=1),$s.normalize(),xo.crossVectors(n,$s),xo.lengthSq()===0&&(Math.abs(n.z)===1?$s.x+=1e-4:$s.z+=1e-4,$s.normalize(),xo.crossVectors(n,$s)),xo.normalize(),Am.crossVectors($s,xo),i[0]=xo.x,i[4]=Am.x,i[8]=$s.x,i[1]=xo.y,i[5]=Am.y,i[9]=$s.y,i[2]=xo.z,i[6]=Am.z,i[10]=$s.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],u=n[4],c=n[8],d=n[12],f=n[1],p=n[5],g=n[9],y=n[13],x=n[2],v=n[6],S=n[10],w=n[14],M=n[3],T=n[7],A=n[11],C=n[15],D=i[0],R=i[4],B=i[8],L=i[12],X=i[1],G=i[5],j=i[9],ee=i[13],P=i[2],Y=i[6],F=i[10],k=i[14],I=i[3],$=i[7],re=i[11],V=i[15];return r[0]=o*D+u*X+c*P+d*I,r[4]=o*R+u*G+c*Y+d*$,r[8]=o*B+u*j+c*F+d*re,r[12]=o*L+u*ee+c*k+d*V,r[1]=f*D+p*X+g*P+y*I,r[5]=f*R+p*G+g*Y+y*$,r[9]=f*B+p*j+g*F+y*re,r[13]=f*L+p*ee+g*k+y*V,r[2]=x*D+v*X+S*P+w*I,r[6]=x*R+v*G+S*Y+w*$,r[10]=x*B+v*j+S*F+w*re,r[14]=x*L+v*ee+S*k+w*V,r[3]=M*D+T*X+A*P+C*I,r[7]=M*R+T*G+A*Y+C*$,r[11]=M*B+T*j+A*F+C*re,r[15]=M*L+T*ee+A*k+C*V,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],u=e[5],c=e[9],d=e[13],f=e[2],p=e[6],g=e[10],y=e[14],x=e[3],v=e[7],S=e[11],w=e[15],M=c*y-d*g,T=u*y-d*p,A=u*g-c*p,C=o*y-d*f,D=o*g-c*f,R=o*p-u*f;return t*(v*M-S*T+w*A)-n*(x*M-S*C+w*D)+i*(x*T-v*C+w*R)-r*(x*A-v*D+S*R)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],u=e[5],c=e[6],d=e[7],f=e[8],p=e[9],g=e[10],y=e[11],x=e[12],v=e[13],S=e[14],w=e[15],M=p*S*d-v*g*d+v*c*y-u*S*y-p*c*w+u*g*w,T=x*g*d-f*S*d-x*c*y+o*S*y+f*c*w-o*g*w,A=f*v*d-x*p*d+x*u*y-o*v*y-f*u*w+o*p*w,C=x*p*c-f*v*c-x*u*g+o*v*g+f*u*S-o*p*S,D=t*M+n*T+i*A+r*C;if(D===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const R=1/D;return e[0]=M*R,e[1]=(v*g*r-p*S*r-v*i*y+n*S*y+p*i*w-n*g*w)*R,e[2]=(u*S*r-v*c*r+v*i*d-n*S*d-u*i*w+n*c*w)*R,e[3]=(p*c*r-u*g*r-p*i*d+n*g*d+u*i*y-n*c*y)*R,e[4]=T*R,e[5]=(f*S*r-x*g*r+x*i*y-t*S*y-f*i*w+t*g*w)*R,e[6]=(x*c*r-o*S*r-x*i*d+t*S*d+o*i*w-t*c*w)*R,e[7]=(o*g*r-f*c*r+f*i*d-t*g*d-o*i*y+t*c*y)*R,e[8]=A*R,e[9]=(x*p*r-f*v*r-x*n*y+t*v*y+f*n*w-t*p*w)*R,e[10]=(o*v*r-x*u*r+x*n*d-t*v*d-o*n*w+t*u*w)*R,e[11]=(f*u*r-o*p*r-f*n*d+t*p*d+o*n*y-t*u*y)*R,e[12]=C*R,e[13]=(f*v*i-x*p*i+x*n*g-t*v*g-f*n*S+t*p*S)*R,e[14]=(x*u*i-o*v*i-x*n*c+t*v*c+o*n*S-t*u*S)*R,e[15]=(o*p*i-f*u*i+f*n*c-t*p*c-o*n*g+t*u*g)*R,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,u=e.y,c=e.z,d=r*o,f=r*u;return this.set(d*o+n,d*u-i*c,d*c+i*u,0,d*u+i*c,f*u+n,f*c-i*o,0,d*c-i*u,f*c+i*o,r*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,u=t._z,c=t._w,d=r+r,f=o+o,p=u+u,g=r*d,y=r*f,x=r*p,v=o*f,S=o*p,w=u*p,M=c*d,T=c*f,A=c*p,C=n.x,D=n.y,R=n.z;return i[0]=(1-(v+w))*C,i[1]=(y+A)*C,i[2]=(x-T)*C,i[3]=0,i[4]=(y-A)*D,i[5]=(1-(g+w))*D,i[6]=(S+M)*D,i[7]=0,i[8]=(x+T)*R,i[9]=(S-M)*R,i[10]=(1-(g+v))*R,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;if(e.x=i[12],e.y=i[13],e.z=i[14],this.determinant()===0)return n.set(1,1,1),t.identity(),this;let r=Ju.set(i[0],i[1],i[2]).length();const o=Ju.set(i[4],i[5],i[6]).length(),u=Ju.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),Li.copy(this);const d=1/r,f=1/o,p=1/u;return Li.elements[0]*=d,Li.elements[1]*=d,Li.elements[2]*=d,Li.elements[4]*=f,Li.elements[5]*=f,Li.elements[6]*=f,Li.elements[8]*=p,Li.elements[9]*=p,Li.elements[10]*=p,t.setFromRotationMatrix(Li),n.x=r,n.y=o,n.z=u,this}makePerspective(e,t,n,i,r,o,u=Qs,c=!1){const d=this.elements,f=2*r/(t-e),p=2*r/(n-i),g=(t+e)/(t-e),y=(n+i)/(n-i);let x,v;if(c)x=r/(o-r),v=o*r/(o-r);else if(u===Qs)x=-(o+r)/(o-r),v=-2*o*r/(o-r);else if(u===xi)x=-o/(o-r),v=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return d[0]=f,d[4]=0,d[8]=g,d[12]=0,d[1]=0,d[5]=p,d[9]=y,d[13]=0,d[2]=0,d[6]=0,d[10]=x,d[14]=v,d[3]=0,d[7]=0,d[11]=-1,d[15]=0,this}makeOrthographic(e,t,n,i,r,o,u=Qs,c=!1){const d=this.elements,f=2/(t-e),p=2/(n-i),g=-(t+e)/(t-e),y=-(n+i)/(n-i);let x,v;if(c)x=1/(o-r),v=o/(o-r);else if(u===Qs)x=-2/(o-r),v=-(o+r)/(o-r);else if(u===xi)x=-1/(o-r),v=-r/(o-r);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return d[0]=f,d[4]=0,d[8]=0,d[12]=g,d[1]=0,d[5]=p,d[9]=0,d[13]=y,d[2]=0,d[6]=0,d[10]=x,d[14]=v,d[3]=0,d[7]=0,d[11]=0,d[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Ju=new J,Li=new gt,w9=new J(0,0,0),M9=new J(1,1,1),xo=new J,Am=new J,$s=new J,g2=new gt,y2=new Go;class bi{constructor(e=0,t=0,n=0,i=bi.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],o=i[4],u=i[8],c=i[1],d=i[5],f=i[9],p=i[2],g=i[6],y=i[10];switch(t){case"XYZ":this._y=Math.asin(it(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-f,y),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(g,d),this._z=0);break;case"YXZ":this._x=Math.asin(-it(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(u,y),this._z=Math.atan2(c,d)):(this._y=Math.atan2(-p,r),this._z=0);break;case"ZXY":this._x=Math.asin(it(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-p,y),this._z=Math.atan2(-o,d)):(this._y=0,this._z=Math.atan2(c,r));break;case"ZYX":this._y=Math.asin(-it(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(g,y),this._z=Math.atan2(c,r)):(this._x=0,this._z=Math.atan2(-o,d));break;case"YZX":this._z=Math.asin(it(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-f,d),this._y=Math.atan2(-p,r)):(this._x=0,this._y=Math.atan2(u,y));break;case"XZY":this._z=Math.asin(-it(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(g,d),this._y=Math.atan2(u,r)):(this._x=Math.atan2(-f,y),this._y=0);break;default:Ne("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return g2.makeRotationFromQuaternion(e),this.setFromRotationMatrix(g2,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return y2.setFromEuler(this),this.setFromQuaternion(y2,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}bi.DEFAULT_ORDER="XYZ";class N9{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let A9=0;const x2=new J,ec=new Go,sa=new gt,Em=new J,ud=new J,E9=new J,R9=new Go,b2=new J(1,0,0),_2=new J(0,1,0),v2=new J(0,0,1),T2={type:"added"},C9={type:"removed"},tc={type:"childadded",child:null},O1={type:"childremoved",child:null};class Sn extends Er{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:A9++}),this.uuid=va(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Sn.DEFAULT_UP.clone();const e=new J,t=new bi,n=new Go,i=new J(1,1,1);function r(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new gt},normalMatrix:{value:new Fs}}),this.matrix=new gt,this.matrixWorld=new gt,this.matrixAutoUpdate=Sn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Sn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new N9,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ec.setFromAxisAngle(e,t),this.quaternion.multiply(ec),this}rotateOnWorldAxis(e,t){return ec.setFromAxisAngle(e,t),this.quaternion.premultiply(ec),this}rotateX(e){return this.rotateOnAxis(b2,e)}rotateY(e){return this.rotateOnAxis(_2,e)}rotateZ(e){return this.rotateOnAxis(v2,e)}translateOnAxis(e,t){return x2.copy(e).applyQuaternion(this.quaternion),this.position.add(x2.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(b2,e)}translateY(e){return this.translateOnAxis(_2,e)}translateZ(e){return this.translateOnAxis(v2,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(sa.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Em.copy(e):Em.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),ud.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?sa.lookAt(ud,Em,this.up):sa.lookAt(Em,ud,this.up),this.quaternion.setFromRotationMatrix(sa),i&&(sa.extractRotation(i.matrixWorld),ec.setFromRotationMatrix(sa),this.quaternion.premultiply(ec.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(Ae("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(T2),tc.child=e,this.dispatchEvent(tc),tc.child=null):Ae("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(C9),O1.child=e,this.dispatchEvent(O1),O1.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),sa.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),sa.multiply(e.parent.matrixWorld)),e.applyMatrix4(sa),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(T2),tc.child=e,this.dispatchEvent(tc),tc.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ud,e,E9),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ud,R9,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(u=>({...u,boundingBox:u.boundingBox?u.boundingBox.toJSON():void 0,boundingSphere:u.boundingSphere?u.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(u=>({...u})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function r(u,c){return u[c.uuid]===void 0&&(u[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const c=u.shapes;if(Array.isArray(c))for(let d=0,f=c.length;d<f;d++){const p=c[d];r(e.shapes,p)}else r(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let c=0,d=this.material.length;c<d;c++)u.push(r(e.materials,this.material[c]));i.material=u}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let u=0;u<this.children.length;u++)i.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let u=0;u<this.animations.length;u++){const c=this.animations[u];i.animations.push(r(e.animations,c))}}if(t){const u=o(e.geometries),c=o(e.materials),d=o(e.textures),f=o(e.images),p=o(e.shapes),g=o(e.skeletons),y=o(e.animations),x=o(e.nodes);u.length>0&&(n.geometries=u),c.length>0&&(n.materials=c),d.length>0&&(n.textures=d),f.length>0&&(n.images=f),p.length>0&&(n.shapes=p),g.length>0&&(n.skeletons=g),y.length>0&&(n.animations=y),x.length>0&&(n.nodes=x)}return n.object=i,n;function o(u){const c=[];for(const d in u){const f=u[d];delete f.metadata,c.push(f)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}Sn.DEFAULT_UP=new J(0,1,0);Sn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Sn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Fi=new J,ia=new J,U1=new J,ra=new J,nc=new J,sc=new J,S2=new J,z1=new J,V1=new J,P1=new J,I1=new yt,k1=new yt,G1=new yt;class Ii{constructor(e=new J,t=new J,n=new J){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Fi.subVectors(e,t),i.cross(Fi);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Fi.subVectors(i,t),ia.subVectors(n,t),U1.subVectors(e,t);const o=Fi.dot(Fi),u=Fi.dot(ia),c=Fi.dot(U1),d=ia.dot(ia),f=ia.dot(U1),p=o*d-u*u;if(p===0)return r.set(0,0,0),null;const g=1/p,y=(d*c-u*f)*g,x=(o*f-u*c)*g;return r.set(1-y-x,x,y)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,ra)===null?!1:ra.x>=0&&ra.y>=0&&ra.x+ra.y<=1}static getInterpolation(e,t,n,i,r,o,u,c){return this.getBarycoord(e,t,n,i,ra)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(r,ra.x),c.addScaledVector(o,ra.y),c.addScaledVector(u,ra.z),c)}static getInterpolatedAttribute(e,t,n,i,r,o){return I1.setScalar(0),k1.setScalar(0),G1.setScalar(0),I1.fromBufferAttribute(e,t),k1.fromBufferAttribute(e,n),G1.fromBufferAttribute(e,i),o.setScalar(0),o.addScaledVector(I1,r.x),o.addScaledVector(k1,r.y),o.addScaledVector(G1,r.z),o}static isFrontFacing(e,t,n,i){return Fi.subVectors(n,t),ia.subVectors(e,t),Fi.cross(ia).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Fi.subVectors(this.c,this.b),ia.subVectors(this.a,this.b),Fi.cross(ia).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ii.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ii.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,r){return Ii.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Ii.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ii.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let o,u;nc.subVectors(i,n),sc.subVectors(r,n),z1.subVectors(e,n);const c=nc.dot(z1),d=sc.dot(z1);if(c<=0&&d<=0)return t.copy(n);V1.subVectors(e,i);const f=nc.dot(V1),p=sc.dot(V1);if(f>=0&&p<=f)return t.copy(i);const g=c*p-f*d;if(g<=0&&c>=0&&f<=0)return o=c/(c-f),t.copy(n).addScaledVector(nc,o);P1.subVectors(e,r);const y=nc.dot(P1),x=sc.dot(P1);if(x>=0&&y<=x)return t.copy(r);const v=y*d-c*x;if(v<=0&&d>=0&&x<=0)return u=d/(d-x),t.copy(n).addScaledVector(sc,u);const S=f*x-y*p;if(S<=0&&p-f>=0&&y-x>=0)return S2.subVectors(r,i),u=(p-f)/(p-f+(y-x)),t.copy(i).addScaledVector(S2,u);const w=1/(S+v+g);return o=v*w,u=g*w,t.copy(n).addScaledVector(nc,o).addScaledVector(sc,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const OD={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},bo={h:0,s:0,l:0},Rm={h:0,s:0,l:0};function $1(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*6*(2/3-t):s}class Qe{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=cs){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,bt.colorSpaceToWorking(this,t),this}setRGB(e,t,n,i=bt.workingColorSpace){return this.r=e,this.g=t,this.b=n,bt.colorSpaceToWorking(this,i),this}setHSL(e,t,n,i=bt.workingColorSpace){if(e=Jv(e,1),t=it(t,0,1),n=it(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,o=2*n-r;this.r=$1(o,r,e+1/3),this.g=$1(o,r,e),this.b=$1(o,r,e-1/3)}return bt.colorSpaceToWorking(this,i),this}setStyle(e,t=cs){function n(r){r!==void 0&&parseFloat(r)<1&&Ne("Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=i[1],u=i[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:Ne("Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=i[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);Ne("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=cs){const n=OD[e.toLowerCase()];return n!==void 0?this.setHex(n,t):Ne("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ta(e.r),this.g=Ta(e.g),this.b=Ta(e.b),this}copyLinearToSRGB(e){return this.r=Bc(e.r),this.g=Bc(e.g),this.b=Bc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=cs){return bt.workingToColorSpace(Qn.copy(this),e),Math.round(it(Qn.r*255,0,255))*65536+Math.round(it(Qn.g*255,0,255))*256+Math.round(it(Qn.b*255,0,255))}getHexString(e=cs){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=bt.workingColorSpace){bt.workingToColorSpace(Qn.copy(this),t);const n=Qn.r,i=Qn.g,r=Qn.b,o=Math.max(n,i,r),u=Math.min(n,i,r);let c,d;const f=(u+o)/2;if(u===o)c=0,d=0;else{const p=o-u;switch(d=f<=.5?p/(o+u):p/(2-o-u),o){case n:c=(i-r)/p+(i<r?6:0);break;case i:c=(r-n)/p+2;break;case r:c=(n-i)/p+4;break}c/=6}return e.h=c,e.s=d,e.l=f,e}getRGB(e,t=bt.workingColorSpace){return bt.workingToColorSpace(Qn.copy(this),t),e.r=Qn.r,e.g=Qn.g,e.b=Qn.b,e}getStyle(e=cs){bt.workingToColorSpace(Qn.copy(this),e);const t=Qn.r,n=Qn.g,i=Qn.b;return e!==cs?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,t,n){return this.getHSL(bo),this.setHSL(bo.h+e,bo.s+t,bo.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(bo),e.getHSL(Rm);const n=Gd(bo.h,Rm.h,t),i=Gd(bo.s,Rm.s,t),r=Gd(bo.l,Rm.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Qn=new Qe;Qe.NAMES=OD;let D9=0;class Ds extends Er{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:D9++}),this.uuid=va(),this.name="",this.type="Material",this.blending=ya,this.side=zo,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Ig,this.blendDst=kg,this.blendEquation=Pi,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Qe(0,0,0),this.blendAlpha=0,this.depthFunc=Gg,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Y_,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Bl,this.stencilZFail=Bl,this.stencilZPass=Bl,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){Ne(`Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){Ne(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==ya&&(n.blending=this.blending),this.side!==zo&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==Ig&&(n.blendSrc=this.blendSrc),this.blendDst!==kg&&(n.blendDst=this.blendDst),this.blendEquation!==Pi&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Gg&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Y_&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Bl&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Bl&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Bl&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.allowOverride===!1&&(n.allowOverride=!1),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(r){const o=[];for(const u in r){const c=r[u];delete c.metadata,o.push(c)}return o}if(t){const r=i(e.textures),o=i(e.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Eo extends Ds{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Qe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new bi,this.combine=Z0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const fa=B9();function B9(){const s=new ArrayBuffer(4),e=new Float32Array(s),t=new Uint32Array(s),n=new Uint32Array(512),i=new Uint32Array(512);for(let c=0;c<256;++c){const d=c-127;d<-27?(n[c]=0,n[c|256]=32768,i[c]=24,i[c|256]=24):d<-14?(n[c]=1024>>-d-14,n[c|256]=1024>>-d-14|32768,i[c]=-d-1,i[c|256]=-d-1):d<=15?(n[c]=d+15<<10,n[c|256]=d+15<<10|32768,i[c]=13,i[c|256]=13):d<128?(n[c]=31744,n[c|256]=64512,i[c]=24,i[c|256]=24):(n[c]=31744,n[c|256]=64512,i[c]=13,i[c|256]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),u=new Uint32Array(64);for(let c=1;c<1024;++c){let d=c<<13,f=0;for(;(d&8388608)===0;)d<<=1,f-=8388608;d&=-8388609,f+=947912704,r[c]=d|f}for(let c=1024;c<2048;++c)r[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)o[c]=c<<23;o[31]=1199570944,o[32]=2147483648;for(let c=33;c<63;++c)o[c]=2147483648+(c-32<<23);o[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(u[c]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:i,mantissaTable:r,exponentTable:o,offsetTable:u}}function Hs(s){Math.abs(s)>65504&&Ne("DataUtils.toHalfFloat(): Value out of range."),s=it(s,-65504,65504),fa.floatView[0]=s;const e=fa.uint32View[0],t=e>>23&511;return fa.baseTable[t]+((e&8388607)>>fa.shiftTable[t])}function Cm(s){const e=s>>10;return fa.uint32View[0]=fa.mantissaTable[fa.offsetTable[e]+(s&1023)]+fa.exponentTable[e],fa.floatView[0]}const _n=new J,Dm=new Ge;let L9=0;class Ks{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:L9++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=Qc,this.updateRanges=[],this.gpuType=Ns,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Dm.fromBufferAttribute(this,t),Dm.applyMatrix3(e),this.setXY(t,Dm.x,Dm.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)_n.fromBufferAttribute(this,t),_n.applyMatrix3(e),this.setXYZ(t,_n.x,_n.y,_n.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)_n.fromBufferAttribute(this,t),_n.applyMatrix4(e),this.setXYZ(t,_n.x,_n.y,_n.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)_n.fromBufferAttribute(this,t),_n.applyNormalMatrix(e),this.setXYZ(t,_n.x,_n.y,_n.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)_n.fromBufferAttribute(this,t),_n.transformDirection(e),this.setXYZ(t,_n.x,_n.y,_n.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=ds(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=tt(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ds(t,this.array)),t}setX(e,t){return this.normalized&&(t=tt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ds(t,this.array)),t}setY(e,t){return this.normalized&&(t=tt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ds(t,this.array)),t}setZ(e,t){return this.normalized&&(t=tt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ds(t,this.array)),t}setW(e,t){return this.normalized&&(t=tt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=tt(t,this.array),n=tt(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=tt(t,this.array),n=tt(n,this.array),i=tt(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=tt(t,this.array),n=tt(n,this.array),i=tt(i,this.array),r=tt(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Qc&&(e.usage=this.usage),e}}class UD extends Ks{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class zD extends Ks{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class VD extends Ks{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Cm(this.array[e*this.itemSize]);return this.normalized&&(t=ds(t,this.array)),t}setX(e,t){return this.normalized&&(t=tt(t,this.array)),this.array[e*this.itemSize]=Hs(t),this}getY(e){let t=Cm(this.array[e*this.itemSize+1]);return this.normalized&&(t=ds(t,this.array)),t}setY(e,t){return this.normalized&&(t=tt(t,this.array)),this.array[e*this.itemSize+1]=Hs(t),this}getZ(e){let t=Cm(this.array[e*this.itemSize+2]);return this.normalized&&(t=ds(t,this.array)),t}setZ(e,t){return this.normalized&&(t=tt(t,this.array)),this.array[e*this.itemSize+2]=Hs(t),this}getW(e){let t=Cm(this.array[e*this.itemSize+3]);return this.normalized&&(t=ds(t,this.array)),t}setW(e,t){return this.normalized&&(t=tt(t,this.array)),this.array[e*this.itemSize+3]=Hs(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=tt(t,this.array),n=tt(n,this.array)),this.array[e+0]=Hs(t),this.array[e+1]=Hs(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=tt(t,this.array),n=tt(n,this.array),i=tt(i,this.array)),this.array[e+0]=Hs(t),this.array[e+1]=Hs(n),this.array[e+2]=Hs(i),this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=tt(t,this.array),n=tt(n,this.array),i=tt(i,this.array),r=tt(r,this.array)),this.array[e+0]=Hs(t),this.array[e+1]=Hs(n),this.array[e+2]=Hs(i),this.array[e+3]=Hs(r),this}}class fn extends Ks{constructor(e,t,n){super(new Float32Array(e),t,n)}}let F9=0;const ci=new gt,H1=new Sn,ic=new J,js=new Df,cd=new Df,Ln=new J;class Si extends Er{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:F9++}),this.uuid=va(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(LD(e)?zD:UD)(e,1):this.index=e,this}setIndirect(e,t=0){return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new Fs().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ci.makeRotationFromQuaternion(e),this.applyMatrix4(ci),this}rotateX(e){return ci.makeRotationX(e),this.applyMatrix4(ci),this}rotateY(e){return ci.makeRotationY(e),this.applyMatrix4(ci),this}rotateZ(e){return ci.makeRotationZ(e),this.applyMatrix4(ci),this}translate(e,t,n){return ci.makeTranslation(e,t,n),this.applyMatrix4(ci),this}scale(e,t,n){return ci.makeScale(e,t,n),this.applyMatrix4(ci),this}lookAt(e){return H1.lookAt(e),H1.updateMatrix(),this.applyMatrix4(H1.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ic).negate(),this.translate(ic.x,ic.y,ic.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let i=0,r=e.length;i<r;i++){const o=e[i];n.push(o.x,o.y,o.z||0)}this.setAttribute("position",new fn(n,3))}else{const n=Math.min(e.length,t.count);for(let i=0;i<n;i++){const r=e[i];t.setXYZ(i,r.x,r.y,r.z||0)}e.length>t.count&&Ne("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Df);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Ae("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new J(-1/0,-1/0,-1/0),new J(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const r=t[n];js.setFromBufferAttribute(r),this.morphTargetsRelative?(Ln.addVectors(this.boundingBox.min,js.min),this.boundingBox.expandByPoint(Ln),Ln.addVectors(this.boundingBox.max,js.max),this.boundingBox.expandByPoint(Ln)):(this.boundingBox.expandByPoint(js.min),this.boundingBox.expandByPoint(js.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Ae('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new iy);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Ae("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new J,1/0);return}if(e){const n=this.boundingSphere.center;if(js.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const u=t[r];cd.setFromBufferAttribute(u),this.morphTargetsRelative?(Ln.addVectors(js.min,cd.min),js.expandByPoint(Ln),Ln.addVectors(js.max,cd.max),js.expandByPoint(Ln)):(js.expandByPoint(cd.min),js.expandByPoint(cd.max))}js.getCenter(n);let i=0;for(let r=0,o=e.count;r<o;r++)Ln.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared(Ln));if(t)for(let r=0,o=t.length;r<o;r++){const u=t[r],c=this.morphTargetsRelative;for(let d=0,f=u.count;d<f;d++)Ln.fromBufferAttribute(u,d),c&&(ic.fromBufferAttribute(e,d),Ln.add(ic)),i=Math.max(i,n.distanceToSquared(Ln))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&Ae('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){Ae("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,i=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ks(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),u=[],c=[];for(let B=0;B<n.count;B++)u[B]=new J,c[B]=new J;const d=new J,f=new J,p=new J,g=new Ge,y=new Ge,x=new Ge,v=new J,S=new J;function w(B,L,X){d.fromBufferAttribute(n,B),f.fromBufferAttribute(n,L),p.fromBufferAttribute(n,X),g.fromBufferAttribute(r,B),y.fromBufferAttribute(r,L),x.fromBufferAttribute(r,X),f.sub(d),p.sub(d),y.sub(g),x.sub(g);const G=1/(y.x*x.y-x.x*y.y);isFinite(G)&&(v.copy(f).multiplyScalar(x.y).addScaledVector(p,-y.y).multiplyScalar(G),S.copy(p).multiplyScalar(y.x).addScaledVector(f,-x.x).multiplyScalar(G),u[B].add(v),u[L].add(v),u[X].add(v),c[B].add(S),c[L].add(S),c[X].add(S))}let M=this.groups;M.length===0&&(M=[{start:0,count:e.count}]);for(let B=0,L=M.length;B<L;++B){const X=M[B],G=X.start,j=X.count;for(let ee=G,P=G+j;ee<P;ee+=3)w(e.getX(ee+0),e.getX(ee+1),e.getX(ee+2))}const T=new J,A=new J,C=new J,D=new J;function R(B){C.fromBufferAttribute(i,B),D.copy(C);const L=u[B];T.copy(L),T.sub(C.multiplyScalar(C.dot(L))).normalize(),A.crossVectors(D,L);const G=A.dot(c[B])<0?-1:1;o.setXYZW(B,T.x,T.y,T.z,G)}for(let B=0,L=M.length;B<L;++B){const X=M[B],G=X.start,j=X.count;for(let ee=G,P=G+j;ee<P;ee+=3)R(e.getX(ee+0)),R(e.getX(ee+1)),R(e.getX(ee+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Ks(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let g=0,y=n.count;g<y;g++)n.setXYZ(g,0,0,0);const i=new J,r=new J,o=new J,u=new J,c=new J,d=new J,f=new J,p=new J;if(e)for(let g=0,y=e.count;g<y;g+=3){const x=e.getX(g+0),v=e.getX(g+1),S=e.getX(g+2);i.fromBufferAttribute(t,x),r.fromBufferAttribute(t,v),o.fromBufferAttribute(t,S),f.subVectors(o,r),p.subVectors(i,r),f.cross(p),u.fromBufferAttribute(n,x),c.fromBufferAttribute(n,v),d.fromBufferAttribute(n,S),u.add(f),c.add(f),d.add(f),n.setXYZ(x,u.x,u.y,u.z),n.setXYZ(v,c.x,c.y,c.z),n.setXYZ(S,d.x,d.y,d.z)}else for(let g=0,y=t.count;g<y;g+=3)i.fromBufferAttribute(t,g+0),r.fromBufferAttribute(t,g+1),o.fromBufferAttribute(t,g+2),f.subVectors(o,r),p.subVectors(i,r),f.cross(p),n.setXYZ(g+0,f.x,f.y,f.z),n.setXYZ(g+1,f.x,f.y,f.z),n.setXYZ(g+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ln.fromBufferAttribute(e,t),Ln.normalize(),e.setXYZ(t,Ln.x,Ln.y,Ln.z)}toNonIndexed(){function e(u,c){const d=u.array,f=u.itemSize,p=u.normalized,g=new d.constructor(c.length*f);let y=0,x=0;for(let v=0,S=c.length;v<S;v++){u.isInterleavedBufferAttribute?y=c[v]*u.data.stride+u.offset:y=c[v]*f;for(let w=0;w<f;w++)g[x++]=d[y++]}return new Ks(g,f,p)}if(this.index===null)return Ne("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Si,n=this.index.array,i=this.attributes;for(const u in i){const c=i[u],d=e(c,n);t.setAttribute(u,d)}const r=this.morphAttributes;for(const u in r){const c=[],d=r[u];for(let f=0,p=d.length;f<p;f++){const g=d[f],y=e(g,n);c.push(y)}t.morphAttributes[u]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let u=0,c=o.length;u<c;u++){const d=o[u];t.addGroup(d.start,d.count,d.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const d in c)c[d]!==void 0&&(e[d]=c[d]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const c in n){const d=n[c];e.data.attributes[c]=d.toJSON(e.data)}const i={};let r=!1;for(const c in this.morphAttributes){const d=this.morphAttributes[c],f=[];for(let p=0,g=d.length;p<g;p++){const y=d[p];f.push(y.toJSON(e.data))}f.length>0&&(i[c]=f,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere=u.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const i=e.attributes;for(const d in i){const f=i[d];this.setAttribute(d,f.clone(t))}const r=e.morphAttributes;for(const d in r){const f=[],p=r[d];for(let g=0,y=p.length;g<y;g++)f.push(p[g].clone(t));this.morphAttributes[d]=f}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let d=0,f=o.length;d<f;d++){const p=o[d];this.addGroup(p.start,p.count,p.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const w2=new gt,Sl=new FD,Bm=new iy,M2=new J,Lm=new J,Fm=new J,Om=new J,j1=new J,Um=new J,N2=new J,zm=new J;class Rn extends Sn{constructor(e=new Si,t=new Eo){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const u=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=r}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const u=this.morphTargetInfluences;if(r&&u){Um.set(0,0,0);for(let c=0,d=r.length;c<d;c++){const f=u[c],p=r[c];f!==0&&(j1.fromBufferAttribute(p,e),o?Um.addScaledVector(j1,f):Um.addScaledVector(j1.sub(t),f))}t.add(Um)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Bm.copy(n.boundingSphere),Bm.applyMatrix4(r),Sl.copy(e.ray).recast(e.near),!(Bm.containsPoint(Sl.origin)===!1&&(Sl.intersectSphere(Bm,M2)===null||Sl.origin.distanceToSquared(M2)>(e.far-e.near)**2))&&(w2.copy(r).invert(),Sl.copy(e.ray).applyMatrix4(w2),!(n.boundingBox!==null&&Sl.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,Sl)))}_computeIntersections(e,t,n){let i;const r=this.geometry,o=this.material,u=r.index,c=r.attributes.position,d=r.attributes.uv,f=r.attributes.uv1,p=r.attributes.normal,g=r.groups,y=r.drawRange;if(u!==null)if(Array.isArray(o))for(let x=0,v=g.length;x<v;x++){const S=g[x],w=o[S.materialIndex],M=Math.max(S.start,y.start),T=Math.min(u.count,Math.min(S.start+S.count,y.start+y.count));for(let A=M,C=T;A<C;A+=3){const D=u.getX(A),R=u.getX(A+1),B=u.getX(A+2);i=Vm(this,w,e,n,d,f,p,D,R,B),i&&(i.faceIndex=Math.floor(A/3),i.face.materialIndex=S.materialIndex,t.push(i))}}else{const x=Math.max(0,y.start),v=Math.min(u.count,y.start+y.count);for(let S=x,w=v;S<w;S+=3){const M=u.getX(S),T=u.getX(S+1),A=u.getX(S+2);i=Vm(this,o,e,n,d,f,p,M,T,A),i&&(i.faceIndex=Math.floor(S/3),t.push(i))}}else if(c!==void 0)if(Array.isArray(o))for(let x=0,v=g.length;x<v;x++){const S=g[x],w=o[S.materialIndex],M=Math.max(S.start,y.start),T=Math.min(c.count,Math.min(S.start+S.count,y.start+y.count));for(let A=M,C=T;A<C;A+=3){const D=A,R=A+1,B=A+2;i=Vm(this,w,e,n,d,f,p,D,R,B),i&&(i.faceIndex=Math.floor(A/3),i.face.materialIndex=S.materialIndex,t.push(i))}}else{const x=Math.max(0,y.start),v=Math.min(c.count,y.start+y.count);for(let S=x,w=v;S<w;S+=3){const M=S,T=S+1,A=S+2;i=Vm(this,o,e,n,d,f,p,M,T,A),i&&(i.faceIndex=Math.floor(S/3),t.push(i))}}}}function O9(s,e,t,n,i,r,o,u){let c;if(e.side===ns?c=n.intersectTriangle(o,r,i,!0,u):c=n.intersectTriangle(i,r,o,e.side===zo,u),c===null)return null;zm.copy(u),zm.applyMatrix4(s.matrixWorld);const d=t.ray.origin.distanceTo(zm);return d<t.near||d>t.far?null:{distance:d,point:zm.clone(),object:s}}function Vm(s,e,t,n,i,r,o,u,c,d){s.getVertexPosition(u,Lm),s.getVertexPosition(c,Fm),s.getVertexPosition(d,Om);const f=O9(s,e,t,n,Lm,Fm,Om,N2);if(f){const p=new J;Ii.getBarycoord(N2,Lm,Fm,Om,p),i&&(f.uv=Ii.getInterpolatedAttribute(i,u,c,d,p,new Ge)),r&&(f.uv1=Ii.getInterpolatedAttribute(r,u,c,d,p,new Ge)),o&&(f.normal=Ii.getInterpolatedAttribute(o,u,c,d,p,new J),f.normal.dot(n.direction)>0&&f.normal.multiplyScalar(-1));const g={a:u,b:c,c:d,normal:new J,materialIndex:0};Ii.getNormal(Lm,Fm,Om,g.normal),f.face=g,f.barycoord=p}return f}class us extends Si{constructor(e=1,t=1,n=1,i=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const u=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const c=[],d=[],f=[],p=[];let g=0,y=0;x("z","y","x",-1,-1,n,t,e,o,r,0),x("z","y","x",1,-1,n,t,-e,o,r,1),x("x","z","y",1,1,e,n,t,i,o,2),x("x","z","y",1,-1,e,n,-t,i,o,3),x("x","y","z",1,-1,e,t,n,i,r,4),x("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(c),this.setAttribute("position",new fn(d,3)),this.setAttribute("normal",new fn(f,3)),this.setAttribute("uv",new fn(p,2));function x(v,S,w,M,T,A,C,D,R,B,L){const X=A/R,G=C/B,j=A/2,ee=C/2,P=D/2,Y=R+1,F=B+1;let k=0,I=0;const $=new J;for(let re=0;re<F;re++){const V=re*G-ee;for(let q=0;q<Y;q++){const he=q*X-j;$[v]=he*M,$[S]=V*T,$[w]=P,d.push($.x,$.y,$.z),$[v]=0,$[S]=0,$[w]=D>0?1:-1,f.push($.x,$.y,$.z),p.push(q/R),p.push(1-re/B),k+=1}}for(let re=0;re<B;re++)for(let V=0;V<R;V++){const q=g+V+Y*re,he=g+V+Y*(re+1),fe=g+(V+1)+Y*(re+1),W=g+(V+1)+Y*re;c.push(q,he,W),c.push(he,fe,W),I+=6}u.addGroup(y,I,L),y+=I,g+=k}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new us(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function PD(s){const e={};for(const t in s){e[t]={};for(const n in s[t]){const i=s[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(Ne("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function U9(s){const e=[];for(let t=0;t<s.length;t++)e.push(s[t].clone());return e}var z9=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,V9=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class P9 extends Ds{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=z9,this.fragmentShader=V9,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=PD(e.uniforms),this.uniformsGroups=U9(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class nT extends Sn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new gt,this.projectionMatrix=new gt,this.projectionMatrixInverse=new gt,this.coordinateSystem=Qs,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const _o=new J,A2=new Ge,E2=new Ge;class Ms extends nT{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Kc*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(kd*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Kc*2*Math.atan(Math.tan(kd*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){_o.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(_o.x,_o.y).multiplyScalar(-e/_o.z),_o.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(_o.x,_o.y).multiplyScalar(-e/_o.z)}getViewSize(e,t){return this.getViewBounds(e,A2,E2),t.subVectors(E2,A2)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(kd*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,d=o.fullHeight;r+=o.offsetX*i/c,t-=o.offsetY*n/d,i*=o.width/c,n*=o.height/d}const u=this.filmOffset;u!==0&&(r+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const rc=-90,ac=1;class ID extends Sn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Ms(rc,ac,e,t);i.layers=this.layers,this.add(i);const r=new Ms(rc,ac,e,t);r.layers=this.layers,this.add(r);const o=new Ms(rc,ac,e,t);o.layers=this.layers,this.add(o);const u=new Ms(rc,ac,e,t);u.layers=this.layers,this.add(u);const c=new Ms(rc,ac,e,t);c.layers=this.layers,this.add(c);const d=new Ms(rc,ac,e,t);d.layers=this.layers,this.add(d)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,o,u,c]=t;for(const d of t)this.remove(d);if(e===Qs)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),u.up.set(0,1,0),u.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===xi)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),u.up.set(0,-1,0),u.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const d of t)this.add(d),d.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,u,c,d,f]=this.children,p=e.getRenderTarget(),g=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),x=e.xr.enabled;e.xr.enabled=!1;const v=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,o),e.setRenderTarget(n,2,i),e.render(t,u),e.setRenderTarget(n,3,i),e.render(t,c),e.setRenderTarget(n,4,i),e.render(t,d),n.texture.generateMipmaps=v,e.setRenderTarget(n,5,i),e.render(t,f),e.setRenderTarget(p,g,y),e.xr.enabled=x,n.texture.needsPMREMUpdate=!0}}class ry extends jn{constructor(e=[],t=Yc,n,i,r,o,u,c,d,f){super(e,t,n,i,r,o,u,c,d,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class I9 extends v9{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new ry(i),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new us(5,5,5),r=new P9({name:"CubemapFromEquirect",uniforms:PD(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:ns,blending:Xc});r.uniforms.tEquirect.value=t;const o=new Rn(i,r),u=t.minFilter;return t.minFilter===xa&&(t.minFilter=ms),new ID(1,10,this).update(e,o),t.minFilter=u,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,n=!0,i=!0){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,i);e.setRenderTarget(r)}}class Cd extends Sn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const k9={type:"move"};class G9{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Cd,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Cd,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new J,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new J),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Cd,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new J,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new J),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,o=null;const u=this._targetRay,c=this._grip,d=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(d&&e.hand){o=!0;for(const v of e.hand.values()){const S=t.getJointPose(v,n),w=this._getHandJoint(d,v);S!==null&&(w.matrix.fromArray(S.transform.matrix),w.matrix.decompose(w.position,w.rotation,w.scale),w.matrixWorldNeedsUpdate=!0,w.jointRadius=S.radius),w.visible=S!==null}const f=d.joints["index-finger-tip"],p=d.joints["thumb-tip"],g=f.position.distanceTo(p.position),y=.02,x=.005;d.inputState.pinching&&g>y+x?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!d.inputState.pinching&&g<=y-x&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(c.matrix.fromArray(r.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,r.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(r.linearVelocity)):c.hasLinearVelocity=!1,r.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(r.angularVelocity)):c.hasAngularVelocity=!1));u!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&r!==null&&(i=r),i!==null&&(u.matrix.fromArray(i.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,i.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(i.linearVelocity)):u.hasLinearVelocity=!1,i.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(i.angularVelocity)):u.hasAngularVelocity=!1,this.dispatchEvent(k9)))}return u!==null&&(u.visible=i!==null),c!==null&&(c.visible=r!==null),d!==null&&(d.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Cd;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class ay extends Sn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new bi,this.environmentIntensity=1,this.environmentRotation=new bi,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class kD{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Qc,this.updateRanges=[],this.version=0,this.uuid=va()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=va()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=va()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const os=new J;class sT{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)os.fromBufferAttribute(this,t),os.applyMatrix4(e),this.setXYZ(t,os.x,os.y,os.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)os.fromBufferAttribute(this,t),os.applyNormalMatrix(e),this.setXYZ(t,os.x,os.y,os.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)os.fromBufferAttribute(this,t),os.transformDirection(e),this.setXYZ(t,os.x,os.y,os.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=ds(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=tt(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=tt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=tt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=tt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=tt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=ds(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=ds(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=ds(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=ds(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=tt(t,this.array),n=tt(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=tt(t,this.array),n=tt(n,this.array),i=tt(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=tt(t,this.array),n=tt(n,this.array),i=tt(i,this.array),r=tt(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(e===void 0){Z_("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return new Ks(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new sT(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){Z_("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class $9 extends Ds{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Qe(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class GD extends jn{constructor(e=null,t=1,n=1,i,r,o,u,c,d=hn,f=hn,p,g){super(null,o,u,c,d,f,i,r,p,g),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Lc extends Ks{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const q1=new J,H9=new J,j9=new Fs;class ca{constructor(e=new J(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=q1.subVectors(n,t).cross(H9.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(q1),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||j9.getNormalMatrix(e),i=this.coplanarPoint(q1).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const wl=new iy,q9=new Ge(.5,.5),Pm=new J;class iT{constructor(e=new ca,t=new ca,n=new ca,i=new ca,r=new ca,o=new ca){this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const u=this.planes;return u[0].copy(e),u[1].copy(t),u[2].copy(n),u[3].copy(i),u[4].copy(r),u[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Qs,n=!1){const i=this.planes,r=e.elements,o=r[0],u=r[1],c=r[2],d=r[3],f=r[4],p=r[5],g=r[6],y=r[7],x=r[8],v=r[9],S=r[10],w=r[11],M=r[12],T=r[13],A=r[14],C=r[15];if(i[0].setComponents(d-o,y-f,w-x,C-M).normalize(),i[1].setComponents(d+o,y+f,w+x,C+M).normalize(),i[2].setComponents(d+u,y+p,w+v,C+T).normalize(),i[3].setComponents(d-u,y-p,w-v,C-T).normalize(),n)i[4].setComponents(c,g,S,A).normalize(),i[5].setComponents(d-c,y-g,w-S,C-A).normalize();else if(i[4].setComponents(d-c,y-g,w-S,C-A).normalize(),t===Qs)i[5].setComponents(d+c,y+g,w+S,C+A).normalize();else if(t===xi)i[5].setComponents(c,g,S,A).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),wl.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),wl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(wl)}intersectsSprite(e){wl.center.set(0,0,0);const t=q9.distanceTo(e.center);return wl.radius=.7071067811865476+t,wl.applyMatrix4(e.matrixWorld),this.intersectsSphere(wl)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Pm.x=i.normal.x>0?e.max.x:e.min.x,Pm.y=i.normal.y>0?e.max.y:e.min.y,Pm.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Pm)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const ir=new gt,rr=new iT;class rT{constructor(){this.coordinateSystem=Qs}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(ir.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),rr.setFromProjectionMatrix(ir,i.coordinateSystem,i.reversedDepth),rr.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(ir.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),rr.setFromProjectionMatrix(ir,i.coordinateSystem,i.reversedDepth),rr.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(ir.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),rr.setFromProjectionMatrix(ir,i.coordinateSystem,i.reversedDepth),rr.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(ir.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),rr.setFromProjectionMatrix(ir,i.coordinateSystem,i.reversedDepth),rr.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(ir.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),rr.setFromProjectionMatrix(ir,i.coordinateSystem,i.reversedDepth),rr.containsPoint(e))return!0}return!1}clone(){return new rT}}class $D extends Ds{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Qe(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}class W9 extends Ds{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Qe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class aT extends jn{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=hn,this.minFilter=hn,this.generateMipmaps=!1,this.needsUpdate=!0}}class gi extends jn{constructor(e,t,n=rn,i,r,o,u=hn,c=hn,d,f=Hi,p=1){if(f!==Hi&&f!==ba)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const g={width:e,height:t,depth:p};super(g,i,r,o,u,c,f,n,d),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new tT(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class X9 extends gi{constructor(e,t=rn,n=Yc,i,r,o=hn,u=hn,c,d=Hi){const f={width:e,height:e,depth:1},p=[f,f,f,f,f,f];super(e,e,t,n,i,r,o,u,c,d),this.image=p,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class oT extends Si{constructor(e=1,t=1,n=1,i=32,r=1,o=!1,u=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:u,thetaLength:c};const d=this;i=Math.floor(i),r=Math.floor(r);const f=[],p=[],g=[],y=[];let x=0;const v=[],S=n/2;let w=0;M(),o===!1&&(e>0&&T(!0),t>0&&T(!1)),this.setIndex(f),this.setAttribute("position",new fn(p,3)),this.setAttribute("normal",new fn(g,3)),this.setAttribute("uv",new fn(y,2));function M(){const A=new J,C=new J;let D=0;const R=(t-e)/n;for(let B=0;B<=r;B++){const L=[],X=B/r,G=X*(t-e)+e;for(let j=0;j<=i;j++){const ee=j/i,P=ee*c+u,Y=Math.sin(P),F=Math.cos(P);C.x=G*Y,C.y=-X*n+S,C.z=G*F,p.push(C.x,C.y,C.z),A.set(Y,R,F).normalize(),g.push(A.x,A.y,A.z),y.push(ee,1-X),L.push(x++)}v.push(L)}for(let B=0;B<i;B++)for(let L=0;L<r;L++){const X=v[L][B],G=v[L+1][B],j=v[L+1][B+1],ee=v[L][B+1];(e>0||L!==0)&&(f.push(X,G,ee),D+=3),(t>0||L!==r-1)&&(f.push(G,j,ee),D+=3)}d.addGroup(w,D,0),w+=D}function T(A){const C=x,D=new Ge,R=new J;let B=0;const L=A===!0?e:t,X=A===!0?1:-1;for(let j=1;j<=i;j++)p.push(0,S*X,0),g.push(0,X,0),y.push(.5,.5),x++;const G=x;for(let j=0;j<=i;j++){const P=j/i*c+u,Y=Math.cos(P),F=Math.sin(P);R.x=L*F,R.y=S*X,R.z=L*Y,p.push(R.x,R.y,R.z),g.push(0,X,0),D.x=Y*.5+.5,D.y=F*.5*X+.5,y.push(D.x,D.y),x++}for(let j=0;j<i;j++){const ee=C+j,P=G+j;A===!0?f.push(P,P+1,ee):f.push(P+1,P,ee),B+=3}d.addGroup(w,B,A===!0?1:2),w+=B}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new oT(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class lT extends Si{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],o=[];u(i),d(n),f(),this.setAttribute("position",new fn(r,3)),this.setAttribute("normal",new fn(r.slice(),3)),this.setAttribute("uv",new fn(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function u(M){const T=new J,A=new J,C=new J;for(let D=0;D<t.length;D+=3)y(t[D+0],T),y(t[D+1],A),y(t[D+2],C),c(T,A,C,M)}function c(M,T,A,C){const D=C+1,R=[];for(let B=0;B<=D;B++){R[B]=[];const L=M.clone().lerp(A,B/D),X=T.clone().lerp(A,B/D),G=D-B;for(let j=0;j<=G;j++)j===0&&B===D?R[B][j]=L:R[B][j]=L.clone().lerp(X,j/G)}for(let B=0;B<D;B++)for(let L=0;L<2*(D-B)-1;L++){const X=Math.floor(L/2);L%2===0?(g(R[B][X+1]),g(R[B+1][X]),g(R[B][X])):(g(R[B][X+1]),g(R[B+1][X+1]),g(R[B+1][X]))}}function d(M){const T=new J;for(let A=0;A<r.length;A+=3)T.x=r[A+0],T.y=r[A+1],T.z=r[A+2],T.normalize().multiplyScalar(M),r[A+0]=T.x,r[A+1]=T.y,r[A+2]=T.z}function f(){const M=new J;for(let T=0;T<r.length;T+=3){M.x=r[T+0],M.y=r[T+1],M.z=r[T+2];const A=S(M)/2/Math.PI+.5,C=w(M)/Math.PI+.5;o.push(A,1-C)}x(),p()}function p(){for(let M=0;M<o.length;M+=6){const T=o[M+0],A=o[M+2],C=o[M+4],D=Math.max(T,A,C),R=Math.min(T,A,C);D>.9&&R<.1&&(T<.2&&(o[M+0]+=1),A<.2&&(o[M+2]+=1),C<.2&&(o[M+4]+=1))}}function g(M){r.push(M.x,M.y,M.z)}function y(M,T){const A=M*3;T.x=e[A+0],T.y=e[A+1],T.z=e[A+2]}function x(){const M=new J,T=new J,A=new J,C=new J,D=new Ge,R=new Ge,B=new Ge;for(let L=0,X=0;L<r.length;L+=9,X+=6){M.set(r[L+0],r[L+1],r[L+2]),T.set(r[L+3],r[L+4],r[L+5]),A.set(r[L+6],r[L+7],r[L+8]),D.set(o[X+0],o[X+1]),R.set(o[X+2],o[X+3]),B.set(o[X+4],o[X+5]),C.copy(M).add(T).add(A).divideScalar(3);const G=S(C);v(D,X+0,M,G),v(R,X+2,T,G),v(B,X+4,A,G)}}function v(M,T,A,C){C<0&&M.x===1&&(o[T]=M.x-1),A.x===0&&A.z===0&&(o[T]=C/2/Math.PI+.5)}function S(M){return Math.atan2(M.z,-M.x)}function w(M){return Math.atan2(-M.y,Math.sqrt(M.x*M.x+M.z*M.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new lT(e.vertices,e.indices,e.radius,e.detail)}}class uT extends lT{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new uT(e.radius,e.detail)}}class cT extends Si{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,o=t/2,u=Math.floor(n),c=Math.floor(i),d=u+1,f=c+1,p=e/u,g=t/c,y=[],x=[],v=[],S=[];for(let w=0;w<f;w++){const M=w*g-o;for(let T=0;T<d;T++){const A=T*p-r;x.push(A,-M,0),v.push(0,0,1),S.push(T/u),S.push(1-w/c)}}for(let w=0;w<c;w++)for(let M=0;M<u;M++){const T=M+d*w,A=M+d*(w+1),C=M+1+d*(w+1),D=M+1+d*w;y.push(T,A,D),y.push(A,C,D)}this.setIndex(y),this.setAttribute("position",new fn(x,3)),this.setAttribute("normal",new fn(v,3)),this.setAttribute("uv",new fn(S,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cT(e.width,e.height,e.widthSegments,e.heightSegments)}}class hT extends Si{constructor(e=1,t=32,n=16,i=0,r=Math.PI*2,o=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:u},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const c=Math.min(o+u,Math.PI);let d=0;const f=[],p=new J,g=new J,y=[],x=[],v=[],S=[];for(let w=0;w<=n;w++){const M=[],T=w/n;let A=0;w===0&&o===0?A=.5/t:w===n&&c===Math.PI&&(A=-.5/t);for(let C=0;C<=t;C++){const D=C/t;p.x=-e*Math.cos(i+D*r)*Math.sin(o+T*u),p.y=e*Math.cos(o+T*u),p.z=e*Math.sin(i+D*r)*Math.sin(o+T*u),x.push(p.x,p.y,p.z),g.copy(p).normalize(),v.push(g.x,g.y,g.z),S.push(D+A,1-T),M.push(d++)}f.push(M)}for(let w=0;w<n;w++)for(let M=0;M<t;M++){const T=f[w][M+1],A=f[w][M],C=f[w+1][M],D=f[w+1][M+1];(w!==0||o>0)&&y.push(T,A,D),(w!==n-1||c<Math.PI)&&y.push(A,C,D)}this.setIndex(y),this.setAttribute("position",new fn(x,3)),this.setAttribute("normal",new fn(v,3)),this.setAttribute("uv",new fn(S,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hT(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class dT extends Si{constructor(e=1,t=.4,n=64,i=8,r=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:o},n=Math.floor(n),i=Math.floor(i);const u=[],c=[],d=[],f=[],p=new J,g=new J,y=new J,x=new J,v=new J,S=new J,w=new J;for(let T=0;T<=n;++T){const A=T/n*r*Math.PI*2;M(A,r,o,e,y),M(A+.01,r,o,e,x),S.subVectors(x,y),w.addVectors(x,y),v.crossVectors(S,w),w.crossVectors(v,S),v.normalize(),w.normalize();for(let C=0;C<=i;++C){const D=C/i*Math.PI*2,R=-t*Math.cos(D),B=t*Math.sin(D);p.x=y.x+(R*w.x+B*v.x),p.y=y.y+(R*w.y+B*v.y),p.z=y.z+(R*w.z+B*v.z),c.push(p.x,p.y,p.z),g.subVectors(p,y).normalize(),d.push(g.x,g.y,g.z),f.push(T/n),f.push(C/i)}}for(let T=1;T<=n;T++)for(let A=1;A<=i;A++){const C=(i+1)*(T-1)+(A-1),D=(i+1)*T+(A-1),R=(i+1)*T+A,B=(i+1)*(T-1)+A;u.push(C,D,B),u.push(D,R,B)}this.setIndex(u),this.setAttribute("position",new fn(c,3)),this.setAttribute("normal",new fn(d,3)),this.setAttribute("uv",new fn(f,2));function M(T,A,C,D,R){const B=Math.cos(T),L=Math.sin(T),X=C/A*T,G=Math.cos(X);R.x=D*(2+G)*.5*B,R.y=D*(2+G)*L*.5,R.z=D*Math.sin(X)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dT(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Y9 extends Ds{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Qe(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Tc extends Ds{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Qe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=_a,this.normalScale=new Ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new bi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Z9 extends Tc{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ge(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return it(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Qe(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Qe(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Qe(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Q9 extends Ds{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Qe(16777215),this.specular=new Qe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=_a,this.normalScale=new Ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new bi,this.combine=Z0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class K9 extends Ds{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Qe(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=_a,this.normalScale=new Ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class J9 extends Ds{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=_a,this.normalScale=new Ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class eH extends Ds{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Qe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=_a,this.normalScale=new Ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new bi,this.combine=Z0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class tH extends Ds{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Qe(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=_a,this.normalScale=new Ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nH extends $D{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}const W1={enabled:!1,files:{},add:function(s,e){this.enabled!==!1&&(this.files[s]=e)},get:function(s){if(this.enabled!==!1)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};class sH{constructor(e,t,n){const i=this;let r=!1,o=0,u=0,c;const d=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this._abortController=null,this.itemStart=function(f){u++,r===!1&&i.onStart!==void 0&&i.onStart(f,o,u),r=!0},this.itemEnd=function(f){o++,i.onProgress!==void 0&&i.onProgress(f,o,u),o===u&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(f){i.onError!==void 0&&i.onError(f)},this.resolveURL=function(f){return c?c(f):f},this.setURLModifier=function(f){return c=f,this},this.addHandler=function(f,p){return d.push(f,p),this},this.removeHandler=function(f){const p=d.indexOf(f);return p!==-1&&d.splice(p,2),this},this.getHandler=function(f){for(let p=0,g=d.length;p<g;p+=2){const y=d[p],x=d[p+1];if(y.global&&(y.lastIndex=0),y.test(f))return x}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const iH=new sH;class fT{constructor(e){this.manager=e!==void 0?e:iH,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}fT.DEFAULT_MATERIAL_NAME="__DEFAULT";const oc=new WeakMap;class rH extends fT{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=W1.get(`image:${e}`);if(o!==void 0){if(o.complete===!0)r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0);else{let p=oc.get(o);p===void 0&&(p=[],oc.set(o,p)),p.push({onLoad:t,onError:i})}return o}const u=y0("img");function c(){f(),t&&t(this);const p=oc.get(this)||[];for(let g=0;g<p.length;g++){const y=p[g];y.onLoad&&y.onLoad(this)}oc.delete(this),r.manager.itemEnd(e)}function d(p){f(),i&&i(p),W1.remove(`image:${e}`);const g=oc.get(this)||[];for(let y=0;y<g.length;y++){const x=g[y];x.onError&&x.onError(p)}oc.delete(this),r.manager.itemError(e),r.manager.itemEnd(e)}function f(){u.removeEventListener("load",c,!1),u.removeEventListener("error",d,!1)}return u.addEventListener("load",c,!1),u.addEventListener("error",d,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(u.crossOrigin=this.crossOrigin),W1.add(`image:${e}`,u),r.manager.itemStart(e),u.src=e,u}}class HD extends fT{constructor(e){super(e)}load(e,t,n,i){const r=new jn,o=new rH(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(u){r.image=u,r.needsUpdate=!0,t!==void 0&&t(r)},n,i),r}}class tu extends Sn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Qe(e),this.intensity=t}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t}}class aH extends tu{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Sn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Qe(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}toJSON(e){const t=super.toJSON(e);return t.object.groundColor=this.groundColor.getHex(),t}}const X1=new gt,R2=new J,C2=new J;class pT{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ge(512,512),this.mapType=es,this.map=null,this.mapPass=null,this.matrix=new gt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new iT,this._frameExtents=new Ge(1,1),this._viewportCount=1,this._viewports=[new yt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;R2.setFromMatrixPosition(e.matrixWorld),t.position.copy(R2),C2.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(C2),t.updateMatrixWorld(),X1.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(X1,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(X1)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class oH extends pT{constructor(){super(new Ms(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=Kc*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,r=e.distance||t.far;(n!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class oy extends tu{constructor(e,t,n=0,i=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Sn.DEFAULT_UP),this.updateMatrix(),this.target=new Sn,this.distance=n,this.angle=i,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new oH}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.angle=this.angle,t.object.decay=this.decay,t.object.penumbra=this.penumbra,t.object.target=this.target.uuid,this.map&&this.map.isTexture&&(t.object.map=this.map.toJSON(e).uuid),t.object.shadow=this.shadow.toJSON(),t}}class lH extends pT{constructor(){super(new Ms(90,1,.5,500)),this.isPointLightShadow=!0}}class uH extends tu{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new lH}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.decay=this.decay,t.object.shadow=this.shadow.toJSON(),t}}class mT extends nT{constructor(e=-1,t=1,n=1,i=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,u=i+t,c=i-t;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=d*this.view.offsetX,o=r+d*this.view.width,u-=f*this.view.offsetY,c=u-f*this.view.height}this.projectionMatrix.makeOrthographic(r,o,u,c,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class cH extends pT{constructor(){super(new mT(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class jD extends tu{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Sn.DEFAULT_UP),this.updateMatrix(),this.target=new Sn,this.shadow=new cH}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.shadow=this.shadow.toJSON(),t.object.target=this.target.uuid,t}}class qD extends tu{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class hH extends tu{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class dH{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new J)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*i)),t.addScaledVector(o[5],1.092548*(i*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(n*r)),t.addScaledVector(o[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*i),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*i),t.addScaledVector(o[5],2*.429043*i*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*n*r),t.addScaledVector(o[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}class fH extends tu{constructor(e=new dH,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class pH extends Ms{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class mH extends kD{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class D2{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=it(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(it(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class ly{constructor(e,t,n,i){ly.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,i){const r=this.elements;return r[0]=e,r[2]=t,r[1]=n,r[3]=i,this}}class gH extends Er{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){Ne("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function yH(s,e,t,n){const i=xH(n);switch(t){case wD:return s*e;case J0:return s*e/i.components*i.byteLength;case ey:return s*e/i.components*i.byteLength;case gr:return s*e*2/i.components*i.byteLength;case ty:return s*e*2/i.components*i.byteLength;case K0:return s*e*3/i.components*i.byteLength;case Zs:return s*e*4/i.components*i.byteLength;case ny:return s*e*4/i.components*i.byteLength;case zd:case Vd:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*8;case Pd:case Id:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case q_:case X_:return Math.max(s,16)*Math.max(e,8)/4;case j_:case W_:return Math.max(s,8)*Math.max(e,8)/2;case Hg:case jg:case Wg:case Xg:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*8;case qg:case df:case Yg:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case Zg:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case Qg:return Math.floor((s+4)/5)*Math.floor((e+3)/4)*16;case Kg:return Math.floor((s+4)/5)*Math.floor((e+4)/5)*16;case Jg:return Math.floor((s+5)/6)*Math.floor((e+4)/5)*16;case e0:return Math.floor((s+5)/6)*Math.floor((e+5)/6)*16;case t0:return Math.floor((s+7)/8)*Math.floor((e+4)/5)*16;case n0:return Math.floor((s+7)/8)*Math.floor((e+5)/6)*16;case s0:return Math.floor((s+7)/8)*Math.floor((e+7)/8)*16;case i0:return Math.floor((s+9)/10)*Math.floor((e+4)/5)*16;case r0:return Math.floor((s+9)/10)*Math.floor((e+5)/6)*16;case a0:return Math.floor((s+9)/10)*Math.floor((e+7)/8)*16;case o0:return Math.floor((s+9)/10)*Math.floor((e+9)/10)*16;case l0:return Math.floor((s+11)/12)*Math.floor((e+9)/10)*16;case u0:return Math.floor((s+11)/12)*Math.floor((e+11)/12)*16;case c0:case U8:case z8:return Math.ceil(s/4)*Math.ceil(e/4)*16;case h0:case d0:return Math.ceil(s/4)*Math.ceil(e/4)*8;case ff:case f0:return Math.ceil(s/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function xH(s){switch(s){case es:case Cc:return{byteLength:1,components:1};case Vl:case Dc:case Gn:return{byteLength:2,components:1};case TD:case SD:return{byteLength:2,components:4};case rn:case Kn:case Ns:return{byteLength:4,components:1};case Qv:case Kv:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${s}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Cf}}));typeof window<"u"&&(window.__THREE__?Ne("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Cf);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const bH=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],Y1=new WeakMap;class _H{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=bH,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:n,material:i,object:r}=e;if(t={material:this.getMaterialData(i),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:r.matrixWorld.clone()},r.center&&(t.center=r.center.clone()),r.morphTargetInfluences&&(t.morphTargetInfluences=r.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:u}=e.context;t.bufferWidth=o,t.bufferHeight=u}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const i=e[n];t[n]={version:i.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return!!(e.context.modelViewMatrix||e.context.modelNormalViewMatrix||e.context.getAO||e.context.getShadow)}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const i=e[n];i!=null&&(typeof i=="object"&&i.clone!==void 0?i.isTexture===!0?t[n]={id:i.id,version:i.version}:t[n]=i.clone():t[n]=i)}return t}equals(e,t){const{object:n,material:i,geometry:r}=e,o=this.getRenderObjectData(e);if(o.worldMatrix.equals(n.matrixWorld)!==!0)return o.worldMatrix.copy(n.matrixWorld),!1;const u=o.material;for(const S in u){const w=u[S],M=i[S];if(w.equals!==void 0){if(w.equals(M)===!1)return w.copy(M),!1}else if(M.isTexture===!0){if(w.id!==M.id||w.version!==M.version)return w.id=M.id,w.version=M.version,!1}else if(w!==M)return u[S]=M,!1}if(u.transmission>0){const{width:S,height:w}=e.context;if(o.bufferWidth!==S||o.bufferHeight!==w)return o.bufferWidth=S,o.bufferHeight=w,!1}const c=o.geometry,d=r.attributes,f=c.attributes,p=Object.keys(f),g=Object.keys(d);if(c.id!==r.id)return c.id=r.id,!1;if(p.length!==g.length)return o.geometry.attributes=this.getAttributesData(d),!1;for(const S of p){const w=f[S],M=d[S];if(M===void 0)return delete f[S],!1;if(w.version!==M.version)return w.version=M.version,!1}const y=r.index,x=c.indexVersion,v=y?y.version:null;if(x!==v)return c.indexVersion=v,!1;if(c.drawRange.start!==r.drawRange.start||c.drawRange.count!==r.drawRange.count)return c.drawRange.start=r.drawRange.start,c.drawRange.count=r.drawRange.count,!1;if(o.morphTargetInfluences){let S=!1;for(let w=0;w<o.morphTargetInfluences.length;w++)o.morphTargetInfluences[w]!==n.morphTargetInfluences[w]&&(o.morphTargetInfluences[w]=n.morphTargetInfluences[w],S=!0);if(S)return!1}if(o.lights){for(let S=0;S<t.length;S++)if(o.lights[S].map!==t[S].map)return!1}return o.center&&o.center.equals(n.center)===!1?(o.center.copy(n.center),!0):(e.bundle!==null&&(o.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const n of e)n.isSpotLight===!0&&n.map!==null&&t.push({map:n.map.version});return t}getLights(e,t){if(Y1.has(e)){const i=Y1.get(e);if(i.renderId===t)return i.lightsData}const n=this.getLightsData(e.getLights());return Y1.set(e,{renderId:t,lightsData:n}),n}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const i=e.object.static===!0,r=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(i||r)return!1;const o=this.getLights(e.lightsNode,n);return this.equals(e,o)!==!0}}function gT(s,e=0){let t=3735928559^e,n=1103547991^e;if(s instanceof Array)for(let i=0,r;i<s.length;i++)r=s[i],t=Math.imul(t^r,2654435761),n=Math.imul(n^r,1597334677);else for(let i=0,r;i<s.length;i++)r=s.charCodeAt(i),t=Math.imul(t^r,2654435761),n=Math.imul(n^r,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&n)+(t>>>0)}const Bf=s=>gT(s),ih=s=>gT(s),$d=(...s)=>gT(s),vH=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),B2=new WeakMap;function WD(s){return vH.get(s)}function x0(s){if(/[iu]?vec\d/.test(s))return s.startsWith("ivec")?Int32Array:s.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(s)||/float/.test(s))return Float32Array;if(/uint/.test(s))return Uint32Array;if(/int/.test(s))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${s}`)}function XD(s){if(/float|int|uint/.test(s))return 1;if(/vec2/.test(s))return 2;if(/vec3/.test(s))return 3;if(/vec4/.test(s)||/mat2/.test(s))return 4;if(/mat3/.test(s))return 9;if(/mat4/.test(s))return 16;Ae("TSL: Unsupported type:",s)}function TH(s){if(/float|int|uint/.test(s))return 1;if(/vec2/.test(s))return 2;if(/vec3/.test(s))return 3;if(/vec4/.test(s)||/mat2/.test(s))return 4;if(/mat3/.test(s))return 12;if(/mat4/.test(s))return 16;Ae("TSL: Unsupported type:",s)}function SH(s){if(/float|int|uint/.test(s))return 4;if(/vec2/.test(s))return 8;if(/vec3/.test(s)||/vec4/.test(s))return 16;if(/mat2/.test(s))return 8;if(/mat3/.test(s)||/mat4/.test(s))return 16;Ae("TSL: Unsupported type:",s)}function Fo(s){if(s==null)return null;const e=typeof s;return s.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":s.isVector2===!0?"vec2":s.isVector3===!0?"vec3":s.isVector4===!0?"vec4":s.isMatrix2===!0?"mat2":s.isMatrix3===!0?"mat3":s.isMatrix4===!0?"mat4":s.isColor===!0?"color":s instanceof ArrayBuffer?"ArrayBuffer":null}function yT(s,...e){const t=s?s.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),s==="color"?new Qe(...e):t==="vec2"?new Ge(...e):t==="vec3"?new J(...e):t==="vec4"?new yt(...e):t==="mat2"?new ly(...e):t==="mat3"?new Fs(...e):t==="mat4"?new gt(...e):s==="bool"?e[0]||!1:s==="float"||s==="int"||s==="uint"?e[0]||0:s==="string"?e[0]||"":s==="ArrayBuffer"?QD(e[0]):null}function YD(s){let e=B2.get(s);return e===void 0&&(e={},B2.set(s,e)),e}function ZD(s){let e="";const t=new Uint8Array(s);for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function QD(s){return Uint8Array.from(atob(s),e=>e.charCodeAt(0)).buffer}const Dd={VERTEX:"vertex",FRAGMENT:"fragment"},Ye={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},wH={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},$n={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},KD=["fragment","vertex"],Q_=["setup","analyze","generate"],K_=[...KD,"compute"],nu=["x","y","z","w"],MH={analyze:"setup",generate:"analyze"};let NH=0,Be=class extends Er{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Ye.NONE,this.updateBeforeType=Ye.NONE,this.updateAfterType=Ye.NONE,this.uuid=eT.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:NH++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,Ye.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Ye.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Ye.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const n of Object.getOwnPropertyNames(this)){const i=this[n];if(!(n.startsWith("_")===!0||e.has(i))){if(Array.isArray(i)===!0)for(let r=0;r<i.length;r++){const o=i[r];o&&o.isNode===!0&&t.push({property:n,index:r,childNode:o})}else if(i&&i.isNode===!0)t.push({property:n,childNode:i});else if(i&&Object.getPrototypeOf(i)===Object.prototype)for(const r in i){if(r.startsWith("_")===!0)continue;const o=i[r];o&&o.isNode===!0&&t.push({property:n,index:r,childNode:o})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const n=[];for(const{property:i,childNode:r}of this._getChildren(t))n.push(Bf(i.slice(0,-4)),r.getCacheKey(e,t));this._cacheKey=$d(ih(n),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let n=0;for(const i of this.getChildren())t["node"+n++]=i;return t.outputNode||null}analyze(e,t=null){const n=e.increaseUsage(this);if(this.parents===!0){const i=e.getDataFromNode(this,"any");i.stages=i.stages||{},i.stages[e.shaderStage]=i.stages[e.shaderStage]||[],i.stages[e.shaderStage].push(t)}if(n===1){const i=e.getNodeProperties(this);for(const r of Object.values(i))r&&r.isNode===!0&&r.build(e,this)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(e,t)}updateBefore(){Ne("Abstract function.")}updateAfter(){Ne("Abstract function.")}update(){Ne("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);if(this._beforeNodes!==null){const c=this._beforeNodes;this._beforeNodes=null;for(const d of c)d.build(e,t);this._beforeNodes=c}const i=e.getDataFromNode(this);i.buildStages=i.buildStages||{},i.buildStages[e.buildStage]=!0;const r=MH[e.buildStage];if(r&&i.buildStages[r]!==!0){const c=e.getBuildStage();e.setBuildStage(r),this.build(e),e.setBuildStage(c)}e.addNode(this),e.addChain(this);let o=null;const u=e.getBuildStage();if(u==="setup"){this.updateReference(e);const c=e.getNodeProperties(this);if(c.initialized!==!0){c.initialized=!0,c.outputNode=this.setup(e)||c.outputNode||null;for(const d of Object.values(c))if(d&&d.isNode===!0){if(d.parents===!0){const f=e.getNodeProperties(d);f.parents=f.parents||[],f.parents.push(this)}d.build(e)}}o=c.outputNode}else if(u==="analyze")this.analyze(e,t);else if(u==="generate"){if(this.generate.length<2){const d=this.getNodeType(e),f=e.getDataFromNode(this);o=f.snippet,o===void 0?f.generated===void 0?(f.generated=!0,o=this.generate(e)||"",f.snippet=o):(Ne("Node: Recursion detected.",this),o="/* Recursion detected. */"):f.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,d,t)}else o=this.generate(e,t)||"";o===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(Ae(`TSL: Invalid generated code, expected a "${t}".`),o=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),o}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:i,index:r,childNode:o}of t)r!==void 0?(n[i]===void 0&&(n[i]=Number.isInteger(r)?[]:{}),n[i][r]=o.toJSON(e.meta).uuid):n[i]=o.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const i=[];for(const r of e.inputNodes[n])i.push(t[r]);this[n]=i}else if(typeof e.inputNodes[n]=="object"){const i={};for(const r in e.inputNodes[n]){const o=e.inputNodes[n][r];i[r]=t[o]}this[n]=i}else{const i=e.inputNodes[n];this[n]=t[i]}}}toJSON(e){const{uuid:t,type:n}=this,i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});let r=e.nodes[t];r===void 0&&(r={uuid:t,type:n,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},i!==!0&&(e.nodes[r.uuid]=r),this.serialize(r),delete r.meta);function o(u){const c=[];for(const d in u){const f=u[d];delete f.metadata,c.push(f)}return c}if(i){const u=o(e.textures),c=o(e.images),d=o(e.nodes);u.length>0&&(r.textures=u),c.length>0&&(r.images=c),d.length>0&&(r.nodes=d)}return r}};class su extends Be{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}generate(e){const t=this.indexNode.getNodeType(e),n=this.node.build(e),i=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${n}[ ${i} ]`}}class JD extends Be{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const i of this.convertTo.split("|"))(n===null||e.getTypeLength(t)===e.getTypeLength(i))&&(n=i);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,i=this.getNodeType(e),r=n.build(e,i);return e.format(r,i,t)}}class nn extends Be{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const i=e.getVectorType(this.getNodeType(e,t)),r=e.getDataFromNode(this);if(r.propertyName!==void 0)return e.format(r.propertyName,i,t);if(i!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,i),u=e.getVarFromNode(this,null,i),c=e.getPropertyName(u);return e.addLineFlowCode(`${c} = ${o}`,this),r.snippet=o,r.propertyName=c,e.format(r.propertyName,i,t)}}return super.build(e,t)}}class AH extends nn{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),i=e.getTypeLength(n),r=this.nodes,o=e.getComponentType(n),u=[];let c=0;for(const f of r){if(c>=i){Ae(`TSL: Length of parameters exceeds maximum length of function '${n}()' type.`);break}let p=f.getNodeType(e),g=e.getTypeLength(p),y;if(c+g>i&&(Ae(`TSL: Length of '${n}()' data exceeds maximum length of output type.`),g=i-c,p=e.getTypeFromLength(g)),c+=g,y=f.build(e,p),e.getComponentType(p)!==o){const v=e.getTypeFromLength(g,o);y=e.format(y,p,v)}u.push(y)}const d=`${e.getType(n)}( ${u.join(", ")} )`;return e.format(d,n,t)}}const EH=nu.join("");class eB extends Be{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(nu.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const n=this.node,i=e.getTypeLength(n.getNodeType(e));let r=null;if(i>1){let o=null;this.getVectorLength()>=i&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=n.build(e,o);this.components.length===i&&this.components===EH.slice(0,this.components.length)?r=e.format(c,o,t):r=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else r=n.build(e,t);return r}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class RH extends nn{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:i}=this,r=this.getNodeType(e),o=e.getComponentType(i.getNodeType(e)),u=e.getTypeFromLength(n.length,o),c=i.build(e,u),d=t.build(e,r),f=e.getTypeLength(r),p=[];for(let g=0;g<f;g++){const y=nu[g];y===n[0]?(p.push(c),g+=n.length-1):p.push(d+"."+y)}return`${e.getType(r)}( ${p.join(", ")} )`}}class CH extends nn{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,i=this.getNodeType(e),r=n.build(e),o=e.getVarFromNode(this),u=e.getPropertyName(o);e.addLineFlowCode(u+" = "+r,this);const c=e.getTypeLength(i),d=[];let f=0;for(let p=0;p<c;p++){const g=nu[p];g===t[f]?(d.push("1.0 - "+(u+"."+g)),f++):d.push(u+"."+g)}return`${e.getType(i)}( ${d.join(", ")} )`}}class xT extends Be{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?Fo(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Fo(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=ZD(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?yT(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){Ne("Abstract function.")}}const L2=/float|u?int/;class wi extends xT{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return L2.test(n)&&L2.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class DH extends Be{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){Ne(`TSL: Member "${this.property}" does not exist in struct.`);const n=this.getNodeType(e);return e.generateConst(n)}return this.structNode.build(e)+"."+this.property}}let $o=null;const J_=new Map;function me(s,e){if(J_.has(s)){Ne(`TSL: Redefinition of method chaining '${s}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${s} is not a function`);J_.set(s,e),s!=="assign"&&(Be.prototype[s]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},Be.prototype[s+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const BH=s=>s.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),F2=s=>BH(s).split("").sort().join("");Be.prototype.assign=function(...s){if(this.isStackNode!==!0)return $o!==null?$o.assign(this,...s):Ae("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const e=J_.get("assign");return this.addToStack(e(...s))}};Be.prototype.toVarIntent=function(){return this};Be.prototype.get=function(s){return new DH(this,s)};const Hd={};function Im(s,e,t){Hd[s]=Hd[e]=Hd[t]={get(){this._cache=this._cache||{};let o=this._cache[s];return o===void 0&&(o=new eB(this,s),this._cache[s]=o),o},set(o){this[s].assign(Re(o))}};const n=s.toUpperCase(),i=e.toUpperCase(),r=t.toUpperCase();Be.prototype["set"+n]=Be.prototype["set"+i]=Be.prototype["set"+r]=function(o){const u=F2(s);return new RH(this,u,Re(o))},Be.prototype["flip"+n]=Be.prototype["flip"+i]=Be.prototype["flip"+r]=function(){const o=F2(s);return new CH(this,o)}}const ar=["x","y","z","w"],or=["r","g","b","a"],lr=["s","t","p","q"];for(let s=0;s<4;s++){let e=ar[s],t=or[s],n=lr[s];Im(e,t,n);for(let i=0;i<4;i++){e=ar[s]+ar[i],t=or[s]+or[i],n=lr[s]+lr[i],Im(e,t,n);for(let r=0;r<4;r++){e=ar[s]+ar[i]+ar[r],t=or[s]+or[i]+or[r],n=lr[s]+lr[i]+lr[r],Im(e,t,n);for(let o=0;o<4;o++)e=ar[s]+ar[i]+ar[r]+ar[o],t=or[s]+or[i]+or[r]+or[o],n=lr[s]+lr[i]+lr[r]+lr[o],Im(e,t,n)}}}for(let s=0;s<32;s++)Hd[s]={get(){this._cache=this._cache||{};let e=this._cache[s];return e===void 0&&(e=new su(this,new wi(s,"uint")),this._cache[s]=e),e},set(e){this[s].assign(Re(e))}};Object.defineProperties(Be.prototype,Hd);const O2=new WeakMap,LH=function(s,e=null){const t=Fo(s);return t==="node"?s:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?Re(ev(s,e)):t==="shader"?s.isFn?s:te(s):s},FH=function(s,e=null){for(const t in s)s[t]=Re(s[t],e);return s},OH=function(s,e=null){const t=s.length;for(let n=0;n<t;n++)s[n]=Re(s[n],e);return s},tB=function(s,e=null,t=null,n=null){function i(f){return n!==null?(f=Re(Object.assign(f,n)),n.intent===!0&&(f=f.toVarIntent())):f=Re(f),f}let r,o=e,u,c;function d(f){let p;return o?p=/[a-z]/i.test(o)?o+"()":o:p=s.type,u!==void 0&&f.length<u?(Ae(`TSL: "${p}" parameter length is less than minimum required.`),f.concat(new Array(u-f.length).fill(0))):c!==void 0&&f.length>c?(Ae(`TSL: "${p}" parameter length exceeds limit.`),f.slice(0,c)):f}return e===null?r=(...f)=>i(new s(...Wl(d(f)))):t!==null?(t=Re(t),r=(...f)=>i(new s(e,...Wl(d(f)),t))):r=(...f)=>i(new s(e,...Wl(d(f)))),r.setParameterLength=(...f)=>(f.length===1?u=c=f[0]:f.length===2&&([u,c]=f),r),r.setName=f=>(o=f,r),r},UH=function(s,...e){return new s(...Wl(e))};class zH extends Be{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:n}=this,i=e.getNodeProperties(t),r=e.getClosestSubBuild(t.subBuilds)||"",o=r||"default";if(i[o])return i[o];const u=e.subBuildFn,c=e.fnCall;e.subBuildFn=r,e.fnCall=this;let d=null;if(t.layout){let f=O2.get(e.constructor);f===void 0&&(f=new WeakMap,O2.set(e.constructor,f));let p=f.get(t);p===void 0&&(p=Re(e.buildFunctionNode(t)),f.set(t,p)),e.addInclude(p);const g=n?VH(n):null;d=Re(p.call(g))}else{const f=new Proxy(e,{get:(v,S,w)=>{let M;return Symbol.iterator===S?M=function*(){yield void 0}:M=Reflect.get(v,S,w),M}}),p=n?PH(n):null,g=Array.isArray(n)?n.length>0:n!==null,y=t.jsFunc,x=g||y.length>1?y(p,f):y(f);d=Re(x)}return e.subBuildFn=u,e.fnCall=c,t.once&&(i[o]=d),d}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),n=e.getSubBuildOutput(this);return t[n]=t[n]||this.setupOutput(e),t[n].subBuild=e.getClosestSubBuild(this),t[n]}build(e,t=null){let n=null;const i=e.getBuildStage(),r=e.getNodeProperties(this),o=e.getSubBuildOutput(this),u=this.getOutputNode(e),c=e.fnCall;if(e.fnCall=this,i==="setup"){const d=e.getSubBuildProperty("initialized",this);if(r[d]!==!0&&(r[d]=!0,r[o]=this.getOutputNode(e),r[o].build(e),this.shaderNode.subBuilds))for(const f of e.chaining){const p=e.getDataFromNode(f,"any");p.subBuilds=p.subBuilds||new Set;for(const g of this.shaderNode.subBuilds)p.subBuilds.add(g)}n=r[o]}else i==="analyze"?u.build(e,t):i==="generate"&&(n=u.build(e,t)||"");return e.fnCall=c,n}}function VH(s){let e;return hy(s),s[0]&&(s[0].isNode||Object.getPrototypeOf(s[0])!==Object.prototype)?e=[...s]:e=s[0],e}function PH(s){let e=0;return hy(s),new Proxy(s,{get:(t,n,i)=>{let r;if(n==="length")return r=s.length,r;if(Symbol.iterator===n)r=function*(){for(const o of s)yield Re(o)};else{if(s.length>0)if(Object.getPrototypeOf(s[0])===Object.prototype){const o=s[0];o[n]===void 0?r=o[e++]:r=Reflect.get(o,n,i)}else s[0]instanceof Be&&(s[n]===void 0?r=s[e++]:r=Reflect.get(s,n,i));else r=Reflect.get(t,n,i);r=Re(r)}return r}})}class IH extends Be{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new zH(this,e)}setup(){return this.call()}}const kH=[!1,!0],GH=[0,1,2,3],$H=[-1,-2],nB=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],bT=new Map;for(const s of kH)bT.set(s,new wi(s));const _T=new Map;for(const s of GH)_T.set(s,new wi(s,"uint"));const vT=new Map([..._T].map(s=>new wi(s.value,"int")));for(const s of $H)vT.set(s,new wi(s,"int"));const uy=new Map([...vT].map(s=>new wi(s.value)));for(const s of nB)uy.set(s,new wi(s));for(const s of nB)uy.set(-s,new wi(-s));const cy={bool:bT,uint:_T,ints:vT,float:uy},U2=new Map([...bT,...uy]),ev=(s,e)=>U2.has(s)?U2.get(s):s.isNode===!0?s:new wi(s,e),Mn=function(s,e=null){return(...t)=>{for(const i of t)if(i===void 0)return Ae(`TSL: Invalid parameter for the type "${s}".`),new wi(0,s);if((t.length===0||!["bool","float","int","uint"].includes(s)&&t.every(i=>{const r=typeof i;return r!=="object"&&r!=="function"}))&&(t=[yT(s,...t)]),t.length===1&&e!==null&&e.has(t[0]))return Bd(e.get(t[0]));if(t.length===1){const i=ev(t[0],s);return i.nodeType===s?Bd(i):Bd(new JD(i,s))}const n=t.map(i=>ev(i));return Bd(new AH(n,s))}},pf=s=>typeof s=="object"&&s!==null?s.value:s,sB=s=>s!=null?s.nodeType||s.convertTo||(typeof s=="string"?s:null):null;function Sc(s,e){return new IH(s,e)}const Re=(s,e=null)=>LH(s,e),Bd=(s,e=null)=>Re(s,e).toVarIntent(),hy=(s,e=null)=>new FH(s,e),Wl=(s,e=null)=>new OH(s,e),We=(s,e=null,t=null,n=null)=>new tB(s,e,t,n),Ee=(s,...e)=>new UH(s,...e),we=(s,e=null,t=null,n={})=>new tB(s,e,t,{...n,intent:!0});let HH=0;class jH extends Be{constructor(e,t=null){super();let n=null;t!==null&&(typeof t=="object"?n=t.return:(typeof t=="string"?n=t:Ae("TSL: Invalid layout type."),t=null)),this.shaderNode=new Sc(e,n),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const n={name:"fn"+HH++,type:t,inputs:[]};for(const i in e)i!=="return"&&n.inputs.push({name:i,type:e[i]});e=n}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return Ae('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function te(s,e=null){const t=new jH(s,e);return new Proxy(()=>{},{apply(n,i,r){return t.call(...r)},get(n,i,r){return Reflect.get(t,i,r)},set(n,i,r,o){return Reflect.set(t,i,r,o)}})}const mf=s=>{$o=s},TT=()=>$o,ke=(...s)=>$o.If(...s),qH=(...s)=>$o.Switch(...s);function dy(s){return $o&&$o.addToStack(s),s}me("toStack",dy);const iB=new Mn("color"),z=new Mn("float",cy.float),H=new Mn("int",cy.ints),ve=new Mn("uint",cy.uint),_i=new Mn("bool",cy.bool),Se=new Mn("vec2"),vn=new Mn("ivec2"),ST=new Mn("uvec2"),rB=new Mn("bvec2"),Z=new Mn("vec3"),wT=new Mn("ivec3"),iu=new Mn("uvec3"),MT=new Mn("bvec3"),Ie=new Mn("vec4"),NT=new Mn("ivec4"),AT=new Mn("uvec4"),aB=new Mn("bvec4"),fy=new Mn("mat2"),qn=new Mn("mat3"),Po=new Mn("mat4"),WH=(s="")=>new wi(s,"string"),XH=s=>new wi(s,"ArrayBuffer");me("toColor",iB);me("toFloat",z);me("toInt",H);me("toUint",ve);me("toBool",_i);me("toVec2",Se);me("toIVec2",vn);me("toUVec2",ST);me("toBVec2",rB);me("toVec3",Z);me("toIVec3",wT);me("toUVec3",iu);me("toBVec3",MT);me("toVec4",Ie);me("toIVec4",NT);me("toUVec4",AT);me("toBVec4",aB);me("toMat2",fy);me("toMat3",qn);me("toMat4",Po);const oB=We(su).setParameterLength(2),lB=(s,e)=>Re(new JD(Re(s),e)),YH=(s,e)=>Re(new eB(Re(s),e));me("element",oB);me("convert",lB);const ZH=s=>(Ne("TSL: append() has been renamed to Stack()."),dy(s));me("append",s=>(Ne("TSL: .append() has been renamed to .toStack()."),dy(s)));class vt extends Be{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return Bf(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Sa=(s,e)=>new vt(s,e),gf=(s,e)=>new vt(s,e,!0),Nt=Ee(vt,"vec4","DiffuseColor"),Ll=Ee(vt,"vec3","DiffuseContribution"),tv=Ee(vt,"vec3","EmissiveColor"),pr=Ee(vt,"float","Roughness"),ga=Ee(vt,"float","Metalness"),b0=Ee(vt,"float","Clearcoat"),yf=Ee(vt,"float","ClearcoatRoughness"),Ws=Ee(vt,"vec3","Sheen"),Ro=Ee(vt,"float","SheenRoughness"),py=Ee(vt,"float","Iridescence"),_0=Ee(vt,"float","IridescenceIOR"),v0=Ee(vt,"float","IridescenceThickness"),T0=Ee(vt,"float","AlphaT"),No=Ee(vt,"float","Anisotropy"),jd=Ee(vt,"vec3","AnisotropyT"),Xl=Ee(vt,"vec3","AnisotropyB"),Ho=Ee(vt,"color","SpecularColor"),Il=Ee(vt,"color","SpecularColorBlended"),Fc=Ee(vt,"float","SpecularF90"),S0=Ee(vt,"float","Shininess"),Oc=Ee(vt,"vec4","Output"),gg=Ee(vt,"float","dashSize"),nv=Ee(vt,"float","gapSize"),QH=Ee(vt,"float","pointWidth"),qd=Ee(vt,"float","IOR"),w0=Ee(vt,"float","Transmission"),ET=Ee(vt,"float","Thickness"),RT=Ee(vt,"float","AttenuationDistance"),CT=Ee(vt,"color","AttenuationColor"),DT=Ee(vt,"float","Dispersion");class uB extends Be{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const cB=s=>new uB(s),my=(s,e=0)=>new uB(s,!0,e),hB=my("frame"),Ue=my("render"),BT=cB("object");class Lf extends xT{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=BT}setName(e){return this.name=e,this}label(e){return Ne('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(n=>{const i=e(n,this);i!==void 0&&(this.value=i)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const n=this.getNodeType(e),i=this.getUniformHash(e);let r=e.getNodeFromHash(i);r===void 0&&(e.setHashNode(this,i),r=this);const o=r.getInputType(e),u=e.getUniformFromNode(r,o,e.shaderStage,this.name||e.context.nodeName),c=e.getPropertyName(u);e.context.nodeName!==void 0&&delete e.context.nodeName;let d=c;if(n==="bool"){const f=e.getDataFromNode(this);let p=f.propertyName;if(p===void 0){const g=e.getVarFromNode(this,null,"bool");p=e.getPropertyName(g),f.propertyName=p,d=e.format(c,o,n),e.addLineFlowCode(`${p} = ${d}`,this)}d=p}return e.format(d,n,t)}}const ze=(s,e)=>{const t=sB(e||s);if(t===s&&(s=yT(t)),s&&s.isNode===!0){let n=s.value;s.traverse(i=>{i.isConstNode===!0&&(n=i.value)}),s=n}return new Lf(s,t)};class z2 extends nn{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null?this.values[0].getNodeType(e):this.nodeType}getElementType(e){return this.getNodeType(e)}getMemberType(e,t){return this.nodeType===null?this.values[0].getMemberType(e,t):super.getMemberType(e,t)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const dB=(...s)=>{let e;if(s.length===1){const t=s[0];e=new z2(null,t.length,t)}else{const t=s[0],n=s[1];e=new z2(t,n)}return Re(e)};me("toArray",(s,e)=>dB(Array(e).fill(s)));class KH extends nn{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return nu.join("").slice(0,n)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:n}=this,i=t.getScope(),r=e.getDataFromNode(i);r.assign=!0;const o=e.getNodeProperties(this);o.sourceNode=n,o.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:n,sourceNode:i}=e.getNodeProperties(this),r=this.needsSplitAssign(e),o=n.build(e),u=n.getNodeType(e),c=i.build(e,u),d=i.getNodeType(e),f=e.getDataFromNode(this);let p;if(f.initialized===!0)t!=="void"&&(p=o);else if(r){const g=e.getVarFromNode(this,null,u),y=e.getPropertyName(g);e.addLineFlowCode(`${y} = ${c}`,this);const x=n.node,S=x.node.context({assign:!0}).build(e);for(let w=0;w<x.components.length;w++){const M=x.components[w];e.addLineFlowCode(`${S}.${M} = ${y}[ ${w} ]`,this)}t!=="void"&&(p=o)}else p=`${o} = ${c}`,(t==="void"||d==="void")&&(e.addLineFlowCode(p,this),t!=="void"&&(p=o));return f.initialized=!0,e.format(p,u,t)}}const fB=We(KH).setParameterLength(2);me("assign",fB);class JH extends nn{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],n=this.functionNode,i=n.getInputs(e),r=this.parameters,o=(c,d)=>{const f=d.type,p=f==="pointer";let g;return p?g="&"+c.build(e):g=c.build(e,f),g};if(Array.isArray(r)){if(r.length>i.length)Ae("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),r.length=i.length;else if(r.length<i.length)for(Ae("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");r.length<i.length;)r.push(z(0));for(let c=0;c<r.length;c++)t.push(o(r[c],i[c]))}else for(const c of i){const d=r[c.name];d!==void 0?t.push(o(d,c)):(Ae(`TSL: Input '${c.name}' not found in 'Fn()'.`),t.push(o(z(0),c)))}return`${n.build(e,"property")}( ${t.join(", ")} )`}}const pB=(s,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Wl(e):hy(e[0]),new JH(Re(s),e));me("call",pB);const ej={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class Kt extends nn{static get type(){return"OperatorNode"}constructor(e,t,n,...i){if(super(),i.length>0){let r=new Kt(e,t,n);for(let o=0;o<i.length-1;o++)r=new Kt(e,r,i[o]);t=r,n=i[i.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(ej[this.op],t)}getNodeType(e,t=null){const n=this.op,i=this.aNode,r=this.bNode,o=i.getNodeType(e),u=r?r.getNodeType(e):null;if(o==="void"||u==="void")return t||"void";if(n==="%")return o;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return e.getIntegerType(o);if(n==="!"||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">="){const c=Math.max(e.getTypeLength(o),e.getTypeLength(u));return c>1?`bvec${c}`:"bool"}else{if(e.isMatrix(o)){if(u==="float")return o;if(e.isVector(u))return e.getVectorFromMatrix(o);if(e.isMatrix(u))return o}else if(e.isMatrix(u)){if(o==="float")return u;if(e.isVector(o))return e.getVectorFromMatrix(u)}return e.getTypeLength(u)>e.getTypeLength(o)?u:o}}generate(e,t){const n=this.op,{aNode:i,bNode:r}=this,o=this.getNodeType(e,t);let u=null,c=null;o!=="void"?(u=i.getNodeType(e),c=r?r.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?e.isVector(u)?c=u:e.isVector(c)?u=c:u!==c&&(u=c="float"):n===">>"||n==="<<"?(u=o,c=e.changeComponentType(c,"uint")):n==="%"?(u=o,c=e.isInteger(u)&&e.isInteger(c)?c:u):e.isMatrix(u)?c==="float"?c="float":e.isVector(c)?c=e.getVectorFromMatrix(u):e.isMatrix(c)||(u=c=o):e.isMatrix(c)?u==="float"?u="float":e.isVector(u)?u=e.getVectorFromMatrix(c):u=c=o:u=c=o):u=c=o;const d=i.build(e,u),f=r?r.build(e,c):null,p=e.getFunctionOperator(n);if(t!=="void"){const g=e.renderer.coordinateSystem===Qs;if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">=")return g?e.isVector(u)?e.format(`${this.getOperatorMethod(e,t)}( ${d}, ${f} )`,o,t):e.format(`( ${d} ${n} ${f} )`,o,t):e.format(`( ${d} ${n} ${f} )`,o,t);if(n==="%")return e.isInteger(c)?e.format(`( ${d} % ${f} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${d}, ${f} )`,o,t);if(n==="!"||n==="~")return e.format(`(${n}${d})`,u,t);if(p)return e.format(`${p}( ${d}, ${f} )`,o,t);if(e.isMatrix(u)&&c==="float")return e.format(`( ${f} ${n} ${d} )`,o,t);if(u==="float"&&e.isMatrix(c))return e.format(`${d} ${n} ${f}`,o,t);{let y=`( ${d} ${n} ${f} )`;return!g&&o==="bool"&&e.isVector(u)&&e.isVector(c)&&(y=`all${y}`),e.format(y,o,t)}}else if(u!=="void")return p?e.format(`${p}( ${d}, ${f} )`,o,t):e.isMatrix(u)&&c==="float"?e.format(`${f} ${n} ${d}`,o,t):e.format(`${d} ${n} ${f}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const pn=we(Kt,"+").setParameterLength(2,1/0).setName("add"),ot=we(Kt,"-").setParameterLength(2,1/0).setName("sub"),qe=we(Kt,"*").setParameterLength(2,1/0).setName("mul"),ti=we(Kt,"/").setParameterLength(2,1/0).setName("div"),Ff=we(Kt,"%").setParameterLength(2).setName("mod"),LT=we(Kt,"==").setParameterLength(2).setName("equal"),mB=we(Kt,"!=").setParameterLength(2).setName("notEqual"),gB=we(Kt,"<").setParameterLength(2).setName("lessThan"),FT=we(Kt,">").setParameterLength(2).setName("greaterThan"),yB=we(Kt,"<=").setParameterLength(2).setName("lessThanEqual"),xB=we(Kt,">=").setParameterLength(2).setName("greaterThanEqual"),bB=we(Kt,"&&").setParameterLength(2,1/0).setName("and"),_B=we(Kt,"||").setParameterLength(2,1/0).setName("or"),vB=we(Kt,"!").setParameterLength(1).setName("not"),TB=we(Kt,"^^").setParameterLength(2).setName("xor"),SB=we(Kt,"&").setParameterLength(2).setName("bitAnd"),wB=we(Kt,"~").setParameterLength(1).setName("bitNot"),MB=we(Kt,"|").setParameterLength(2).setName("bitOr"),NB=we(Kt,"^").setParameterLength(2).setName("bitXor"),AB=we(Kt,"<<").setParameterLength(2).setName("shiftLeft"),EB=we(Kt,">>").setParameterLength(2).setName("shiftRight"),RB=te(([s])=>(s.addAssign(1),s)),CB=te(([s])=>(s.subAssign(1),s)),DB=te(([s])=>{const e=H(s).toConst();return s.addAssign(1),e}),BB=te(([s])=>{const e=H(s).toConst();return s.subAssign(1),e});me("add",pn);me("sub",ot);me("mul",qe);me("div",ti);me("mod",Ff);me("equal",LT);me("notEqual",mB);me("lessThan",gB);me("greaterThan",FT);me("lessThanEqual",yB);me("greaterThanEqual",xB);me("and",bB);me("or",_B);me("not",vB);me("xor",TB);me("bitAnd",SB);me("bitNot",wB);me("bitOr",MB);me("bitXor",NB);me("shiftLeft",AB);me("shiftRight",EB);me("incrementBefore",RB);me("decrementBefore",CB);me("increment",DB);me("decrement",BB);const LB=(s,e)=>(Ne('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),Ff(H(s),H(e)));me("modInt",LB);class oe extends nn{static get type(){return"MathNode"}constructor(e,t,n=null,i=null){if(super(),(e===oe.MAX||e===oe.MIN)&&arguments.length>3){let r=new oe(e,t,n);for(let o=2;o<arguments.length-1;o++)r=new oe(e,r,arguments[o]);t=r,n=arguments[arguments.length-1],i=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=i,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,i=this.cNode?this.cNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(n)?0:e.getTypeLength(n),u=e.isMatrix(i)?0:e.getTypeLength(i);return r>o&&r>u?t:o>u?n:u>r?i:t}getNodeType(e){const t=this.method;return t===oe.LENGTH||t===oe.DISTANCE||t===oe.DOT?"float":t===oe.CROSS?"vec3":t===oe.ALL||t===oe.ANY?"bool":t===oe.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:n,method:i}=this;let r=null;if(i===oe.ONE_MINUS)r=ot(1,t);else if(i===oe.RECIPROCAL)r=ti(1,t);else if(i===oe.DIFFERENCE)r=It(ot(t,n));else if(i===oe.TRANSFORM_DIRECTION){let o=t,u=n;e.isMatrix(o.getNodeType(e))?u=Ie(Z(u),0):o=Ie(Z(o),0);const c=qe(o,u).xyz;r=ps(c)}return r!==null?r:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let i=this.method;const r=this.getNodeType(e),o=this.getInputType(e),u=this.aNode,c=this.bNode,d=this.cNode,f=e.renderer.coordinateSystem;if(i===oe.NEGATE)return e.format("( - "+u.build(e,o)+" )",r,t);{const p=[];return i===oe.CROSS?p.push(u.build(e,r),c.build(e,r)):f===Qs&&i===oe.STEP?p.push(u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":o),c.build(e,o)):f===Qs&&(i===oe.MIN||i===oe.MAX)?p.push(u.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):i===oe.REFRACT?p.push(u.build(e,o),c.build(e,o),d.build(e,"float")):i===oe.MIX?p.push(u.build(e,o),c.build(e,o),d.build(e,e.getTypeLength(d.getNodeType(e))===1?"float":o)):(f===xi&&i===oe.ATAN&&c!==null&&(i="atan2"),e.shaderStage!=="fragment"&&(i===oe.DFDX||i===oe.DFDY)&&(Ne(`TSL: '${i}' is not supported in the ${e.shaderStage} stage.`),i="/*"+i+"*/"),p.push(u.build(e,o)),c!==null&&p.push(c.build(e,o)),d!==null&&p.push(d.build(e,o))),e.format(`${e.getMethod(i,r)}( ${p.join(", ")} )`,r,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}oe.ALL="all";oe.ANY="any";oe.RADIANS="radians";oe.DEGREES="degrees";oe.EXP="exp";oe.EXP2="exp2";oe.LOG="log";oe.LOG2="log2";oe.SQRT="sqrt";oe.INVERSE_SQRT="inversesqrt";oe.FLOOR="floor";oe.CEIL="ceil";oe.NORMALIZE="normalize";oe.FRACT="fract";oe.SIN="sin";oe.COS="cos";oe.TAN="tan";oe.ASIN="asin";oe.ACOS="acos";oe.ATAN="atan";oe.ABS="abs";oe.SIGN="sign";oe.LENGTH="length";oe.NEGATE="negate";oe.ONE_MINUS="oneMinus";oe.DFDX="dFdx";oe.DFDY="dFdy";oe.ROUND="round";oe.RECIPROCAL="reciprocal";oe.TRUNC="trunc";oe.FWIDTH="fwidth";oe.TRANSPOSE="transpose";oe.DETERMINANT="determinant";oe.INVERSE="inverse";oe.EQUALS="equals";oe.MIN="min";oe.MAX="max";oe.STEP="step";oe.REFLECT="reflect";oe.DISTANCE="distance";oe.DIFFERENCE="difference";oe.DOT="dot";oe.CROSS="cross";oe.POW="pow";oe.TRANSFORM_DIRECTION="transformDirection";oe.MIX="mix";oe.CLAMP="clamp";oe.REFRACT="refract";oe.SMOOTHSTEP="smoothstep";oe.FACEFORWARD="faceforward";const OT=z(1e-6),tj=z(1e6),M0=z(Math.PI),nj=z(Math.PI*2),sj=z(Math.PI*2),ij=z(Math.PI*.5),FB=we(oe,oe.ALL).setParameterLength(1),OB=we(oe,oe.ANY).setParameterLength(1),UB=we(oe,oe.RADIANS).setParameterLength(1),zB=we(oe,oe.DEGREES).setParameterLength(1),UT=we(oe,oe.EXP).setParameterLength(1),Jc=we(oe,oe.EXP2).setParameterLength(1),gy=we(oe,oe.LOG).setParameterLength(1),br=we(oe,oe.LOG2).setParameterLength(1),ts=we(oe,oe.SQRT).setParameterLength(1),zT=we(oe,oe.INVERSE_SQRT).setParameterLength(1),_r=we(oe,oe.FLOOR).setParameterLength(1),yy=we(oe,oe.CEIL).setParameterLength(1),ps=we(oe,oe.NORMALIZE).setParameterLength(1),Wi=we(oe,oe.FRACT).setParameterLength(1),hs=we(oe,oe.SIN).setParameterLength(1),zi=we(oe,oe.COS).setParameterLength(1),VB=we(oe,oe.TAN).setParameterLength(1),PB=we(oe,oe.ASIN).setParameterLength(1),VT=we(oe,oe.ACOS).setParameterLength(1),xy=we(oe,oe.ATAN).setParameterLength(1,2),It=we(oe,oe.ABS).setParameterLength(1),PT=we(oe,oe.SIGN).setParameterLength(1),vr=we(oe,oe.LENGTH).setParameterLength(1),IT=we(oe,oe.NEGATE).setParameterLength(1),IB=we(oe,oe.ONE_MINUS).setParameterLength(1),kT=we(oe,oe.DFDX).setParameterLength(1),GT=we(oe,oe.DFDY).setParameterLength(1),kB=we(oe,oe.ROUND).setParameterLength(1),GB=we(oe,oe.RECIPROCAL).setParameterLength(1),$T=we(oe,oe.TRUNC).setParameterLength(1),HT=we(oe,oe.FWIDTH).setParameterLength(1),$B=we(oe,oe.TRANSPOSE).setParameterLength(1),HB=we(oe,oe.DETERMINANT).setParameterLength(1),jB=we(oe,oe.INVERSE).setParameterLength(1),qB=(s,e)=>(Ne('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),LT(s,e)),Bs=we(oe,oe.MIN).setParameterLength(2,1/0),Jt=we(oe,oe.MAX).setParameterLength(2,1/0),by=we(oe,oe.STEP).setParameterLength(2),WB=we(oe,oe.REFLECT).setParameterLength(2),XB=we(oe,oe.DISTANCE).setParameterLength(2),YB=we(oe,oe.DIFFERENCE).setParameterLength(2),vi=we(oe,oe.DOT).setParameterLength(2),Ra=we(oe,oe.CROSS).setParameterLength(2),fi=we(oe,oe.POW).setParameterLength(2),jT=s=>qe(s,s),ZB=s=>qe(s,s,s),qT=s=>qe(s,s,s,s),QB=we(oe,oe.TRANSFORM_DIRECTION).setParameterLength(2),KB=s=>qe(PT(s),fi(It(s),1/3)),WT=s=>vi(s,s),at=we(oe,oe.MIX).setParameterLength(3),Xi=(s,e=0,t=1)=>Re(new oe(oe.CLAMP,Re(s),Re(e),Re(t))),_y=s=>Xi(s),XT=we(oe,oe.REFRACT).setParameterLength(3),Yi=we(oe,oe.SMOOTHSTEP).setParameterLength(3),YT=we(oe,oe.FACEFORWARD).setParameterLength(3),JB=te(([s])=>{const n=43758.5453,i=vi(s.xy,Se(12.9898,78.233)),r=Ff(i,M0);return Wi(hs(r).mul(n))}),eL=(s,e,t)=>at(e,t,s),tL=(s,e,t)=>Yi(e,t,s),nL=(s,e)=>by(e,s),sL=(s,e)=>(Ne('TSL: "atan2" is overloaded. Use "atan" instead.'),xy(s,e)),rj=YT,aj=zT;me("all",FB);me("any",OB);me("equals",qB);me("radians",UB);me("degrees",zB);me("exp",UT);me("exp2",Jc);me("log",gy);me("log2",br);me("sqrt",ts);me("inverseSqrt",zT);me("floor",_r);me("ceil",yy);me("normalize",ps);me("fract",Wi);me("sin",hs);me("cos",zi);me("tan",VB);me("asin",PB);me("acos",VT);me("atan",xy);me("abs",It);me("sign",PT);me("length",vr);me("lengthSq",WT);me("negate",IT);me("oneMinus",IB);me("dFdx",kT);me("dFdy",GT);me("round",kB);me("reciprocal",GB);me("trunc",$T);me("fwidth",HT);me("atan2",sL);me("min",Bs);me("max",Jt);me("step",nL);me("reflect",WB);me("distance",XB);me("dot",vi);me("cross",Ra);me("pow",fi);me("pow2",jT);me("pow3",ZB);me("pow4",qT);me("transformDirection",QB);me("mix",eL);me("clamp",Xi);me("refract",XT);me("smoothstep",tL);me("faceForward",YT);me("difference",YB);me("saturate",_y);me("cbrt",KB);me("transpose",$B);me("determinant",HB);me("inverse",jB);me("rand",JB);class oj extends Be{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const i=t.getNodeType(e);if(n!==null){const r=n.getNodeType(e);if(e.getTypeLength(r)>e.getTypeLength(i))return r}return i}setup(e){const t=this.condNode,n=this.ifNode.isolate(),i=this.elseNode?this.elseNode.isolate():null,r=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=r,i!==null&&(e.getDataFromNode(i).parentNodeBlock=r);const o=e.context.uniformFlow,u=e.getNodeProperties(this);u.condNode=t,u.ifNode=o?n:n.context({nodeBlock:n}),u.elseNode=i?o?i:i.context({nodeBlock:i}):null}generate(e,t){const n=this.getNodeType(e),i=e.getDataFromNode(this);if(i.nodeProperty!==void 0)return i.nodeProperty;const{condNode:r,ifNode:o,elseNode:u}=e.getNodeProperties(this),c=e.currentFunctionNode,d=t!=="void",f=d?Sa(n).build(e):"";i.nodeProperty=f;const p=r.build(e,"bool");if(e.context.uniformFlow&&u!==null){const x=o.build(e,n),v=u.build(e,n),S=e.getTernary(p,x,v);return e.format(S,n,t)}e.addFlowCode(`
${e.tab}if ( ${p} ) {

`).addFlowTab();let y=o.build(e,n);if(y&&(d?y=f+" = "+y+";":(y="return "+y+";",c===null&&(Ne("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),y="// "+y))),e.removeFlowTab().addFlowCode(e.tab+"	"+y+`

`+e.tab+"}"),u!==null){e.addFlowCode(` else {

`).addFlowTab();let x=u.build(e,n);x&&(d?x=f+" = "+x+";":(x="return "+x+";",c===null&&(Ne("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),x="// "+x))),e.removeFlowTab().addFlowCode(e.tab+"	"+x+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(f,n,t)}}const Hn=We(oj).setParameterLength(2,3);me("select",Hn);class iL extends Be{static get type(){return"ContextNode"}constructor(e=null,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getFlowContextData(){const e=[];return this.traverse(t=>{t.isContextNode===!0&&e.push(t.value)}),Object.assign({},...e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const n=e.addContext(this.value),i=this.node.build(e,t);return e.setContext(n),i}}const Fa=(s=null,e={})=>{let t=s;return(t===null||t.isNode!==!0)&&(e=t||e,t=null),new iL(t,e)},rL=s=>Fa(s,{uniformFlow:!0}),ZT=(s,e)=>Fa(s,{nodeName:e});function aL(s,e,t=null){return Fa(t,{getShadow:({light:n,shadowColorNode:i})=>e===n?i.mul(s):i})}function oL(s,e=null){return Fa(e,{getAO:(t,{material:n})=>n.transparent===!0?t:t!==null?t.mul(s):s})}function lL(s,e){return Ne('TSL: "label()" has been deprecated. Use "setName()" instead.'),ZT(s,e)}me("context",Fa);me("label",lL);me("uniformFlow",rL);me("setName",ZT);me("builtinShadowContext",(s,e,t)=>aL(e,t,s));me("builtinAOContext",(s,e)=>oL(e,s));class yg extends Be{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}isIntent(e){return e.getDataFromNode(this).forceDeclaration===!0?!1:this.intent}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){return e.getDataFromNode(this).assign}build(...e){const t=e[0];if(this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)){let n=!1;if(this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&t.fnCall&&t.fnCall.shaderNode&&t.getDataFromNode(this.node.shaderNode).hasLoop){const o=t.getDataFromNode(this);o.forceDeclaration=!0,n=!0}const i=t.getBaseStack();n?i.addToStackBefore(this):i.addToStack(this)}return this.isIntent(t)&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:n,readOnly:i}=this,{renderer:r}=e,o=r.backend.isWebGPUBackend===!0;let u=!1,c=!1;i&&(u=e.isDeterministic(t),c=o?i:u);const d=this.getNodeType(e);if(d=="void")return this.isIntent(e)!==!0&&Ae('TSL: ".toVar()" can not be used with void type.'),t.build(e);const f=e.getVectorType(d),p=t.build(e,f),g=e.getVarFromNode(this,n,f,void 0,c),y=e.getPropertyName(g);let x=y;if(c)if(o)x=u?`const ${y}`:`let ${y}`;else{const v=t.getArrayCount(e);x=`const ${e.getVar(g.type,y,v)}`}return e.addLineFlowCode(`${x} = ${p}`,this),y}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}}const QT=We(yg),uL=(s,e=null)=>QT(s,e).toStack(),cL=(s,e=null)=>QT(s,e,!0).toStack(),hL=s=>QT(s).setIntent(!0).toStack();me("toVar",uL);me("toConst",cL);me("toVarIntent",hL);class lj extends Be{static get type(){return"SubBuild"}constructor(e,t,n=null){super(n),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const n=this.node.build(e,...t);return e.removeSubBuild(),n}}const Uc=(s,e,t=null)=>Re(new lj(Re(s),e,t));class uj extends Be{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(n===void 0){const i=this.name,r=this.getNodeType(e),o=this.interpolationType,u=this.interpolationSampling;t.varying=n=e.getVaryingFromNode(this,i,r,o,u),t.node=Uc(this.node,"VERTEX")}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(Dd.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(Dd.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),n=e.getNodeProperties(this),i=this.setupVarying(e);if(n[t]===void 0){const r=this.getNodeType(e),o=e.getPropertyName(i,Dd.VERTEX);e.flowNodeFromShaderStage(Dd.VERTEX,n.node,r,o),n[t]=o}return e.getPropertyName(i)}}const Rr=We(uj).setParameterLength(1,2),dL=s=>Rr(s);me("toVarying",Rr);me("toVertexStage",dL);me("varying",(...s)=>(Ne("TSL: .varying() has been renamed to .toVarying()."),Rr(...s)));me("vertexStage",(...s)=>(Ne("TSL: .vertexStage() has been renamed to .toVertexStage()."),Rr(...s)));const fL=te(([s])=>{const e=s.mul(.9478672986).add(.0521327014).pow(2.4),t=s.mul(.0773993808),n=s.lessThanEqual(.04045);return at(e,t,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),pL=te(([s])=>{const e=s.pow(.41666).mul(1.055).sub(.055),t=s.mul(12.92),n=s.lessThanEqual(.0031308);return at(e,t,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),KT="WorkingColorSpace",cj="OutputColorSpace";class JT extends nn{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===KT?bt.workingColorSpace:t===cj?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),i=this.resolveColorSpace(e,this.target);let r=t;return bt.enabled===!1||n===i||!n||!i||(bt.getTransfer(n)===Ke&&(r=Ie(fL(r.rgb),r.a)),bt.getPrimaries(n)!==bt.getPrimaries(i)&&(r=Ie(qn(bt._getMatrix(new Fs,n,i)).mul(r.rgb),r.a)),bt.getTransfer(i)===Ke&&(r=Ie(pL(r.rgb),r.a))),r}}const mL=(s,e)=>Re(new JT(Re(s),KT,e)),vy=(s,e)=>Re(new JT(Re(s),e,KT)),hj=(s,e,t)=>Re(new JT(Re(s),e,t));me("workingToColorSpace",mL);me("colorSpaceToWorking",vy);let dj=class extends su{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,n,i)}};class gL extends Be{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,i=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=i,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=Ye.OBJECT}setGroup(e){return this.group=e,this}element(e){return new dj(this,Re(e))}setNodeType(e){const t=ze(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let i=1;i<t.length;i++)n=n[t[i]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const fj=(s,e,t)=>new gL(s,e,t);class pj extends gL{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(Ue)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const yL=(s,e,t=null)=>new pj(s,e,t);class mj extends nn{static get type(){return"ToneMappingNode"}constructor(e,t=bL,n=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return $d(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,n=this._toneMapping;if(n===Lo)return t;let i=null;const r=e.renderer.library.getToneMappingFunction(n);return r!==null?i=Ie(r(t.rgb,this.exposureNode),t.a):(Ae("ToneMappingNode: Unsupported Tone Mapping configuration.",n),i=t),i}}const xL=(s,e,t)=>Re(new mj(s,Re(e),Re(t))),bL=yL("toneMappingExposure","float");me("toneMapping",(s,e,t)=>xL(e,t,s));const V2=new WeakMap;function P2(s,e){let t=V2.get(s);return t===void 0&&(t=new kD(s,e),V2.set(s,t)),t}class vo extends xT{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=i,this.usage=Qc,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&e.itemSize<=4&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),n=e.getTypeLength(t),i=this.value,r=this.bufferStride||n,o=this.bufferOffset;let u;i.isInterleavedBuffer===!0?u=i:i.isBufferAttribute===!0?u=P2(i.array,r):u=P2(i,r);const c=new sT(u,n,o);u.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),i=e.getPropertyName(n);let r=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=i,r=i):r=Rr(this).build(e,t),r}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}function Ty(s,e=null,t=0,n=0,i=Qc,r=!1){return e==="mat3"||e===null&&s.itemSize===9?qn(new vo(s,"vec3",9,0).setUsage(i).setInstanced(r),new vo(s,"vec3",9,3).setUsage(i).setInstanced(r),new vo(s,"vec3",9,6).setUsage(i).setInstanced(r)):e==="mat4"||e===null&&s.itemSize===16?Po(new vo(s,"vec4",16,0).setUsage(i).setInstanced(r),new vo(s,"vec4",16,4).setUsage(i).setInstanced(r),new vo(s,"vec4",16,8).setUsage(i).setInstanced(r),new vo(s,"vec4",16,12).setUsage(i).setInstanced(r)):new vo(s,e,t,n)}const eS=(s,e=null,t=0,n=0)=>Ty(s,e,t,n),gj=(s,e=null,t=0,n=0)=>Ty(s,e,t,n,Pl),N0=(s,e=null,t=0,n=0)=>Ty(s,e,t,n,Qc,!0),sv=(s,e=null,t=0,n=0)=>Ty(s,e,t,n,Pl,!0);me("toAttribute",s=>eS(s.value));class yj extends Be{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=Ye.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return Ne('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const n=e.getNodeProperties(this);n.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if(n==="compute"){const i=this.computeNode.build(e,"void");i!==""&&e.addLineFlowCode(i,this)}else{const r=e.getNodeProperties(this).outputComputeNode;if(r)return r.build(e,t)}}}const tS=(s,e=[64])=>{(e.length===0||e.length>3)&&Ae("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let t=0;t<e.length;t++){const n=e[t];(typeof n!="number"||n<=0||!Number.isInteger(n))&&Ae(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`)}for(;e.length<3;)e.push(1);return Re(new yj(Re(s),e))},_L=(s,e,t)=>tS(s,t).setCount(e);me("compute",_L);me("computeKernel",tS);class xj extends Be{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const i=this.node.getNodeType(e);return e.setCache(t),i}build(e,...t){const n=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const r=this.node.build(e,...t);return e.setCache(n),r}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const zc=s=>new xj(Re(s));function vL(s,e=!0){return Ne('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),zc(s).setParent(e)}me("cache",vL);me("isolate",zc);class bj extends Be{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const TL=We(bj).setParameterLength(2);me("bypass",TL);class SL extends Be{static get type(){return"RemapNode"}constructor(e,t,n,i=z(0),r=z(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=i,this.outHighNode=r,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:i,outHighNode:r,doClamp:o}=this;let u=e.sub(t).div(n.sub(t));return o===!0&&(u=u.clamp()),u.mul(r.sub(i)).add(i)}}const wL=We(SL,null,null,{doClamp:!1}).setParameterLength(3,5),ML=We(SL).setParameterLength(3,5);me("remap",wL);me("remapClamp",ML);class xg extends Be{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),i=this.snippet;if(n==="void")e.addLineFlowCode(i,this);else return e.format(i,n,t)}}const Ca=We(xg).setParameterLength(1,2),NL=s=>(s?Hn(s,Ca("discard")):Ca("discard")).toStack(),_j=()=>Ca("return").toStack();me("discard",NL);class vj extends nn{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const n=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||Lo,i=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||ko;return n!==Lo&&(t=t.toneMapping(n)),i!==ko&&i!==bt.workingColorSpace&&(t=t.workingToColorSpace(i)),t}}const nS=(s,e=null,t=null)=>Re(new vj(Re(s),e,t));me("renderOutput",nS);class Tj extends nn{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e),i="--- TSL debug - "+e.shaderStage+" shader ---",r="-".repeat(i.length);let o="";return o+="// #"+i+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+n+` /* ... */
`,o+="// #"+r+`#
`,t!==null?t(e,o):Z_(o),n}}const AL=(s,e=null)=>Re(new Tj(Re(s),e)).toStack();me("debug",AL);class EL{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class Sj extends Be{static get type(){return"InspectorNode"}constructor(e,t="",n=null){super(),this.node=e,this.name=t,this.callback=n,this.updateType=Ye.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==EL&&$t('TSL: ".toInspector()" is only available with WebGPU.'),t}}function RL(s,e="",t=null){return s=Re(s),s.before(new Sj(s,e,t))}me("toInspector",RL);function wj(s){Ne("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",s)}class CL extends Be{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const i=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(i)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const r=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(r),u=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(u.name,o,n):Rr(this).build(e,n)}else return Ne(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Da=(s,e=null)=>new CL(s,e),Ct=(s=0)=>Da("uv"+(s>0?s:""),"vec2");class Mj extends Be{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),i=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${i} )`,this.getNodeType(e),t)}}const wa=We(Mj).setParameterLength(1,2);class Nj extends Lf{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Ye.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&n.width!==void 0){const{width:i,height:r}=n;this.value=Math.log2(Math.max(i,r))}}}const sS=We(Nj).setParameterLength(1),iS=new jn;let Mr=class extends Lf{static get type(){return"TextureNode"}constructor(e=iS,t=null,n=null,i=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=i,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Ye.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===rn?"uvec4":this.value.type===Kn?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Ct(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=ze(this.value.matrix)),this._matrixUniform.mul(Z(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=ze(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(H(wa(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");const i=te(()=>{let o=this.uvNode;return(o===null||e.context.forceUVContext===!0)&&e.context.getUV&&(o=e.context.getUV(this,e)),o||(o=this.getDefaultUV()),this.updateMatrix===!0&&(o=this.getTransformedUV(o)),o=this.setupUV(e,o),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?Ye.OBJECT:Ye.NONE,o})();let r=this.levelNode;r===null&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),t.uvNode=i,t.levelNode=r,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,n,i,r,o,u,c,d){const f=this.value;let p;return r?p=e.generateTextureBias(f,t,n,r,o,d):c?p=e.generateTextureGrad(f,t,n,c,o,d):u?p=e.generateTextureCompare(f,t,n,u,o,d):this.sampler===!1?p=e.generateTextureLoad(f,t,n,i,o,d):i?p=e.generateTextureLevel(f,t,n,i,o,d):p=e.generateTexture(f,t,n,o,d),p}generate(e,t){const n=this.value,i=e.getNodeProperties(this),r=super.generate(e,"property");if(/^sampler/.test(t))return r+"_sampler";if(e.isReference(t))return r;{const o=e.getDataFromNode(this);let u=o.propertyName;if(u===void 0){const{uvNode:f,levelNode:p,biasNode:g,compareNode:y,depthNode:x,gradNode:v,offsetNode:S}=i,w=this.generateUV(e,f),M=p?p.build(e,"float"):null,T=g?g.build(e,"float"):null,A=x?x.build(e,"int"):null,C=y?y.build(e,"float"):null,D=v?[v[0].build(e,"vec2"),v[1].build(e,"vec2")]:null,R=S?this.generateOffset(e,S):null,B=e.getVarFromNode(this);u=e.getPropertyName(B);const L=this.generateSnippet(e,r,w,M,T,A,C,D,R);e.addLineFlowCode(`${u} = ${L}`,this),o.snippet=L,o.propertyName=u}let c=u;const d=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(c=vy(Ca(c,d),n.colorSpace).setup(e).build(e,d)),e.format(c,d,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return Ne("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Re(e),t.referenceNode=this.getBase(),Re(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=Re(e).mul(sS(t)),t.referenceNode=this.getBase();const n=t.value;return t.generateMipmaps===!1&&(n&&n.generateMipmaps===!1||n.minFilter===hn||n.magFilter===hn)&&(Ne("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Re(t)}level(e){const t=this.clone();return t.levelNode=Re(e),t.referenceNode=this.getBase(),Re(t)}size(e){return wa(this,e)}bias(e){const t=this.clone();return t.biasNode=Re(e),t.referenceNode=this.getBase(),Re(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=Re(e),t.referenceNode=this.getBase(),Re(t)}grad(e,t){const n=this.clone();return n.gradNode=[Re(e),Re(t)],n.referenceNode=this.getBase(),Re(n)}depth(e){const t=this.clone();return t.depthNode=Re(e),t.referenceNode=this.getBase(),Re(t)}offset(e){const t=this.clone();return t.offsetNode=Re(e),t.referenceNode=this.getBase(),Re(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const n=this._flipYUniform;n!==null&&(n.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}};const Aj=We(Mr).setParameterLength(1,4).setName("texture"),_t=(s=iS,e=null,t=null,n=null)=>{let i;return s&&s.isTextureNode===!0?(i=Re(s.clone()),i.referenceNode=s.getBase(),e!==null&&(i.uvNode=Re(e)),t!==null&&(i.levelNode=Re(t)),n!==null&&(i.biasNode=Re(n))):i=Aj(s,e,t,n),i},Ej=(s=iS)=>_t(s),sn=(...s)=>_t(...s).setSampler(!1),Rj=(s,e,t)=>_t(s,e).level(t),Cj=s=>(s.isNode===!0?s:_t(s)).convert("sampler"),Dj=s=>(s.isNode===!0?s:_t(s)).convert("samplerComparison");class rS extends Lf{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n,this.updateRanges=[]}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const Of=(s,e,t)=>new rS(s,e,t);class Bj extends su{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),i=this.node.getPaddedType();return e.format(t,i,n)}}class Lj extends rS{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?Fo(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Ye.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let i=0;i<e.length;i++){const r=i*4;t[r]=e[i]}else if(n==="color")for(let i=0;i<e.length;i++){const r=i*4,o=e[i];t[r]=o.r,t[r+1]=o.g,t[r+2]=o.b||0}else if(n==="mat2")for(let i=0;i<e.length;i++){const r=i*4,o=e[i];t[r]=o.elements[0],t[r+1]=o.elements[1],t[r+2]=o.elements[2],t[r+3]=o.elements[3]}else if(n==="mat3")for(let i=0;i<e.length;i++){const r=i*16,o=e[i];t[r]=o.elements[0],t[r+1]=o.elements[1],t[r+2]=o.elements[2],t[r+4]=o.elements[3],t[r+5]=o.elements[4],t[r+6]=o.elements[5],t[r+8]=o.elements[6],t[r+9]=o.elements[7],t[r+10]=o.elements[8],t[r+15]=1}else if(n==="mat4")for(let i=0;i<e.length;i++){const r=i*16,o=e[i];for(let u=0;u<o.elements.length;u++)t[r+u]=o.elements[u]}else for(let i=0;i<e.length;i++){const r=i*4,o=e[i];t[r]=o.x,t[r+1]=o.y,t[r+2]=o.z||0,t[r+3]=o.w||0}}setup(e){const t=this.array.length,n=this.elementType;let i=Float32Array;const r=this.paddedType,o=e.getTypeLength(r);return n.charAt(0)==="i"&&(i=Int32Array),n.charAt(0)==="u"&&(i=Uint32Array),this.value=new i(t*o),this.bufferCount=t,this.bufferType=r,super.setup(e)}element(e){return new Bj(this,Re(e))}}const Jn=(s,e)=>new Lj(s,e);class Fj extends Be{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const Oa=We(Fj).setParameterLength(1);let hd,dd;class Gt extends Be{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===Gt.DPR?"float":this.scope===Gt.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Ye.NONE;return(this.scope===Gt.SIZE||this.scope===Gt.VIEWPORT||this.scope===Gt.DPR)&&(e=Ye.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===Gt.VIEWPORT?t!==null?dd.copy(t.viewport):(e.getViewport(dd),dd.multiplyScalar(e.getPixelRatio())):this.scope===Gt.DPR?this._output.value=e.getPixelRatio():t!==null?(hd.width=t.width,hd.height=t.height):e.getDrawingBufferSize(hd)}setup(){const e=this.scope;let t=null;return e===Gt.SIZE?t=ze(hd||(hd=new Ge)):e===Gt.VIEWPORT?t=ze(dd||(dd=new yt)):e===Gt.DPR?t=ze(1):t=Se(ru.div(Jl)),this._output=t,t}generate(e){if(this.scope===Gt.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(Jl).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}}Gt.COORDINATE="coordinate";Gt.VIEWPORT="viewport";Gt.SIZE="size";Gt.UV="uv";Gt.DPR="dpr";const DL=Ee(Gt,Gt.DPR),Ma=Ee(Gt,Gt.UV),Jl=Ee(Gt,Gt.SIZE),ru=Ee(Gt,Gt.COORDINATE),aS=Ee(Gt,Gt.VIEWPORT),oS=aS.zw,BL=ru.sub(aS.xy),Oj=BL.div(oS),Uj=te(()=>(Ne('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),Jl),"vec2").once()(),jo=ze(0,"uint").setName("u_cameraIndex").setGroup(my("cameraIndex")).toVarying("v_cameraIndex"),Co=ze("float").setName("cameraNear").setGroup(Ue).onRenderUpdate(({camera:s})=>s.near),Do=ze("float").setName("cameraFar").setGroup(Ue).onRenderUpdate(({camera:s})=>s.far),Na=te(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const i of s.cameras)t.push(i.projectionMatrix);e=Jn(t).setGroup(Ue).setName("cameraProjectionMatrices").element(s.isMultiViewCamera?Oa("gl_ViewID_OVR"):jo).toConst("cameraProjectionMatrix")}else e=ze("mat4").setName("cameraProjectionMatrix").setGroup(Ue).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),zj=te(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const i of s.cameras)t.push(i.projectionMatrixInverse);e=Jn(t).setGroup(Ue).setName("cameraProjectionMatricesInverse").element(s.isMultiViewCamera?Oa("gl_ViewID_OVR"):jo).toConst("cameraProjectionMatrixInverse")}else e=ze("mat4").setName("cameraProjectionMatrixInverse").setGroup(Ue).onRenderUpdate(({camera:t})=>t.projectionMatrixInverse);return e}).once()(),Mi=te(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const i of s.cameras)t.push(i.matrixWorldInverse);e=Jn(t).setGroup(Ue).setName("cameraViewMatrices").element(s.isMultiViewCamera?Oa("gl_ViewID_OVR"):jo).toConst("cameraViewMatrix")}else e=ze("mat4").setName("cameraViewMatrix").setGroup(Ue).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),Vj=te(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const i of s.cameras)t.push(i.matrixWorld);e=Jn(t).setGroup(Ue).setName("cameraWorldMatrices").element(s.isMultiViewCamera?Oa("gl_ViewID_OVR"):jo).toConst("cameraWorldMatrix")}else e=ze("mat4").setName("cameraWorldMatrix").setGroup(Ue).onRenderUpdate(({camera:t})=>t.matrixWorld);return e}).once()(),Pj=te(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const i of s.cameras)t.push(i.normalMatrix);e=Jn(t).setGroup(Ue).setName("cameraNormalMatrices").element(s.isMultiViewCamera?Oa("gl_ViewID_OVR"):jo).toConst("cameraNormalMatrix")}else e=ze("mat3").setName("cameraNormalMatrix").setGroup(Ue).onRenderUpdate(({camera:t})=>t.normalMatrix);return e}).once()(),LL=te(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(let i=0,r=s.cameras.length;i<r;i++)t.push(new J);e=Jn(t).setGroup(Ue).setName("cameraPositions").onRenderUpdate(({camera:i},r)=>{const o=i.cameras,u=r.array;for(let c=0,d=o.length;c<d;c++)u[c].setFromMatrixPosition(o[c].matrixWorld)}).element(s.isMultiViewCamera?Oa("gl_ViewID_OVR"):jo).toConst("cameraPosition")}else e=ze(new J).setName("cameraPosition").setGroup(Ue).onRenderUpdate(({camera:t},n)=>n.value.setFromMatrixPosition(t.matrixWorld));return e}).once()(),Ij=te(({camera:s})=>{let e;if(s.isArrayCamera&&s.cameras.length>0){const t=[];for(const i of s.cameras)t.push(i.viewport);e=Jn(t,"vec4").setGroup(Ue).setName("cameraViewports").element(jo).toConst("cameraViewport")}else e=Ie(0,0,Jl.x,Jl.y).toConst("cameraViewport");return e}).once()(),I2=new iy;class rt extends Be{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Ye.OBJECT,this.uniformNode=new Lf(null)}getNodeType(){const e=this.scope;if(e===rt.WORLD_MATRIX)return"mat4";if(e===rt.POSITION||e===rt.VIEW_POSITION||e===rt.DIRECTION||e===rt.SCALE)return"vec3";if(e===rt.RADIUS)return"float"}update(e){const t=this.object3d,n=this.uniformNode,i=this.scope;if(i===rt.WORLD_MATRIX)n.value=t.matrixWorld;else if(i===rt.POSITION)n.value=n.value||new J,n.value.setFromMatrixPosition(t.matrixWorld);else if(i===rt.SCALE)n.value=n.value||new J,n.value.setFromMatrixScale(t.matrixWorld);else if(i===rt.DIRECTION)n.value=n.value||new J,t.getWorldDirection(n.value);else if(i===rt.VIEW_POSITION){const r=e.camera;n.value=n.value||new J,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(r.matrixWorldInverse)}else if(i===rt.RADIUS){const r=e.object.geometry;r.boundingSphere===null&&r.computeBoundingSphere(),I2.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),n.value=I2.radius}}generate(e){const t=this.scope;return t===rt.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===rt.POSITION||t===rt.VIEW_POSITION||t===rt.DIRECTION||t===rt.SCALE?this.uniformNode.nodeType="vec3":t===rt.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}rt.WORLD_MATRIX="worldMatrix";rt.POSITION="position";rt.SCALE="scale";rt.VIEW_POSITION="viewPosition";rt.DIRECTION="direction";rt.RADIUS="radius";const kj=We(rt,rt.DIRECTION).setParameterLength(1),Gj=We(rt,rt.WORLD_MATRIX).setParameterLength(1),FL=We(rt,rt.POSITION).setParameterLength(1),$j=We(rt,rt.SCALE).setParameterLength(1),Hj=We(rt,rt.VIEW_POSITION).setParameterLength(1),jj=We(rt,rt.RADIUS).setParameterLength(1);class Ti extends rt{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const qj=Ee(Ti,Ti.DIRECTION),pi=Ee(Ti,Ti.WORLD_MATRIX),Wj=Ee(Ti,Ti.POSITION),Xj=Ee(Ti,Ti.SCALE),Yj=Ee(Ti,Ti.VIEW_POSITION),Zj=Ee(Ti,Ti.RADIUS),OL=ze(new Fs).onObjectUpdate(({object:s},e)=>e.value.getNormalMatrix(s.matrixWorld)),Qj=ze(new gt).onObjectUpdate(({object:s},e)=>e.value.copy(s.matrixWorld).invert()),qo=te(s=>s.context.modelViewMatrix||UL).once()().toVar("modelViewMatrix"),UL=Mi.mul(pi),iv=te(s=>(s.context.isHighPrecisionModelViewMatrix=!0,ze("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),rv=te(s=>{const e=s.context.isHighPrecisionModelViewMatrix;return ze("mat3").onObjectUpdate(({object:t,camera:n})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),Uf=Da("position","vec3"),Qt=Uf.toVarying("positionLocal"),A0=Uf.toVarying("positionPrevious"),Tr=te(s=>pi.mul(Qt).xyz.toVarying(s.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),lS=te(()=>Qt.transformDirection(pi).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),ln=te(s=>s.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),Ot=te(s=>{let e;return s.camera.isOrthographicCamera?e=Z(0,0,1):e=ln.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class Kj extends Be{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===ns?"false":e.getFrontFacing()}}const zL=Ee(Kj),uS=z(zL).mul(2).sub(1),rh=te(([s],{material:e})=>{const t=e.side;return t===ns?s=s.mul(-1):t===ql&&(s=s.mul(uS)),s}),Sy=Da("normal","vec3"),Ls=te(s=>s.geometry.hasAttribute("normal")===!1?(Ne('TSL: Vertex attribute "normal" not found on geometry.'),Z(0,1,0)):Sy,"vec3").once()().toVar("normalLocal"),VL=ln.dFdx().cross(ln.dFdy()).normalize().toVar("normalFlat"),eh=te(s=>{let e;return s.material.flatShading===!0?e=VL:e=cS(Ls).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),PL=te(s=>{let e=eh.transformDirection(Mi);return s.material.flatShading!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),mt=te(({subBuildFn:s,material:e,context:t})=>{let n;return s==="NORMAL"||s==="VERTEX"?(n=eh,e.flatShading!==!0&&(n=rh(n))):n=t.setupNormal().context({getUV:null}),n},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),Wo=mt.transformDirection(Mi).toVar("normalWorld"),kl=te(({subBuildFn:s,context:e})=>{let t;return s==="NORMAL"||s==="VERTEX"?t=mt:t=e.setupClearcoatNormal().context({getUV:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),IL=te(([s,e=pi])=>{const t=qn(e),n=s.div(Z(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(n).xyz}),cS=te(([s],e)=>{const t=e.context.modelNormalViewMatrix;if(t)return t.transformDirection(s);const n=OL.mul(s);return Mi.transformDirection(n)}),Jj=te(()=>(Ne('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),mt)).once(["NORMAL","VERTEX"])(),e7=te(()=>(Ne('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),Wo)).once(["NORMAL","VERTEX"])(),t7=te(()=>(Ne('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),kl)).once(["NORMAL","VERTEX"])(),k2=new bi,Z1=new gt,kL=ze(0).onReference(({material:s})=>s).onObjectUpdate(({material:s})=>s.refractionRatio),bg=ze(1).onReference(({material:s})=>s).onObjectUpdate(function({material:s,scene:e}){return s.envMap?s.envMapIntensity:e.environmentIntensity}),hS=ze(new gt).onReference(function(s){return s.material}).onObjectUpdate(function({material:s,scene:e}){const t=e.environment!==null&&s.envMap===null?e.environmentRotation:s.envMapRotation;return t?(k2.copy(t),Z1.makeRotationFromEuler(k2)):Z1.identity(),Z1}),GL=Ot.negate().reflect(mt),$L=Ot.negate().refract(mt,kL),HL=GL.transformDirection(Mi).toVar("reflectVector"),jL=$L.transformDirection(Mi).toVar("reflectVector"),qL=new ry;class n7 extends Mr{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,i=null){super(e,t,n,i),this.isCubeTextureNode=!0}getInputType(){return this.value.isDepthTexture===!0?"cubeDepthTexture":"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===Yc?HL:e.mapping===$g?jL:(Ae('CubeTextureNode: Mapping "%s" not supported.',e.mapping),Z(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return n.isDepthTexture===!0?e.renderer.coordinateSystem===xi?Z(t.x,t.y.negate(),t.z):t:((e.renderer.coordinateSystem===xi||!n.isRenderTargetTexture)&&(t=Z(t.x.negate(),t.yz)),hS.mul(t))}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}}const dS=We(n7).setParameterLength(1,4).setName("cubeTexture"),fs=(s=qL,e=null,t=null,n=null)=>{let i;return s&&s.isCubeTextureNode===!0?(i=Re(s.clone()),i.referenceNode=s,e!==null&&(i.uvNode=Re(e)),t!==null&&(i.levelNode=Re(t)),n!==null&&(i.biasNode=Re(n))):i=dS(s,e,t,n),i},s7=(s=qL)=>dS(s);class i7 extends su{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,n,i)}}class wy extends Be{static get type(){return"ReferenceNode"}constructor(e,t,n=null,i=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=i,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=Ye.OBJECT}element(e){return new i7(this,Re(e))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return Ne('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=Of(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Jn(null,e):e==="texture"?t=_t(null):e==="cubeTexture"?t=fs(null):t=ze(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let i=1;i<t.length;i++)n=n[t[i]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Et=(s,e,t)=>new wy(s,e,t),av=(s,e,t,n)=>new wy(s,e,n,t);class r7 extends wy{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const pa=(s,e,t=null)=>new r7(s,e,t),WL=Ct(),a7=ln.dFdx(),o7=ln.dFdy(),XL=WL.dFdx(),YL=WL.dFdy(),ZL=mt,QL=o7.cross(ZL),KL=ZL.cross(a7),ov=QL.mul(XL.x).add(KL.mul(YL.x)),lv=QL.mul(XL.y).add(KL.mul(YL.y)),G2=ov.dot(ov).max(lv.dot(lv)),JL=G2.equal(0).select(0,G2.inverseSqrt()),l7=ov.mul(JL).toVar("tangentViewFrame"),u7=lv.mul(JL).toVar("bitangentViewFrame"),My=Da("tangent","vec4"),zf=My.xyz.toVar("tangentLocal"),Ny=te(({subBuildFn:s,geometry:e,material:t})=>{let n;return s==="VERTEX"||e.hasAttribute("tangent")?n=qo.mul(Ie(zf,0)).xyz.toVarying("v_tangentView").normalize():n=l7,t.flatShading!==!0&&(n=rh(n)),n},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),eF=Ny.transformDirection(Mi).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),Ay=te(([s,e],{subBuildFn:t,material:n})=>{let i=s.mul(My.w).xyz;return t==="NORMAL"&&n.flatShading!==!0&&(i=i.toVarying(e)),i}).once(["NORMAL"]),c7=Ay(Sy.cross(My),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),h7=Ay(Ls.cross(zf),"v_bitangentLocal").normalize().toVar("bitangentLocal"),tF=te(({subBuildFn:s,geometry:e,material:t})=>{let n;return s==="VERTEX"||e.hasAttribute("tangent")?n=Ay(mt.cross(Ny),"v_bitangentView").normalize():n=u7,t.flatShading!==!0&&(n=rh(n)),n},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),d7=Ay(Wo.cross(eF),"v_bitangentWorld").normalize().toVar("bitangentWorld"),Gl=qn(Ny,tF,mt).toVar("TBNViewMatrix"),nF=Ot.mul(Gl),f7=(s,e)=>s.sub(nF.mul(e)),sF=te(()=>{let s=Xl.cross(Ot);return s=s.cross(Xl).normalize(),s=at(s,mt,No.mul(pr.oneMinus()).oneMinus().pow2().pow2()).normalize(),s}).once()(),iF=s=>Re(s).mul(.5).add(.5),p7=s=>Re(s).mul(2).sub(1),uv=s=>Z(s,ts(_y(z(1).sub(vi(s,s)))));class m7 extends nn{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=_a,this.unpackNormalMode=M1}setup({material:e}){const{normalMapType:t,scaleNode:n,unpackNormalMode:i}=this;let r=this.node.mul(2).sub(1);if(t===_a?i===MD?r=uv(r.xy):i===P8?r=uv(r.yw):i!==M1&&console.error(`THREE.NodeMaterial: Unexpected unpack normal mode: ${i}`):i!==M1&&console.error(`THREE.NodeMaterial: Normal map type '${t}' is not compatible with unpack normal mode '${i}'`),n!==null){let u=n;e.flatShading===!0&&(u=rh(u)),r=Z(r.xy.mul(u),r.z)}let o=null;return t===V8?o=cS(r):t===_a?o=Gl.mul(r).normalize():(Ae(`NodeMaterial: Unsupported normal map type: ${t}`),o=mt),o}}const cv=We(m7).setParameterLength(1,2),g7=te(({textureNode:s,bumpScale:e})=>{const t=i=>s.isolate().context({getUV:r=>i(r.uvNode||Ct()),forceUVContext:!0}),n=z(t(i=>i));return Se(z(t(i=>i.add(i.dFdx()))).sub(n),z(t(i=>i.add(i.dFdy()))).sub(n)).mul(e)}),y7=te(s=>{const{surf_pos:e,surf_norm:t,dHdxy:n}=s,i=e.dFdx().normalize(),r=e.dFdy().normalize(),o=t,u=r.cross(o),c=o.cross(i),d=i.dot(u).mul(uS),f=d.sign().mul(n.x.mul(u).add(n.y.mul(c)));return d.abs().mul(t).sub(f).normalize()});class x7 extends nn{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=g7({textureNode:this.textureNode,bumpScale:e});return y7({surf_pos:ln,surf_norm:mt,dHdxy:t})}}const fS=We(x7).setParameterLength(1,2),$2=new Map;class ye extends Be{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=$2.get(e);return n===void 0&&(n=pa(e,t),$2.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let i=null;if(n===ye.COLOR){const r=t.color!==void 0?this.getColor(n):Z();t.map&&t.map.isTexture===!0?i=r.mul(this.getTexture("map")):i=r}else if(n===ye.OPACITY){const r=this.getFloat(n);t.alphaMap&&t.alphaMap.isTexture===!0?i=r.mul(this.getTexture("alpha")):i=r}else if(n===ye.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?i=this.getTexture("specular").r:i=z(1);else if(n===ye.SPECULAR_INTENSITY){const r=this.getFloat(n);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?i=r.mul(this.getTexture(n).a):i=r}else if(n===ye.SPECULAR_COLOR){const r=this.getColor(n);t.specularColorMap&&t.specularColorMap.isTexture===!0?i=r.mul(this.getTexture(n).rgb):i=r}else if(n===ye.ROUGHNESS){const r=this.getFloat(n);t.roughnessMap&&t.roughnessMap.isTexture===!0?i=r.mul(this.getTexture(n).g):i=r}else if(n===ye.METALNESS){const r=this.getFloat(n);t.metalnessMap&&t.metalnessMap.isTexture===!0?i=r.mul(this.getTexture(n).b):i=r}else if(n===ye.EMISSIVE){const r=this.getFloat("emissiveIntensity"),o=this.getColor(n).mul(r);t.emissiveMap&&t.emissiveMap.isTexture===!0?i=o.mul(this.getTexture(n)):i=o}else if(n===ye.NORMAL)t.normalMap?(i=cv(this.getTexture("normal"),this.getCache("normalScale","vec2")),i.normalMapType=t.normalMapType,(t.normalMap.format==gr||t.normalMap.format==ff||t.normalMap.format==df)&&(i.unpackNormalMode=MD)):t.bumpMap?i=fS(this.getTexture("bump").r,this.getFloat("bumpScale")):i=mt;else if(n===ye.CLEARCOAT){const r=this.getFloat(n);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?i=r.mul(this.getTexture(n).r):i=r}else if(n===ye.CLEARCOAT_ROUGHNESS){const r=this.getFloat(n);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?i=r.mul(this.getTexture(n).r):i=r}else if(n===ye.CLEARCOAT_NORMAL)t.clearcoatNormalMap?i=cv(this.getTexture(n),this.getCache(n+"Scale","vec2")):i=mt;else if(n===ye.SHEEN){const r=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?i=r.mul(this.getTexture("sheenColor").rgb):i=r}else if(n===ye.SHEEN_ROUGHNESS){const r=this.getFloat(n);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?i=r.mul(this.getTexture(n).a):i=r,i=i.clamp(1e-4,1)}else if(n===ye.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const r=this.getTexture(n);i=fy(gc.x,gc.y,gc.y.negate(),gc.x).mul(r.rg.mul(2).sub(Se(1)).normalize().mul(r.b))}else i=gc;else if(n===ye.IRIDESCENCE_THICKNESS){const r=Et("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=Et("0","float",t.iridescenceThicknessRange);i=r.sub(o).mul(this.getTexture(n).g).add(o)}else i=r}else if(n===ye.TRANSMISSION){const r=this.getFloat(n);t.transmissionMap?i=r.mul(this.getTexture(n).r):i=r}else if(n===ye.THICKNESS){const r=this.getFloat(n);t.thicknessMap?i=r.mul(this.getTexture(n).g):i=r}else if(n===ye.IOR)i=this.getFloat(n);else if(n===ye.LIGHT_MAP)i=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===ye.AO)i=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(n===ye.LINE_DASH_OFFSET)i=t.dashOffset?this.getFloat(n):z(0);else{const r=this.getNodeType(e);i=this.getCache(n,r)}return i}}ye.ALPHA_TEST="alphaTest";ye.COLOR="color";ye.OPACITY="opacity";ye.SHININESS="shininess";ye.SPECULAR="specular";ye.SPECULAR_STRENGTH="specularStrength";ye.SPECULAR_INTENSITY="specularIntensity";ye.SPECULAR_COLOR="specularColor";ye.REFLECTIVITY="reflectivity";ye.ROUGHNESS="roughness";ye.METALNESS="metalness";ye.NORMAL="normal";ye.CLEARCOAT="clearcoat";ye.CLEARCOAT_ROUGHNESS="clearcoatRoughness";ye.CLEARCOAT_NORMAL="clearcoatNormal";ye.EMISSIVE="emissive";ye.ROTATION="rotation";ye.SHEEN="sheen";ye.SHEEN_ROUGHNESS="sheenRoughness";ye.ANISOTROPY="anisotropy";ye.IRIDESCENCE="iridescence";ye.IRIDESCENCE_IOR="iridescenceIOR";ye.IRIDESCENCE_THICKNESS="iridescenceThickness";ye.IOR="ior";ye.TRANSMISSION="transmission";ye.THICKNESS="thickness";ye.ATTENUATION_DISTANCE="attenuationDistance";ye.ATTENUATION_COLOR="attenuationColor";ye.LINE_SCALE="scale";ye.LINE_DASH_SIZE="dashSize";ye.LINE_GAP_SIZE="gapSize";ye.LINE_WIDTH="linewidth";ye.LINE_DASH_OFFSET="dashOffset";ye.POINT_SIZE="size";ye.DISPERSION="dispersion";ye.LIGHT_MAP="light";ye.AO="ao";const rF=Ee(ye,ye.ALPHA_TEST),aF=Ee(ye,ye.COLOR),oF=Ee(ye,ye.SHININESS),lF=Ee(ye,ye.EMISSIVE),pS=Ee(ye,ye.OPACITY),uF=Ee(ye,ye.SPECULAR),hv=Ee(ye,ye.SPECULAR_INTENSITY),cF=Ee(ye,ye.SPECULAR_COLOR),Wd=Ee(ye,ye.SPECULAR_STRENGTH),_g=Ee(ye,ye.REFLECTIVITY),hF=Ee(ye,ye.ROUGHNESS),dF=Ee(ye,ye.METALNESS),fF=Ee(ye,ye.NORMAL),pF=Ee(ye,ye.CLEARCOAT),mF=Ee(ye,ye.CLEARCOAT_ROUGHNESS),gF=Ee(ye,ye.CLEARCOAT_NORMAL),yF=Ee(ye,ye.ROTATION),xF=Ee(ye,ye.SHEEN),bF=Ee(ye,ye.SHEEN_ROUGHNESS),_F=Ee(ye,ye.ANISOTROPY),vF=Ee(ye,ye.IRIDESCENCE),TF=Ee(ye,ye.IRIDESCENCE_IOR),SF=Ee(ye,ye.IRIDESCENCE_THICKNESS),wF=Ee(ye,ye.TRANSMISSION),MF=Ee(ye,ye.THICKNESS),NF=Ee(ye,ye.IOR),AF=Ee(ye,ye.ATTENUATION_DISTANCE),EF=Ee(ye,ye.ATTENUATION_COLOR),RF=Ee(ye,ye.LINE_SCALE),CF=Ee(ye,ye.LINE_DASH_SIZE),DF=Ee(ye,ye.LINE_GAP_SIZE),b7=Ee(ye,ye.LINE_WIDTH),BF=Ee(ye,ye.LINE_DASH_OFFSET),LF=Ee(ye,ye.POINT_SIZE),FF=Ee(ye,ye.DISPERSION),mS=Ee(ye,ye.LIGHT_MAP),OF=Ee(ye,ye.AO),gc=ze(new Ge).onReference(function(s){return s.material}).onRenderUpdate(function({material:s}){this.value.set(s.anisotropy*Math.cos(s.anisotropyRotation),s.anisotropy*Math.sin(s.anisotropyRotation))}),UF=te(s=>s.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class _7 extends su{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const n=this.storageBufferNode.structTypeNode;return n?n.getMemberType(e,t):"void"}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let n;const i=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&i!==!0&&(this.node.value.isInstancedBufferAttribute||e.shaderStage!=="compute")?n=e.generatePBO(this):n=this.node.build(e):n=super.generate(e),i!==!0){const r=this.getNodeType(e);n=e.format(n,r,t)}return n}}const v7=We(_7).setParameterLength(2);class T7 extends rS{static get type(){return"StorageBufferNode"}constructor(e,t=null,n=0){let i,r=null;t&&t.isStruct?(i="struct",r=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(n=e.count)):t===null&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(i=WD(e.itemSize),n=e.count):i=t,super(e,i,n),this.isStorageBufferNode=!0,this.structTypeNode=r,this.access=$n.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return v7(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess($n.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=eS(this.value),this._varying=Rr(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return this.structTypeNode!==null?this.structTypeNode.getMemberType(e,t):"void"}generate(e){if(this.structTypeNode!==null&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:n}=this.getAttributeData(),i=n.build(e);return e.registerTransform(i,t),i}}const Aa=(s,e=null,t=0)=>new T7(s,e,t),S7=(s,e,t)=>(Ne('TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),Aa(s,e,t).setPBO(!0));class Xt extends Be{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let i;if(n===Xt.VERTEX)i=e.getVertexIndex();else if(n===Xt.INSTANCE)i=e.getInstanceIndex();else if(n===Xt.DRAW)i=e.getDrawIndex();else if(n===Xt.INVOCATION_LOCAL)i=e.getInvocationLocalIndex();else if(n===Xt.INVOCATION_SUBGROUP)i=e.getInvocationSubgroupIndex();else if(n===Xt.SUBGROUP)i=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let r;return e.shaderStage==="vertex"||e.shaderStage==="compute"?r=i:r=Rr(this).build(e,t),r}}Xt.VERTEX="vertex";Xt.INSTANCE="instance";Xt.SUBGROUP="subgroup";Xt.INVOCATION_LOCAL="invocationLocal";Xt.INVOCATION_SUBGROUP="invocationSubgroup";Xt.DRAW="draw";const zF=Ee(Xt,Xt.VERTEX),Sr=Ee(Xt,Xt.INSTANCE),w7=Ee(Xt,Xt.SUBGROUP),M7=Ee(Xt,Xt.INVOCATION_SUBGROUP),N7=Ee(Xt,Xt.INVOCATION_LOCAL),VF=Ee(Xt,Xt.DRAW);class PF extends Be{static get type(){return"InstanceNode"}constructor(e,t,n=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Ye.FRAME,this.buffer=null,this.bufferColor=null}get isStorageMatrix(){const{instanceMatrix:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}get isStorageColor(){const{instanceColor:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}setup(e){const{instanceMatrix:t,instanceColor:n,isStorageMatrix:i,isStorageColor:r}=this,{count:o}=t;let{instanceMatrixNode:u,instanceColorNode:c}=this;if(u===null){if(i)u=Aa(t,"mat4",Math.max(o,1)).element(Sr);else if(o<=1e3)u=Of(t.array,"mat4",Math.max(o,1)).element(Sr);else{const f=new mH(t.array,16,1);this.buffer=f;const p=t.usage===Pl?sv:N0,g=[p(f,"vec4",16,0),p(f,"vec4",16,4),p(f,"vec4",16,8),p(f,"vec4",16,12)];u=Po(...g)}this.instanceMatrixNode=u}if(n&&c===null){if(r)c=Aa(n,"vec3",Math.max(n.count,1)).element(Sr);else{const f=new Lc(n.array,3),p=n.usage===Pl?sv:N0;this.bufferColor=f,c=Z(p(f,"vec3",3,0))}this.instanceColorNode=c}const d=u.mul(Qt).xyz;if(Qt.assign(d),e.hasGeometryAttribute("normal")){const f=IL(Ls,u);Ls.assign(f)}this.instanceColorNode!==null&&gf("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.buffer!==null&&this.isStorageMatrix!==!0&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==Pl&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&this.isStorageColor!==!0&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==Pl&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}const A7=We(PF).setParameterLength(2,3);class E7 extends PF{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:i}=e;super(t,n,i),this.instancedMesh=e}}const IF=We(E7).setParameterLength(1);class R7 extends Be{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=Sr:this.batchingIdNode=VF);const n=te(([x])=>{const v=H(wa(sn(this.batchMesh._indirectTexture),0).x).toConst(),S=H(x).mod(v).toConst(),w=H(x).div(v).toConst();return sn(this.batchMesh._indirectTexture,vn(S,w)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(H(this.batchingIdNode)),i=this.batchMesh._matricesTexture,r=H(wa(sn(i),0).x).toConst(),o=z(n).mul(4).toInt().toConst(),u=o.mod(r).toConst(),c=o.div(r).toConst(),d=Po(sn(i,vn(u,c)),sn(i,vn(u.add(1),c)),sn(i,vn(u.add(2),c)),sn(i,vn(u.add(3),c))),f=this.batchMesh._colorsTexture;if(f!==null){const v=te(([S])=>{const w=H(wa(sn(f),0).x).toConst(),M=S,T=M.mod(w).toConst(),A=M.div(w).toConst();return sn(f,vn(T,A)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);gf("vec3","vBatchColor").assign(v)}const p=qn(d);Qt.assign(d.mul(Qt));const g=Ls.div(Z(p[0].dot(p[0]),p[1].dot(p[1]),p[2].dot(p[2]))),y=p.mul(g).xyz;Ls.assign(y),e.hasGeometryAttribute("tangent")&&zf.mulAssign(p)}}const kF=We(R7).setParameterLength(1),H2=new WeakMap;class GF extends Be{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Ye.OBJECT,this.skinIndexNode=Da("skinIndex","uvec4"),this.skinWeightNode=Da("skinWeight","vec4"),this.bindMatrixNode=Et("bindMatrix","mat4"),this.bindMatrixInverseNode=Et("bindMatrixInverse","mat4"),this.boneMatricesNode=av("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=Qt,this.toPositionNode=Qt,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:n,skinWeightNode:i,bindMatrixNode:r,bindMatrixInverseNode:o}=this,u=e.element(n.x),c=e.element(n.y),d=e.element(n.z),f=e.element(n.w),p=r.mul(t),g=pn(u.mul(i.x).mul(p),c.mul(i.y).mul(p),d.mul(i.z).mul(p),f.mul(i.w).mul(p));return o.mul(g).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=Ls){const{skinIndexNode:n,skinWeightNode:i,bindMatrixNode:r,bindMatrixInverseNode:o}=this,u=e.element(n.x),c=e.element(n.y),d=e.element(n.z),f=e.element(n.w);let p=pn(i.x.mul(u),i.y.mul(c),i.z.mul(d),i.w.mul(f));return p=o.mul(p).mul(r),p.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=av("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,A0)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||YD(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&A0.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const n=this.getSkinnedNormal();Ls.assign(n),e.hasGeometryAttribute("tangent")&&zf.assign(n)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;H2.get(t)!==e.frameId&&(H2.set(t,e.frameId),this.previousBoneMatricesNode!==null&&(t.previousBoneMatrices===null&&(t.previousBoneMatrices=new Float32Array(t.boneMatrices)),t.previousBoneMatrices.set(t.boneMatrices)),t.update())}}const $F=s=>new GF(s),C7=(s,e=null)=>{const t=new GF(s);return t.positionNode=Aa(new Lc(s.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(Sr).toVar(),t.skinIndexNode=Aa(new Lc(new Uint32Array(s.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(Sr).toVar(),t.skinWeightNode=Aa(new Lc(s.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(Sr).toVar(),t.bindMatrixNode=ze(s.bindMatrix,"mat4"),t.bindMatrixInverseNode=ze(s.bindMatrixInverse,"mat4"),t.boneMatricesNode=Of(s.skeleton.boneMatrices,"mat4",s.skeleton.bones.length),t.toPositionNode=e,Re(t)};class D7 extends Be{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const n={};for(let u=0,c=this.params.length-1;u<c;u++){const d=this.params[u],f=d.isNode!==!0&&d.name||this.getVarName(u),p=d.isNode!==!0&&d.type||"int";n[f]=Ca(f,p)}const i=e.addStack(),r=this.params[this.params.length-1](n);t.returnsNode=r.context({nodeLoop:r}),t.stackNode=i;const o=this.params[0];if(o.isNode!==!0&&typeof o.update=="function"){const u=te(this.params[0].update)(n);t.updateNode=u.context({nodeLoop:u})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),n=this.params,i=t.stackNode;for(let o=0,u=n.length-1;o<u;o++){const c=n[o];let d=!1,f=null,p=null,g=null,y=null,x=null,v=null;c.isNode?c.getNodeType(e)==="bool"?(d=!0,y="bool",p=c.build(e,y)):(y="int",g=this.getVarName(o),f="0",p=c.build(e,y),x="<"):(y=c.type||"int",g=c.name||this.getVarName(o),f=c.start,p=c.end,x=c.condition,v=c.update,typeof f=="number"?f=e.generateConst(y,f):f&&f.isNode&&(f=f.build(e,y)),typeof p=="number"?p=e.generateConst(y,p):p&&p.isNode&&(p=p.build(e,y)),f!==void 0&&p===void 0?(f=f+" - 1",p="0",x=">="):p!==void 0&&f===void 0&&(f="0",x="<"),x===void 0&&(Number(f)>Number(p)?x=">=":x="<"));let S;if(d)S=`while ( ${p} )`;else{const w={start:f,end:p},M=w.start,T=w.end;let A;const C=()=>x.includes("<")?"+=":"-=";if(v!=null)switch(typeof v){case"function":A=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":A=g+" "+C()+" "+e.generateConst(y,v);break;case"string":A=g+" "+v;break;default:v.isNode?A=g+" "+C()+" "+v.build(e):(Ae("TSL: 'Loop( { update: ... } )' is not a function, string or number."),A="break /* invalid update */")}else y==="int"||y==="uint"?v=x.includes("<")?"++":"--":v=C()+" 1.",A=g+" "+v;const D=e.getVar(y,g)+" = "+M,R=g+" "+x+" "+T;S=`for ( ${D}; ${R}; ${A} )`}e.addFlowCode((o===0?`
`:"")+e.tab+S+` {

`).addFlowTab()}const r=i.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+r);for(let o=0,u=this.params.length-1;o<u;o++)e.addFlowCode((o===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}}const At=(...s)=>new D7(Wl(s,"int")).toStack(),B7=()=>Ca("continue").toStack(),HF=()=>Ca("break").toStack(),Q1=new WeakMap,qs=new yt,j2=te(({bufferMap:s,influence:e,stride:t,width:n,depth:i,offset:r})=>{const o=H(zF).mul(t).add(r),u=o.div(n),c=o.sub(u.mul(n));return sn(s,vn(c,u)).depth(i).xyz.mul(e)});function L7(s){const e=s.morphAttributes.position!==void 0,t=s.morphAttributes.normal!==void 0,n=s.morphAttributes.color!==void 0,i=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,r=i!==void 0?i.length:0;let o=Q1.get(s);if(o===void 0||o.count!==r){let M=function(){S.dispose(),Q1.delete(s),s.removeEventListener("dispose",M)};var u=M;o!==void 0&&o.texture.dispose();const c=s.morphAttributes.position||[],d=s.morphAttributes.normal||[],f=s.morphAttributes.color||[];let p=0;e===!0&&(p=1),t===!0&&(p=2),n===!0&&(p=3);let g=s.attributes.position.count*p,y=1;const x=4096;g>x&&(y=Math.ceil(g/x),g=x);const v=new Float32Array(g*y*4*r),S=new T9(v,g,y,r);S.type=Ns,S.needsUpdate=!0;const w=p*4;for(let T=0;T<r;T++){const A=c[T],C=d[T],D=f[T],R=g*y*4*T;for(let B=0;B<A.count;B++){const L=B*w;e===!0&&(qs.fromBufferAttribute(A,B),v[R+L+0]=qs.x,v[R+L+1]=qs.y,v[R+L+2]=qs.z,v[R+L+3]=0),t===!0&&(qs.fromBufferAttribute(C,B),v[R+L+4]=qs.x,v[R+L+5]=qs.y,v[R+L+6]=qs.z,v[R+L+7]=0),n===!0&&(qs.fromBufferAttribute(D,B),v[R+L+8]=qs.x,v[R+L+9]=qs.y,v[R+L+10]=qs.z,v[R+L+11]=D.itemSize===4?qs.w:1)}}o={count:r,texture:S,stride:p,size:new Ge(g,y)},Q1.set(s,o),s.addEventListener("dispose",M)}return o}class F7 extends Be{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=ze(1),this.updateType=Ye.OBJECT}setup(e){const{geometry:t}=e,n=t.morphAttributes.position!==void 0,i=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,r=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=r!==void 0?r.length:0,{texture:u,stride:c,size:d}=L7(t);n===!0&&Qt.mulAssign(this.morphBaseInfluence),i===!0&&Ls.mulAssign(this.morphBaseInfluence);const f=H(d.width);At(o,({i:p})=>{const g=z(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?g.assign(sn(this.mesh.morphTexture,vn(H(p).add(1),H(Sr))).r):g.assign(Et("morphTargetInfluences","float").element(p).toVar()),ke(g.notEqual(0),()=>{n===!0&&Qt.addAssign(j2({bufferMap:u,influence:g,stride:c,width:f,depth:p,offset:H(0)})),i===!0&&Ls.addAssign(j2({bufferMap:u,influence:g,stride:c,width:f,depth:p,offset:H(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,n)=>t+n,0)}}const jF=We(F7).setParameterLength(1);class ah extends Be{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class O7 extends ah{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class U7 extends iL{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,i=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=i,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n=Z().toVar("directDiffuse"),i=Z().toVar("directSpecular"),r=Z().toVar("indirectDiffuse"),o=Z().toVar("indirectSpecular"),u={directDiffuse:n,directSpecular:i,indirectDiffuse:r,indirectSpecular:o};return{radiance:Z().toVar("radiance"),irradiance:Z().toVar("irradiance"),iblIrradiance:Z().toVar("iblIrradiance"),ambientOcclusion:z(1).toVar("ambientOcclusion"),reflectedLight:u,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const qF=We(U7);class z7 extends ah{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const lc=new Ge;class Ey extends Mr{static get type(){return"ViewportTextureNode"}constructor(e=Ma,t=null,n=null){let i=null;n===null?(i=new aT,i.minFilter=xa,n=i):i=n,super(n,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=i,this.isOutputTextureNode=!0,this.updateBeforeType=Ye.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,n;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,n=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,n=this._cacheTextures),e===null)return t;if(n.has(e)===!1){const i=t.clone();n.set(e,i)}return n.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,n=t.getRenderTarget();n===null?t.getDrawingBufferSize(lc):lc.set(n.width,n.height);const i=this.getTextureForReference(n);(i.image.width!==lc.width||i.image.height!==lc.height)&&(i.image.width=lc.width,i.image.height=lc.height,i.needsUpdate=!0);const r=i.generateMipmaps;i.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(i),i.generateMipmaps=r}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const V7=We(Ey).setParameterLength(0,3),gS=We(Ey,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let km=null;class P7 extends Ey{static get type(){return"ViewportDepthTextureNode"}constructor(e=Ma,t=null){km===null&&(km=new gi),super(e,t,km)}getTextureForReference(){return km}}const yS=We(P7).setParameterLength(0,2);class Es extends Be{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Es.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let i=null;if(t===Es.DEPTH_BASE)n!==null&&(i=XF().assign(n));else if(t===Es.DEPTH)e.isPerspectiveCamera?i=WF(ln.z,Co,Do):i=Vc(ln.z,Co,Do);else if(t===Es.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const r=xS(n,Co,Do);i=Vc(r,Co,Do)}else i=n;else i=Vc(ln.z,Co,Do);return i}}Es.DEPTH_BASE="depthBase";Es.DEPTH="depth";Es.LINEAR_DEPTH="linearDepth";const Vc=(s,e,t)=>s.add(e).div(e.sub(t)),I7=(s,e,t)=>e.sub(t).mul(s).sub(e),WF=(s,e,t)=>e.add(s).mul(t).div(t.sub(e).mul(s)),xS=(s,e,t)=>e.mul(t).div(t.sub(e).mul(s).sub(t)),bS=(s,e,t)=>{e=e.max(1e-6).toVar();const n=br(s.negate().div(e)),i=br(t.div(e));return n.div(i)},k7=(s,e,t)=>{const n=s.mul(gy(t.div(e)));return z(Math.E).pow(n).mul(e).negate()},XF=We(Es,Es.DEPTH_BASE),_S=Ee(Es,Es.DEPTH),E0=We(Es,Es.LINEAR_DEPTH).setParameterLength(0,1),G7=E0(yS());_S.assign=s=>XF(s);class yi extends Be{static get type(){return"ClippingNode"}constructor(e=yi.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:i}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===yi.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,i):this.scope===yi.HARDWARE?this.setupHardwareClipping(i,e):this.setupDefault(n,i)}setupAlphaToCoverage(e,t){return te(()=>{const n=z().toVar("distanceToPlane"),i=z().toVar("distanceToGradient"),r=z(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const c=Jn(t).setGroup(Ue);At(o,({i:d})=>{const f=c.element(d);n.assign(ln.dot(f.xyz).negate().add(f.w)),i.assign(n.fwidth().div(2)),r.mulAssign(Yi(i.negate(),i,n))})}const u=e.length;if(u>0){const c=Jn(e).setGroup(Ue),d=z(1).toVar("intersectionClipOpacity");At(u,({i:f})=>{const p=c.element(f);n.assign(ln.dot(p.xyz).negate().add(p.w)),i.assign(n.fwidth().div(2)),d.mulAssign(Yi(i.negate(),i,n).oneMinus())}),r.mulAssign(d.oneMinus())}Nt.a.mulAssign(r),Nt.a.equal(0).discard()})()}setupDefault(e,t){return te(()=>{const n=t.length;if(this.hardwareClipping===!1&&n>0){const r=Jn(t).setGroup(Ue);At(n,({i:o})=>{const u=r.element(o);ln.dot(u.xyz).greaterThan(u.w).discard()})}const i=e.length;if(i>0){const r=Jn(e).setGroup(Ue),o=_i(!0).toVar("clipped");At(i,({i:u})=>{const c=r.element(u);o.assign(ln.dot(c.xyz).greaterThan(c.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),te(()=>{const i=Jn(e).setGroup(Ue),r=Oa(t.getClipDistance());At(n,({i:o})=>{const u=i.element(o),c=ln.dot(u.xyz).sub(u.w).negate();r.element(o).assign(c)})})()}}yi.ALPHA_TO_COVERAGE="alphaToCoverage";yi.DEFAULT="default";yi.HARDWARE="hardware";const $7=()=>new yi,H7=()=>new yi(yi.ALPHA_TO_COVERAGE),j7=()=>new yi(yi.HARDWARE),q7=.05,q2=te(([s])=>Wi(qe(1e4,hs(qe(17,s.x).add(qe(.1,s.y)))).mul(pn(.1,It(hs(qe(13,s.y).add(s.x))))))),W2=te(([s])=>q2(Se(q2(s.xy),s.z))),W7=te(([s])=>{const e=Jt(vr(kT(s.xyz)),vr(GT(s.xyz))),t=z(1).div(z(q7).mul(e)).toVar("pixScale"),n=Se(Jc(_r(br(t))),Jc(yy(br(t)))),i=Se(W2(_r(n.x.mul(s.xyz))),W2(_r(n.y.mul(s.xyz)))),r=Wi(br(t)),o=pn(qe(r.oneMinus(),i.x),qe(r,i.y)),u=Bs(r,r.oneMinus()),c=Z(o.mul(o).div(qe(2,u).mul(ot(1,u))),o.sub(qe(.5,u)).div(ot(1,u)),ot(1,ot(1,o).mul(ot(1,o)).div(qe(2,u).mul(ot(1,u))))),d=o.lessThan(u.oneMinus()).select(o.lessThan(u).select(c.x,c.y),c.z);return Xi(d,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class X7 extends CL{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),n=e.hasGeometryAttribute(t);let i;return n===!0?i=super.generate(e):i=e.generateConst(this.nodeType,new yt(1,1,1,1)),i}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const YF=(s=0)=>new X7(s),ZF=te(([s,e])=>Bs(1,s.oneMinus().div(e)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),QF=te(([s,e])=>Bs(s.div(e.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),KF=te(([s,e])=>s.oneMinus().mul(e.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),JF=te(([s,e])=>at(s.mul(2).mul(e),s.oneMinus().mul(2).mul(e.oneMinus()).oneMinus(),by(.5,s))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Y7=te(([s,e])=>{const t=e.a.add(s.a.mul(e.a.oneMinus()));return Ie(e.rgb.mul(e.a).add(s.rgb.mul(s.a).mul(e.a.oneMinus())).div(t),t)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),eO=te(([s])=>Ie(s.rgb.mul(s.a),s.a),{color:"vec4",return:"vec4"}),Z7=te(([s])=>(ke(s.a.equal(0),()=>Ie(0)),Ie(s.rgb.div(s.a),s.a)),{color:"vec4",return:"vec4"}),Q7=(...s)=>(Ne('TSL: "burn" has been renamed. Use "blendBurn" instead.'),ZF(s)),K7=(...s)=>(Ne('TSL: "dodge" has been renamed. Use "blendDodge" instead.'),QF(s)),J7=(...s)=>(Ne('TSL: "screen" has been renamed. Use "blendScreen" instead.'),KF(s)),eq=(...s)=>(Ne('TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),JF(s));class en extends Ds{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,this.contextNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{Ne('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const n=this[t];n&&n.isNode===!0&&e.push({property:t,childNode:n})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:n}of this._getNodeChildren())e.push(Bf(t.slice(0,-4)),n.getCacheKey());return this.type+ih(e)}build(e){this.setup(e)}setupObserver(e){return new _H(e)}setup(e){e.context.setupNormal=()=>Uc(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();t.contextNode.isContextNode===!0?e.context={...e.context,...t.contextNode.getFlowContextData()}:Ae('NodeMaterial: "renderer.contextNode" must be an instance of `context()`.'),this.contextNode!==null&&(this.contextNode.isContextNode===!0?e.context={...e.context,...this.contextNode.getFlowContextData()}:Ae('NodeMaterial: "material.contextNode" must be an instance of `context()`.')),e.addStack();const i=Uc(this.setupVertex(e),"VERTEX"),r=this.vertexNode||i;e.stack.outputNode=r,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let o;const u=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const c=this.setupLighting(e);u!==null&&e.stack.addToStack(u);const d=Ie(c,Nt.a).max(0);o=this.setupOutput(e,d),Oc.assign(o);const f=this.outputNode!==null;if(f&&(o=this.outputNode),e.context.getOutput&&(o=e.context.getOutput(o,e)),n!==null){const p=t.getMRT(),g=this.mrtNode;p!==null?(f&&Oc.assign(o),o=p,g!==null&&(o=p.merge(g))):g!==null&&(o=g)}}else{let c=this.fragmentNode;c.isOutputStructNode!==!0&&(c=Ie(c)),o=this.setupOutput(e,c)}e.stack.outputNode=o,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let i=null;if(t.length>0||n.length>0){const r=e.renderer.currentSamples;this.alphaToCoverage&&r>1?i=H7():e.stack.addToStack($7())}return i}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(j7()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let i=this.depthNode;if(i===null){const r=t.getMRT();r&&r.has("depth")?i=r.get("depth"):t.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?i=bS(ln.z,Co,Do):i=Vc(ln.z,Co,Do))}i!==null&&_S.assign(i).toStack()}setupPositionView(){return qo.mul(Qt).xyz}setupModelViewProjection(){return Na.mul(ln)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),UF}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&jF(t).toStack(),t.isSkinnedMesh===!0&&$F(t).toStack(),this.displacementMap){const i=pa("displacementMap","texture"),r=pa("displacementScale","float"),o=pa("displacementBias","float");Qt.addAssign(Ls.normalize().mul(i.x.mul(r).add(o)))}return t.isBatchedMesh&&kF(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&IF(t).toStack(),this.positionNode!==null&&Qt.assign(Uc(this.positionNode,"POSITION","vec3")),Qt}setupDiffuseColor(e){const{object:t,geometry:n}=e;this.maskNode!==null&&_i(this.maskNode).not().discard();let i=this.colorNode?Ie(this.colorNode):aF;this.vertexColors===!0&&n.hasAttribute("color")&&(i=i.mul(YF())),t.instanceColor&&(i=gf("vec3","vInstanceColor").mul(i)),t.isBatchedMesh&&t._colorsTexture&&(i=gf("vec3","vBatchColor").mul(i)),Nt.assign(i);const r=this.opacityNode?z(this.opacityNode):pS;Nt.a.assign(Nt.a.mul(r));let o=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(o=this.alphaTestNode!==null?z(this.alphaTestNode):rF,this.alphaToCoverage===!0?(Nt.a=Yi(o,o.add(HT(Nt.a)),Nt.a),Nt.a.lessThanEqual(0).discard()):Nt.a.lessThanEqual(o).discard()),this.alphaHash===!0&&Nt.a.lessThan(W7(Qt)).discard(),e.isOpaque()&&Nt.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?Z(0):Nt.rgb}setupNormal(){return this.normalNode?Z(this.normalNode):fF}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?pa("envMap","cubeTexture"):pa("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new z7(mS)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const i=this.setupLightMap(e);i&&i.isLightingNode&&t.push(i);let r=this.aoNode;r===null&&e.material.aoMap&&(r=OF),e.context.getAO&&(r=e.context.getAO(r,e)),r&&t.push(new O7(r));let o=this.lightsNode||e.lightsNode;return t.length>0&&(o=e.renderer.lighting.createNode([...o.getLights(),...t])),o}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:i,emissiveNode:r}=this,u=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=this.setupOutgoingLight(e);if(u&&u.getScope().hasLights){const d=this.setupLightingModel(e)||null;c=qF(u,d,n,i)}else n!==null&&(c=Z(i!==null?at(c,n,i):n));return(r&&r.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(tv.assign(Z(r||lF)),c=c.add(tv)),c}setupFog(e,t){const n=e.fogNode;return n&&(Oc.assign(t),t=Ie(n.toVar())),t}setupPremultipliedAlpha(e,t){return eO(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const n in e){const i=e[n];this[n]===void 0&&(this[n]=i,i&&i.clone&&(this[n]=i.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&t[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const n=Ds.prototype.toJSON.call(this,e);n.inputNodes={};for(const{property:r,childNode:o}of this._getNodeChildren())n.inputNodes[r]=o.toJSON(e).uuid;function i(r){const o=[];for(const u in r){const c=r[u];delete c.metadata,o.push(c)}return o}if(t){const r=i(e.textures),o=i(e.images),u=i(e.nodes);r.length>0&&(n.textures=r),o.length>0&&(n.images=o),u.length>0&&(n.nodes=u)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,this.contextNode=e.contextNode,super.copy(e)}}const tq=new $D;class nq extends en{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(tq),this.setValues(e)}}const sq=new nH;class iq extends en{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(sq),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?z(this.offsetNode):BF,t=this.dashScaleNode?z(this.dashScaleNode):RF,n=this.dashSizeNode?z(this.dashSizeNode):CF,i=this.gapSizeNode?z(this.gapSizeNode):DF;gg.assign(n),nv.assign(i);const r=Rr(Da("lineDistance").mul(t));(e?r.add(e):r).mod(gg.add(nv)).greaterThan(gg).discard()}}let Gm=null;class rq extends Ey{static get type(){return"ViewportSharedTextureNode"}constructor(e=Ma,t=null){Gm===null&&(Gm=new aT),super(e,t,Gm)}getTextureForReference(){return Gm}updateReference(){return this}}const aq=We(rq).setParameterLength(0,2),oq=new J9;class lq extends en{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(oq),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?z(this.opacityNode):pS;Nt.assign(vy(Ie(iF(mt),e),cs))}}const vS=te(([s=lS])=>{const e=s.z.atan(s.x).mul(1/(Math.PI*2)).add(.5),t=s.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Se(e,t)});class tO extends I9{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,i=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r=new us(5,5,5),o=vS(lS),u=new en;u.colorNode=_t(t,o,0),u.side=ns,u.blending=Xc;const c=new Rn(r,u),d=new ay;d.add(c),t.minFilter===xa&&(t.minFilter=ms);const f=new ID(1,10,this),p=e.getMRT();return e.setMRT(null),f.update(e,d),e.setMRT(p),t.minFilter=n,t.currentGenerateMipmaps=i,c.geometry.dispose(),c.material.dispose(),this}}const Xd=new WeakMap;class uq extends nn{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=fs(null);const t=new ry;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Ye.RENDER}updateBefore(e){const{renderer:t,material:n}=e,i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const r=i.isTextureNode?i.value:n[i.property];if(r&&r.isTexture){const o=r.mapping;if(o===Q0||o===Zv){if(Xd.has(r)){const u=Xd.get(r);X2(u,r.mapping),this._cubeTexture=u}else{const u=r.image;if(cq(u)){const c=new tO(u.height);c.fromEquirectangularTexture(t,r),X2(c.texture,r.mapping),this._cubeTexture=c.texture,Xd.set(r,c.texture),r.addEventListener("dispose",nO)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function cq(s){return s==null?!1:s.height>0}function nO(s){const e=s.target;e.removeEventListener("dispose",nO);const t=Xd.get(e);t!==void 0&&(Xd.delete(e),t.dispose())}function X2(s,e){e===Q0?s.mapping=Yc:e===Zv&&(s.mapping=$g)}const sO=We(uq).setParameterLength(1);class TS extends ah{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=sO(this.envNode)}}class hq extends ah{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=z(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Ry{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class iO extends Ry{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,i=e.irradianceLightMap;n.indirectDiffuse.assign(Ie(0)),i?n.indirectDiffuse.addAssign(i):n.indirectDiffuse.addAssign(Ie(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(Nt.rgb)}finish(e){const{material:t,context:n}=e,i=n.outgoingLight,r=e.context.environment;if(r)switch(t.combine){case Z0:i.rgb.assign(at(i.rgb,i.rgb.mul(r.rgb),Wd.mul(_g)));break;case A8:i.rgb.assign(at(i.rgb,r.rgb,Wd.mul(_g)));break;case E8:i.rgb.addAssign(r.rgb.mul(Wd.mul(_g)));break;default:Ne("BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const dq=new Eo;class rO extends en{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(dq),this.setValues(e)}setupNormal(){return rh(eh)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new TS(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new hq(mS)),t}setupOutgoingLight(){return Nt.rgb}setupLightingModel(){return new iO}}const th=te(({f0:s,f90:e,dotVH:t})=>{const n=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return s.mul(n.oneMinus()).add(e.mul(n))}),eu=te(s=>s.diffuseColor.mul(1/Math.PI)),fq=()=>z(.25),pq=te(({dotNH:s})=>S0.mul(z(.5)).add(1).mul(z(1/Math.PI)).mul(s.pow(S0))),mq=te(({lightDirection:s})=>{const e=s.add(Ot).normalize(),t=mt.dot(e).clamp(),n=Ot.dot(e).clamp(),i=th({f0:Ho,f90:1,dotVH:n}),r=fq(),o=pq({dotNH:t});return i.mul(r).mul(o)});class aO extends iO{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const r=mt.dot(e).clamp().mul(t);n.directDiffuse.addAssign(r.mul(eu({diffuseColor:Nt.rgb}))),this.specular===!0&&n.directSpecular.addAssign(r.mul(mq({lightDirection:e})).mul(Wd))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(n.mul(eu({diffuseColor:Nt}))),i.indirectDiffuse.mulAssign(t)}}const gq=new eH;class yq extends en{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(gq),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new TS(t):null}setupLightingModel(){return new aO(!1)}}const xq=new Q9;class bq extends en{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(xq),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new TS(t):null}setupLightingModel(){return new aO}setupVariants(){const e=(this.shininessNode?z(this.shininessNode):oF).max(1e-4);S0.assign(e);const t=this.specularNode||uF;Ho.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const oO=te(s=>{if(s.geometry.hasAttribute("normal")===!1)return z(0);const e=eh.dFdx().abs().max(eh.dFdy().abs());return e.x.max(e.y).max(e.z)}),SS=te(s=>{const{roughness:e}=s,t=oO();let n=e.max(.0525);return n=n.add(t),n=n.min(1),n}),lO=te(({alpha:s,dotNL:e,dotNV:t})=>{const n=s.pow2(),i=e.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt()),r=t.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return ti(.5,i.add(r).max(OT))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),_q=te(({alphaT:s,alphaB:e,dotTV:t,dotBV:n,dotTL:i,dotBL:r,dotNV:o,dotNL:u})=>{const c=u.mul(Z(s.mul(t),e.mul(n),o).length()),d=o.mul(Z(s.mul(i),e.mul(r),u).length());return ti(.5,c.add(d))}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),uO=te(({alpha:s,dotNH:e})=>{const t=s.pow2(),n=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),vq=z(1/Math.PI),Tq=te(({alphaT:s,alphaB:e,dotNH:t,dotTH:n,dotBH:i})=>{const r=s.mul(e),o=Z(e.mul(n),s.mul(i),r.mul(t)),u=o.dot(o),c=r.div(u);return vq.mul(r.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),wS=te(({lightDirection:s,f0:e,f90:t,roughness:n,f:i,normalView:r=mt,USE_IRIDESCENCE:o,USE_ANISOTROPY:u})=>{const c=n.pow2(),d=s.add(Ot).normalize(),f=r.dot(s).clamp(),p=r.dot(Ot).clamp(),g=r.dot(d).clamp(),y=Ot.dot(d).clamp();let x=th({f0:e,f90:t,dotVH:y}),v,S;if(pf(o)&&(x=py.mix(x,i)),pf(u)){const w=jd.dot(s),M=jd.dot(Ot),T=jd.dot(d),A=Xl.dot(s),C=Xl.dot(Ot),D=Xl.dot(d);v=_q({alphaT:T0,alphaB:c,dotTV:M,dotBV:C,dotTL:w,dotBL:A,dotNV:p,dotNL:f}),S=Tq({alphaT:T0,alphaB:c,dotNH:g,dotTH:T,dotBH:D})}else v=lO({alpha:c,dotNL:f,dotNV:p}),S=uO({alpha:c,dotNH:g});return x.mul(v).mul(S)}),Sq=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let ur=null;const xf=te(({roughness:s,dotNV:e})=>{ur===null&&(ur=new GD(Sq,16,16,gr,Gn),ur.name="DFG_LUT",ur.minFilter=ms,ur.magFilter=ms,ur.wrapS=mr,ur.wrapT=mr,ur.generateMipmaps=!1,ur.needsUpdate=!0);const t=Se(s,e);return _t(ur,t).rg}),wq=te(({lightDirection:s,f0:e,f90:t,roughness:n,f:i,USE_IRIDESCENCE:r,USE_ANISOTROPY:o})=>{const u=wS({lightDirection:s,f0:e,f90:t,roughness:n,f:i,USE_IRIDESCENCE:r,USE_ANISOTROPY:o}),c=mt.dot(s).clamp(),d=mt.dot(Ot).clamp(),f=xf({roughness:n,dotNV:d}),p=xf({roughness:n,dotNV:c}),g=e.mul(f.x).add(t.mul(f.y)),y=e.mul(p.x).add(t.mul(p.y)),x=f.x.add(f.y),v=p.x.add(p.y),S=z(1).sub(x),w=z(1).sub(v),M=e.add(e.oneMinus().mul(.047619)),T=g.mul(y).mul(M).div(z(1).sub(S.mul(w).mul(M).mul(M)).add(OT)),A=S.mul(w),C=T.mul(A);return u.add(C)}),cO=te(s=>{const{dotNV:e,specularColor:t,specularF90:n,roughness:i}=s,r=xf({dotNV:e,roughness:i});return t.mul(r.x).add(n.mul(r.y))}),dv=te(({f:s,f90:e,dotVH:t})=>{const n=t.oneMinus().saturate(),i=n.mul(n),r=n.mul(i,i).clamp(0,.9999);return s.sub(Z(e).mul(r)).div(r.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Mq=te(({roughness:s,dotNH:e})=>{const t=s.pow2(),n=z(1).div(t),r=e.pow2().oneMinus().max(.0078125);return z(2).add(n).mul(r.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Nq=te(({dotNV:s,dotNL:e})=>z(1).div(z(4).mul(e.add(s).sub(e.mul(s))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Aq=te(({lightDirection:s})=>{const e=s.add(Ot).normalize(),t=mt.dot(s).clamp(),n=mt.dot(Ot).clamp(),i=mt.dot(e).clamp(),r=Mq({roughness:Ro,dotNH:i}),o=Nq({dotNV:n,dotNL:t});return Ws.mul(r).mul(o)}),Eq=te(({N:s,V:e,roughness:t})=>{const r=.0078125,o=s.dot(e).saturate(),u=Se(t,o.oneMinus().sqrt());return u.assign(u.mul(.984375).add(r)),u}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),Rq=te(({f:s})=>{const e=s.length();return Jt(e.mul(e).add(s.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),$m=te(({v1:s,v2:e})=>{const t=s.dot(e),n=t.abs().toVar(),i=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),r=n.add(4.1616724).mul(n).add(3.417594).toVar(),o=i.div(r),u=t.greaterThan(0).select(o,Jt(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return s.cross(e).mul(u)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),Y2=te(({N:s,V:e,P:t,mInv:n,p0:i,p1:r,p2:o,p3:u})=>{const c=r.sub(i).toVar(),d=u.sub(i).toVar(),f=c.cross(d),p=Z().toVar();return ke(f.dot(t.sub(i)).greaterThanEqual(0),()=>{const g=e.sub(s.mul(e.dot(s))).normalize(),y=s.cross(g).negate(),x=n.mul(qn(g,y,s).transpose()).toVar(),v=x.mul(i.sub(t)).normalize().toVar(),S=x.mul(r.sub(t)).normalize().toVar(),w=x.mul(o.sub(t)).normalize().toVar(),M=x.mul(u.sub(t)).normalize().toVar(),T=Z(0).toVar();T.addAssign($m({v1:v,v2:S})),T.addAssign($m({v1:S,v2:w})),T.addAssign($m({v1:w,v2:M})),T.addAssign($m({v1:M,v2:v})),p.assign(Z(Rq({f:T})))}),p}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Cy=1/6,hO=s=>qe(Cy,qe(s,qe(s,s.negate().add(3)).sub(3)).add(1)),fv=s=>qe(Cy,qe(s,qe(s,qe(3,s).sub(6))).add(4)),dO=s=>qe(Cy,qe(s,qe(s,qe(-3,s).add(3)).add(3)).add(1)),pv=s=>qe(Cy,fi(s,3)),Z2=s=>hO(s).add(fv(s)),Q2=s=>dO(s).add(pv(s)),K2=s=>pn(-1,fv(s).div(hO(s).add(fv(s)))),J2=s=>pn(1,pv(s).div(dO(s).add(pv(s)))),eR=(s,e,t)=>{const n=s.uvNode,i=qe(n,e.zw).add(.5),r=_r(i),o=Wi(i),u=Z2(o.x),c=Q2(o.x),d=K2(o.x),f=J2(o.x),p=K2(o.y),g=J2(o.y),y=Se(r.x.add(d),r.y.add(p)).sub(.5).mul(e.xy),x=Se(r.x.add(f),r.y.add(p)).sub(.5).mul(e.xy),v=Se(r.x.add(d),r.y.add(g)).sub(.5).mul(e.xy),S=Se(r.x.add(f),r.y.add(g)).sub(.5).mul(e.xy),w=Z2(o.y).mul(pn(u.mul(s.sample(y).level(t)),c.mul(s.sample(x).level(t)))),M=Q2(o.y).mul(pn(u.mul(s.sample(v).level(t)),c.mul(s.sample(S).level(t))));return w.add(M)},MS=te(([s,e])=>{const t=Se(s.size(H(e))),n=Se(s.size(H(e.add(1)))),i=ti(1,t),r=ti(1,n),o=eR(s,Ie(i,t),_r(e)),u=eR(s,Ie(r,n),yy(e));return Wi(e).mix(o,u)}),Cq=te(([s,e])=>{const t=e.mul(sS(s));return MS(s,t)}),tR=te(([s,e,t,n,i])=>{const r=Z(XT(e.negate(),ps(s),ti(1,n))),o=Z(vr(i[0].xyz),vr(i[1].xyz),vr(i[2].xyz));return ps(r).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),Dq=te(([s,e])=>s.mul(Xi(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),Bq=gS(),Lq=gS(),nR=te(([s,e,t],{material:n})=>{const r=(n.side===ns?Bq:Lq).sample(s),o=br(Jl.x).mul(Dq(e,t));return MS(r,o)}),sR=te(([s,e,t])=>(ke(t.notEqual(0),()=>{const n=gy(e).negate().div(t);return UT(n.negate().mul(s))}),Z(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),Fq=te(([s,e,t,n,i,r,o,u,c,d,f,p,g,y,x])=>{let v,S;if(x){v=Ie().toVar(),S=Z().toVar();const C=f.sub(1).mul(x.mul(.025)),D=Z(f.sub(C),f,f.add(C));At({start:0,end:3},({i:R})=>{const B=D.element(R),L=tR(s,e,p,B,u),X=o.add(L),G=d.mul(c.mul(Ie(X,1))),j=Se(G.xy.div(G.w)).toVar();j.addAssign(1),j.divAssign(2),j.assign(Se(j.x,j.y.oneMinus()));const ee=nR(j,t,B);v.element(R).assign(ee.element(R)),v.a.addAssign(ee.a),S.element(R).assign(n.element(R).mul(sR(vr(L),g,y).element(R)))}),v.a.divAssign(3)}else{const C=tR(s,e,p,f,u),D=o.add(C),R=d.mul(c.mul(Ie(D,1))),B=Se(R.xy.div(R.w)).toVar();B.addAssign(1),B.divAssign(2),B.assign(Se(B.x,B.y.oneMinus())),v=nR(B,t,f),S=n.mul(sR(vr(C),g,y))}const w=S.rgb.mul(v.rgb),M=s.dot(e).clamp(),T=Z(cO({dotNV:M,specularColor:i,specularF90:r,roughness:t})),A=S.r.add(S.g,S.b).div(3);return Ie(T.oneMinus().mul(w),v.a.oneMinus().mul(A).oneMinus())}),Oq=qn(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Uq=s=>{const e=s.sqrt();return Z(1).add(e).div(Z(1).sub(e))},iR=(s,e)=>s.sub(e).div(s.add(e)).pow2(),zq=(s,e)=>{const t=s.mul(2*Math.PI*1e-9),n=Z(54856e-17,44201e-17,52481e-17),i=Z(1681e3,1795300,2208400),r=Z(43278e5,93046e5,66121e5),o=z(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let u=n.mul(r.mul(2*Math.PI).sqrt()).mul(i.mul(t).add(e).cos()).mul(t.pow2().negate().mul(r).exp());return u=Z(u.x.add(o),u.y,u.z).div(10685e-11),Oq.mul(u)},rR=te(({outsideIOR:s,eta2:e,cosTheta1:t,thinFilmThickness:n,baseF0:i})=>{const r=at(s,e,Yi(0,.03,n)),u=s.div(r).pow2().mul(t.pow2().oneMinus()).oneMinus();ke(u.lessThan(0),()=>Z(1));const c=u.sqrt(),d=iR(r,s),f=th({f0:d,f90:1,dotVH:t}),p=f.oneMinus(),g=r.lessThan(s).select(Math.PI,0),y=z(Math.PI).sub(g),x=Uq(i.clamp(0,.9999)),v=iR(x,r.toVec3()),S=th({f0:v,f90:1,dotVH:c}),w=Z(x.x.lessThan(r).select(Math.PI,0),x.y.lessThan(r).select(Math.PI,0),x.z.lessThan(r).select(Math.PI,0)),M=r.mul(n,c,2),T=Z(y).add(w),A=f.mul(S).clamp(1e-5,.9999),C=A.sqrt(),D=p.pow2().mul(S).div(Z(1).sub(A)),B=f.add(D).toVar(),L=D.sub(p).toVar();return At({start:1,end:2,condition:"<=",name:"m"},({m:X})=>{L.mulAssign(C);const G=zq(z(X).mul(M),z(X).mul(T)).mul(2);B.addAssign(L.mul(G))}),B.max(Z(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),fd=te(({normal:s,viewDir:e,roughness:t})=>{const n=s.dot(e).saturate(),i=t.mul(t),r=t.add(.1).reciprocal(),o=z(-1.9362).add(t.mul(1.0678)).add(i.mul(.4573)).sub(r.mul(.8469)),u=z(-.6014).add(t.mul(.5538)).sub(i.mul(.467)).sub(r.mul(.1255));return o.mul(n).add(u).exp().saturate()}),K1=Z(.04),J1=z(1);class fO extends Ry{constructor(e=!1,t=!1,n=!1,i=!1,r=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=i,this.transmission=r,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null,this.iridescenceF0Dielectric=null,this.iridescenceF0Metallic=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=Z().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=Z().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Z().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=Z().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=Z().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=mt.dot(Ot).clamp(),n=rR({outsideIOR:z(1),eta2:_0,cosTheta1:t,thinFilmThickness:v0,baseF0:Ho}),i=rR({outsideIOR:z(1),eta2:_0,cosTheta1:t,thinFilmThickness:v0,baseF0:Nt.rgb});this.iridescenceFresnel=at(n,i,ga),this.iridescenceF0Dielectric=dv({f:n,f90:1,dotVH:t}),this.iridescenceF0Metallic=dv({f:i,f90:1,dotVH:t}),this.iridescenceF0=at(this.iridescenceF0Dielectric,this.iridescenceF0Metallic,ga)}if(this.transmission===!0){const t=Tr,n=LL.sub(Tr).normalize(),i=Wo,r=e.context;r.backdrop=Fq(i,n,pr,Ll,Il,Fc,t,pi,Mi,Na,qd,ET,CT,RT,this.dispersion?DT:null),r.backdropAlpha=w0,Nt.a.mulAssign(at(1,r.backdrop.a,w0))}super.start(e)}computeMultiscattering(e,t,n,i,r=null){const o=mt.dot(Ot).clamp(),u=xf({roughness:pr,dotNV:o}),c=r?py.mix(i,r):i,d=c.mul(u.x).add(n.mul(u.y)),p=u.x.add(u.y).oneMinus(),g=c.add(c.oneMinus().mul(.047619)),y=d.mul(g).div(p.mul(g).oneMinus());e.addAssign(d),t.addAssign(y.mul(p))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const r=mt.dot(e).clamp().mul(t).toVar();if(this.sheen===!0){this.sheenSpecularDirect.addAssign(r.mul(Aq({lightDirection:e})));const o=fd({normal:mt,viewDir:Ot,roughness:Ro}),u=fd({normal:mt,viewDir:e,roughness:Ro}),c=Ws.r.max(Ws.g).max(Ws.b).mul(o.max(u)).oneMinus();r.mulAssign(c)}if(this.clearcoat===!0){const u=kl.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(u.mul(wS({lightDirection:e,f0:K1,f90:J1,roughness:yf,normalView:kl})))}n.directDiffuse.addAssign(r.mul(eu({diffuseColor:Ll}))),n.directSpecular.addAssign(r.mul(wq({lightDirection:e,f0:Il,f90:1,roughness:pr,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:i,reflectedLight:r,ltc_1:o,ltc_2:u}){const c=t.add(n).sub(i),d=t.sub(n).sub(i),f=t.sub(n).add(i),p=t.add(n).add(i),g=mt,y=Ot,x=ln.toVar(),v=Eq({N:g,V:y,roughness:pr}),S=o.sample(v).toVar(),w=u.sample(v).toVar(),M=qn(Z(S.x,0,S.y),Z(0,1,0),Z(S.z,0,S.w)).toVar(),T=Il.mul(w.x).add(Il.oneMinus().mul(w.y)).toVar();r.directSpecular.addAssign(e.mul(T).mul(Y2({N:g,V:y,P:x,mInv:M,p0:c,p1:d,p2:f,p3:p}))),r.directDiffuse.addAssign(e.mul(Ll).mul(Y2({N:g,V:y,P:x,mInv:qn(1,0,0,0,1,0,0,0,1),p0:c,p1:d,p2:f,p3:p})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context,i=t.mul(eu({diffuseColor:Ll})).toVar();if(this.sheen===!0){const r=fd({normal:mt,viewDir:Ot,roughness:Ro}),o=Ws.r.max(Ws.g).max(Ws.b).mul(r).oneMinus();i.mulAssign(o)}n.indirectDiffuse.addAssign(i)}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:i}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(Ws,fd({normal:mt,viewDir:Ot,roughness:Ro}))),this.clearcoat===!0){const S=kl.dot(Ot).clamp(),w=cO({dotNV:S,specularColor:K1,specularF90:J1,roughness:yf});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(w))}const r=Z().toVar("singleScatteringDielectric"),o=Z().toVar("multiScatteringDielectric"),u=Z().toVar("singleScatteringMetallic"),c=Z().toVar("multiScatteringMetallic");this.computeMultiscattering(r,o,Fc,Ho,this.iridescenceF0Dielectric),this.computeMultiscattering(u,c,Fc,Nt.rgb,this.iridescenceF0Metallic);const d=at(r,u,ga),f=at(o,c,ga),p=r.add(o),g=Ll.mul(p.oneMinus()),y=n.mul(1/Math.PI),x=t.mul(d).add(f.mul(y)).toVar(),v=g.mul(y).toVar();if(this.sheen===!0){const S=fd({normal:mt,viewDir:Ot,roughness:Ro}),w=Ws.r.max(Ws.g).max(Ws.b).mul(S).oneMinus();x.mulAssign(w),v.mulAssign(w)}i.indirectSpecular.addAssign(x),i.indirectDiffuse.addAssign(v)}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,r=mt.dot(Ot).clamp().add(t),o=pr.mul(-16).oneMinus().negate().exp2(),u=t.sub(r.pow(o).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(u)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const n=kl.dot(Ot).clamp(),i=th({dotVH:n,f0:K1,f90:J1}),r=t.mul(b0.mul(i).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(b0));t.assign(r)}if(this.sheen===!0){const n=t.add(this.sheenSpecularDirect,this.sheenSpecularIndirect.mul(1/Math.PI));t.assign(n)}}}const aR=z(1),mv=z(-2),Hm=z(.8),e_=z(-1),jm=z(.4),t_=z(2),qm=z(.305),n_=z(3),oR=z(.21),Vq=z(4),lR=z(4),Pq=z(16),Iq=te(([s])=>{const e=Z(It(s)).toVar(),t=z(-1).toVar();return ke(e.x.greaterThan(e.z),()=>{ke(e.x.greaterThan(e.y),()=>{t.assign(Hn(s.x.greaterThan(0),0,3))}).Else(()=>{t.assign(Hn(s.y.greaterThan(0),1,4))})}).Else(()=>{ke(e.z.greaterThan(e.y),()=>{t.assign(Hn(s.z.greaterThan(0),2,5))}).Else(()=>{t.assign(Hn(s.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),kq=te(([s,e])=>{const t=Se().toVar();return ke(e.equal(0),()=>{t.assign(Se(s.z,s.y).div(It(s.x)))}).ElseIf(e.equal(1),()=>{t.assign(Se(s.x.negate(),s.z.negate()).div(It(s.y)))}).ElseIf(e.equal(2),()=>{t.assign(Se(s.x.negate(),s.y).div(It(s.z)))}).ElseIf(e.equal(3),()=>{t.assign(Se(s.z.negate(),s.y).div(It(s.x)))}).ElseIf(e.equal(4),()=>{t.assign(Se(s.x.negate(),s.z).div(It(s.y)))}).Else(()=>{t.assign(Se(s.x,s.y).div(It(s.z)))}),qe(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),Gq=te(([s])=>{const e=z(0).toVar();return ke(s.greaterThanEqual(Hm),()=>{e.assign(aR.sub(s).mul(e_.sub(mv)).div(aR.sub(Hm)).add(mv))}).ElseIf(s.greaterThanEqual(jm),()=>{e.assign(Hm.sub(s).mul(t_.sub(e_)).div(Hm.sub(jm)).add(e_))}).ElseIf(s.greaterThanEqual(qm),()=>{e.assign(jm.sub(s).mul(n_.sub(t_)).div(jm.sub(qm)).add(t_))}).ElseIf(s.greaterThanEqual(oR),()=>{e.assign(qm.sub(s).mul(Vq.sub(n_)).div(qm.sub(oR)).add(n_))}).Else(()=>{e.assign(z(-2).mul(br(qe(1.16,s))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),pO=te(([s,e])=>{const t=s.toVar();t.assign(qe(2,t).sub(1));const n=Z(t,1).toVar();return ke(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),mO=te(([s,e,t,n,i,r])=>{const o=z(t),u=Z(e),c=Xi(Gq(o),mv,r),d=Wi(c),f=_r(c),p=Z(bf(s,u,f,n,i,r)).toVar();return ke(d.notEqual(0),()=>{const g=Z(bf(s,u,f.add(1),n,i,r)).toVar();p.assign(at(p,g,d))}),p}),bf=te(([s,e,t,n,i,r])=>{const o=z(t).toVar(),u=Z(e),c=z(Iq(u)).toVar(),d=z(Jt(lR.sub(o),0)).toVar();o.assign(Jt(o,lR));const f=z(Jc(o)).toVar(),p=Se(kq(u,c).mul(f.sub(2)).add(1)).toVar();return ke(c.greaterThan(2),()=>{p.y.addAssign(f),c.subAssign(3)}),p.x.addAssign(c.mul(f)),p.x.addAssign(d.mul(qe(3,Pq))),p.y.addAssign(qe(4,Jc(r).sub(f))),p.x.mulAssign(n),p.y.mulAssign(i),s.sample(p).grad(Se(),Se())}),s_=te(({envMap:s,mipInt:e,outputDirection:t,theta:n,axis:i,CUBEUV_TEXEL_WIDTH:r,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:u})=>{const c=zi(n),d=t.mul(c).add(i.cross(t).mul(hs(n))).add(i.mul(i.dot(t).mul(c.oneMinus())));return bf(s,d,e,r,o,u)}),gO=te(({n:s,latitudinal:e,poleAxis:t,outputDirection:n,weights:i,samples:r,dTheta:o,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p})=>{const g=Z(Hn(e,t,Ra(t,n))).toVar();ke(g.equal(Z(0)),()=>{g.assign(Z(n.z,0,n.x.negate()))}),g.assign(ps(g));const y=Z().toVar();return y.addAssign(i.element(0).mul(s_({theta:0,axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p}))),At({start:H(1),end:s},({i:x})=>{ke(x.greaterThanEqual(r),()=>{HF()});const v=z(o.mul(z(x))).toVar();y.addAssign(i.element(x).mul(s_({theta:v.mul(-1),axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p}))),y.addAssign(i.element(x).mul(s_({theta:v,axis:g,outputDirection:n,mipInt:u,envMap:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p})))}),Ie(y,1)}),$q=te(([s])=>{const e=ve(s).toVar();return e.assign(e.shiftLeft(ve(16)).bitOr(e.shiftRight(ve(16)))),e.assign(e.bitAnd(ve(1431655765)).shiftLeft(ve(1)).bitOr(e.bitAnd(ve(2863311530)).shiftRight(ve(1)))),e.assign(e.bitAnd(ve(858993459)).shiftLeft(ve(2)).bitOr(e.bitAnd(ve(3435973836)).shiftRight(ve(2)))),e.assign(e.bitAnd(ve(252645135)).shiftLeft(ve(4)).bitOr(e.bitAnd(ve(4042322160)).shiftRight(ve(4)))),e.assign(e.bitAnd(ve(16711935)).shiftLeft(ve(8)).bitOr(e.bitAnd(ve(4278255360)).shiftRight(ve(8)))),z(e).mul(23283064365386963e-26)}),Hq=te(([s,e])=>Se(z(s).div(z(e)),$q(s))),jq=te(([s,e,t])=>{const n=Z(e).toVar(),i=z(t),r=i.mul(i).toVar(),o=ps(Z(r.mul(n.x),r.mul(n.y),n.z)).toVar(),u=o.x.mul(o.x).add(o.y.mul(o.y)),c=Hn(u.greaterThan(0),Z(o.y.negate(),o.x,0).div(ts(u)),Z(1,0,0)).toVar(),d=Ra(o,c).toVar(),f=ts(s.x),p=qe(2,3.14159265359).mul(s.y),g=f.mul(zi(p)).toVar(),y=f.mul(hs(p)).toVar(),x=qe(.5,o.z.add(1));y.assign(x.oneMinus().mul(ts(g.mul(g).oneMinus())).add(x.mul(y)));const v=c.mul(g).add(d.mul(y)).add(o.mul(ts(Jt(0,g.mul(g).add(y.mul(y)).oneMinus()))));return ps(Z(r.mul(v.x),r.mul(v.y),Jt(0,v.z)))}),yO=te(({roughness:s,mipInt:e,envMap:t,N_immutable:n,GGX_SAMPLES:i,CUBEUV_TEXEL_WIDTH:r,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:u})=>{const c=Z(n).toVar(),d=Z(0).toVar(),f=z(0).toVar();return ke(s.lessThan(.001),()=>{d.assign(bf(t,c,e,r,o,u))}).Else(()=>{const p=Hn(It(c.z).lessThan(.999),Z(0,0,1),Z(1,0,0)),g=ps(Ra(p,c)).toVar(),y=Ra(c,g).toVar();At({start:ve(0),end:i},({i:x})=>{const v=Hq(x,i),S=jq(v,Z(0,0,1),s),w=ps(g.mul(S.x).add(y.mul(S.y)).add(c.mul(S.z))),M=ps(w.mul(vi(c,w).mul(2)).sub(c)),T=Jt(vi(c,M),0);ke(T.greaterThan(0),()=>{const A=bf(t,M,e,r,o,u);d.addAssign(A.mul(T)),f.addAssign(T)})}),ke(f.greaterThan(0),()=>{d.assign(d.div(f))})}),Ie(d,1)}),Oo=4,uR=[.125,.215,.35,.446,.526,.582],Fl=20,qq=512,pd=new mT(-1,1,1,-1,0,1),Wq=new Ms(90,1),cR=new Qe;let i_=null,r_=0,a_=0;const Xq=new J,R0=new WeakMap,Yq=[3,1,5,0,4,2],o_=pO(Ct(),Da("faceIndex")).normalize(),Dy=Z(o_.x,o_.y,o_.z);class Zq{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,i=100,r={}){const{size:o=256,position:u=Xq,renderTarget:c=null}=r;if(this._setSize(o),this._hasInitialized===!1){Ne('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const f=c||this._allocateTarget();return r.renderTarget=f,this.fromSceneAsync(e,t,n,i,r),f}i_=this._renderer.getRenderTarget(),r_=this._renderer.getActiveCubeFace(),a_=this._renderer.getActiveMipmapLevel();const d=c||this._allocateTarget();return d.depthBuffer=!0,this._init(d),this._sceneToCubeUV(e,n,i,d,u),t>0&&this._blur(d,0,0,t),this._applyPMREM(d),this._cleanup(d),d}async fromSceneAsync(e,t=0,n=.1,i=100,r={}){return $t('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,n,i,r)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){Ne('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return $t('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){Ne("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return $t('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=dR(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=fR(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===Yc||e.mapping===$g?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(i_,r_,a_),e.scissorTest=!1,uc(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),i_=this._renderer.getRenderTarget(),r_=this._renderer.getActiveCubeFace(),a_=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTarget();return this._init(n),this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return hR(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=hR(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=Qq(t)),this._blurMaterial=Kq(t,e.width,e.height),this._ggxMaterial=Jq(t,e.width,e.height)}}async _compileMaterial(e){const t=new Rn(new Si,e);await this._renderer.compile(t,pd)}_sceneToCubeUV(e,t,n,i,r){const o=Wq;o.near=t,o.far=n;const u=[1,1,1,1,-1,1],c=[1,-1,1,-1,1,-1],d=this._renderer,f=d.autoClear;d.getClearColor(cR),d.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new Rn(new us,new Eo({name:"PMREM.Background",side:ns,depthWrite:!1,depthTest:!1})));const p=this._backgroundBox,g=p.material;let y=!1;const x=e.background;x?x.isColor&&(g.color.copy(x),e.background=null,y=!0):(g.color.copy(cR),y=!0),d.setRenderTarget(i),d.clear(),y&&d.render(p,o);for(let v=0;v<6;v++){const S=v%3;S===0?(o.up.set(0,u[v],0),o.position.set(r.x,r.y,r.z),o.lookAt(r.x+c[v],r.y,r.z)):S===1?(o.up.set(0,0,u[v]),o.position.set(r.x,r.y,r.z),o.lookAt(r.x,r.y+c[v],r.z)):(o.up.set(0,u[v],0),o.position.set(r.x,r.y,r.z),o.lookAt(r.x,r.y,r.z+c[v]));const w=this._cubeSize;uc(i,S*w,v>2?w:0,w,w),d.render(e,o)}d.autoClear=f,e.background=x}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===Yc||e.mapping===$g;i?this._cubemapMaterial===null&&(this._cubemapMaterial=dR(e)):this._equirectMaterial===null&&(this._equirectMaterial=fR(e));const r=i?this._cubemapMaterial:this._equirectMaterial;r.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=r;const u=this._cubeSize;uc(t,0,0,3*u,2*u),n.setRenderTarget(t),n.render(o,pd)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodMeshes.length;for(let r=1;r<i;r++)this._applyGGXFilter(e,r-1,r);t.autoClear=n}_applyGGXFilter(e,t,n){const i=this._renderer,r=this._pingPongRenderTarget,o=this._ggxMaterial,u=this._lodMeshes[n];u.material=o;const c=R0.get(o),d=n/(this._lodMeshes.length-1),f=t/(this._lodMeshes.length-1),p=Math.sqrt(d*d-f*f),g=0+d*1.25,y=p*g,{_lodMax:x}=this,v=this._sizeLods[n],S=3*v*(n>x-Oo?n-x+Oo:0),w=4*(this._cubeSize-v);e.texture.frame=(e.texture.frame||0)+1,c.envMap.value=e.texture,c.roughness.value=y,c.mipInt.value=x-t,uc(r,S,w,3*v,2*v),i.setRenderTarget(r),i.render(u,pd),r.texture.frame=(r.texture.frame||0)+1,c.envMap.value=r.texture,c.roughness.value=0,c.mipInt.value=x-n,uc(e,S,w,3*v,2*v),i.setRenderTarget(e),i.render(u,pd)}_blur(e,t,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",r),this._halfBlur(o,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,o,u){const c=this._renderer,d=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&Ae("blur direction must be either latitudinal or longitudinal!");const f=3,p=this._lodMeshes[i];p.material=d;const g=R0.get(d),y=this._sizeLods[n]-1,x=isFinite(r)?Math.PI/(2*y):2*Math.PI/(2*Fl-1),v=r/x,S=isFinite(r)?1+Math.floor(f*v):Fl;S>Fl&&Ne(`sigmaRadians, ${r}, is too large and will clip, as it requested ${S} samples when the maximum is set to ${Fl}`);const w=[];let M=0;for(let R=0;R<Fl;++R){const B=R/v,L=Math.exp(-B*B/2);w.push(L),R===0?M+=L:R<S&&(M+=2*L)}for(let R=0;R<w.length;R++)w[R]=w[R]/M;e.texture.frame=(e.texture.frame||0)+1,g.envMap.value=e.texture,g.samples.value=S,g.weights.array=w,g.latitudinal.value=o==="latitudinal"?1:0,u&&(g.poleAxis.value=u);const{_lodMax:T}=this;g.dTheta.value=x,g.mipInt.value=T-n;const A=this._sizeLods[i],C=3*A*(i>T-Oo?i-T+Oo:0),D=4*(this._cubeSize-A);uc(t,C,D,3*A,2*A),c.setRenderTarget(t),c.render(p,pd)}}function Qq(s){const e=[],t=[],n=[];let i=s;const r=s-Oo+1+uR.length;for(let o=0;o<r;o++){const u=Math.pow(2,i);e.push(u);let c=1/u;o>s-Oo?c=uR[o-s+Oo-1]:o===0&&(c=0),t.push(c);const d=1/(u-2),f=-d,p=1+d,g=[f,f,p,f,p,p,f,f,p,p,f,p],y=6,x=6,v=3,S=2,w=1,M=new Float32Array(v*x*y),T=new Float32Array(S*x*y),A=new Float32Array(w*x*y);for(let D=0;D<y;D++){const R=D%3*2/3-1,B=D>2?0:-1,L=[R,B,0,R+2/3,B,0,R+2/3,B+1,0,R,B,0,R+2/3,B+1,0,R,B+1,0],X=Yq[D];M.set(L,v*x*X),T.set(g,S*x*X);const G=[X,X,X,X,X,X];A.set(G,w*x*X)}const C=new Si;C.setAttribute("position",new Ks(M,v)),C.setAttribute("uv",new Ks(T,S)),C.setAttribute("faceIndex",new Ks(A,w)),n.push(new Rn(C,null)),i>Oo&&i--}return{lodMeshes:n,sizeLods:e,sigmas:t}}function hR(s,e){const t={magFilter:ms,minFilter:ms,generateMipmaps:!1,type:Gn,format:Zs,colorSpace:p0},n=new La(s,e,t);return n.texture.mapping=$_,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function uc(s,e,t,n,i){s.viewport.set(e,t,n,i),s.scissor.set(e,t,n,i)}function By(s){const e=new en;return e.depthTest=!1,e.depthWrite=!1,e.blending=Xc,e.name=`PMREM_${s}`,e}function Kq(s,e,t){const n=Jn(new Array(Fl).fill(0)),i=ze(new J(0,1,0)),r=ze(0),o=z(Fl),u=ze(0),c=ze(1),d=_t(),f=ze(0),p=z(1/e),g=z(1/t),y=z(s),x={n:o,latitudinal:u,weights:n,poleAxis:i,outputDirection:Dy,dTheta:r,samples:c,envMap:d,mipInt:f,CUBEUV_TEXEL_WIDTH:p,CUBEUV_TEXEL_HEIGHT:g,CUBEUV_MAX_MIP:y},v=By("blur");return v.fragmentNode=gO({...x,latitudinal:u.equal(1)}),R0.set(v,x),v}function Jq(s,e,t){const n=_t(),i=ze(0),r=ze(0),o=z(1/e),u=z(1/t),c=z(s),d={envMap:n,roughness:i,mipInt:r,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:c},f=By("ggx");return f.fragmentNode=yO({...d,N_immutable:Dy,GGX_SAMPLES:ve(qq)}),R0.set(f,d),f}function dR(s){const e=By("cubemap");return e.fragmentNode=fs(s,Dy),e}function fR(s){const e=By("equirect");return e.fragmentNode=_t(s,vS(Dy),0),e}const pR=new WeakMap;function eW(s){const e=Math.log2(s)-2,t=1/s;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:t,maxMip:e}}function tW(s,e,t){const n=nW(e);let i=n.get(s);if((i!==void 0?i.pmremVersion:-1)!==s.pmremVersion){const o=s.image;if(s.isCubeTexture)if(iW(o))i=t.fromCubemap(s,i);else return null;else if(rW(o))i=t.fromEquirectangular(s,i);else return null;i.pmremVersion=s.pmremVersion,n.set(s,i)}return i.texture}function nW(s){let e=pR.get(s);return e===void 0&&(e=new WeakMap,pR.set(s,e)),e}class sW extends nn{static get type(){return"PMREMNode"}constructor(e,t=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const i=new jn;i.isRenderTargetTexture=!0,this._texture=_t(i),this._width=ze(0),this._height=ze(0),this._maxMip=ze(0),this.updateBeforeType=Ye.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=eW(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,i=this._value;n!==i.pmremVersion&&(i.isPMREMTexture===!0?t=i:t=tW(i,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new Zq(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this,e)),t=hS.mul(Z(t.x,t.y.negate(),t.z));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),mO(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function iW(s){if(s==null)return!1;let e=0;const t=6;for(let n=0;n<t;n++)s[n]!==void 0&&e++;return e===t}function rW(s){return s==null?!1:s.height>0}const NS=We(sW).setParameterLength(1,3),mR=new WeakMap;class aW extends ah{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const p=n.isTextureNode?n.value:t[n.property];let g=mR.get(p);g===void 0&&(g=NS(p),mR.set(p,g)),n=g}const r=t.useAnisotropy===!0||t.anisotropy>0?sF:mt,o=n.context(gR(pr,r)).mul(bg),u=n.context(oW(Wo)).mul(Math.PI).mul(bg),c=zc(o),d=zc(u);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(d);const f=e.context.lightingModel.clearcoatRadiance;if(f){const p=n.context(gR(yf,kl)).mul(bg),g=zc(p);f.addAssign(g)}}}const gR=(s,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Ot.negate().reflect(e),t=qT(s).mix(t,e).normalize(),t=t.transformDirection(Mi)),t),getTextureLevel:()=>s}},oW=s=>({getUV:()=>s,getTextureLevel:()=>z(1)}),lW=new Tc;class Ly extends en{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(lW),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new aW(t):null}setupLightingModel(){return new fO}setupSpecular(){const e=at(Z(.04),Nt.rgb,ga);Ho.assign(Z(.04)),Il.assign(e),Fc.assign(1)}setupVariants(){const e=this.metalnessNode?z(this.metalnessNode):dF;ga.assign(e);let t=this.roughnessNode?z(this.roughnessNode):hF;t=SS({roughness:t}),pr.assign(t),this.setupSpecular(),Ll.assign(Nt.rgb.mul(e.oneMinus()))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const uW=new Z9;class cW extends Ly{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(uW),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?z(this.iorNode):NF;qd.assign(e),Ho.assign(Bs(jT(qd.sub(1).div(qd.add(1))).mul(cF),Z(1)).mul(hv)),Il.assign(at(Ho,Nt.rgb,ga)),Fc.assign(at(hv,1,ga))}setupLightingModel(){return new fO(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?z(this.clearcoatNode):pF,n=this.clearcoatRoughnessNode?z(this.clearcoatRoughnessNode):mF;b0.assign(t),yf.assign(SS({roughness:n}))}if(this.useSheen){const t=this.sheenNode?Z(this.sheenNode):xF,n=this.sheenRoughnessNode?z(this.sheenRoughnessNode):bF;Ws.assign(t),Ro.assign(n)}if(this.useIridescence){const t=this.iridescenceNode?z(this.iridescenceNode):vF,n=this.iridescenceIORNode?z(this.iridescenceIORNode):TF,i=this.iridescenceThicknessNode?z(this.iridescenceThicknessNode):SF;py.assign(t),_0.assign(n),v0.assign(i)}if(this.useAnisotropy){const t=(this.anisotropyNode?Se(this.anisotropyNode):_F).toVar();No.assign(t.length()),ke(No.equal(0),()=>{t.assign(Se(1,0))}).Else(()=>{t.divAssign(Se(No)),No.assign(No.saturate())}),T0.assign(No.pow2().mix(pr.pow2(),1)),jd.assign(Gl[0].mul(t.x).add(Gl[1].mul(t.y))),Xl.assign(Gl[1].mul(t.x).sub(Gl[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?z(this.transmissionNode):wF,n=this.thicknessNode?z(this.thicknessNode):MF,i=this.attenuationDistanceNode?z(this.attenuationDistanceNode):AF,r=this.attenuationColorNode?Z(this.attenuationColorNode):EF;if(w0.assign(t),ET.assign(n),RT.assign(i),CT.assign(r),this.useDispersion){const o=this.dispersionNode?z(this.dispersionNode):FF;DT.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Z(this.clearcoatNormalNode):gF}setup(e){e.context.setupClearcoatNormal=()=>Uc(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const hW=te(({normal:s,lightDirection:e,builder:t})=>{const n=s.dot(e),i=Se(n.mul(.5).add(.5),0);if(t.material.gradientMap){const r=pa("gradientMap","texture").context({getUV:()=>i});return Z(r.r)}else{const r=i.fwidth().mul(.5);return at(Z(.7),Z(1),Yi(z(.7).sub(r.x),z(.7).add(r.x),i.x))}});class dW extends Ry{direct({lightDirection:e,lightColor:t,reflectedLight:n},i){const r=hW({normal:Sy,lightDirection:e,builder:i}).mul(t);n.directDiffuse.addAssign(r.mul(eu({diffuseColor:Nt.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(n.mul(eu({diffuseColor:Nt}))),i.indirectDiffuse.mulAssign(t)}}const fW=new K9;class pW extends en{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(fW),this.setValues(e)}setupLightingModel(){return new dW}}const xO=te(()=>{const s=Z(Ot.z,0,Ot.x.negate()).normalize(),e=Ot.cross(s);return Se(s.dot(mt),e.dot(mt)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),mW=new tH;class gW extends en{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(mW),this.setValues(e)}setupVariants(e){const t=xO;let n;e.material.matcap?n=pa("matcap","texture").context({getUV:()=>t}):n=Z(at(.2,.8,t.y)),Nt.rgb.mulAssign(n.rgb)}}class yW extends nn{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const r=t.cos(),o=t.sin();return fy(r,o,o.negate(),r).mul(n)}else{const r=t,o=Po(Ie(1,0,0,0),Ie(0,zi(r.x),hs(r.x).negate(),0),Ie(0,hs(r.x),zi(r.x),0),Ie(0,0,0,1)),u=Po(Ie(zi(r.y),0,hs(r.y),0),Ie(0,1,0,0),Ie(hs(r.y).negate(),0,zi(r.y),0),Ie(0,0,0,1)),c=Po(Ie(zi(r.z),hs(r.z).negate(),0,0),Ie(hs(r.z),zi(r.z),0,0),Ie(0,0,1,0),Ie(0,0,0,1));return o.mul(u).mul(c).mul(Ie(n,1)).xyz}}}const Vf=We(yW).setParameterLength(2),xW=new $9;class bO extends en{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(xW),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,{positionNode:i,rotationNode:r,scaleNode:o,sizeAttenuation:u}=this,c=qo.mul(Z(i||0));let d=Se(pi[0].xyz.length(),pi[1].xyz.length());o!==null&&(d=d.mul(Se(o))),n.isPerspectiveCamera&&u===!1&&(d=d.mul(c.z.negate()));let f=Uf.xy;if(t.center&&t.center.isVector2===!0){const y=fj("center","vec2",t);f=f.sub(y.sub(.5))}f=f.mul(d);const p=z(r||yF),g=Vf(f,p);return Ie(c.xy.add(g),c.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const bW=new W9,_W=new Ge;class vW extends bO{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(bW),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return qo.mul(Z(e||Qt)).xyz}setupVertexSprite(e){const{material:t,camera:n}=e,{rotationNode:i,scaleNode:r,sizeNode:o,sizeAttenuation:u}=this;let c=super.setupVertex(e);if(t.isNodeMaterial!==!0)return c;let d=o!==null?Se(o):LF;d=d.mul(DL),n.isPerspectiveCamera&&u===!0&&(d=d.mul(TW.div(ln.z.negate()))),r&&r.isNode&&(d=d.mul(Se(r)));let f=Uf.xy;if(i&&i.isNode){const p=z(i);f=Vf(f,p)}return f=f.mul(d),f=f.div(oS.div(2)),f=f.mul(c.w),c=c.add(Ie(f,0,0)),c}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const TW=ze(1).onFrameUpdate(function({renderer:s}){const e=s.getSize(_W);this.value=.5*e.y});class SW extends Ry{constructor(){super(),this.shadowNode=z(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){Nt.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Nt.rgb)}}const wW=new Y9;class MW extends en{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(wW),this.setValues(e)}setupLightingModel(){return new SW}}Sa("vec3");Sa("vec3");Sa("vec3");class NW{constructor(e,t,n){this.renderer=e,this.nodes=t,this.info=n,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,n),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class Zi{constructor(){this.weakMaps={}}_getWeakMap(e){const t=e.length;let n=this.weakMaps[t];return n===void 0&&(n=new WeakMap,this.weakMaps[t]=n),n}get(e){let t=this._getWeakMap(e);for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let n=this._getWeakMap(e);for(let i=0;i<e.length-1;i++){const r=e[i];n.has(r)===!1&&n.set(r,new WeakMap),n=n.get(r)}return n.set(e[e.length-1],t),this}delete(e){let t=this._getWeakMap(e);for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return!1;return t.delete(e[e.length-1])}}let AW=0;function EW(s){const e=Object.keys(s);let t=Object.getPrototypeOf(s);for(;t;){const n=Object.getOwnPropertyDescriptors(t);for(const i in n)if(n[i]!==void 0){const r=n[i];r&&typeof r.get=="function"&&e.push(i)}t=Object.getPrototypeOf(t)}return e}class RW{constructor(e,t,n,i,r,o,u,c,d,f){this.id=AW++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=i,this.material=r,this.scene=o,this.camera=u,this.lightsNode=c,this.context=d,this.geometry=i.geometry,this.version=r.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=f,this.clippingContextCacheKey=f!==null?f.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getIndirectOffset(){return this._geometries.getIndirectOffset(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],i=new Set,r={};for(const o of e){let u;if(o.node&&o.node.attribute?u=o.node.attribute:(u=t.getAttribute(o.name),r[o.name]=u.version),u===void 0)continue;n.push(u);const c=u.isInterleavedBufferAttribute?u.data:u;i.add(c)}return this.attributes=n,this.attributesId=r,this.vertexBuffers=Array.from(i.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:i,drawRange:r}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),u=this.getIndex(),c=u!==null;let d=1;if(n.isInstancedBufferGeometry===!0?d=n.instanceCount:e.count!==void 0&&(d=Math.max(0,e.count)),d===0)return null;if(o.instanceCount=d,e.isBatchedMesh===!0)return o;let f=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(f=2);let p=r.start*f,g=(r.start+r.count)*f;i!==null&&(p=Math.max(p,i.start*f),g=Math.min(g,(i.start+i.count)*f));const y=n.attributes.position;let x=1/0;c?x=u.count:y!=null&&(x=y.count),p=Math.max(p,0),g=Math.min(g,x);const v=g-p;return v<0||v===1/0?null:(o.vertexCount=v,o.firstVertex=p,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const i=e.attributes[n];t+=n+",",i.data&&(t+=i.data.stride+","),i.offset&&(t+=i.offset+","),i.itemSize&&(t+=i.itemSize+","),i.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const i=e.morphAttributes[n];t+="morph-"+n+",";for(let r=0,o=i.length;r<o;r++){const u=i[r];t+=u.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:n}=this;let i=t.customProgramCacheKey();for(const r of EW(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(r))continue;const o=t[r];let u;if(o!==null){const c=typeof o;c==="number"?u=o!==0?"1":"0":c==="object"?(u="{",o.isTexture&&(u+=o.mapping,n.backend.isWebGPUBackend===!0&&(u+=o.magFilter,u+=o.minFilter,u+=o.wrapS,u+=o.wrapT,u+=o.wrapR)),u+="}"):u=String(o)}else u=String(o);i+=u+","}return i+=this.clippingContextCacheKey+",",e.geometry&&(i+=this.getGeometryCacheKey()),e.skeleton&&(i+=e.skeleton.bones.length+","),e.isBatchedMesh&&(i+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(i+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(i+=e.uuid+","),i+=this.context.id+",",i+=e.receiveShadow+",",Bf(i)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const n=this.geometry.getAttribute(t);if(n===void 0||e[t]!==n.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=$d(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=$d(e,1)),e=$d(e,this.camera.id,this.renderer.contextNode.id,this.renderer.contextNode.version),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const Ml=[];class CW{constructor(e,t,n,i,r,o){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=i,this.bindings=r,this.info=o,this.chainMaps={}}get(e,t,n,i,r,o,u,c){const d=this.getChainMap(c);Ml[0]=e,Ml[1]=t,Ml[2]=o,Ml[3]=r;let f=d.get(Ml);return f===void 0?(f=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,i,r,o,u,c),d.set(Ml,f)):(f.updateClipping(u),f.needsGeometryUpdate&&f.setGeometry(e.geometry),(f.version!==t.version||f.needsUpdate)&&(f.initialCacheKey!==f.getCacheKey()?(f.dispose(),f=this.get(e,t,n,i,r,o,u,c)):f.version=t.version)),Ml.length=0,f}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Zi)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,i,r,o,u,c,d,f,p){const g=this.getChainMap(p),y=new RW(e,t,n,i,r,o,u,c,d,f);return y.onDispose=()=>{this.pipelines.delete(y),this.bindings.deleteForRender(y),this.nodes.delete(y),g.delete(y.getChainArray())},y}}class Xo{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const mi={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Bo=16,DW=211,BW=212;class LW extends Xo{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(n.version===void 0)t===mi.VERTEX?this.backend.createAttribute(e):t===mi.INDEX?this.backend.createIndexAttribute(e):t===mi.STORAGE?this.backend.createStorageAttribute(e):t===mi.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const i=this._getBufferAttribute(e);(n.version<i.version||i.usage===Pl)&&(this.backend.updateAttribute(e),n.version=i.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function _O(s){return s.index!==null?s.index.version:s.attributes.position.version}function yR(s){const e=[],t=s.index,n=s.attributes.position;if(t!==null){const r=t.array;for(let o=0,u=r.length;o<u;o+=3){const c=r[o+0],d=r[o+1],f=r[o+2];e.push(c,d,d,f,f,c)}}else{const r=n.array;for(let o=0,u=r.length/3-1;o<u;o+=3){const c=o+0,d=o+1,f=o+2;e.push(c,d,d,f,f,c)}}const i=new(LD(e)?zD:UD)(e,1);return i.version=_O(s),i}class FW extends Xo{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,n=this.get(t);n.initialized=!0,this.info.memory.geometries++;const i=()=>{this.info.memory.geometries--;const r=t.index,o=e.getAttributes();r!==null&&this.attributes.delete(r);for(const c of o)this.attributes.delete(c);const u=this.wireframes.get(t);u!==void 0&&this.attributes.delete(u),t.removeEventListener("dispose",i),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",i),this._geometryDisposeListeners.set(t,i)}updateAttributes(e){const t=e.getAttributes();for(const r of t)r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute?this.updateAttribute(r,mi.STORAGE):this.updateAttribute(r,mi.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,mi.INDEX);const i=e.geometry.indirect;i!==null&&this.updateAttribute(i,mi.INDIRECT)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndirectOffset(e){return e.geometry.indirectOffset}getIndex(e){const{geometry:t,material:n}=e;let i=t.index;if(n.wireframe===!0){const r=this.wireframes;let o=r.get(t);o===void 0?(o=yR(t),r.set(t,o)):o.version!==_O(t)&&(this.attributes.delete(o),o=yR(t),r.set(t,o)),i=o}return i}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class OW{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):Ae("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class vO{constructor(e){this.cacheKey=e,this.usedTimes=0}}class UW extends vO{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class zW extends vO{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let VW=0;class l_{constructor(e,t,n,i=null,r=null){this.id=VW++,this.code=e,this.stage=t,this.name=n,this.transforms=i,this.attributes=r,this.usedTimes=0}}class PW extends Xo{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,i=this.get(e);if(this._needsComputeUpdate(e)){const r=i.pipeline;r&&(r.usedTimes--,r.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let u=this.programs.compute.get(o.computeShader);u===void 0&&(r&&r.computeProgram.usedTimes===0&&this._releaseProgram(r.computeProgram),u=new l_(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,u),n.createProgram(u));const c=this._getComputeCacheKey(e,u);let d=this.caches.get(c);d===void 0&&(r&&r.usedTimes===0&&this._releasePipeline(r),d=this._getComputePipeline(e,u,c,t)),d.usedTimes++,u.usedTimes++,i.version=e.version,i.pipeline=d}return i.pipeline}getForRender(e,t=null){const{backend:n}=this,i=this.get(e);if(this._needsRenderUpdate(e)){const r=i.pipeline;r&&(r.usedTimes--,r.vertexProgram.usedTimes--,r.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),u=e.material?e.material.name:"";let c=this.programs.vertex.get(o.vertexShader);c===void 0&&(r&&r.vertexProgram.usedTimes===0&&this._releaseProgram(r.vertexProgram),c=new l_(o.vertexShader,"vertex",u),this.programs.vertex.set(o.vertexShader,c),n.createProgram(c));let d=this.programs.fragment.get(o.fragmentShader);d===void 0&&(r&&r.fragmentProgram.usedTimes===0&&this._releaseProgram(r.fragmentProgram),d=new l_(o.fragmentShader,"fragment",u),this.programs.fragment.set(o.fragmentShader,d),n.createProgram(d));const f=this._getRenderCacheKey(e,c,d);let p=this.caches.get(f);p===void 0?(r&&r.usedTimes===0&&this._releasePipeline(r),p=this._getRenderPipeline(e,c,d,f,t)):e.pipeline=p,p.usedTimes++,c.usedTimes++,d.usedTimes++,i.pipeline=p}return i.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,i){n=n||this._getComputeCacheKey(e,t);let r=this.caches.get(n);return r===void 0&&(r=new zW(n,t),this.caches.set(n,r),this.backend.createComputePipeline(r,i)),r}_getRenderPipeline(e,t,n,i,r){i=i||this._getRenderCacheKey(e,t,n);let o=this.caches.get(i);return o===void 0&&(o=new UW(i,t,n),this.caches.set(i,o),e.pipeline=o,this.backend.createRenderPipeline(e,r)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class IW extends Xo{constructor(e,t,n,i,r,o){super(),this.backend=e,this.textures=n,this.pipelines=r,this.attributes=i,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const i=this.get(n);i.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),i.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const i=this.get(n);i.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),i.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t)this.backend.deleteBindGroupData(n),this.delete(n)}deleteForRender(e){const t=e.getBindings();for(const n of t)this.backend.deleteBindGroupData(n),this.delete(n)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const n=t.attribute,i=n.isIndirectStorageBufferAttribute?mi.INDIRECT:mi.STORAGE;this.attributes.update(n,i)}}_update(e,t){const{backend:n}=this;let i=!1,r=!0,o=0,u=0;for(const c of e.bindings)if(this.nodes.updateGroup(c)!==!1){if(c.isStorageBuffer){const f=c.attribute,p=f.isIndirectStorageBufferAttribute?mi.INDIRECT:mi.STORAGE;this.attributes.update(f,p)}if(c.isUniformBuffer)c.update()&&n.updateBinding(c);else if(c.isSampledTexture){const f=c.update(),p=c.texture,g=this.textures.get(p);if(f&&(this.textures.updateTexture(p),c.generation!==g.generation&&(c.generation=g.generation,i=!0,r=!1)),n.get(p).externalTexture!==void 0||g.isDefaultTexture?r=!1:(o=o*10+p.id,u+=p.version),p.isStorageTexture===!0&&p.mipmapsAutoUpdate===!0){const x=this.get(p);c.store===!0?x.needsMipmap=!0:this.textures.needsMipmaps(p)&&x.needsMipmap===!0&&(this.backend.generateMipmaps(p),x.needsMipmap=!1)}}else if(c.isSampler&&c.update()){const p=this.textures.updateSampler(c.texture);c.samplerKey!==p&&(c.samplerKey=p,i=!0,r=!1)}}i===!0&&this.backend.updateBindings(e,t,r?o:0,u)}}function kW(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?s.z-e.z:s.id-e.id}function xR(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?e.z-s.z:s.id-e.id}function bR(s){return(s.transmission>0||s.transmissionNode&&s.transmissionNode.isNode)&&s.side===ql&&s.forceSinglePass===!1}class GW{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,i,r,o,u){let c=this.renderItems[this.renderItemsIndex];return c===void 0?(c={id:e.id,object:e,geometry:t,material:n,groupOrder:i,renderOrder:e.renderOrder,z:r,group:o,clippingContext:u},this.renderItems[this.renderItemsIndex]=c):(c.id=e.id,c.object=e,c.geometry=t,c.material=n,c.groupOrder=i,c.renderOrder=e.renderOrder,c.z=r,c.group=o,c.clippingContext=u),this.renderItemsIndex++,c}push(e,t,n,i,r,o,u){const c=this.getNextRenderItem(e,t,n,i,r,o,u);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(bR(n)&&this.transparentDoublePass.push(c),this.transparent.push(c)):this.opaque.push(c)}unshift(e,t,n,i,r,o,u){const c=this.getNextRenderItem(e,t,n,i,r,o,u);n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(bR(n)&&this.transparentDoublePass.unshift(c),this.transparent.unshift(c)):this.opaque.unshift(c)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||kW),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||xR),this.transparent.length>1&&this.transparent.sort(t||xR)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null,n.clippingContext=null}}}const md=[];class $W{constructor(e){this.lighting=e,this.lists=new Zi}get(e,t){const n=this.lists;md[0]=e,md[1]=t;let i=n.get(md);return i===void 0&&(i=new GW(this.lighting,e,t),n.set(md,i)),md.length=0,i}dispose(){this.lists=new Zi}}let HW=0;class jW{constructor(){this.id=HW++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new yt,this.scissor=!1,this.scissorValue=new yt,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return TO(this)}}function TO(s){const{textures:e,activeCubeFace:t,activeMipmapLevel:n}=s,i=[t,n];for(const r of e)i.push(r.id);return ih(i)}const cc=[],qW=new ay,WW=new nT;class XW{constructor(){this.chainMaps={}}get(e,t,n=null,i=null){cc[0]=e,cc[1]=t,i!==null&&(cc[2]=i);let r;if(n===null)r="default";else{const c=n.texture.format;r=`${n.textures.length}:${c}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const o=this._getChainMap(r);let u=o.get(cc);return u===void 0&&(u=new jW,o.set(cc,u)),cc.length=0,n!==null&&(u.sampleCount=n.samples===0?1:n.samples),u}getForClear(e=null){return this.get(qW,WW,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Zi)}dispose(){this.chainMaps={}}}const YW=new J;class ZW extends Xo{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){const n=this.get(e),i=e.samples===0?1:e.samples,r=n.depthTextureMips||(n.depthTextureMips={}),o=e.textures,u=this.getSize(o[0]),c=u.width>>t,d=u.height>>t;let f=e.depthTexture||r[t];const p=e.depthBuffer===!0||e.stencilBuffer===!0;let g=!1;f===void 0&&p&&(f=new gi,f.format=e.stencilBuffer?ba:Hi,f.type=e.stencilBuffer?Vo:rn,f.image.width=c,f.image.height=d,f.image.depth=u.depth,f.renderTarget=e,f.isArrayTexture=e.multiview===!0&&u.depth>1,r[t]=f),(n.width!==u.width||u.height!==n.height)&&(g=!0,f&&(f.needsUpdate=!0,f.image.width=c,f.image.height=d,f.image.depth=f.isArrayTexture?f.image.depth:1)),n.width=u.width,n.height=u.height,n.textures=o,n.depthTexture=f||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==i&&(g=!0,f&&(f.needsUpdate=!0),n.sampleCount=i);const y={sampleCount:i};if(e.isXRRenderTarget!==!0){for(let x=0;x<o.length;x++){const v=o[x];g&&(v.needsUpdate=!0),this.updateTexture(v,y)}f&&this.updateTexture(f,y)}n.initialized!==!0&&(n.initialized=!0,n.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",n.onDispose))}updateTexture(e,t={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const i=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,r=this.backend;if(i&&n.initialized===!0&&r.destroyTexture(e),e.isFramebufferTexture){const d=this.renderer.getRenderTarget();d?e.type=d.texture.type:e.type=es}const{width:o,height:u,depth:c}=this.getSize(e);if(t.width=o,t.height=u,t.depth=c,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,u):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,i||e.isStorageTexture===!0||e.isExternalTexture===!0)r.createTexture(e,t),n.generation=e.version;else if(e.version>0){const d=e.image;if(d===void 0)Ne("Renderer: Texture marked for update but image is undefined.");else if(d.complete===!1)Ne("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const p=[];for(const g of e.images)p.push(g);t.images=p}else t.image=d;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(r.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&r.updateTexture(e,t);const f=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!f&&r.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else r.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;n.initialized!==!0&&(n.initialized=!0,n.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&bt.enabled===!0&&bt.getTransfer(e.colorSpace)!==Ke&&Ne("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),n.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",n.onDispose)),n.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=YW){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?(t.width=n.videoWidth||1,t.height=n.videoHeight||1,t.depth=1):typeof VideoFrame<"u"&&n instanceof VideoFrame?(t.width=n.displayWidth||1,t.height=n.displayHeight||1,t.depth=1):(t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let i;return e.mipmaps.length>0?i=e.mipmaps.length:e.isCompressedTexture===!0?i=1:i=Math.floor(Math.log2(Math.max(t,n)))+1,i}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){const t=this.get(e),n=t.textures,i=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let r=0;r<n.length;r++)this._destroyTexture(n[r]);i&&this._destroyTexture(i),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const n=t.isDefaultTexture;this.backend.destroyTexture(e,n),this.delete(e),this.info.memory.textures--}}}class AS extends Qe{constructor(e,t,n,i=1){super(e,t,n),this.a=i}set(e,t,n,i=1){return this.a=i,super.set(e,t,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class SO extends vt{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const n=this.getNodeType(e),i=e.getStructTypeNode(n);let r;return i!==null?r=i.getMemberType(e,t):(Ae(`TSL: Member "${t}" not found in struct "${n}".`),r="float"),r}getHash(){return this.uuid}generate(){return this.name}}const QW=(s,e)=>new SO(s,e);class KW extends Be{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this._currentNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):"void"}addToStack(e,t=this.nodes.length){return e.isNode!==!0?(Ae("TSL: Invalid node added to stack."),this):(this.nodes.splice(t,0,e),this)}addToStackBefore(e){const t=this._currentNode?this.nodes.indexOf(this._currentNode):0;return this.addToStack(e,t)}If(e,t){const n=new Sc(t);return this._currentCond=Hn(e,n),this.addToStack(this._currentCond)}ElseIf(e,t){const n=new Sc(t),i=Hn(e,n);return this._currentCond.elseNode=i,this._currentCond=i,this}Else(e){return this._currentCond.elseNode=new Sc(e),this}Switch(e){return this._expressionNode=Re(e),this}Case(...e){const t=[];if(e.length>=2)for(let u=0;u<e.length-1;u++)t.push(this._expressionNode.equal(Re(e[u])));else Ae("TSL: Invalid parameter length. Case() requires at least two parameters.");const n=e[e.length-1],i=new Sc(n);let r=t[0];for(let u=1;u<t.length;u++)r=r.or(t[u]);const o=Hn(r,i);return this._currentCond===null?(this._currentCond=o,this.addToStack(this._currentCond)):(this._currentCond.elseNode=o,this._currentCond=o,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const i of this.getChildren())i.isVarNode&&i.isIntent(e)&&i.isAssign(e)!==!0||(t["node"+n++]=i);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){const n=TT(),i=e.buildStage;mf(this),e.setActiveStack(this);const r=d=>{if(this._currentNode=d,!(d.isVarNode&&d.isIntent(e)&&d.isAssign(e)!==!0)){if(i==="setup")d.build(e);else if(i==="analyze")d.build(e,this);else if(i==="generate"){const f=e.getDataFromNode(d,"any").stages,p=f&&f[e.shaderStage];if(d.isVarNode&&p&&p.length===1&&p[0]&&p[0].isStackNode)return;d.build(e,"void")}}},o=[...this.nodes];for(const d of o)r(d);this._currentNode=null;const u=this.nodes.filter(d=>o.indexOf(d)===-1);for(const d of u)r(d);let c;return this.hasOutput?c=this.outputNode.build(e,...t):c=super.build(e,...t),mf(n),e.removeActiveStack(this),c}}const vg=We(KW).setParameterLength(0,1);function JW(s){return Object.entries(s).map(([e,t])=>typeof t=="string"?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})}class eX extends Be{static get type(){return"StructTypeNode"}constructor(e,t=null){super("struct"),this.membersLayout=JW(e),this.name=t,this.isStructLayoutNode=!0}getLength(){const e=Float32Array.BYTES_PER_ELEMENT;let t=1,n=0;for(const i of this.membersLayout){const r=i.type,o=TH(r),u=SH(r)/e;t=Math.max(t,u);const d=n%t%u;d!==0&&(n+=u-d),n+=o}return Math.ceil(n/t)*t}getMemberType(e,t){const n=this.membersLayout.find(i=>i.name===t);return n?n.type:"void"}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.getStructTypeFromNode(this,this.membersLayout,this.name),e.addInclude(this)}generate(e){return this.getNodeType(e)}}class tX extends Be{static get type(){return"StructNode"}constructor(e,t){super("vec3"),this.structTypeNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structTypeNode.getNodeType(e)}getMemberType(e,t){return this.structTypeNode.getMemberType(e,t)}generate(e){const t=e.getVarFromNode(this),n=t.type,i=e.getPropertyName(t);return e.addLineFlowCode(`${i} = ${e.generateStruct(n,this.structTypeNode.membersLayout,this.values)}`,this),t.name}}const nX=(s,e=null)=>{const t=new eX(s,e),n=(...i)=>{let r=null;if(i.length>0)if(i[0].isNode){r={};const o=Object.keys(s);for(let u=0;u<i.length;u++)r[o[u]]=i[u]}else r=i[0];return new tX(t,r)};return n.layout=t,n.isStruct=!0,n};class wO extends Be{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(e){const t=e.getNodeProperties(this);if(t.membersLayout===void 0){const n=this.members,i=[];for(let r=0;r<n.length;r++){const o="m"+r,u=n[r].getNodeType(e);i.push({name:o,type:u,index:r})}t.membersLayout=i,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}return t.structType.name}generate(e){const t=e.getOutputStructName(),n=this.members,i=t!==""?t+".":"";for(let r=0;r<n.length;r++){const o=n[r].build(e);e.addLineFlowCode(`${i}m${r} = ${o}`,this)}return t}}const sX=We(wO);function MO(s,e){for(let t=0;t<s.length;t++)if(s[t].name===e)return t;return-1}class iX extends wO{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return this.outputNodes[e]!==void 0}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes};return NO(t)}setup(e){const t=this.outputNodes,n=e.renderer.getRenderTarget(),i=[],r=n.textures;for(const o in t){const u=MO(r,o);i[u]=Ie(t[o])}return this.members=i,super.setup(e)}}const NO=We(iX);class Pf extends nn{static get type(){return"BitcastNode"}constructor(e,t,n=null){super(),this.valueNode=e,this.conversionType=t,this.inputType=n,this.isBitcastNode=!0}getNodeType(e){if(this.inputType!==null){const t=this.valueNode.getNodeType(e),n=e.getTypeLength(t);return e.getTypeFromLength(n,this.conversionType)}return this.conversionType}generate(e){const t=this.getNodeType(e);let n="";if(this.inputType!==null){const i=this.valueNode.getNodeType(e);n=e.getTypeLength(i)===1?this.inputType:e.changeComponentType(i,this.inputType)}else n=this.valueNode.getNodeType(e);return`${e.getBitcastMethod(t,n)}( ${this.valueNode.build(e,n)} )`}}const AO=we(Pf).setParameterLength(2),rX=s=>new Pf(s,"int","float"),EO=s=>new Pf(s,"uint","float"),aX=s=>new Pf(s,"float","int"),oX=s=>new Pf(s,"float","uint"),Wm={};class Js extends oe{static get type(){return"BitcountNode"}constructor(e,t){super(e,t),this.isBitcountNode=!0}_resolveElementType(e,t,n){n==="int"?t.assign(AO(e,"uint")):t.assign(e)}_returnDataNode(e){switch(e){case"uint":return ve;case"int":return H;case"uvec2":return ST;case"uvec3":return iu;case"uvec4":return AT;case"ivec2":return vn;case"ivec3":return wT;case"ivec4":return NT}}_createTrailingZerosBaseLayout(e,t){const n=this._returnDataNode(t);return te(([r])=>{const o=ve(0);this._resolveElementType(r,o,t);const u=z(o.bitAnd(IT(o))),d=EO(u).shiftRight(23).sub(127);return n(d)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createLeadingZerosBaseLayout(e,t){const n=this._returnDataNode(t);return te(([r])=>{ke(r.equal(ve(0)),()=>ve(32));const o=ve(0),u=ve(0);return this._resolveElementType(r,o,t),ke(o.shiftRight(16).equal(0),()=>{u.addAssign(16),o.shiftLeftAssign(16)}),ke(o.shiftRight(24).equal(0),()=>{u.addAssign(8),o.shiftLeftAssign(8)}),ke(o.shiftRight(28).equal(0),()=>{u.addAssign(4),o.shiftLeftAssign(4)}),ke(o.shiftRight(30).equal(0),()=>{u.addAssign(2),o.shiftLeftAssign(2)}),ke(o.shiftRight(31).equal(0),()=>{u.addAssign(1)}),n(u)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createOneBitsBaseLayout(e,t){const n=this._returnDataNode(t);return te(([r])=>{const o=ve(0);this._resolveElementType(r,o,t),o.assign(o.sub(o.shiftRight(ve(1)).bitAnd(ve(1431655765)))),o.assign(o.bitAnd(ve(858993459)).add(o.shiftRight(ve(2)).bitAnd(ve(858993459))));const u=o.add(o.shiftRight(ve(4))).bitAnd(ve(252645135)).mul(ve(16843009)).shiftRight(ve(24));return n(u)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createMainLayout(e,t,n,i){const r=this._returnDataNode(t);return te(([u])=>{if(n===1)return r(i(u));{const c=r(0),d=["x","y","z","w"];for(let f=0;f<n;f++){const p=d[f];c[p].assign(i(u[p]))}return c}}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}setup(e){const{method:t,aNode:n}=this,{renderer:i}=e;if(i.backend.isWebGPUBackend)return super.setup(e);const r=this.getInputType(e),o=e.getElementType(r),u=e.getTypeLength(r),c=`${t}_base_${o}`,d=`${t}_${r}`;let f=Wm[c];if(f===void 0){switch(t){case Js.COUNT_LEADING_ZEROS:{f=this._createLeadingZerosBaseLayout(c,o);break}case Js.COUNT_TRAILING_ZEROS:{f=this._createTrailingZerosBaseLayout(c,o);break}case Js.COUNT_ONE_BITS:{f=this._createOneBitsBaseLayout(c,o);break}}Wm[c]=f}let p=Wm[d];return p===void 0&&(p=this._createMainLayout(d,r,u,f),Wm[d]=p),te(()=>p(n))()}}Js.COUNT_TRAILING_ZEROS="countTrailingZeros";Js.COUNT_LEADING_ZEROS="countLeadingZeros";Js.COUNT_ONE_BITS="countOneBits";const lX=we(Js,Js.COUNT_TRAILING_ZEROS).setParameterLength(1),uX=we(Js,Js.COUNT_LEADING_ZEROS).setParameterLength(1),cX=we(Js,Js.COUNT_ONE_BITS).setParameterLength(1),hX=te(([s])=>{const e=s.toUint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).toFloat().mul(1/2**32)}),gv=(s,e)=>fi(qe(4,s.mul(ot(1,s))),e),dX=(s,e)=>s.lessThan(.5)?gv(s.mul(2),e).div(2):ot(1,gv(qe(ot(1,s),2),e).div(2)),fX=(s,e,t)=>fi(ti(fi(s,e),pn(fi(s,e),fi(ot(1,s),t))),1/e),pX=(s,e)=>hs(M0.mul(e.mul(s).sub(1))).div(M0.mul(e.mul(s).sub(1)));class ES extends nn{static get type(){return"PackFloatNode"}constructor(e,t){super(),this.vectorNode=t,this.encoding=e,this.isPackFloatNode=!0}getNodeType(){return"uint"}generate(e){const t=this.vectorNode.getNodeType(e);return`${e.getFloatPackingMethod(this.encoding)}(${this.vectorNode.build(e,t)})`}}const mX=we(ES,"snorm").setParameterLength(1),gX=we(ES,"unorm").setParameterLength(1),yX=we(ES,"float16").setParameterLength(1);class RS extends nn{static get type(){return"UnpackFloatNode"}constructor(e,t){super(),this.uintNode=t,this.encoding=e,this.isUnpackFloatNode=!0}getNodeType(){return"vec2"}generate(e){const t=this.uintNode.getNodeType(e);return`${e.getFloatUnpackingMethod(this.encoding)}(${this.uintNode.build(e,t)})`}}const xX=we(RS,"snorm").setParameterLength(1),bX=we(RS,"unorm").setParameterLength(1),_X=we(RS,"float16").setParameterLength(1),ha=te(([s])=>s.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),vX=te(([s])=>Z(ha(s.z.add(ha(s.y.mul(1)))),ha(s.z.add(ha(s.x.mul(1)))),ha(s.y.add(ha(s.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),TX=te(([s,e,t])=>{const n=Z(s).toVar(),i=z(1.4).toVar(),r=z(0).toVar(),o=Z(n).toVar();return At({start:z(0),end:z(3),type:"float",condition:"<="},()=>{const u=Z(vX(o.mul(2))).toVar();n.addAssign(u.add(t.mul(z(.1).mul(e)))),o.mulAssign(1.8),i.mulAssign(1.5),n.mulAssign(1.2);const c=z(ha(n.z.add(ha(n.x.add(ha(n.y)))))).toVar();r.addAssign(c.div(i)),o.addAssign(.14)}),r}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class SX extends Be{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFn=null,this.global=!0}getNodeType(e){return this.getCandidateFn(e).shaderNode.layout.type}getCandidateFn(e){const t=this.parametersNodes;let n=this._candidateFn;if(n===null){let i=null,r=-1;for(const o of this.functionNodes){const c=o.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const d=c.inputs;if(t.length===d.length){let f=0;for(let p=0;p<t.length;p++){const g=t[p],y=d[p];g.getNodeType(e)===y.type&&f++}f>r&&(i=o,r=f)}}this._candidateFn=n=i}return n}setup(e){return this.getCandidateFn(e)(...this.parametersNodes)}}const wX=We(SX),Wn=s=>(...e)=>wX(s,...e),oh=ze(0).setGroup(Ue).onRenderUpdate(s=>s.time),MX=ze(0).setGroup(Ue).onRenderUpdate(s=>s.deltaTime),RO=ze(0,"uint").setGroup(Ue).onRenderUpdate(s=>s.frameId),NX=(s=oh)=>s.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),AX=(s=oh)=>s.fract().round(),EX=(s=oh)=>s.add(.5).fract().mul(2).sub(1).abs(),RX=(s=oh)=>s.fract();function CX(s,e=null){return Fa(e,{getUV:s})}const DX=te(([s,e,t=Se(.5)])=>Vf(s.sub(t),e).add(t)),BX=te(([s,e,t=Se(.5)])=>{const n=s.sub(t),i=n.dot(n),o=i.mul(i).mul(e);return s.add(n.mul(o))}),LX=te(({position:s=null,horizontal:e=!0,vertical:t=!1})=>{let n;s!==null?(n=pi.toVar(),n[3][0]=s.x,n[3][1]=s.y,n[3][2]=s.z):n=pi;const i=Mi.mul(n);return pf(e)&&(i[0][0]=pi[0].length(),i[0][1]=0,i[0][2]=0),pf(t)&&(i[1][0]=0,i[1][1]=pi[1].length(),i[1][2]=0),i[2][0]=0,i[2][1]=0,i[2][2]=1,Na.mul(i).mul(Qt)}),FX=te(([s=null])=>{const e=E0();return E0(yS(s)).sub(e).lessThan(0).select(Ma,s)});class OX extends Be{static get type(){return"SpriteSheetUVNode"}constructor(e,t=Ct(),n=z(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=n}setup(){const{frameNode:e,uvNode:t,countNode:n}=this,{width:i,height:r}=n,o=e.mod(i.mul(r)).floor(),u=o.mod(i),c=r.sub(o.add(1).div(i).ceil()),d=n.reciprocal(),f=Se(u,c);return t.add(f).mul(d)}}const UX=We(OX).setParameterLength(3),CO=te(([s,e=null,t=null,n=z(1),i=Qt,r=Ls])=>{let o=r.abs().normalize();o=o.div(o.dot(Z(1)));const u=i.yz.mul(n),c=i.zx.mul(n),d=i.xy.mul(n),f=s.value,p=e!==null?e.value:f,g=t!==null?t.value:f,y=_t(f,u).mul(o.x),x=_t(p,c).mul(o.y),v=_t(g,d).mul(o.z);return pn(y,x,v)}),zX=(...s)=>CO(...s),hc=new ca,Nl=new J,dc=new J,u_=new J,gd=new gt,Xm=new J(0,0,-1),cr=new yt,yd=new J,Ym=new J,xd=new yt,Zm=new Ge,C0=new La,VX=Ma.flipX();C0.depthTexture=new gi(1,1);let Qm=!1;class CS extends Mr{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||C0.texture,VX),this._reflectorBaseNode=e.reflector||new PX(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=Re(new CS({defaultTexture:C0.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){const e=new this.constructor(this.reflectorNode);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e._reflectorBaseNode=this._reflectorBaseNode,e}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class PX extends Be{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();const{target:n=new Sn,resolutionScale:i=1,generateMipmaps:r=!1,bounces:o=!0,depth:u=!1,samples:c=0}=t;this.textureNode=e,this.target=n,this.resolutionScale=i,t.resolution!==void 0&&($t('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=t.resolution),this.generateMipmaps=r,this.bounces=o,this.depth=u,this.samples=c,this.updateBeforeType=o?Ye.RENDER:Ye.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(e,t){const n=this.resolutionScale;t.getDrawingBufferSize(Zm),e.setSize(Math.round(Zm.width*n),Math.round(Zm.height*n))}setup(e){return this._updateResolution(C0,e.renderer),super.setup(e)}dispose(){super.dispose();for(const e of this.renderTargets.values())e.dispose()}getVirtualCamera(e){let t=this.virtualCameras.get(e);return t===void 0&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return t===void 0&&(t=new La(0,0,{type:Gn,samples:this.samples}),this.generateMipmaps===!0&&(t.texture.minFilter=F8,t.texture.generateMipmaps=!0),this.depth===!0&&(t.depthTexture=new gi),this.renderTargets.set(e,t)),t}updateBefore(e){if(this.bounces===!1&&Qm)return!1;Qm=!0;const{scene:t,camera:n,renderer:i,material:r}=e,{target:o}=this,u=this.getVirtualCamera(n),c=this.getRenderTarget(u);i.getDrawingBufferSize(Zm),this._updateResolution(c,i),dc.setFromMatrixPosition(o.matrixWorld),u_.setFromMatrixPosition(n.matrixWorld),gd.extractRotation(o.matrixWorld),Nl.set(0,0,1),Nl.applyMatrix4(gd),yd.subVectors(dc,u_);const d=yd.dot(Nl)>0;let f=!1;if(d===!0&&this.forceUpdate===!1){if(this.hasOutput===!1){Qm=!1;return}f=!0}yd.reflect(Nl).negate(),yd.add(dc),gd.extractRotation(n.matrixWorld),Xm.set(0,0,-1),Xm.applyMatrix4(gd),Xm.add(u_),Ym.subVectors(dc,Xm),Ym.reflect(Nl).negate(),Ym.add(dc),u.coordinateSystem=n.coordinateSystem,u.position.copy(yd),u.up.set(0,1,0),u.up.applyMatrix4(gd),u.up.reflect(Nl),u.lookAt(Ym),u.near=n.near,u.far=n.far,u.updateMatrixWorld(),u.projectionMatrix.copy(n.projectionMatrix),hc.setFromNormalAndCoplanarPoint(Nl,dc),hc.applyMatrix4(u.matrixWorldInverse),cr.set(hc.normal.x,hc.normal.y,hc.normal.z,hc.constant);const p=u.projectionMatrix;xd.x=(Math.sign(cr.x)+p.elements[8])/p.elements[0],xd.y=(Math.sign(cr.y)+p.elements[9])/p.elements[5],xd.z=-1,xd.w=(1+p.elements[10])/p.elements[14],cr.multiplyScalar(1/cr.dot(xd));const g=0;p.elements[2]=cr.x,p.elements[6]=cr.y,p.elements[10]=i.coordinateSystem===xi?cr.z-g:cr.z+1-g,p.elements[14]=cr.w,this.textureNode.value=c.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=c.depthTexture),r.visible=!1;const y=i.getRenderTarget(),x=i.getMRT(),v=i.autoClear;i.setMRT(null),i.setRenderTarget(c),i.autoClear=!0;const S=t.name;t.name=(t.name||"Scene")+" [ Reflector ]",f?(i.clear(),this.hasOutput=!1):(i.render(t,u),this.hasOutput=!0),t.name=S,i.setMRT(x),i.setRenderTarget(y),i.autoClear=v,r.visible=!0,Qm=!1,this.forceUpdate=!1}get resolution(){return $t('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(e){$t('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=e}}const IX=s=>new CS(s),c_=new mT(-1,1,1,-1,0,1);class kX extends Si{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new fn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new fn(t,2))}}const GX=new kX;class If extends Rn{constructor(e=null){super(GX,e),this.camera=c_,this.isQuadMesh=!0}async renderAsync(e){$t('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,c_)}render(e){e.render(this,c_)}}const $X=new Ge;class HX extends Mr{static get type(){return"RTTNode"}constructor(e,t=null,n=null,i={type:Gn}){const r=new La(t,n,i);super(r.texture,Ct()),this.isRTTNode=!0,this.node=e,this.width=t,this.height=n,this.pixelRatio=1,this.renderTarget=r,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new If(new en),this.updateBeforeType=Ye.RENDER}get autoResize(){return this.width===null}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const n=e*this.pixelRatio,i=t*this.pixelRatio;this.renderTarget.setSize(n,i),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoResize===!0){const i=e.getPixelRatio(),r=e.getSize($X),o=Math.floor(r.width*i),u=Math.floor(r.height*i);(o!==this.renderTarget.width||u!==this.renderTarget.height)&&(this.renderTarget.setSize(o,u),this.textureNeedsUpdate=!0)}let t="RTT";this.node.name&&(t=this.node.name+" [ "+t+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=t;const n=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(n)}clone(){const e=new Mr(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const DO=(s,...e)=>Re(new HX(Re(s),...e)),jX=(s,...e)=>s.isSampleNode||s.isTextureNode?s:s.isPassNode?s.getTextureNode():DO(s,...e),yc=te(([s,e,t],n)=>{let i;n.renderer.coordinateSystem===xi?(s=Se(s.x,s.y.oneMinus()).mul(2).sub(1),i=Ie(Z(s,e),1)):i=Ie(Z(s.x,s.y.oneMinus(),e).mul(2).sub(1),1);const r=Ie(t.mul(i));return r.xyz.div(r.w)}),qX=te(([s,e])=>{const t=e.mul(Ie(s,1)),n=t.xy.div(t.w).mul(.5).add(.5).toVar();return Se(n.x,n.y.oneMinus())}),WX=te(([s,e,t])=>{const n=wa(sn(e)),i=vn(s.mul(n)).toVar(),r=sn(e,i).toVar(),o=sn(e,i.sub(vn(2,0))).toVar(),u=sn(e,i.sub(vn(1,0))).toVar(),c=sn(e,i.add(vn(1,0))).toVar(),d=sn(e,i.add(vn(2,0))).toVar(),f=sn(e,i.add(vn(0,2))).toVar(),p=sn(e,i.add(vn(0,1))).toVar(),g=sn(e,i.sub(vn(0,1))).toVar(),y=sn(e,i.sub(vn(0,2))).toVar(),x=It(ot(z(2).mul(u).sub(o),r)).toVar(),v=It(ot(z(2).mul(c).sub(d),r)).toVar(),S=It(ot(z(2).mul(p).sub(f),r)).toVar(),w=It(ot(z(2).mul(g).sub(y),r)).toVar(),M=yc(s,r,t).toVar(),T=x.lessThan(v).select(M.sub(yc(s.sub(Se(z(1).div(n.x),0)),u,t)),M.negate().add(yc(s.add(Se(z(1).div(n.x),0)),c,t))),A=S.lessThan(w).select(M.sub(yc(s.add(Se(0,z(1).div(n.y))),p,t)),M.negate().add(yc(s.sub(Se(0,z(1).div(n.y))),g,t)));return ps(Ra(T,A))}),DS=te(([s])=>Wi(z(52.9829189).mul(Wi(vi(s,Se(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]}),ki=te(([s,e,t])=>{const n=z(2.399963229728653),i=ts(z(s).add(.5).div(z(e))),r=z(s).mul(n).add(t);return Se(zi(r),hs(r)).mul(i)}).setLayout({name:"vogelDiskSample",type:"vec2",inputs:[{name:"sampleIndex",type:"int"},{name:"samplesCount",type:"int"},{name:"phi",type:"float"}]});class XX extends Be{static get type(){return"SampleNode"}constructor(e,t=null){super(),this.callback=e,this.uvNode=t,this.isSampleNode=!0}setup(){return this.sample(Ct())}sample(e){return this.callback(e)}}const YX=(s,e=null)=>new XX(s,Re(e));class Rs extends Be{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===Rs.OBJECT?this.updateType=Ye.OBJECT:e===Rs.MATERIAL?this.updateType=Ye.RENDER:e===Rs.BEFORE_OBJECT?this.updateBeforeType=Ye.OBJECT:e===Rs.BEFORE_MATERIAL&&(this.updateBeforeType=Ye.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}Rs.OBJECT="object";Rs.MATERIAL="material";Rs.BEFORE_OBJECT="beforeObject";Rs.BEFORE_MATERIAL="beforeMaterial";const Fy=(s,e)=>new Rs(s,e).toStack(),ZX=s=>Fy(Rs.OBJECT,s),QX=s=>Fy(Rs.MATERIAL,s),KX=s=>Fy(Rs.BEFORE_OBJECT,s),JX=s=>Fy(Rs.BEFORE_MATERIAL,s);class eY extends Lc{constructor(e,t,n=Float32Array){const i=ArrayBuffer.isView(e)?e:new n(e*t);super(i,t),this.isStorageInstancedBufferAttribute=!0}}class tY extends Ks{constructor(e,t,n=Float32Array){const i=ArrayBuffer.isView(e)?e:new n(e*t);super(i,t),this.isStorageBufferAttribute=!0}}const nY=(s,e="float")=>{let t,n;e.isStruct===!0?(t=e.layout.getLength(),n=x0("float")):(t=XD(e),n=x0(e));const i=new tY(s,t,n);return Aa(i,e,s)},sY=(s,e="float")=>{let t,n;e.isStruct===!0?(t=e.layout.getLength(),n=x0("float")):(t=XD(e),n=x0(e));const i=new eY(s,t,n);return Aa(i,e,s)};class iY extends Be{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const rY=Ee(iY),bd=new bi,h_=new gt;class Cs extends Be{static get type(){return"SceneNode"}constructor(e=Cs.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=this.scene!==null?this.scene:e.scene;let i;return t===Cs.BACKGROUND_BLURRINESS?i=Et("backgroundBlurriness","float",n):t===Cs.BACKGROUND_INTENSITY?i=Et("backgroundIntensity","float",n):t===Cs.BACKGROUND_ROTATION?i=ze("mat4").setName("backgroundRotation").setGroup(Ue).onRenderUpdate(()=>{const r=n.background;return r!==null&&r.isTexture&&r.mapping!==Yv?(bd.copy(n.backgroundRotation),bd.x*=-1,bd.y*=-1,bd.z*=-1,h_.makeRotationFromEuler(bd)):h_.identity(),h_}):Ae("SceneNode: Unknown scope:",t),i}}Cs.BACKGROUND_BLURRINESS="backgroundBlurriness";Cs.BACKGROUND_INTENSITY="backgroundIntensity";Cs.BACKGROUND_ROTATION="backgroundRotation";const BO=Ee(Cs,Cs.BACKGROUND_BLURRINESS),yv=Ee(Cs,Cs.BACKGROUND_INTENSITY),LO=Ee(Cs,Cs.BACKGROUND_ROTATION);class aY extends Mr{static get type(){return"StorageTextureNode"}constructor(e,t,n=null){super(e,t),this.storeNode=n,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=$n.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);return t.storeNode=this.storeNode,t}setAccess(e){return this.access=e,this}setMipLevel(e){return this.mipLevel=e,this}generate(e,t){let n;return this.storeNode!==null?n=this.generateStore(e):n=super.generate(e,t),n}toReadWrite(){return this.setAccess($n.READ_WRITE)}toReadOnly(){return this.setAccess($n.READ_ONLY)}toWriteOnly(){return this.setAccess($n.WRITE_ONLY)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:n,storeNode:i,depthNode:r}=t,o=super.generate(e,"property"),u=n.build(e,this.value.is3DTexture===!0?"uvec3":"uvec2"),c=i.build(e,"vec4"),d=r?r.build(e,"int"):null,f=e.generateTextureStore(e,o,u,d,c);e.addLineFlowCode(f,this)}clone(){const e=super.clone();return e.storeNode=this.storeNode,e.mipLevel=this.mipLevel,e}}const FO=We(aY).setParameterLength(1,3),oY=(s,e,t)=>{const n=FO(s,e,t);return t!==null&&n.toStack(),n},lY=te(({texture:s,uv:e})=>{const n=Z().toVar();return ke(e.x.lessThan(1e-4),()=>{n.assign(Z(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{n.assign(Z(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{n.assign(Z(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{n.assign(Z(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{n.assign(Z(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{n.assign(Z(0,0,-1))}).Else(()=>{const r=s.sample(e.add(Z(-.01,0,0))).r.sub(s.sample(e.add(Z(.01,0,0))).r),o=s.sample(e.add(Z(0,-.01,0))).r.sub(s.sample(e.add(Z(0,.01,0))).r),u=s.sample(e.add(Z(0,0,-.01))).r.sub(s.sample(e.add(Z(0,0,.01))).r);n.assign(Z(r,o,u))}),n.normalize()});class uY extends Mr{static get type(){return"Texture3DNode"}constructor(e,t=null,n=null){super(e,t,n),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return Z(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(H(wa(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return lY({texture:this,uv:e})}}const Oy=We(uY).setParameterLength(1,3),cY=(...s)=>Oy(...s).setSampler(!1),hY=(s,e,t)=>Oy(s,e).level(t);class dY extends wy{static get type(){return"UserDataNode"}constructor(e,t,n=null){super(e,t,n),this.userData=n}updateReference(e){return this.reference=this.userData!==null?this.userData:e.object.userData,this.reference}}const fY=(s,e,t)=>new dY(s,e,t),_R=new WeakMap;class pY extends nn{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=Ye.OBJECT,this.updateAfterType=Ye.OBJECT,this.previousModelWorldMatrix=ze(new gt),this.previousProjectionMatrix=ze(new gt).setGroup(Ue),this.previousCameraViewMatrix=ze(new gt)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:n}){const i=vR(n);this.previousModelWorldMatrix.value.copy(i);const r=OO(t);r.frameId!==e&&(r.frameId=e,r.previousProjectionMatrix===void 0?(r.previousProjectionMatrix=new gt,r.previousCameraViewMatrix=new gt,r.currentProjectionMatrix=new gt,r.currentCameraViewMatrix=new gt,r.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),r.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(r.previousProjectionMatrix.copy(r.currentProjectionMatrix),r.previousCameraViewMatrix.copy(r.currentCameraViewMatrix)),r.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),r.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(r.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(r.previousCameraViewMatrix))}updateAfter({object:e}){vR(e).copy(e.matrixWorld)}setup(){const e=this.projectionMatrix===null?Na:ze(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),n=e.mul(qo).mul(Qt),i=this.previousProjectionMatrix.mul(t).mul(A0),r=n.xy.div(n.w),o=i.xy.div(i.w);return ot(r,o)}}function OO(s){let e=_R.get(s);return e===void 0&&(e={},_R.set(s,e)),e}function vR(s,e=0){const t=OO(s);let n=t[e];return n===void 0&&(t[e]=n=new gt,t[e].copy(s.matrixWorld)),n}const mY=Ee(pY),gY=te(([s])=>BS(s.rgb)),yY=te(([s,e=z(1)])=>e.mix(BS(s.rgb),s.rgb)),xY=te(([s,e=z(1)])=>{const t=pn(s.r,s.g,s.b).div(3),n=s.r.max(s.g.max(s.b)),i=n.sub(t).mul(e).mul(-3);return at(s.rgb,n,i)}),bY=te(([s,e=z(1)])=>{const t=Z(.57735,.57735,.57735),n=e.cos();return Z(s.rgb.mul(n).add(t.cross(s.rgb).mul(e.sin()).add(t.mul(vi(t,s.rgb).mul(n.oneMinus())))))}),BS=(s,e=Z(bt.getLuminanceCoefficients(new J)))=>vi(s,e),_Y=te(([s,e=Z(1),t=Z(0),n=Z(1),i=z(1),r=Z(bt.getLuminanceCoefficients(new J,p0))])=>{const o=s.rgb.dot(Z(r)),u=Jt(s.rgb.mul(e).add(t),0).toVar(),c=u.pow(n).toVar();return ke(u.r.greaterThan(0),()=>{u.r.assign(c.r)}),ke(u.g.greaterThan(0),()=>{u.g.assign(c.g)}),ke(u.b.greaterThan(0),()=>{u.b.assign(c.b)}),u.assign(o.add(u.sub(o).mul(i))),Ie(u.rgb,s.a)});class vY extends nn{static get type(){return"PosterizeNode"}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const TY=We(vY).setParameterLength(2),Km=new Ge;class UO extends Mr{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class TR extends UO{static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class Nr extends nn{static get type(){return"PassNode"}constructor(e,t,n,i={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=i,this._pixelRatio=1,this._width=1,this._height=1;const r=new gi;r.isRenderTargetTexture=!0,r.name="depth";const o=new La(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Gn,...i});o.texture.name="output",o.depthTexture=r,this.renderTarget=o,this.overrideMaterial=null,this.transparent=!0,this.opaque=!0,this.contextNode=null,this._contextNodeCache=null,this._textures={output:o.texture,depth:r},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=ze(0),this._cameraFar=ze(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=Ye.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return Ne("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return Ne("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const n=this._textures[e],i=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[i]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=new TR(this,e),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=new TR(this,e,!0),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const n=this._cameraNear,i=this._cameraFar;this._viewZNodes[e]=t=xS(this.getTextureNode(e),n,i)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const n=this._cameraNear,i=this._cameraFar,r=this.getViewZNode(e);this._linearDepthNodes[e]=t=Vc(r,n,i)}return t}async compileAsync(e){const t=e.getRenderTarget(),n=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(n)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getOutputBufferType(),this.scope===Nr.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let i,r;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(r=1,i=t.xr.getCamera(),t.xr.updateCamera(i),Km.set(o.width,o.height)):(i=this.camera,r=t.getPixelRatio(),t.getSize(Km)),this._pixelRatio=r,this.setSize(Km.width,Km.height);const u=t.getRenderTarget(),c=t.getMRT(),d=t.autoClear,f=t.transparent,p=t.opaque,g=i.layers.mask,y=t.contextNode,x=n.overrideMaterial;this._cameraNear.value=i.near,this._cameraFar.value=i.far,this._layers!==null&&(i.layers.mask=this._layers.mask);for(const S in this._previousTextures)this.toggleTexture(S);this.overrideMaterial!==null&&(n.overrideMaterial=this.overrideMaterial),t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0,t.transparent=this.transparent,t.opaque=this.opaque,this.contextNode!==null&&((this._contextNodeCache===null||this._contextNodeCache.version!==this.version)&&(this._contextNodeCache={version:this.version,context:Fa({...t.contextNode.getFlowContextData(),...this.contextNode.getFlowContextData()})}),t.contextNode=this._contextNodeCache.context);const v=n.name;n.name=this.name?this.name:n.name,t.render(n,i),n.name=v,n.overrideMaterial=x,t.setRenderTarget(u),t.setMRT(c),t.autoClear=d,t.transparent=f,t.opaque=p,t.contextNode=y,i.layers.mask=g}setSize(e,t){this._width=e,this._height=t;const n=Math.floor(this._width*this._pixelRatio*this._resolutionScale),i=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(n,i),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,n,i){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new yt),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,n,i),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,n,i){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new yt),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,n,i),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Nr.COLOR="color";Nr.DEPTH="depth";const SY=(s,e,t)=>new Nr(Nr.COLOR,s,e,t),wY=(s,e)=>new UO(s,e),MY=(s,e,t)=>new Nr(Nr.DEPTH,s,e,t);class NY extends Nr{static get type(){return"ToonOutlinePassNode"}constructor(e,t,n,i,r){super(Nr.COLOR,e,t),this.colorNode=n,this.thicknessNode=i,this.alphaNode=r,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(e){const{renderer:t}=e,n=t.getRenderObjectFunction();t.setRenderObjectFunction((i,r,o,u,c,d,f,p)=>{if((c.isMeshToonMaterial||c.isMeshToonNodeMaterial)&&c.wireframe===!1){const g=this._getOutlineMaterial(c);t.renderObject(i,r,o,u,g,d,f,p)}t.renderObject(i,r,o,u,c,d,f,p)}),super.updateBefore(e),t.setRenderObjectFunction(n)}_createMaterial(){const e=new en;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=ns;const t=Ls.negate(),n=Na.mul(qo),i=z(1),r=n.mul(Ie(Qt,1)),o=n.mul(Ie(Qt.add(t),1)),u=ps(r.sub(o));return e.vertexNode=r.add(u.mul(this.thicknessNode).mul(r.w).mul(i)),e.colorNode=Ie(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return t===void 0&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const AY=(s,e,t=new Qe(0,0,0),n=.003,i=1)=>Re(new NY(s,e,Re(t),Re(n),Re(i))),zO=te(([s,e])=>s.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),VO=te(([s,e])=>(s=s.mul(e),s.div(s.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),PO=te(([s,e])=>{s=s.mul(e),s=s.sub(.004).max(0);const t=s.mul(s.mul(6.2).add(.5)),n=s.mul(s.mul(6.2).add(1.7)).add(.06);return t.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),EY=te(([s])=>{const e=s.mul(s.add(.0245786)).sub(90537e-9),t=s.mul(s.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),IO=te(([s,e])=>{const t=qn(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=qn(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return s=s.mul(e).div(.6),s=t.mul(s),s=EY(s),s=n.mul(s),s.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),RY=qn(Z(1.6605,-.1246,-.0182),Z(-.5876,1.1329,-.1006),Z(-.0728,-.0083,1.1187)),CY=qn(Z(.6274,.0691,.0164),Z(.3293,.9195,.088),Z(.0433,.0113,.8956)),DY=te(([s])=>{const e=Z(s).toVar(),t=Z(e.mul(e)).toVar(),n=Z(t.mul(t)).toVar();return z(15.5).mul(n.mul(t)).sub(qe(40.14,n.mul(e))).add(qe(31.96,n).sub(qe(6.868,t.mul(e))).add(qe(.4298,t).add(qe(.1191,e).sub(.00232))))}),kO=te(([s,e])=>{const t=Z(s).toVar(),n=qn(Z(.856627153315983,.137318972929847,.11189821299995),Z(.0951212405381588,.761241990602591,.0767994186031903),Z(.0482516061458583,.101439036467562,.811302368396859)),i=qn(Z(1.1271005818144368,-.1413297634984383,-.14132976349843826),Z(-.11060664309660323,1.157823702216272,-.11060664309660294),Z(-.016493938717834573,-.016493938717834257,1.2519364065950405)),r=z(-12.47393),o=z(4.026069);return t.mulAssign(e),t.assign(CY.mul(t)),t.assign(n.mul(t)),t.assign(Jt(t,1e-10)),t.assign(br(t)),t.assign(t.sub(r).div(o.sub(r))),t.assign(Xi(t,0,1)),t.assign(DY(t)),t.assign(i.mul(t)),t.assign(fi(Jt(Z(0),t),Z(2.2))),t.assign(RY.mul(t)),t.assign(Xi(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),GO=te(([s,e])=>{const t=z(.76),n=z(.15);s=s.mul(e);const i=Bs(s.r,Bs(s.g,s.b)),r=Hn(i.lessThan(.08),i.sub(qe(6.25,i.mul(i))),.04);s.subAssign(r);const o=Jt(s.r,Jt(s.g,s.b));ke(o.lessThan(t),()=>s);const u=ot(1,t),c=ot(1,u.mul(u).div(o.add(u.sub(t))));s.mulAssign(c.div(o));const d=ot(1,ti(1,n.mul(o.sub(c)).add(1)));return at(s,Z(c),d)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});let Fn=class extends Be{static get type(){return"CodeNode"}constructor(e="",t=[],n=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=n}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const i of t)i.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}};const Uy=We(Fn).setParameterLength(1,3),BY=(s,e)=>Uy(s,e,"js"),LY=(s,e)=>Uy(s,e,"wgsl"),FY=(s,e)=>Uy(s,e,"glsl");class $O extends Fn{static get type(){return"FunctionNode"}constructor(e="",t=[],n=""){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),i=n.name,r=n.type,o=e.getCodeFromNode(this,r);i!==""&&(o.name=i);const u=e.getPropertyName(o),c=this.getNodeFunction(e).getCode(u);return o.code=c+`
`,t==="property"?u:e.format(`${u}()`,r,t)}}const HO=(s,e=[],t="")=>{for(let r=0;r<e.length;r++){const o=e[r];typeof o=="function"&&(e[r]=o.functionNode)}const n=new $O(s,e,t),i=(...r)=>n.call(...r);return i.functionNode=n,i},OY=(s,e)=>HO(s,e,"glsl"),UY=(s,e)=>HO(s,e,"wgsl");class zY extends Be{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outputType=null,this.events=new Er,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:z()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=ZD(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=QD(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const Tg=We(zY).setParameterLength(1);class jO extends Map{get(e,t=null,...n){if(this.has(e))return super.get(e);if(t!==null){const i=t(...n);return this.set(e,i),i}}}class VY{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const Sg=new jO;class PY extends Be{static get type(){return"ScriptableNode"}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new jO,this._output=Tg(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const n=this._outputs;return n[e]===void 0?n[e]=Tg(t):n[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const n=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),n[e]=t,n[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),n[e]=t,n[e].events.addEventListener("refresh",this.onRefresh)):n[e]===void 0?(n[e]=Tg(t),n[e].events.addEventListener("refresh",this.onRefresh)):n[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const i=this.getObject()[e];if(typeof i=="function")return i(...t)}async callAsync(e,...t){const i=this.getObject()[e];if(typeof i=="function")return i.constructor.name==="AsyncFunction"?await i(...t):i(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(d,f)=>this.setOutput(d,f),n=new VY(this),i=Sg.get("THREE"),r=Sg.get("TSL"),o=this.getMethod(),u=[n,this._local,Sg,e,t,i,r];this._object=o(...u);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const d of c.elements){const f=d.id||d.name;d.inputType&&(this.getParameter(f)===void 0&&this.setParameter(f,null),this.getParameter(f).inputType=d.inputType),d.outputType&&(this.getOutput(f)===void 0&&this.setOutput(f,null),this.getOutput(f).outputType=d.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let n=this.parameters[t];n.isScriptableNode&&(n=n.getDefaultOutput()),n.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:z()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],n=["layout","init","main","dispose"].join(", "),i="var "+n+`; var output = {};
`,r=`
return { ...output, `+n+" };",o=i+this.codeNode.code+r;return this._method=new Function(...e,o),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){const t=[Bf(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(const n in this.parameters)t.push(this.parameters[n].getCacheKey(e));return ih(t)}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const IY=We(PY).setParameterLength(1,2);function qO(s){let e;const t=s.context.getViewZ;return t!==void 0&&(e=t(this)),(e||ln.z).negate()}const LS=te(([s,e],t)=>{const n=qO(t);return Yi(s,e,n)}),FS=te(([s],e)=>{const t=qO(e);return s.mul(s,t,t).negate().exp().oneMinus()}),_f=te(([s,e])=>Ie(e.toFloat().mix(Oc.rgb,s.toVec3()),Oc.a));function kY(s,e,t){return Ne('TSL: "rangeFog( color, near, far )" is deprecated. Use "fog( color, rangeFogFactor( near, far ) )" instead.'),_f(s,LS(e,t))}function GY(s,e){return Ne('TSL: "densityFog( color, density )" is deprecated. Use "fog( color, densityFogFactor( density ) )" instead.'),_f(s,FS(e))}let Al=null,El=null;class $Y extends Be{static get type(){return"RangeNode"}constructor(e=z(),t=z()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=this.getConstNode(this.minNode),n=this.getConstNode(this.maxNode),i=e.getTypeLength(Fo(t.value)),r=e.getTypeLength(Fo(n.value));return i>r?i:r}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}getConstNode(e){let t=null;if(e.traverse(n=>{n.isConstNode===!0&&(t=n)}),t===null)throw new Error('THREE.TSL: No "ConstNode" found in node graph.');return t}setup(e){const t=e.object;let n=null;if(t.count>1){const i=this.getConstNode(this.minNode),r=this.getConstNode(this.maxNode),o=i.value,u=r.value,c=e.getTypeLength(Fo(o)),d=e.getTypeLength(Fo(u));Al=Al||new yt,El=El||new yt,Al.setScalar(0),El.setScalar(0),c===1?Al.setScalar(o):o.isColor?Al.set(o.r,o.g,o.b,1):Al.set(o.x,o.y,o.z||0,o.w||0),d===1?El.setScalar(u):u.isColor?El.set(u.r,u.g,u.b,1):El.set(u.x,u.y,u.z||0,u.w||0);const f=4,p=f*t.count,g=new Float32Array(p);for(let x=0;x<p;x++){const v=x%f,S=Al.getComponent(v),w=El.getComponent(v);g[x]=eT.lerp(S,w,Math.random())}const y=this.getNodeType(e);if(t.count<=4096)n=Of(g,"vec4",t.count).element(Sr).convert(y);else{const x=new Lc(g,4);e.geometry.setAttribute("__range"+this.id,x),n=N0(x).convert(y)}}else n=z(0);return n}}const HY=We($Y).setParameterLength(2);class jY extends Be{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){const n=this.getBuiltinName(e),i=this.getNodeType(e);return e.shaderStage==="compute"?e.format(n,i,t):(Ne(`ComputeBuiltinNode: Compute built-in value ${n} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(i))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const kf=(s,e)=>new jY(s,e),qY=kf("numWorkgroups","uvec3"),WY=kf("workgroupId","uvec3"),XY=kf("globalId","uvec3"),YY=kf("localId","uvec3"),ZY=kf("subgroupSize","uint");class QY extends Be{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}const OS=We(QY),KY=()=>OS("workgroup").toStack(),JY=()=>OS("storage").toStack(),eZ=()=>OS("texture").toStack();class tZ extends su{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let n;const i=e.context.assign;if(n=super.generate(e),i!==!0){const r=this.getNodeType(e);n=e.format(n,r,t)}return n}}class nZ extends Be{constructor(e,t,n=0){super(t),this.bufferType=t,this.bufferCount=n,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e,this.name=""}setName(e){return this.name=e,this}label(e){return Ne('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return new tZ(this,e)}generate(e){const t=this.name!==""?this.name:`${this.scope}Array_${this.id}`;return e.getScopedArray(t,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const sZ=(s,e)=>new nZ("Workgroup",s,e);class Cn extends Be{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),n=t.parents,i=this.method,r=this.getNodeType(e),o=this.getInputType(e),u=this.pointerNode,c=this.valueNode,d=[];d.push(`&${u.build(e,o)}`),c!==null&&d.push(c.build(e,o));const f=`${e.getMethod(i,r)}( ${d.join(", ")} )`;if(n?n.length===1&&n[0].isStackNode===!0:!1)e.addLineFlowCode(f,this);else return t.constNode===void 0&&(t.constNode=Ca(f,r).toConst()),t.constNode.build(e)}}Cn.ATOMIC_LOAD="atomicLoad";Cn.ATOMIC_STORE="atomicStore";Cn.ATOMIC_ADD="atomicAdd";Cn.ATOMIC_SUB="atomicSub";Cn.ATOMIC_MAX="atomicMax";Cn.ATOMIC_MIN="atomicMin";Cn.ATOMIC_AND="atomicAnd";Cn.ATOMIC_OR="atomicOr";Cn.ATOMIC_XOR="atomicXor";const iZ=We(Cn),Cr=(s,e,t)=>iZ(s,e,t).toStack(),rZ=s=>Cr(Cn.ATOMIC_LOAD,s,null),aZ=(s,e)=>Cr(Cn.ATOMIC_STORE,s,e),oZ=(s,e)=>Cr(Cn.ATOMIC_ADD,s,e),lZ=(s,e)=>Cr(Cn.ATOMIC_SUB,s,e),uZ=(s,e)=>Cr(Cn.ATOMIC_MAX,s,e),cZ=(s,e)=>Cr(Cn.ATOMIC_MIN,s,e),hZ=(s,e)=>Cr(Cn.ATOMIC_AND,s,e),dZ=(s,e)=>Cr(Cn.ATOMIC_OR,s,e),fZ=(s,e)=>Cr(Cn.ATOMIC_XOR,s,e);class Ce extends nn{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=n}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,n=this.bNode?this.bNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),r=e.isMatrix(n)?0:e.getTypeLength(n);return i>r?t:n}getNodeType(e){const t=this.method;return t===Ce.SUBGROUP_ELECT?"bool":t===Ce.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const n=this.method,i=this.getNodeType(e),r=this.getInputType(e),o=this.aNode,u=this.bNode,c=[];if(n===Ce.SUBGROUP_BROADCAST||n===Ce.SUBGROUP_SHUFFLE||n===Ce.QUAD_BROADCAST){const f=u.getNodeType(e);c.push(o.build(e,i),u.build(e,f==="float"?"int":i))}else n===Ce.SUBGROUP_SHUFFLE_XOR||n===Ce.SUBGROUP_SHUFFLE_DOWN||n===Ce.SUBGROUP_SHUFFLE_UP?c.push(o.build(e,i),u.build(e,"uint")):(o!==null&&c.push(o.build(e,r)),u!==null&&c.push(u.build(e,r)));const d=c.length===0?"()":`( ${c.join(", ")} )`;return e.format(`${e.getMethod(n,i)}${d}`,i,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Ce.SUBGROUP_ELECT="subgroupElect";Ce.SUBGROUP_BALLOT="subgroupBallot";Ce.SUBGROUP_ADD="subgroupAdd";Ce.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";Ce.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";Ce.SUBGROUP_MUL="subgroupMul";Ce.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";Ce.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";Ce.SUBGROUP_AND="subgroupAnd";Ce.SUBGROUP_OR="subgroupOr";Ce.SUBGROUP_XOR="subgroupXor";Ce.SUBGROUP_MIN="subgroupMin";Ce.SUBGROUP_MAX="subgroupMax";Ce.SUBGROUP_ALL="subgroupAll";Ce.SUBGROUP_ANY="subgroupAny";Ce.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";Ce.QUAD_SWAP_X="quadSwapX";Ce.QUAD_SWAP_Y="quadSwapY";Ce.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";Ce.SUBGROUP_BROADCAST="subgroupBroadcast";Ce.SUBGROUP_SHUFFLE="subgroupShuffle";Ce.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";Ce.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";Ce.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";Ce.QUAD_BROADCAST="quadBroadcast";const pZ=we(Ce,Ce.SUBGROUP_ELECT).setParameterLength(0),mZ=we(Ce,Ce.SUBGROUP_BALLOT).setParameterLength(1),gZ=we(Ce,Ce.SUBGROUP_ADD).setParameterLength(1),yZ=we(Ce,Ce.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),xZ=we(Ce,Ce.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),bZ=we(Ce,Ce.SUBGROUP_MUL).setParameterLength(1),_Z=we(Ce,Ce.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),vZ=we(Ce,Ce.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),TZ=we(Ce,Ce.SUBGROUP_AND).setParameterLength(1),SZ=we(Ce,Ce.SUBGROUP_OR).setParameterLength(1),wZ=we(Ce,Ce.SUBGROUP_XOR).setParameterLength(1),MZ=we(Ce,Ce.SUBGROUP_MIN).setParameterLength(1),NZ=we(Ce,Ce.SUBGROUP_MAX).setParameterLength(1),AZ=we(Ce,Ce.SUBGROUP_ALL).setParameterLength(0),EZ=we(Ce,Ce.SUBGROUP_ANY).setParameterLength(0),RZ=we(Ce,Ce.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),CZ=we(Ce,Ce.QUAD_SWAP_X).setParameterLength(1),DZ=we(Ce,Ce.QUAD_SWAP_Y).setParameterLength(1),BZ=we(Ce,Ce.QUAD_SWAP_DIAGONAL).setParameterLength(1),LZ=we(Ce,Ce.SUBGROUP_BROADCAST).setParameterLength(2),FZ=we(Ce,Ce.SUBGROUP_SHUFFLE).setParameterLength(2),OZ=we(Ce,Ce.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),UZ=we(Ce,Ce.SUBGROUP_SHUFFLE_UP).setParameterLength(2),zZ=we(Ce,Ce.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),VZ=we(Ce,Ce.QUAD_BROADCAST).setParameterLength(1);let Jm;function zy(s){Jm=Jm||new WeakMap;let e=Jm.get(s);return e===void 0&&Jm.set(s,e={}),e}function Vy(s){const e=zy(s);return e.shadowMatrix||(e.shadowMatrix=ze("mat4").setGroup(Ue).onRenderUpdate(t=>((s.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(s.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(s.shadow.camera.coordinateSystem=t.camera.coordinateSystem,s.shadow.camera.updateProjectionMatrix()),s.shadow.updateMatrices(s)),s.shadow.matrix)))}function WO(s,e=Tr){const t=Vy(s).mul(e);return t.xyz.div(t.w)}function US(s){const e=zy(s);return e.position||(e.position=ze(new J).setGroup(Ue).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(s.matrixWorld)))}function XO(s){const e=zy(s);return e.targetPosition||(e.targetPosition=ze(new J).setGroup(Ue).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(s.target.matrixWorld)))}function zS(s){const e=zy(s);return e.viewPosition||(e.viewPosition=ze(new J).setGroup(Ue).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new J,n.value.setFromMatrixPosition(s.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)}))}const VS=s=>Mi.transformDirection(US(s).sub(XO(s))),PZ=s=>s.sort((e,t)=>e.id-t.id),IZ=(s,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===s)return t;return null},d_=new WeakMap,_d=[];class PS extends Be{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Sa("vec3","totalDiffuse"),this.totalSpecularNode=Sa("vec3","totalSpecular"),this.outgoingLightNode=Sa("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let n=0;n<e.length;n++){const i=e[n];if(_d.push(i.id),_d.push(i.castShadow?1:0),i.isSpotLight===!0){const r=i.map!==null?i.map.id:-1,o=i.colorNode?i.colorNode.getCacheKey():-1;_d.push(r,o)}}const t=ih(_d);return _d.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const n of this._lightNodes)t.push(n.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const n of t.nodes)n.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,i=PZ(this._lights),r=e.renderer.library;for(const o of i)if(o.isNode)t.push(Re(o));else{let u=null;if(n!==null&&(u=IZ(o.id,n)),u===null){const c=r.getLightNodeClass(o.constructor);if(c===null){Ne(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let d=null;d_.has(o)?d=d_.get(o):(d=new c(o),d_.set(o,d)),t.push(d)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:i,reflectedLight:r}=e.context;i.direct({...n,lightNode:t,reflectedLight:r},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:i,reflectedLight:r}=e.context;i.directRectArea({...n,lightNode:t,reflectedLight:r},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const i=e.context,r=i.lightingModel,o=e.getNodeProperties(this);if(r){const{totalDiffuseNode:u,totalSpecularNode:c}=this;i.outgoingLight=n;const d=e.addStack();o.nodes=d.nodes,r.start(e);const{backdrop:f,backdropAlpha:p}=i,{directDiffuse:g,directSpecular:y,indirectDiffuse:x,indirectSpecular:v}=i.reflectedLight;let S=g.add(x);f!==null&&(p!==null?S=Z(p.mix(S,f)):S=Z(f)),u.assign(S),c.assign(y.add(v)),n.assign(u.add(c)),r.finish(e),n=n.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const kZ=(s=[])=>new PS().setLights(s);class GZ extends Be{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=Ye.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){IS.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||Tr)}}const IS=Sa("vec3","shadowPositionWorld");function $Z(s,e={}){return e.toneMapping=s.toneMapping,e.toneMappingExposure=s.toneMappingExposure,e.outputColorSpace=s.outputColorSpace,e.renderTarget=s.getRenderTarget(),e.activeCubeFace=s.getActiveCubeFace(),e.activeMipmapLevel=s.getActiveMipmapLevel(),e.renderObjectFunction=s.getRenderObjectFunction(),e.pixelRatio=s.getPixelRatio(),e.mrt=s.getMRT(),e.clearColor=s.getClearColor(e.clearColor||new Qe),e.clearAlpha=s.getClearAlpha(),e.autoClear=s.autoClear,e.scissorTest=s.getScissorTest(),e}function HZ(s,e){return e=$Z(s,e),s.setMRT(null),s.setRenderObjectFunction(null),s.setClearColor(0,1),s.autoClear=!0,e}function jZ(s,e){s.toneMapping=e.toneMapping,s.toneMappingExposure=e.toneMappingExposure,s.outputColorSpace=e.outputColorSpace,s.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),s.setRenderObjectFunction(e.renderObjectFunction),s.setPixelRatio(e.pixelRatio),s.setMRT(e.mrt),s.setClearColor(e.clearColor,e.clearAlpha),s.autoClear=e.autoClear,s.setScissorTest(e.scissorTest)}function qZ(s,e={}){return e.background=s.background,e.backgroundNode=s.backgroundNode,e.overrideMaterial=s.overrideMaterial,e}function WZ(s,e){return e=qZ(s,e),s.background=null,s.backgroundNode=null,s.overrideMaterial=null,e}function XZ(s,e){s.background=e.background,s.backgroundNode=e.backgroundNode,s.overrideMaterial=e.overrideMaterial}function YZ(s,e,t){return t=HZ(s,t),t=WZ(e,t),t}function ZZ(s,e,t){jZ(s,t),XZ(e,t)}const D0=new WeakMap,YO=te(({depthTexture:s,shadowCoord:e,depthLayer:t})=>{let n=_t(s,e.xy).setName("t_basic");return s.isArrayTexture&&(n=n.depth(t)),n.compare(e.z)}),ZO=te(({depthTexture:s,shadowCoord:e,shadow:t,depthLayer:n})=>{const i=(f,p)=>{let g=_t(s,f);return s.isArrayTexture&&(g=g.depth(n)),g.compare(p)},r=Et("mapSize","vec2",t).setGroup(Ue),o=Et("radius","float",t).setGroup(Ue),u=Se(1).div(r),c=o.mul(u.x),d=DS(ru.xy).mul(6.28318530718);return pn(i(e.xy.add(ki(0,5,d).mul(c)),e.z),i(e.xy.add(ki(1,5,d).mul(c)),e.z),i(e.xy.add(ki(2,5,d).mul(c)),e.z),i(e.xy.add(ki(3,5,d).mul(c)),e.z),i(e.xy.add(ki(4,5,d).mul(c)),e.z)).mul(1/5)}),QO=te(({depthTexture:s,shadowCoord:e,shadow:t,depthLayer:n})=>{const i=(p,g)=>{let y=_t(s,p);return s.isArrayTexture&&(y=y.depth(n)),y.compare(g)},r=Et("mapSize","vec2",t).setGroup(Ue),o=Se(1).div(r),u=o.x,c=o.y,d=e.xy,f=Wi(d.mul(r).add(.5));return d.subAssign(f.mul(o)),pn(i(d,e.z),i(d.add(Se(u,0)),e.z),i(d.add(Se(0,c)),e.z),i(d.add(o),e.z),at(i(d.add(Se(u.negate(),0)),e.z),i(d.add(Se(u.mul(2),0)),e.z),f.x),at(i(d.add(Se(u.negate(),c)),e.z),i(d.add(Se(u.mul(2),c)),e.z),f.x),at(i(d.add(Se(0,c.negate())),e.z),i(d.add(Se(0,c.mul(2))),e.z),f.y),at(i(d.add(Se(u,c.negate())),e.z),i(d.add(Se(u,c.mul(2))),e.z),f.y),at(at(i(d.add(Se(u.negate(),c.negate())),e.z),i(d.add(Se(u.mul(2),c.negate())),e.z),f.x),at(i(d.add(Se(u.negate(),c.mul(2))),e.z),i(d.add(Se(u.mul(2),c.mul(2))),e.z),f.x),f.y)).mul(1/9)}),KO=te(({depthTexture:s,shadowCoord:e,depthLayer:t})=>{let n=_t(s).sample(e.xy);s.isArrayTexture&&(n=n.depth(t)),n=n.rg;const i=n.x,r=Jt(1e-7,n.y.mul(n.y)),o=by(e.z,i);ke(o.equal(1),()=>z(1));const u=e.z.sub(i);let c=r.div(r.add(u.mul(u)));return c=Xi(ot(c,.3).div(.65)),Jt(o,c)}),QZ=te(([s,e,t])=>{let n=Tr.sub(s).length();return n=n.sub(e).div(t.sub(e)),n=n.saturate(),n}),KZ=s=>{const e=s.shadow.camera,t=Et("near","float",e).setGroup(Ue),n=Et("far","float",e).setGroup(Ue),i=FL(s);return QZ(i,t,n)},JO=s=>{let e=D0.get(s);if(e===void 0){const t=s.isPointLight?KZ(s):null;e=new en,e.colorNode=Ie(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,D0.set(s,e)}return e},eU=s=>{const e=D0.get(s);e!==void 0&&(e.dispose(),D0.delete(s))},SR=new Zi,fc=[],tU=(s,e,t,n)=>{fc[0]=s,fc[1]=e;let i=SR.get(fc);return(i===void 0||i.shadowType!==t||i.useVelocity!==n)&&(i=(r,o,u,c,d,f,...p)=>{(r.castShadow===!0||r.receiveShadow&&t===mg)&&(n&&(YD(r).useVelocity=!0),r.onBeforeShadow(s,r,u,e.camera,c,o.overrideMaterial,f),s.renderObject(r,o,u,c,d,f,...p),r.onAfterShadow(s,r,u,e.camera,c,o.overrideMaterial,f))},i.shadowType=t,i.useVelocity=n,SR.set(fc,i)),fc[0]=null,fc[1]=null,i},JZ=te(({samples:s,radius:e,size:t,shadowPass:n,depthLayer:i})=>{const r=z(0).toVar("meanVertical"),o=z(0).toVar("squareMeanVertical"),u=s.lessThanEqual(z(1)).select(z(0),z(2).div(s.sub(1))),c=s.lessThanEqual(z(1)).select(z(0),z(-1));At({start:H(0),end:H(s),type:"int",condition:"<"},({i:f})=>{const p=c.add(z(f).mul(u));let g=n.sample(pn(ru.xy,Se(0,p).mul(e)).div(t));n.value.isArrayTexture&&(g=g.depth(i)),g=g.x,r.addAssign(g),o.addAssign(g.mul(g))}),r.divAssign(s),o.divAssign(s);const d=ts(o.sub(r.mul(r)).max(0));return Se(r,d)}),eQ=te(({samples:s,radius:e,size:t,shadowPass:n,depthLayer:i})=>{const r=z(0).toVar("meanHorizontal"),o=z(0).toVar("squareMeanHorizontal"),u=s.lessThanEqual(z(1)).select(z(0),z(2).div(s.sub(1))),c=s.lessThanEqual(z(1)).select(z(0),z(-1));At({start:H(0),end:H(s),type:"int",condition:"<"},({i:f})=>{const p=c.add(z(f).mul(u));let g=n.sample(pn(ru.xy,Se(p,0).mul(e)).div(t));n.value.isArrayTexture&&(g=g.depth(i)),r.addAssign(g.x),o.addAssign(pn(g.y.mul(g.y),g.x.mul(g.x)))}),r.divAssign(s),o.divAssign(s);const d=ts(o.sub(r.mul(r)).max(0));return Se(r,d)}),tQ=[YO,ZO,QO,KO];let f_;const eg=new If;class nU extends GZ{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:i,shadow:r,depthLayer:o}){const u=i.x.greaterThanEqual(0).and(i.x.lessThanEqual(1)).and(i.y.greaterThanEqual(0)).and(i.y.lessThanEqual(1)).and(i.z.lessThanEqual(1)),c=t({depthTexture:n,shadowCoord:i,shadow:r,depthLayer:o});return u.select(c,z(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:i}=e,r=Et("bias","float",n).setGroup(Ue);let o=t,u;if(n.camera.isOrthographicCamera||i.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),u=o.z,i.coordinateSystem===xi&&(u=u.mul(2).sub(1));else{const c=o.w;o=o.xy.div(c);const d=Et("near","float",n.camera).setGroup(Ue),f=Et("far","float",n.camera).setGroup(Ue);u=bS(c.negate(),d,f)}return o=Z(o.x,o.y.oneMinus(),u.add(r)),o}getShadowFilterFn(e){return tQ[e]}setupRenderTarget(e,t){const n=new gi(e.mapSize.width,e.mapSize.height);n.name="ShadowDepthTexture",n.compareFunction=sy;const i=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return i.texture.name="ShadowMap",i.texture.type=e.mapType,i.depthTexture=n,{shadowMap:i,depthTexture:n}}setupShadow(e){const{renderer:t,camera:n}=e,{light:i,shadow:r}=this,o=t.shadowMap.type,{depthTexture:u,shadowMap:c}=this.setupRenderTarget(r,e);if(r.camera.coordinateSystem=n.coordinateSystem,r.camera.updateProjectionMatrix(),o===mg&&r.isPointLightShadow!==!0){u.compareFunction=null,c.depth>1?(c._vsmShadowMapVertical||(c._vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:gr,type:Gn,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=c._vsmShadowMapVertical,c._vsmShadowMapHorizontal||(c._vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:gr,type:Gn,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=c._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:gr,type:Gn,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:gr,type:Gn,depthBuffer:!1}));let T=_t(u);u.isArrayTexture&&(T=T.depth(this.depthLayer));let A=_t(this.vsmShadowMapVertical.texture);u.isArrayTexture&&(A=A.depth(this.depthLayer));const C=Et("blurSamples","float",r).setGroup(Ue),D=Et("radius","float",r).setGroup(Ue),R=Et("mapSize","vec2",r).setGroup(Ue);let B=this.vsmMaterialVertical||(this.vsmMaterialVertical=new en);B.fragmentNode=JZ({samples:C,radius:D,size:R,shadowPass:T,depthLayer:this.depthLayer}).context(e.getSharedContext()),B.name="VSMVertical",B=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new en),B.fragmentNode=eQ({samples:C,radius:D,size:R,shadowPass:A,depthLayer:this.depthLayer}).context(e.getSharedContext()),B.name="VSMHorizontal"}const d=Et("intensity","float",r).setGroup(Ue),f=Et("normalBias","float",r).setGroup(Ue),p=Vy(i).mul(IS.add(Wo.mul(f))),g=this.setupShadowCoord(e,p),y=r.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(y===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const x=o===mg&&r.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:u,v=this.setupShadowFilter(e,{filterFn:y,shadowTexture:c.texture,depthTexture:x,shadowCoord:g,shadow:r,depthLayer:this.depthLayer});let S;c.texture.isCubeTexture?S=fs(c.texture,g.xyz):(S=_t(c.texture,g),u.isArrayTexture&&(S=S.depth(this.depthLayer)));const w=at(1,v.rgb.mix(S,1),d.mul(S.a)).toVar();this.shadowMap=c,this.shadow.map=c;const M=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return w.toInspector(`${M} / Color`,()=>this.shadowMap.texture.isCubeTexture?fs(this.shadowMap.texture):_t(this.shadowMap.texture)).toInspector(`${M} / Depth`,()=>this.shadowMap.texture.isCubeTexture?fs(this.shadowMap.texture).r.oneMinus():sn(this.shadowMap.depthTexture,Ct().mul(wa(_t(this.shadowMap.depthTexture)))).r.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return te(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let n=this._node;return this.setupShadowPosition(e),n===null&&(this._node=n=this.setupShadow(e),this._currentShadowType=t),e.material.shadowNode&&Ne('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(n=e.material.receivedShadowNode(n)),n})()}renderShadow(e){const{shadow:t,shadowMap:n,light:i}=this,{renderer:r,scene:o}=e;t.updateMatrices(i),n.setSize(t.mapSize.width,t.mapSize.height,n.depth);const u=o.name;o.name=`Shadow Map [ ${i.name||"ID: "+i.id} ]`,r.render(o,t.camera),o.name=u}updateShadow(e){const{shadowMap:t,light:n,shadow:i}=this,{renderer:r,scene:o,camera:u}=e,c=r.shadowMap.type,d=t.depthTexture.version;this._depthVersionCached=d;const f=i.camera.layers.mask;(i.camera.layers.mask&4294967294)===0&&(i.camera.layers.mask=u.layers.mask);const p=r.getRenderObjectFunction(),g=r.getMRT(),y=g?g.has("velocity"):!1;f_=YZ(r,o,f_),o.overrideMaterial=JO(n),r.setRenderObjectFunction(tU(r,i,c,y)),r.setClearColor(0,0),r.setRenderTarget(t),this.renderShadow(e),r.setRenderObjectFunction(p),c===mg&&i.isPointLightShadow!==!0&&this.vsmPass(r),i.camera.layers.mask=f,ZZ(r,o,f_)}vsmPass(e){const{shadow:t}=this,n=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,n),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,n),e.setRenderTarget(this.vsmShadowMapVertical),eg.material=this.vsmMaterialVertical,eg.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),eg.material=this.vsmMaterialHorizontal,eg.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,eU(this.light),this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const sU=(s,e)=>new nU(s,e),nQ=new Qe,wR=new gt,vd=new J,p_=new J,sQ=[new J(1,0,0),new J(-1,0,0),new J(0,-1,0),new J(0,1,0),new J(0,0,1),new J(0,0,-1)],iQ=[new J(0,-1,0),new J(0,-1,0),new J(0,0,-1),new J(0,0,1),new J(0,-1,0),new J(0,-1,0)],rQ=[new J(1,0,0),new J(-1,0,0),new J(0,1,0),new J(0,-1,0),new J(0,0,1),new J(0,0,-1)],aQ=[new J(0,-1,0),new J(0,-1,0),new J(0,0,1),new J(0,0,-1),new J(0,-1,0),new J(0,-1,0)],iU=te(({depthTexture:s,bd3D:e,dp:t})=>fs(s,e).compare(t)),rU=te(({depthTexture:s,bd3D:e,dp:t,shadow:n})=>{const i=Et("radius","float",n).setGroup(Ue),r=Et("mapSize","vec2",n).setGroup(Ue),o=i.div(r.x),u=It(e),c=ps(Ra(e,u.x.greaterThan(u.z).select(Z(0,1,0),Z(1,0,0)))),d=Ra(e,c),f=DS(ru.xy).mul(6.28318530718),p=ki(0,5,f),g=ki(1,5,f),y=ki(2,5,f),x=ki(3,5,f),v=ki(4,5,f);return fs(s,e.add(c.mul(p.x).add(d.mul(p.y)).mul(o))).compare(t).add(fs(s,e.add(c.mul(g.x).add(d.mul(g.y)).mul(o))).compare(t)).add(fs(s,e.add(c.mul(y.x).add(d.mul(y.y)).mul(o))).compare(t)).add(fs(s,e.add(c.mul(x.x).add(d.mul(x.y)).mul(o))).compare(t)).add(fs(s,e.add(c.mul(v.x).add(d.mul(v.y)).mul(o))).compare(t)).mul(1/5)}),oQ=te(({filterFn:s,depthTexture:e,shadowCoord:t,shadow:n})=>{const i=t.xyz.toVar(),r=i.length(),o=ze("float").setGroup(Ue).onRenderUpdate(()=>n.camera.near),u=ze("float").setGroup(Ue).onRenderUpdate(()=>n.camera.far),c=Et("bias","float",n).setGroup(Ue),d=z(1).toVar();return ke(r.sub(u).lessThanEqual(0).and(r.sub(o).greaterThanEqual(0)),()=>{const f=r.sub(o).div(u.sub(o)).toVar();f.addAssign(c);const p=i.normalize();d.assign(s({depthTexture:e,bd3D:p,dp:f,shadow:n}))}),d});class lQ extends nU{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===T8?iU:rU}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:i,shadow:r}){return oQ({filterFn:t,depthTexture:n,shadowCoord:i,shadow:r})}setupRenderTarget(e,t){const n=new X9(e.mapSize.width);n.name="PointShadowDepthTexture",n.compareFunction=sy;const i=t.createCubeRenderTarget(e.mapSize.width);return i.texture.name="PointShadowMap",i.depthTexture=n,{shadowMap:i,depthTexture:n}}renderShadow(e){const{shadow:t,shadowMap:n,light:i}=this,{renderer:r,scene:o}=e,u=t.camera,c=t.matrix,d=r.coordinateSystem===xi,f=d?sQ:rQ,p=d?iQ:aQ;n.setSize(t.mapSize.width,t.mapSize.width);const g=r.autoClear,y=r.getClearColor(nQ),x=r.getClearAlpha();r.autoClear=!1,r.setClearColor(t.clearColor,t.clearAlpha);for(let v=0;v<6;v++){r.setRenderTarget(n,v),r.clear();const S=i.distance||u.far;S!==u.far&&(u.far=S,u.updateProjectionMatrix()),vd.setFromMatrixPosition(i.matrixWorld),u.position.copy(vd),p_.copy(u.position),p_.add(f[v]),u.up.copy(p[v]),u.lookAt(p_),u.updateMatrixWorld(),c.makeTranslation(-vd.x,-vd.y,-vd.z),wR.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),t._frustum.setFromProjectionMatrix(wR,u.coordinateSystem,u.reversedDepth);const w=o.name;o.name=`Point Light Shadow [ ${i.name||"ID: "+i.id} ] - Face ${v+1}`,r.render(o,u),o.name=w}r.autoClear=g,r.setClearColor(y,x)}}const aU=(s,e)=>new lQ(s,e);class au extends ah{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new Qe,this.colorNode=e&&e.colorNode||ze(this.color).setGroup(Ue),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Ye.FRAME,e&&e.shadow&&(this._shadowDisposeListener=()=>{this.disposeShadow()},e.addEventListener("dispose",this._shadowDisposeListener))}dispose(){this._shadowDisposeListener&&this.light.removeEventListener("dispose",this._shadowDisposeListener),super.dispose()}disposeShadow(){this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null),this.shadowColorNode=null,this.baseColorNode!==null&&(this.colorNode=this.baseColorNode,this.baseColorNode=null)}getHash(){return this.light.uuid}getLightVector(e){return zS(this.light).sub(e.context.positionView||ln)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return sU(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const i=this.light.shadow.shadowNode;let r;i!==void 0?r=Re(i):r=this.setupShadowNode(),this.shadowNode=r,this.shadowColorNode=n=this.colorNode.mul(r),this.baseColorNode=this.colorNode}e.context.getShadow&&(n=e.context.getShadow(this,e)),this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const kS=te(({lightDistance:s,cutoffDistance:e,decayExponent:t})=>{const n=s.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(n.mul(s.div(e).pow4().oneMinus().clamp().pow2()),n)}),oU=({color:s,lightVector:e,cutoffDistance:t,decayExponent:n})=>{const i=e.normalize(),r=e.length(),o=kS({lightDistance:r,cutoffDistance:t,decayExponent:n}),u=s.mul(o);return{lightDirection:i,lightColor:u}};class uQ extends au{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=ze(0).setGroup(Ue),this.decayExponentNode=ze(2).setGroup(Ue)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return aU(this.light)}setupDirect(e){return oU({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const cQ=te(([s=Ct()])=>{const e=s.mul(2),t=e.x.floor(),n=e.y.floor();return t.add(n).mod(2).sign()}),hQ=te(([s=Ct()],{renderer:e,material:t})=>{const n=WT(s.mul(2).sub(1));let i;if(t.alphaToCoverage&&e.currentSamples>0){const r=z(n.fwidth()).toVar();i=Yi(r.oneMinus(),r.add(1),n).oneMinus()}else i=Hn(n.greaterThan(1),0,1);return i}),Yd=te(([s,e,t])=>{const n=z(t).toVar(),i=z(e).toVar(),r=_i(s).toVar();return Hn(r,i,n)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),B0=te(([s,e])=>{const t=_i(e).toVar(),n=z(s).toVar();return Hn(t,n.negate(),n)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),dn=te(([s])=>{const e=z(s).toVar();return H(_r(e))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),Yt=te(([s,e])=>{const t=z(s).toVar();return e.assign(dn(t)),t.sub(z(e))}),dQ=te(([s,e,t,n,i,r])=>{const o=z(r).toVar(),u=z(i).toVar(),c=z(n).toVar(),d=z(t).toVar(),f=z(e).toVar(),p=z(s).toVar(),g=z(ot(1,u)).toVar();return ot(1,o).mul(p.mul(g).add(f.mul(u))).add(o.mul(d.mul(g).add(c.mul(u))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),fQ=te(([s,e,t,n,i,r])=>{const o=z(r).toVar(),u=z(i).toVar(),c=Z(n).toVar(),d=Z(t).toVar(),f=Z(e).toVar(),p=Z(s).toVar(),g=z(ot(1,u)).toVar();return ot(1,o).mul(p.mul(g).add(f.mul(u))).add(o.mul(d.mul(g).add(c.mul(u))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),lU=Wn([dQ,fQ]),pQ=te(([s,e,t,n,i,r,o,u,c,d,f])=>{const p=z(f).toVar(),g=z(d).toVar(),y=z(c).toVar(),x=z(u).toVar(),v=z(o).toVar(),S=z(r).toVar(),w=z(i).toVar(),M=z(n).toVar(),T=z(t).toVar(),A=z(e).toVar(),C=z(s).toVar(),D=z(ot(1,y)).toVar(),R=z(ot(1,g)).toVar();return z(ot(1,p)).toVar().mul(R.mul(C.mul(D).add(A.mul(y))).add(g.mul(T.mul(D).add(M.mul(y))))).add(p.mul(R.mul(w.mul(D).add(S.mul(y))).add(g.mul(v.mul(D).add(x.mul(y))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),mQ=te(([s,e,t,n,i,r,o,u,c,d,f])=>{const p=z(f).toVar(),g=z(d).toVar(),y=z(c).toVar(),x=Z(u).toVar(),v=Z(o).toVar(),S=Z(r).toVar(),w=Z(i).toVar(),M=Z(n).toVar(),T=Z(t).toVar(),A=Z(e).toVar(),C=Z(s).toVar(),D=z(ot(1,y)).toVar(),R=z(ot(1,g)).toVar();return z(ot(1,p)).toVar().mul(R.mul(C.mul(D).add(A.mul(y))).add(g.mul(T.mul(D).add(M.mul(y))))).add(p.mul(R.mul(w.mul(D).add(S.mul(y))).add(g.mul(v.mul(D).add(x.mul(y))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),uU=Wn([pQ,mQ]),gQ=te(([s,e,t])=>{const n=z(t).toVar(),i=z(e).toVar(),r=ve(s).toVar(),o=ve(r.bitAnd(ve(7))).toVar(),u=z(Yd(o.lessThan(ve(4)),i,n)).toVar(),c=z(qe(2,Yd(o.lessThan(ve(4)),n,i))).toVar();return B0(u,_i(o.bitAnd(ve(1)))).add(B0(c,_i(o.bitAnd(ve(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),yQ=te(([s,e,t,n])=>{const i=z(n).toVar(),r=z(t).toVar(),o=z(e).toVar(),u=ve(s).toVar(),c=ve(u.bitAnd(ve(15))).toVar(),d=z(Yd(c.lessThan(ve(8)),o,r)).toVar(),f=z(Yd(c.lessThan(ve(4)),r,Yd(c.equal(ve(12)).or(c.equal(ve(14))),o,i))).toVar();return B0(d,_i(c.bitAnd(ve(1)))).add(B0(f,_i(c.bitAnd(ve(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),On=Wn([gQ,yQ]),xQ=te(([s,e,t])=>{const n=z(t).toVar(),i=z(e).toVar(),r=iu(s).toVar();return Z(On(r.x,i,n),On(r.y,i,n),On(r.z,i,n))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),bQ=te(([s,e,t,n])=>{const i=z(n).toVar(),r=z(t).toVar(),o=z(e).toVar(),u=iu(s).toVar();return Z(On(u.x,o,r,i),On(u.y,o,r,i),On(u.z,o,r,i))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),hi=Wn([xQ,bQ]),_Q=te(([s])=>{const e=z(s).toVar();return qe(.6616,e)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),vQ=te(([s])=>{const e=z(s).toVar();return qe(.982,e)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),TQ=te(([s])=>{const e=Z(s).toVar();return qe(.6616,e)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),cU=Wn([_Q,TQ]),SQ=te(([s])=>{const e=Z(s).toVar();return qe(.982,e)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),hU=Wn([vQ,SQ]),Xs=te(([s,e])=>{const t=H(e).toVar(),n=ve(s).toVar();return n.shiftLeft(t).bitOr(n.shiftRight(H(32).sub(t)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),dU=te(([s,e,t])=>{s.subAssign(t),s.bitXorAssign(Xs(t,H(4))),t.addAssign(e),e.subAssign(s),e.bitXorAssign(Xs(s,H(6))),s.addAssign(t),t.subAssign(e),t.bitXorAssign(Xs(e,H(8))),e.addAssign(s),s.subAssign(t),s.bitXorAssign(Xs(t,H(16))),t.addAssign(e),e.subAssign(s),e.bitXorAssign(Xs(s,H(19))),s.addAssign(t),t.subAssign(e),t.bitXorAssign(Xs(e,H(4))),e.addAssign(s)}),Gf=te(([s,e,t])=>{const n=ve(t).toVar(),i=ve(e).toVar(),r=ve(s).toVar();return n.bitXorAssign(i),n.subAssign(Xs(i,H(14))),r.bitXorAssign(n),r.subAssign(Xs(n,H(11))),i.bitXorAssign(r),i.subAssign(Xs(r,H(25))),n.bitXorAssign(i),n.subAssign(Xs(i,H(16))),r.bitXorAssign(n),r.subAssign(Xs(n,H(4))),i.bitXorAssign(r),i.subAssign(Xs(r,H(14))),n.bitXorAssign(i),n.subAssign(Xs(i,H(24))),n}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),ss=te(([s])=>{const e=ve(s).toVar();return z(e).div(z(ve(H(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),wr=te(([s])=>{const e=z(s).toVar();return e.mul(e).mul(e).mul(e.mul(e.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),wQ=te(([s])=>{const e=H(s).toVar(),t=ve(ve(1)).toVar(),n=ve(ve(H(3735928559)).add(t.shiftLeft(ve(2))).add(ve(13))).toVar();return Gf(n.add(ve(e)),n,n)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),MQ=te(([s,e])=>{const t=H(e).toVar(),n=H(s).toVar(),i=ve(ve(2)).toVar(),r=ve().toVar(),o=ve().toVar(),u=ve().toVar();return r.assign(o.assign(u.assign(ve(H(3735928559)).add(i.shiftLeft(ve(2))).add(ve(13))))),r.addAssign(ve(n)),o.addAssign(ve(t)),Gf(r,o,u)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),NQ=te(([s,e,t])=>{const n=H(t).toVar(),i=H(e).toVar(),r=H(s).toVar(),o=ve(ve(3)).toVar(),u=ve().toVar(),c=ve().toVar(),d=ve().toVar();return u.assign(c.assign(d.assign(ve(H(3735928559)).add(o.shiftLeft(ve(2))).add(ve(13))))),u.addAssign(ve(r)),c.addAssign(ve(i)),d.addAssign(ve(n)),Gf(u,c,d)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),AQ=te(([s,e,t,n])=>{const i=H(n).toVar(),r=H(t).toVar(),o=H(e).toVar(),u=H(s).toVar(),c=ve(ve(4)).toVar(),d=ve().toVar(),f=ve().toVar(),p=ve().toVar();return d.assign(f.assign(p.assign(ve(H(3735928559)).add(c.shiftLeft(ve(2))).add(ve(13))))),d.addAssign(ve(u)),f.addAssign(ve(o)),p.addAssign(ve(r)),dU(d,f,p),d.addAssign(ve(i)),Gf(d,f,p)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),EQ=te(([s,e,t,n,i])=>{const r=H(i).toVar(),o=H(n).toVar(),u=H(t).toVar(),c=H(e).toVar(),d=H(s).toVar(),f=ve(ve(5)).toVar(),p=ve().toVar(),g=ve().toVar(),y=ve().toVar();return p.assign(g.assign(y.assign(ve(H(3735928559)).add(f.shiftLeft(ve(2))).add(ve(13))))),p.addAssign(ve(d)),g.addAssign(ve(c)),y.addAssign(ve(u)),dU(p,g,y),p.addAssign(ve(o)),g.addAssign(ve(r)),Gf(p,g,y)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),Rt=Wn([wQ,MQ,NQ,AQ,EQ]),RQ=te(([s,e])=>{const t=H(e).toVar(),n=H(s).toVar(),i=ve(Rt(n,t)).toVar(),r=iu().toVar();return r.x.assign(i.bitAnd(H(255))),r.y.assign(i.shiftRight(H(8)).bitAnd(H(255))),r.z.assign(i.shiftRight(H(16)).bitAnd(H(255))),r}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),CQ=te(([s,e,t])=>{const n=H(t).toVar(),i=H(e).toVar(),r=H(s).toVar(),o=ve(Rt(r,i,n)).toVar(),u=iu().toVar();return u.x.assign(o.bitAnd(H(255))),u.y.assign(o.shiftRight(H(8)).bitAnd(H(255))),u.z.assign(o.shiftRight(H(16)).bitAnd(H(255))),u}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),di=Wn([RQ,CQ]),DQ=te(([s])=>{const e=Se(s).toVar(),t=H().toVar(),n=H().toVar(),i=z(Yt(e.x,t)).toVar(),r=z(Yt(e.y,n)).toVar(),o=z(wr(i)).toVar(),u=z(wr(r)).toVar(),c=z(lU(On(Rt(t,n),i,r),On(Rt(t.add(H(1)),n),i.sub(1),r),On(Rt(t,n.add(H(1))),i,r.sub(1)),On(Rt(t.add(H(1)),n.add(H(1))),i.sub(1),r.sub(1)),o,u)).toVar();return cU(c)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),BQ=te(([s])=>{const e=Z(s).toVar(),t=H().toVar(),n=H().toVar(),i=H().toVar(),r=z(Yt(e.x,t)).toVar(),o=z(Yt(e.y,n)).toVar(),u=z(Yt(e.z,i)).toVar(),c=z(wr(r)).toVar(),d=z(wr(o)).toVar(),f=z(wr(u)).toVar(),p=z(uU(On(Rt(t,n,i),r,o,u),On(Rt(t.add(H(1)),n,i),r.sub(1),o,u),On(Rt(t,n.add(H(1)),i),r,o.sub(1),u),On(Rt(t.add(H(1)),n.add(H(1)),i),r.sub(1),o.sub(1),u),On(Rt(t,n,i.add(H(1))),r,o,u.sub(1)),On(Rt(t.add(H(1)),n,i.add(H(1))),r.sub(1),o,u.sub(1)),On(Rt(t,n.add(H(1)),i.add(H(1))),r,o.sub(1),u.sub(1)),On(Rt(t.add(H(1)),n.add(H(1)),i.add(H(1))),r.sub(1),o.sub(1),u.sub(1)),c,d,f)).toVar();return hU(p)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),GS=Wn([DQ,BQ]),LQ=te(([s])=>{const e=Se(s).toVar(),t=H().toVar(),n=H().toVar(),i=z(Yt(e.x,t)).toVar(),r=z(Yt(e.y,n)).toVar(),o=z(wr(i)).toVar(),u=z(wr(r)).toVar(),c=Z(lU(hi(di(t,n),i,r),hi(di(t.add(H(1)),n),i.sub(1),r),hi(di(t,n.add(H(1))),i,r.sub(1)),hi(di(t.add(H(1)),n.add(H(1))),i.sub(1),r.sub(1)),o,u)).toVar();return cU(c)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),FQ=te(([s])=>{const e=Z(s).toVar(),t=H().toVar(),n=H().toVar(),i=H().toVar(),r=z(Yt(e.x,t)).toVar(),o=z(Yt(e.y,n)).toVar(),u=z(Yt(e.z,i)).toVar(),c=z(wr(r)).toVar(),d=z(wr(o)).toVar(),f=z(wr(u)).toVar(),p=Z(uU(hi(di(t,n,i),r,o,u),hi(di(t.add(H(1)),n,i),r.sub(1),o,u),hi(di(t,n.add(H(1)),i),r,o.sub(1),u),hi(di(t.add(H(1)),n.add(H(1)),i),r.sub(1),o.sub(1),u),hi(di(t,n,i.add(H(1))),r,o,u.sub(1)),hi(di(t.add(H(1)),n,i.add(H(1))),r.sub(1),o,u.sub(1)),hi(di(t,n.add(H(1)),i.add(H(1))),r,o.sub(1),u.sub(1)),hi(di(t.add(H(1)),n.add(H(1)),i.add(H(1))),r.sub(1),o.sub(1),u.sub(1)),c,d,f)).toVar();return hU(p)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),$f=Wn([LQ,FQ]),OQ=te(([s])=>{const e=z(s).toVar(),t=H(dn(e)).toVar();return ss(Rt(t))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),UQ=te(([s])=>{const e=Se(s).toVar(),t=H(dn(e.x)).toVar(),n=H(dn(e.y)).toVar();return ss(Rt(t,n))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),zQ=te(([s])=>{const e=Z(s).toVar(),t=H(dn(e.x)).toVar(),n=H(dn(e.y)).toVar(),i=H(dn(e.z)).toVar();return ss(Rt(t,n,i))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),VQ=te(([s])=>{const e=Ie(s).toVar(),t=H(dn(e.x)).toVar(),n=H(dn(e.y)).toVar(),i=H(dn(e.z)).toVar(),r=H(dn(e.w)).toVar();return ss(Rt(t,n,i,r))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),PQ=Wn([OQ,UQ,zQ,VQ]),IQ=te(([s])=>{const e=z(s).toVar(),t=H(dn(e)).toVar();return Z(ss(Rt(t,H(0))),ss(Rt(t,H(1))),ss(Rt(t,H(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),kQ=te(([s])=>{const e=Se(s).toVar(),t=H(dn(e.x)).toVar(),n=H(dn(e.y)).toVar();return Z(ss(Rt(t,n,H(0))),ss(Rt(t,n,H(1))),ss(Rt(t,n,H(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),GQ=te(([s])=>{const e=Z(s).toVar(),t=H(dn(e.x)).toVar(),n=H(dn(e.y)).toVar(),i=H(dn(e.z)).toVar();return Z(ss(Rt(t,n,i,H(0))),ss(Rt(t,n,i,H(1))),ss(Rt(t,n,i,H(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),$Q=te(([s])=>{const e=Ie(s).toVar(),t=H(dn(e.x)).toVar(),n=H(dn(e.y)).toVar(),i=H(dn(e.z)).toVar(),r=H(dn(e.w)).toVar();return Z(ss(Rt(t,n,i,r,H(0))),ss(Rt(t,n,i,r,H(1))),ss(Rt(t,n,i,r,H(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),Py=Wn([IQ,kQ,GQ,$Q]),L0=te(([s,e,t,n])=>{const i=z(n).toVar(),r=z(t).toVar(),o=H(e).toVar(),u=Z(s).toVar(),c=z(0).toVar(),d=z(1).toVar();return At(o,()=>{c.addAssign(d.mul(GS(u))),d.mulAssign(i),u.mulAssign(r)}),c}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Iy=te(([s,e,t,n])=>{const i=z(n).toVar(),r=z(t).toVar(),o=H(e).toVar(),u=Z(s).toVar(),c=Z(0).toVar(),d=z(1).toVar();return At(o,()=>{c.addAssign(d.mul($f(u))),d.mulAssign(i),u.mulAssign(r)}),c}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),HQ=te(([s,e,t,n])=>{const i=z(n).toVar(),r=z(t).toVar(),o=H(e).toVar(),u=Z(s).toVar();return Se(L0(u,o,r,i),L0(u.add(Z(H(19),H(193),H(17))),o,r,i))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),jQ=te(([s,e,t,n])=>{const i=z(n).toVar(),r=z(t).toVar(),o=H(e).toVar(),u=Z(s).toVar(),c=Z(Iy(u,o,r,i)).toVar(),d=z(L0(u.add(Z(H(19),H(193),H(17))),o,r,i)).toVar();return Ie(c,d)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),qQ=te(([s,e,t,n,i,r,o])=>{const u=H(o).toVar(),c=z(r).toVar(),d=H(i).toVar(),f=H(n).toVar(),p=H(t).toVar(),g=H(e).toVar(),y=Se(s).toVar(),x=Z(Py(Se(g.add(f),p.add(d)))).toVar(),v=Se(x.x,x.y).toVar();v.subAssign(.5),v.mulAssign(c),v.addAssign(.5);const S=Se(Se(z(g),z(p)).add(v)).toVar(),w=Se(S.sub(y)).toVar();return ke(u.equal(H(2)),()=>It(w.x).add(It(w.y))),ke(u.equal(H(3)),()=>Jt(It(w.x),It(w.y))),vi(w,w)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),WQ=te(([s,e,t,n,i,r,o,u,c])=>{const d=H(c).toVar(),f=z(u).toVar(),p=H(o).toVar(),g=H(r).toVar(),y=H(i).toVar(),x=H(n).toVar(),v=H(t).toVar(),S=H(e).toVar(),w=Z(s).toVar(),M=Z(Py(Z(S.add(y),v.add(g),x.add(p)))).toVar();M.subAssign(.5),M.mulAssign(f),M.addAssign(.5);const T=Z(Z(z(S),z(v),z(x)).add(M)).toVar(),A=Z(T.sub(w)).toVar();return ke(d.equal(H(2)),()=>It(A.x).add(It(A.y)).add(It(A.z))),ke(d.equal(H(3)),()=>Jt(It(A.x),It(A.y),It(A.z))),vi(A,A)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),lh=Wn([qQ,WQ]),XQ=te(([s,e,t])=>{const n=H(t).toVar(),i=z(e).toVar(),r=Se(s).toVar(),o=H().toVar(),u=H().toVar(),c=Se(Yt(r.x,o),Yt(r.y,u)).toVar(),d=z(1e6).toVar();return At({start:-1,end:H(1),name:"x",condition:"<="},({x:f})=>{At({start:-1,end:H(1),name:"y",condition:"<="},({y:p})=>{const g=z(lh(c,f,p,o,u,i,n)).toVar();d.assign(Bs(d,g))})}),ke(n.equal(H(0)),()=>{d.assign(ts(d))}),d}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),YQ=te(([s,e,t])=>{const n=H(t).toVar(),i=z(e).toVar(),r=Se(s).toVar(),o=H().toVar(),u=H().toVar(),c=Se(Yt(r.x,o),Yt(r.y,u)).toVar(),d=Se(1e6,1e6).toVar();return At({start:-1,end:H(1),name:"x",condition:"<="},({x:f})=>{At({start:-1,end:H(1),name:"y",condition:"<="},({y:p})=>{const g=z(lh(c,f,p,o,u,i,n)).toVar();ke(g.lessThan(d.x),()=>{d.y.assign(d.x),d.x.assign(g)}).ElseIf(g.lessThan(d.y),()=>{d.y.assign(g)})})}),ke(n.equal(H(0)),()=>{d.assign(ts(d))}),d}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),ZQ=te(([s,e,t])=>{const n=H(t).toVar(),i=z(e).toVar(),r=Se(s).toVar(),o=H().toVar(),u=H().toVar(),c=Se(Yt(r.x,o),Yt(r.y,u)).toVar(),d=Z(1e6,1e6,1e6).toVar();return At({start:-1,end:H(1),name:"x",condition:"<="},({x:f})=>{At({start:-1,end:H(1),name:"y",condition:"<="},({y:p})=>{const g=z(lh(c,f,p,o,u,i,n)).toVar();ke(g.lessThan(d.x),()=>{d.z.assign(d.y),d.y.assign(d.x),d.x.assign(g)}).ElseIf(g.lessThan(d.y),()=>{d.z.assign(d.y),d.y.assign(g)}).ElseIf(g.lessThan(d.z),()=>{d.z.assign(g)})})}),ke(n.equal(H(0)),()=>{d.assign(ts(d))}),d}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),QQ=te(([s,e,t])=>{const n=H(t).toVar(),i=z(e).toVar(),r=Z(s).toVar(),o=H().toVar(),u=H().toVar(),c=H().toVar(),d=Z(Yt(r.x,o),Yt(r.y,u),Yt(r.z,c)).toVar(),f=z(1e6).toVar();return At({start:-1,end:H(1),name:"x",condition:"<="},({x:p})=>{At({start:-1,end:H(1),name:"y",condition:"<="},({y:g})=>{At({start:-1,end:H(1),name:"z",condition:"<="},({z:y})=>{const x=z(lh(d,p,g,y,o,u,c,i,n)).toVar();f.assign(Bs(f,x))})})}),ke(n.equal(H(0)),()=>{f.assign(ts(f))}),f}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),KQ=Wn([XQ,QQ]),JQ=te(([s,e,t])=>{const n=H(t).toVar(),i=z(e).toVar(),r=Z(s).toVar(),o=H().toVar(),u=H().toVar(),c=H().toVar(),d=Z(Yt(r.x,o),Yt(r.y,u),Yt(r.z,c)).toVar(),f=Se(1e6,1e6).toVar();return At({start:-1,end:H(1),name:"x",condition:"<="},({x:p})=>{At({start:-1,end:H(1),name:"y",condition:"<="},({y:g})=>{At({start:-1,end:H(1),name:"z",condition:"<="},({z:y})=>{const x=z(lh(d,p,g,y,o,u,c,i,n)).toVar();ke(x.lessThan(f.x),()=>{f.y.assign(f.x),f.x.assign(x)}).ElseIf(x.lessThan(f.y),()=>{f.y.assign(x)})})})}),ke(n.equal(H(0)),()=>{f.assign(ts(f))}),f}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),eK=Wn([YQ,JQ]),tK=te(([s,e,t])=>{const n=H(t).toVar(),i=z(e).toVar(),r=Z(s).toVar(),o=H().toVar(),u=H().toVar(),c=H().toVar(),d=Z(Yt(r.x,o),Yt(r.y,u),Yt(r.z,c)).toVar(),f=Z(1e6,1e6,1e6).toVar();return At({start:-1,end:H(1),name:"x",condition:"<="},({x:p})=>{At({start:-1,end:H(1),name:"y",condition:"<="},({y:g})=>{At({start:-1,end:H(1),name:"z",condition:"<="},({z:y})=>{const x=z(lh(d,p,g,y,o,u,c,i,n)).toVar();ke(x.lessThan(f.x),()=>{f.z.assign(f.y),f.y.assign(f.x),f.x.assign(x)}).ElseIf(x.lessThan(f.y),()=>{f.z.assign(f.y),f.y.assign(x)}).ElseIf(x.lessThan(f.z),()=>{f.z.assign(x)})})})}),ke(n.equal(H(0)),()=>{f.assign(ts(f))}),f}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),$S=Wn([ZQ,tK]),nK=te(([s,e,t,n,i,r,o,u,c,d,f])=>{const p=H(s).toVar(),g=Se(e).toVar(),y=Se(t).toVar(),x=Se(n).toVar(),v=z(i).toVar(),S=z(r).toVar(),w=z(o).toVar(),M=_i(u).toVar(),T=H(c).toVar(),A=z(d).toVar(),C=z(f).toVar(),D=g.mul(y).add(x),R=z(0).toVar();return ke(p.equal(H(0)),()=>{R.assign($f(D))}),ke(p.equal(H(1)),()=>{R.assign(Py(D))}),ke(p.equal(H(2)),()=>{R.assign($S(D,v,H(0)))}),ke(p.equal(H(3)),()=>{R.assign(Iy(Z(D,0),T,A,C))}),R.assign(R.mul(w.sub(S)).add(S)),ke(M,()=>{R.assign(Xi(R,S,w))}),R}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),sK=te(([s,e,t,n,i,r,o,u,c,d,f])=>{const p=H(s).toVar(),g=Z(e).toVar(),y=Z(t).toVar(),x=Z(n).toVar(),v=z(i).toVar(),S=z(r).toVar(),w=z(o).toVar(),M=_i(u).toVar(),T=H(c).toVar(),A=z(d).toVar(),C=z(f).toVar(),D=g.mul(y).add(x),R=z(0).toVar();return ke(p.equal(H(0)),()=>{R.assign($f(D))}),ke(p.equal(H(1)),()=>{R.assign(Py(D))}),ke(p.equal(H(2)),()=>{R.assign($S(D,v,H(0)))}),ke(p.equal(H(3)),()=>{R.assign(Iy(D,T,A,C))}),R.assign(R.mul(w.sub(S)).add(S)),ke(M,()=>{R.assign(Xi(R,S,w))}),R}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),iK=te(([s])=>{const e=s.y,t=s.z,n=Z().toVar();return ke(e.lessThan(1e-4),()=>{n.assign(Z(t,t,t))}).Else(()=>{let i=s.x;i=i.sub(_r(i)).mul(6).toVar();const r=H($T(i)),o=i.sub(z(r)),u=t.mul(e.oneMinus()),c=t.mul(e.mul(o).oneMinus()),d=t.mul(e.mul(o.oneMinus()).oneMinus());ke(r.equal(H(0)),()=>{n.assign(Z(t,d,u))}).ElseIf(r.equal(H(1)),()=>{n.assign(Z(c,t,u))}).ElseIf(r.equal(H(2)),()=>{n.assign(Z(u,t,d))}).ElseIf(r.equal(H(3)),()=>{n.assign(Z(u,c,t))}).ElseIf(r.equal(H(4)),()=>{n.assign(Z(d,u,t))}).Else(()=>{n.assign(Z(t,u,c))})}),n}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),rK=te(([s])=>{const e=Z(s).toVar(),t=z(e.x).toVar(),n=z(e.y).toVar(),i=z(e.z).toVar(),r=z(Bs(t,Bs(n,i))).toVar(),o=z(Jt(t,Jt(n,i))).toVar(),u=z(o.sub(r)).toVar(),c=z().toVar(),d=z().toVar(),f=z().toVar();return f.assign(o),ke(o.greaterThan(0),()=>{d.assign(u.div(o))}).Else(()=>{d.assign(0)}),ke(d.lessThanEqual(0),()=>{c.assign(0)}).Else(()=>{ke(t.greaterThanEqual(o),()=>{c.assign(n.sub(i).div(u))}).ElseIf(n.greaterThanEqual(o),()=>{c.assign(pn(2,i.sub(t).div(u)))}).Else(()=>{c.assign(pn(4,t.sub(n).div(u)))}),c.mulAssign(1/6),ke(c.lessThan(0),()=>{c.addAssign(1)})}),Z(c,d,f)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),aK=te(([s])=>{const e=Z(s).toVar(),t=MT(FT(e,Z(.04045))).toVar(),n=Z(e.div(12.92)).toVar(),i=Z(fi(Jt(e.add(Z(.055)),Z(0)).div(1.055),Z(2.4))).toVar();return at(n,i,t)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),fU=(s,e)=>{s=z(s),e=z(e);const t=Se(e.dFdx(),e.dFdy()).length().mul(.7071067811865476);return Yi(s.sub(t),s.add(t),e)},pU=(s,e,t,n)=>at(s,e,t[n].clamp()),oK=(s,e,t=Ct())=>pU(s,e,t,"x"),lK=(s,e,t=Ct())=>pU(s,e,t,"y"),uK=(s,e,t,n,i=Ct())=>{const r=i.x.clamp(),o=i.y.clamp(),u=at(s,e,r),c=at(t,n,r);return at(u,c,o)},mU=(s,e,t,n,i)=>at(s,e,fU(t,n[i])),cK=(s,e,t,n=Ct())=>mU(s,e,t,n,"x"),hK=(s,e,t,n=Ct())=>mU(s,e,t,n,"y"),dK=(s=1,e=0,t=Ct())=>t.mul(s).add(e),fK=(s,e=1)=>(s=z(s),s.abs().pow(e).mul(s.sign())),pK=(s,e=1,t=.5)=>z(s).sub(t).mul(e).add(t),mK=(s=Ct(),e=1,t=0)=>GS(s.convert("vec2|vec3")).mul(e).add(t),gK=(s=Ct(),e=1,t=0)=>$f(s.convert("vec2|vec3")).mul(e).add(t),yK=(s=Ct(),e=1,t=0)=>(s=s.convert("vec2|vec3"),Ie($f(s),GS(s.add(Se(19,73)))).mul(e).add(t)),xK=(s,e=Ct(),t=Se(1,1),n=Se(0,0),i=1,r=0,o=1,u=!1,c=1,d=2,f=.5)=>nK(s,e.convert("vec2|vec3"),t,n,i,r,o,u,c,d,f),bK=(s,e=Ct(),t=Se(1,1),n=Se(0,0),i=1,r=0,o=1,u=!1,c=1,d=2,f=.5)=>sK(s,e.convert("vec2|vec3"),t,n,i,r,o,u,c,d,f),_K=(s=Ct(),e=1)=>KQ(s.convert("vec2|vec3"),e,H(1)),vK=(s=Ct(),e=1)=>eK(s.convert("vec2|vec3"),e,H(1)),TK=(s=Ct(),e=1)=>$S(s.convert("vec2|vec3"),e,H(1)),SK=(s=Ct())=>PQ(s.convert("vec2|vec3")),wK=(s=Ct(),e=3,t=2,n=.5,i=1)=>L0(s,H(e),t,n).mul(i),MK=(s=Ct(),e=3,t=2,n=.5,i=1)=>HQ(s,H(e),t,n).mul(i),NK=(s=Ct(),e=3,t=2,n=.5,i=1)=>Iy(s,H(e),t,n).mul(i),AK=(s=Ct(),e=3,t=2,n=.5,i=1)=>jQ(s,H(e),t,n).mul(i),EK=(s,e=z(0))=>pn(s,e),RK=(s,e=z(0))=>ot(s,e),CK=(s,e=z(1))=>qe(s,e),DK=(s,e=z(1))=>ti(s,e),BK=(s,e=z(1))=>Ff(s,e),LK=(s,e=z(1))=>fi(s,e),FK=(s=z(0),e=z(1))=>xy(s,e),OK=()=>oh,UK=()=>RO,zK=(s,e=z(1))=>ot(e,s),VK=(s,e,t,n)=>s.greaterThan(e).mix(t,n),PK=(s,e,t,n)=>s.greaterThanEqual(e).mix(t,n),IK=(s,e,t,n)=>s.equal(e).mix(t,n),kK=(s,e=null)=>{if(typeof e=="string"){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},n=e.replace(/^out/,"").toLowerCase();if(t[n]!==void 0)return s.element(t[n])}if(typeof e=="number")return s.element(e);if(typeof e=="string"&&e.length===1){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(t[e]!==void 0)return s.element(t[e])}return s},GK=(s,e=Se(.5,.5),t=Se(1,1),n=z(0),i=Se(0,0))=>{let r=s;if(e&&(r=r.sub(e)),t&&(r=r.mul(t)),n){const o=n.mul(Math.PI/180),u=o.cos(),c=o.sin();r=Se(r.x.mul(u).sub(r.y.mul(c)),r.x.mul(c).add(r.y.mul(u)))}return e&&(r=r.add(e)),i&&(r=r.add(i)),r},$K=(s,e)=>{s=Se(s),e=z(e);const t=e.mul(Math.PI/180);return Vf(s,t)},HK=(s,e,t)=>{s=Z(s),e=z(e),t=Z(t);const n=e.mul(Math.PI/180),i=t.normalize(),r=n.cos(),o=n.sin(),u=z(1).sub(r);return s.mul(r).add(i.cross(s).mul(o)).add(i.mul(i.dot(s)).mul(u))},jK=(s,e)=>(s=Z(s),e=z(e),fS(s,e)),qK=te(([s,e,t])=>{const n=ps(s).toVar(),i=ot(z(.5).mul(e.sub(t)),Tr).div(n).toVar(),r=ot(z(-.5).mul(e.sub(t)),Tr).div(n).toVar(),o=Z().toVar();o.x=n.x.greaterThan(z(0)).select(i.x,r.x),o.y=n.y.greaterThan(z(0)).select(i.y,r.y),o.z=n.z.greaterThan(z(0)).select(i.z,r.z);const u=Bs(o.x,o.y,o.z).toVar();return Tr.add(n.mul(u)).toVar().sub(t)}),gU=te(([s,e])=>{const t=s.x,n=s.y,i=s.z;let r=e.element(0).mul(.886227);return r=r.add(e.element(1).mul(2*.511664).mul(n)),r=r.add(e.element(2).mul(2*.511664).mul(i)),r=r.add(e.element(3).mul(2*.511664).mul(t)),r=r.add(e.element(4).mul(2*.429043).mul(t).mul(n)),r=r.add(e.element(5).mul(2*.429043).mul(n).mul(i)),r=r.add(e.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),r=r.add(e.element(7).mul(2*.429043).mul(t).mul(i)),r=r.add(e.element(8).mul(.429043).mul(qe(t,t).sub(qe(n,n)))),r});var N=Object.freeze({__proto__:null,BRDF_GGX:wS,BRDF_Lambert:eu,BasicPointShadowFilter:iU,BasicShadowFilter:YO,Break:HF,Const:cL,Continue:B7,DFGLUT:xf,D_GGX:uO,Discard:NL,EPSILON:OT,F_Schlick:th,Fn:te,HALF_PI:ij,INFINITY:tj,If:ke,Loop:At,NodeAccess:$n,NodeShaderStage:Dd,NodeType:wH,NodeUpdateType:Ye,OnBeforeMaterialUpdate:JX,OnBeforeObjectUpdate:KX,OnMaterialUpdate:QX,OnObjectUpdate:ZX,PCFShadowFilter:ZO,PCFSoftShadowFilter:QO,PI:M0,PI2:nj,PointShadowFilter:rU,Return:_j,Schlick_to_F0:dv,ScriptableNodeResources:Sg,ShaderNode:Sc,Stack:dy,Switch:qH,TBNViewMatrix:Gl,TWO_PI:sj,VSMShadowFilter:KO,V_GGX_SmithCorrelated:lO,Var:uL,VarIntent:hL,abs:It,acesFilmicToneMapping:IO,acos:VT,add:pn,addMethodChaining:me,addNodeElement:wj,agxToneMapping:kO,all:FB,alphaT:T0,and:bB,anisotropy:No,anisotropyB:Xl,anisotropyT:jd,any:OB,append:ZH,array:dB,arrayBuffer:XH,asin:PB,assign:fB,atan:xy,atan2:sL,atomicAdd:oZ,atomicAnd:hZ,atomicFunc:Cr,atomicLoad:rZ,atomicMax:uZ,atomicMin:cZ,atomicOr:dZ,atomicStore:aZ,atomicSub:lZ,atomicXor:fZ,attenuationColor:CT,attenuationDistance:RT,attribute:Da,attributeArray:nY,backgroundBlurriness:BO,backgroundIntensity:yv,backgroundRotation:LO,batch:kF,bentNormalView:sF,billboarding:LX,bitAnd:SB,bitNot:wB,bitOr:MB,bitXor:NB,bitangentGeometry:c7,bitangentLocal:h7,bitangentView:tF,bitangentWorld:d7,bitcast:AO,blendBurn:ZF,blendColor:Y7,blendDodge:QF,blendOverlay:JF,blendScreen:KF,blur:gO,bool:_i,buffer:Of,bufferAttribute:eS,builtin:Oa,builtinAOContext:oL,builtinShadowContext:aL,bumpMap:fS,burn:Q7,bvec2:rB,bvec3:MT,bvec4:aB,bypass:TL,cache:vL,call:pB,cameraFar:Do,cameraIndex:jo,cameraNear:Co,cameraNormalMatrix:Pj,cameraPosition:LL,cameraProjectionMatrix:Na,cameraProjectionMatrixInverse:zj,cameraViewMatrix:Mi,cameraViewport:Ij,cameraWorldMatrix:Vj,cbrt:KB,cdl:_Y,ceil:yy,checker:cQ,cineonToneMapping:PO,clamp:Xi,clearcoat:b0,clearcoatNormalView:kl,clearcoatRoughness:yf,code:Uy,color:iB,colorSpaceToWorking:vy,colorToDirection:p7,compute:_L,computeKernel:tS,computeSkinning:C7,context:Fa,convert:lB,convertColorSpace:hj,convertToTexture:jX,cos:zi,countLeadingZeros:uX,countOneBits:cX,countTrailingZeros:lX,cross:Ra,cubeTexture:fs,cubeTextureBase:dS,dFdx:kT,dFdy:GT,dashSize:gg,debug:AL,decrement:BB,decrementBefore:CB,defaultBuildStages:Q_,defaultShaderStages:KD,defined:pf,degrees:zB,deltaTime:MX,densityFog:GY,densityFogFactor:FS,depth:_S,depthPass:MY,determinant:HB,difference:YB,diffuseColor:Nt,diffuseContribution:Ll,directPointLight:oU,directionToColor:iF,directionToFaceDirection:rh,dispersion:DT,disposeShadowMaterial:eU,distance:XB,div:ti,dodge:K7,dot:vi,drawIndex:VF,dynamicBufferAttribute:gj,element:oB,emissive:tv,equal:LT,equals:qB,equirectUV:vS,exp:UT,exp2:Jc,expression:Ca,faceDirection:uS,faceForward:YT,faceforward:rj,float:z,floatBitsToInt:rX,floatBitsToUint:EO,floor:_r,fog:_f,fract:Wi,frameGroup:hB,frameId:RO,frontFacing:zL,fwidth:HT,gain:dX,gapSize:nv,getConstNodeType:sB,getCurrentStack:TT,getDirection:pO,getDistanceAttenuation:kS,getGeometryRoughness:oO,getNormalFromDepth:WX,getParallaxCorrectNormal:qK,getRoughness:SS,getScreenPosition:qX,getShIrradianceAt:gU,getShadowMaterial:JO,getShadowRenderObjectFunction:tU,getTextureIndex:MO,getViewPosition:yc,ggxConvolution:yO,globalId:XY,glsl:FY,glslFn:OY,grayscale:gY,greaterThan:FT,greaterThanEqual:xB,hash:hX,highpModelNormalViewMatrix:rv,highpModelViewMatrix:iv,hue:bY,increment:DB,incrementBefore:RB,inspector:RL,instance:A7,instanceIndex:Sr,instancedArray:sY,instancedBufferAttribute:N0,instancedDynamicBufferAttribute:sv,instancedMesh:IF,int:H,intBitsToFloat:aX,interleavedGradientNoise:DS,inverse:jB,inverseSqrt:zT,inversesqrt:aj,invocationLocalIndex:N7,invocationSubgroupIndex:M7,ior:qd,iridescence:py,iridescenceIOR:_0,iridescenceThickness:v0,isolate:zc,ivec2:vn,ivec3:wT,ivec4:NT,js:BY,label:lL,length:vr,lengthSq:WT,lessThan:gB,lessThanEqual:yB,lightPosition:US,lightProjectionUV:WO,lightShadowMatrix:Vy,lightTargetDirection:VS,lightTargetPosition:XO,lightViewPosition:zS,lightingContext:qF,lights:kZ,linearDepth:E0,linearToneMapping:zO,localId:YY,log:gy,log2:br,logarithmicDepthToViewZ:k7,luminance:BS,mat2:fy,mat3:qn,mat4:Po,matcapUV:xO,materialAO:OF,materialAlphaTest:rF,materialAnisotropy:_F,materialAnisotropyVector:gc,materialAttenuationColor:EF,materialAttenuationDistance:AF,materialClearcoat:pF,materialClearcoatNormal:gF,materialClearcoatRoughness:mF,materialColor:aF,materialDispersion:FF,materialEmissive:lF,materialEnvIntensity:bg,materialEnvRotation:hS,materialIOR:NF,materialIridescence:vF,materialIridescenceIOR:TF,materialIridescenceThickness:SF,materialLightMap:mS,materialLineDashOffset:BF,materialLineDashSize:CF,materialLineGapSize:DF,materialLineScale:RF,materialLineWidth:b7,materialMetalness:dF,materialNormal:fF,materialOpacity:pS,materialPointSize:LF,materialReference:pa,materialReflectivity:_g,materialRefractionRatio:kL,materialRotation:yF,materialRoughness:hF,materialSheen:xF,materialSheenRoughness:bF,materialShininess:oF,materialSpecular:uF,materialSpecularColor:cF,materialSpecularIntensity:hv,materialSpecularStrength:Wd,materialThickness:MF,materialTransmission:wF,max:Jt,maxMipLevel:sS,mediumpModelViewMatrix:UL,metalness:ga,min:Bs,mix:at,mixElement:eL,mod:Ff,modInt:LB,modelDirection:qj,modelNormalMatrix:OL,modelPosition:Wj,modelRadius:Zj,modelScale:Xj,modelViewMatrix:qo,modelViewPosition:Yj,modelViewProjection:UF,modelWorldMatrix:pi,modelWorldMatrixInverse:Qj,morphReference:jF,mrt:NO,mul:qe,mx_aastep:fU,mx_add:EK,mx_atan2:FK,mx_cell_noise_float:SK,mx_contrast:pK,mx_divide:DK,mx_fractal_noise_float:wK,mx_fractal_noise_vec2:MK,mx_fractal_noise_vec3:NK,mx_fractal_noise_vec4:AK,mx_frame:UK,mx_heighttonormal:jK,mx_hsvtorgb:iK,mx_ifequal:IK,mx_ifgreater:VK,mx_ifgreatereq:PK,mx_invert:zK,mx_modulo:BK,mx_multiply:CK,mx_noise_float:mK,mx_noise_vec3:gK,mx_noise_vec4:yK,mx_place2d:GK,mx_power:LK,mx_ramp4:uK,mx_ramplr:oK,mx_ramptb:lK,mx_rgbtohsv:rK,mx_rotate2d:$K,mx_rotate3d:HK,mx_safepower:fK,mx_separate:kK,mx_splitlr:cK,mx_splittb:hK,mx_srgb_texture_to_lin_rec709:aK,mx_subtract:RK,mx_timer:OK,mx_transform_uv:dK,mx_unifiednoise2d:xK,mx_unifiednoise3d:bK,mx_worley_noise_float:_K,mx_worley_noise_vec2:vK,mx_worley_noise_vec3:TK,negate:IT,neutralToneMapping:GO,nodeArray:Wl,nodeImmutable:Ee,nodeObject:Re,nodeObjectIntent:Bd,nodeObjects:hy,nodeProxy:We,nodeProxyIntent:we,normalFlat:VL,normalGeometry:Sy,normalLocal:Ls,normalMap:cv,normalView:mt,normalViewGeometry:eh,normalWorld:Wo,normalWorldGeometry:PL,normalize:ps,not:vB,notEqual:mB,numWorkgroups:qY,objectDirection:kj,objectGroup:BT,objectPosition:FL,objectRadius:jj,objectScale:$j,objectViewPosition:Hj,objectWorldMatrix:Gj,oneMinus:IB,or:_B,orthographicDepthToViewZ:I7,oscSawtooth:RX,oscSine:NX,oscSquare:AX,oscTriangle:EX,output:Oc,outputStruct:sX,overlay:eq,overloadingFn:Wn,packHalf2x16:yX,packSnorm2x16:mX,packUnorm2x16:gX,parabola:gv,parallaxDirection:nF,parallaxUV:f7,parameter:QW,pass:SY,passTexture:wY,pcurve:fX,perspectiveDepthToViewZ:xS,pmremTexture:NS,pointShadow:aU,pointUV:rY,pointWidth:QH,positionGeometry:Uf,positionLocal:Qt,positionPrevious:A0,positionView:ln,positionViewDirection:Ot,positionWorld:Tr,positionWorldDirection:lS,posterize:TY,pow:fi,pow2:jT,pow3:ZB,pow4:qT,premultiplyAlpha:eO,property:Sa,quadBroadcast:VZ,quadSwapDiagonal:BZ,quadSwapX:CZ,quadSwapY:DZ,radians:UB,rand:JB,range:HY,rangeFog:kY,rangeFogFactor:LS,reciprocal:GB,reference:Et,referenceBuffer:av,reflect:WB,reflectVector:HL,reflectView:GL,reflector:IX,refract:XT,refractVector:jL,refractView:$L,reinhardToneMapping:VO,remap:wL,remapClamp:ML,renderGroup:Ue,renderOutput:nS,rendererReference:yL,replaceDefaultUV:CX,rotate:Vf,rotateUV:DX,roughness:pr,round:kB,rtt:DO,sRGBTransferEOTF:fL,sRGBTransferOETF:pL,sample:YX,sampler:Cj,samplerComparison:Dj,saturate:_y,saturation:yY,screen:J7,screenCoordinate:ru,screenDPR:DL,screenSize:Jl,screenUV:Ma,scriptable:IY,scriptableValue:Tg,select:Hn,setCurrentStack:mf,setName:ZT,shaderStages:K_,shadow:sU,shadowPositionWorld:IS,shapeCircle:hQ,sharedUniformGroup:my,sheen:Ws,sheenRoughness:Ro,shiftLeft:AB,shiftRight:EB,shininess:S0,sign:PT,sin:hs,sinc:pX,skinning:$F,smoothstep:Yi,smoothstepElement:tL,specularColor:Ho,specularColorBlended:Il,specularF90:Fc,spherizeUV:BX,split:YH,spritesheetUV:UX,sqrt:ts,stack:vg,step:by,stepElement:nL,storage:Aa,storageBarrier:JY,storageObject:S7,storageTexture:FO,string:WH,struct:nX,sub:ot,subBuild:Uc,subgroupAdd:gZ,subgroupAll:AZ,subgroupAnd:TZ,subgroupAny:EZ,subgroupBallot:mZ,subgroupBroadcast:LZ,subgroupBroadcastFirst:RZ,subgroupElect:pZ,subgroupExclusiveAdd:xZ,subgroupExclusiveMul:vZ,subgroupInclusiveAdd:yZ,subgroupInclusiveMul:_Z,subgroupIndex:w7,subgroupMax:NZ,subgroupMin:MZ,subgroupMul:bZ,subgroupOr:SZ,subgroupShuffle:FZ,subgroupShuffleDown:zZ,subgroupShuffleUp:UZ,subgroupShuffleXor:OZ,subgroupSize:ZY,subgroupXor:wZ,tan:VB,tangentGeometry:My,tangentLocal:zf,tangentView:Ny,tangentWorld:eF,texture:_t,texture3D:Oy,texture3DLevel:hY,texture3DLoad:cY,textureBarrier:eZ,textureBicubic:Cq,textureBicubicLevel:MS,textureCubeUV:mO,textureLevel:Rj,textureLoad:sn,textureSize:wa,textureStore:oY,thickness:ET,time:oh,toneMapping:xL,toneMappingExposure:bL,toonOutlinePass:AY,transformDirection:QB,transformNormal:IL,transformNormalToView:cS,transformedClearcoatNormalView:t7,transformedNormalView:Jj,transformedNormalWorld:e7,transmission:w0,transpose:$B,triNoise3D:TX,triplanarTexture:zX,triplanarTextures:CO,trunc:$T,uint:ve,uintBitsToFloat:oX,uniform:ze,uniformArray:Jn,uniformCubeTexture:s7,uniformFlow:rL,uniformGroup:cB,uniformTexture:Ej,unpackHalf2x16:_X,unpackNormal:uv,unpackSnorm2x16:xX,unpackUnorm2x16:bX,unpremultiplyAlpha:Z7,userData:fY,uv:Ct,uvec2:ST,uvec3:iu,uvec4:AT,varying:Rr,varyingProperty:gf,vec2:Se,vec3:Z,vec4:Ie,vectorComponents:nu,velocity:mY,vertexColor:YF,vertexIndex:zF,vertexStage:dL,vibrance:xY,viewZToLogarithmicDepth:bS,viewZToOrthographicDepth:Vc,viewZToPerspectiveDepth:WF,viewport:aS,viewportCoordinate:BL,viewportDepthTexture:yS,viewportLinearDepth:G7,viewportMipTexture:gS,viewportResolution:Uj,viewportSafeUV:FX,viewportSharedTexture:aq,viewportSize:oS,viewportTexture:V7,viewportUV:Oj,vogelDiskSample:ki,wgsl:LY,wgslFn:UY,workgroupArray:sZ,workgroupBarrier:KY,workgroupId:WY,workingToColorSpace:mL,xor:TB});const Oi=new AS;class WK extends Xo{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const i=this.renderer,r=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(r===null)i._clearColor.getRGB(Oi),Oi.a=i._clearColor.a;else if(r.isColor===!0)r.getRGB(Oi),Oi.a=1,o=!0;else if(r.isNode===!0){const d=this.get(e),f=r;Oi.copy(i._clearColor);let p=d.backgroundMesh;if(p===void 0){let T=function(){r.removeEventListener("dispose",T),p.material.dispose(),p.geometry.dispose()};var c=T;const y=Ie(f).mul(yv).context({getUV:()=>LO.mul(PL),getTextureLevel:()=>BO}),x=Na.element(3).element(3).equal(1),v=ti(1,Na.element(1).element(1)).mul(3),S=x.select(Qt.mul(v),Qt);let w=Na.mul(qo.mul(Ie(S,0)));w=w.setZ(w.w);const M=new en;M.name="Background.material",M.side=ns,M.depthTest=!1,M.depthWrite=!1,M.allowOverride=!1,M.fog=!1,M.lights=!1,M.vertexNode=w,M.colorNode=y,d.backgroundMeshNode=y,d.backgroundMesh=p=new Rn(new hT(1,32,32),M),p.frustumCulled=!1,p.name="Background.mesh",r.addEventListener("dispose",T)}const g=f.getCacheKey();d.backgroundCacheKey!==g&&(d.backgroundMeshNode.node=Ie(f).mul(yv),d.backgroundMeshNode.needsUpdate=!0,p.material.needsUpdate=!0,d.backgroundCacheKey=g),t.unshift(p,p.geometry,p.material,0,0,null,null)}else Ae("Renderer: Unsupported background configuration.",r);const u=i.xr.getEnvironmentBlendMode();if(u==="additive"?Oi.set(0,0,0,1):u==="alpha-blend"&&Oi.set(0,0,0,0),i.autoClear===!0||o===!0){const d=n.clearColorValue;d.r=Oi.r,d.g=Oi.g,d.b=Oi.b,d.a=Oi.a,(i.backend.isWebGLBackend===!0||i.alpha===!0)&&(d.r*=d.a,d.g*=d.a,d.b*=d.a),n.depthClearValue=i._clearDepth,n.stencilClearValue=i._clearStencil,n.clearColor=i.autoClearColor===!0,n.clearDepth=i.autoClearDepth===!0,n.clearStencil=i.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let XK=0;class xv{constructor(e="",t=[],n=0,i=[]){this.name=e,this.bindings=t,this.index=n,this.bindingsReference=i,this.id=XK++}}class YK{constructor(e,t,n,i,r,o,u,c,d,f=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=f,this.nodeAttributes=i,this.bindings=r,this.updateNodes=o,this.updateBeforeNodes=u,this.updateAfterNodes=c,this.observer=d,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const i=new xv(t.name,[],t.index,t.bindingsReference);e.push(i);for(const r of t.bindings)i.bindings.push(r.clone())}else e.push(t);return e}}class MR{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class ZK{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class yU{constructor(e,t,n=!1,i=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=i}}class QK extends yU{constructor(e,t,n=null,i=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=n,this.interpolationSampling=i}}class KK{constructor(e,t,n=""){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let JK=0;class m_{constructor(e=null){this.id=JK++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class eJ{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class Yo{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class tJ extends Yo{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class nJ extends Yo{constructor(e,t=new Ge){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class sJ extends Yo{constructor(e,t=new J){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class iJ extends Yo{constructor(e,t=new yt){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class rJ extends Yo{constructor(e,t=new Qe){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class aJ extends Yo{constructor(e,t=new ly){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class oJ extends Yo{constructor(e,t=new Fs){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class lJ extends Yo{constructor(e,t=new gt){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class uJ extends tJ{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class cJ extends nJ{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class hJ extends sJ{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class dJ extends iJ{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class fJ extends rJ{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class pJ extends aJ{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class mJ extends oJ{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class gJ extends lJ{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let yJ=0;const xJ=new WeakMap,NR=new WeakMap,bJ=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),tg=s=>/e/g.test(s)?String(s).replace(/\+/g,""):(s=Number(s),s+(s%1?"":".0"));class xU{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=vg(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new m_,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:yJ++})}isOpaque(){const e=this.material;return e.transparent===!1&&e.blending===ya&&e.alphaToCoverage===!1}getBindGroupsCache(){let e=NR.get(this.renderer);return e===void 0&&(e=new Zi,NR.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new La(e,t,n)}createCubeRenderTarget(e,t){return new tO(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),i=[];let r=!0;for(const u of t)i.push(u),r=r&&u.groupNode.shared!==!0;let o;return r?(o=n.get(i),o===void 0&&(o=new xv(e,i,this.bindingsIndexes[e].group,i),n.set(i,o))):o=new xv(e,i,this.bindingsIndexes[e].group,i),o}getBindGroupArray(e,t){const n=this.bindings[t];let i=n[e];return i===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=i=[]),i}getBindings(){let e=this.bindGroups;if(e===null){const t={},n=this.bindings;for(const i of K_)for(const r in n[i]){const o=n[i][r];(t[r]||(t[r]=[])).push(...o)}e=[];for(const i in t){const r=t[i],o=this._getBindGroup(i,r);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,n)=>t.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==Ye.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==Ye.NONE&&this.updateBeforeNodes.push(e),n!==Ye.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===ms||e.magFilter===H_||e.magFilter===hf||e.magFilter===xa||e.minFilter===ms||e.minFilter===H_||e.minFilter===hf||e.minFilter===xa}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){const e={...this.context};return delete e.material,delete e.getUV,delete e.getOutput,delete e.getTextureLevel,delete e.getAO,delete e.getShadow,e}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new m_(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){Ne("Abstract function.")}getInstanceIndex(){Ne("Abstract function.")}getDrawIndex(){Ne("Abstract function.")}getFrontFacing(){Ne("Abstract function.")}getFragCoord(){Ne("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){Ne("Abstract function.")}generateTextureLod(){Ne("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,n=null){let i=this.generateArrayDeclaration(e,t)+"( ";for(let r=0;r<t;r++){const o=n?n[r]:null;o!==null?i+=o.build(this,e):i+=this.generateConst(e),r<t-1&&(i+=", ")}return i+=" )",i}generateStruct(e,t,n=null){const i=[];for(const r of t){const{name:o,type:u}=r;n&&n[o]&&n[o].isNode?i.push(n[o].build(this,u)):i.push(this.generateConst(u))}return e+"( "+i.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new Qe:e==="vec2"||e==="uvec2"||e==="ivec2"?t=new Ge:e==="vec3"||e==="uvec3"||e==="ivec3"?t=new J:(e==="vec4"||e==="uvec4"||e==="ivec4")&&(t=new yt)),e==="float")return tg(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${tg(t.r)}, ${tg(t.g)}, ${tg(t.b)} )`;const n=this.getTypeLength(e),i=this.getComponentType(e),r=o=>this.generateConst(i,o);if(n===2)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)} )`;if(n===3)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)}, ${r(t.z)} )`;if(n===4&&e!=="mat2")return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)}, ${r(t.z)}, ${r(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(r).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const n=this.attributes;for(const r of n)if(r.name===e)return r;const i=new MR(e,t);return this.registerDeclaration(i),n.push(i),i}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Kn)return"int";if(t===rn)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let n=WD(e);const i=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(n=n.replace("vec","mat")),i+n}getTypeFromArray(e){return bJ.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,i=e.itemSize,r=e.normalized;let o;return!(e instanceof VD)&&r!==!0&&(o=this.getTypeFromArray(n)),this.getTypeFromLength(i,o)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return n!==null?Number(n[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=vg(this.stack);const e=TT();return this.stacks.push(e),mf(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){const n=this.getDataFromNode(t);n.stack=e}return this.stack=e.parent,mf(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let i=n.getData(e);i===void 0&&(i={},n.setData(e,i)),i[t]===void 0&&(i[t]={});let r=i[t];const o=i.any?i.any.subBuilds:null,u=this.getClosestSubBuild(o);return u&&(r.subBuildsCache===void 0&&(r.subBuildsCache={}),r=r.subBuildsCache[u]||(r.subBuildsCache[u]={}),r.subBuilds=o),r}getNodeProperties(e,t="any"){const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e,"vertex");let i=n.bufferAttribute;if(i===void 0){const r=this.uniforms.index++;i=new MR("nodeAttribute"+r,t,e),this.bufferAttributes.push(i),n.bufferAttribute=i}return i}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,n=null,i=this.shaderStage){const r=this.getDataFromNode(e,i,this.globalCache);let o=r.structType;if(o===void 0){const u=this.structs.index++;n===null&&(n="StructType"+u),o=new eJ(n,t),this.structs[i].push(o),this.types[i][n]=e,r.structType=o}return o}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,i=null){const r=this.getDataFromNode(e,n,this.globalCache);let o=r.uniform;if(o===void 0){const u=this.uniforms.index++;o=new ZK(i||"nodeUniform"+u,t,e),this.uniforms[n].push(o),this.registerDeclaration(o),r.uniform=o}return o}getVarFromNode(e,t=null,n=e.getNodeType(this),i=this.shaderStage,r=!1){const o=this.getDataFromNode(e,i),u=this.getSubBuildProperty("variable",o.subBuilds);let c=o[u];if(c===void 0){const d=r?"_const":"_var",f=this.vars[i]||(this.vars[i]=[]),p=this.vars[d]||(this.vars[d]=0);t===null&&(t=(r?"nodeConst":"nodeVar")+p,this.vars[d]++),u!=="variable"&&(t=this.getSubBuildProperty(t,o.subBuilds));const g=e.getArrayCount(this);c=new yU(t,n,r,g),r||f.push(c),this.registerDeclaration(c),o[u]=c}return c}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,n=e.getNodeType(this),i=null,r=null){const o=this.getDataFromNode(e,"any"),u=this.getSubBuildProperty("varying",o.subBuilds);let c=o[u];if(c===void 0){const d=this.varyings,f=d.length;t===null&&(t="nodeVarying"+f),u!=="varying"&&(t=this.getSubBuildProperty(t,o.subBuilds)),c=new QK(t,n,i,r),d.push(c),this.registerDeclaration(c),o[u]=c}return c}registerDeclaration(e){const t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),i=this.getPropertyName(e);let r=1,o=i;for(;n[o]!==void 0;)o=i+"_"+r++;r>1&&(e.name=o,Ne(`TSL: Declaration name '${i}' of '${e.type}' already in use. Renamed to '${o}'.`)),n[o]=e}getCodeFromNode(e,t,n=this.shaderStage){const i=this.getDataFromNode(e);let r=i.code;if(r===void 0){const o=this.codes[n]||(this.codes[n]=[]),u=o.length;r=new KK("nodeCode"+u,t),o.push(r),i.code=r}return r}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:i}=this.getDataFromNode(e);let r=!0,o=t;for(;o;){if(i.get(o)===!0){r=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(r)for(const u of n)this.addLineFlowCode(u)}addLineFlowCodeBlock(e,t,n){const i=this.getDataFromNode(e),r=i.flowCodes||(i.flowCodes=[]),o=i.flowCodeBlock||(i.flowCodeBlock=new WeakMap);r.push(t),o.set(n,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new $O,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let o=0;const u=Object.values(this);return{next:()=>({value:u[o],done:o++>=u.length})}}};for(const o of t.inputs)n[o.name]=new SO(o.type,o.name);e.layout=null;const i=e.call(n),r=this.flowStagesNode(i,t.type);return e.layout=t,r}flowBuildStage(e,t,n=null){const i=this.getBuildStage();this.setBuildStage(t);const r=e.build(this,n);return this.setBuildStage(i),r}flowStagesNode(e,t=null){const n=this.flow,i=this.vars,r=this.declarations,o=this.cache,u=this.buildStage,c=this.stack,d={code:""};this.flow=d,this.vars={},this.declarations={},this.cache=new m_,this.stack=vg();for(const f of Q_)this.setBuildStage(f),d.result=e.build(this,t);return d.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=i,this.declarations=r,this.cache=o,this.stack=c,this.setBuildStage(u),d}getFunctionOperator(){return null}buildFunctionCode(){Ne("Abstract function.")}flowChildNode(e,t=null){const n=this.flow,i={code:""};return this.flow=i,i.result=e.build(this,t),this.flow=n,i}flowNodeFromShaderStage(e,t,n=null,i=null){const r=this.tab,o=this.cache,u=this.shaderStage,c=this.context;this.setShaderStage(e);const d={...this.context};delete d.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=d;let f=null;if(this.buildStage==="generate"){const p=this.flowChildNode(t,n);i!==null&&(p.code+=`${this.tab+i} = ${p.result};
`),this.flowCode[e]=this.flowCode[e]+p.code,f=p}else f=t.build(this);return this.setShaderStage(u),this.cache=o,this.tab=r,this.context=c,f}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){Ne("Abstract function.")}getVaryings(){Ne("Abstract function.")}getVar(e,t,n=null){return`${n!==null?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(n!==void 0)for(const i of n)t+=`${this.getVar(i.type,i.name)}; `;return t}getUniforms(){Ne("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(t!==void 0)for(const i of t)n+=i.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){Ne("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const n=this.subBuildLayers;for(let i=t.length-1;i>=0;i--){const r=t[i];if(n.includes(r))return r}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let n;t!==null?n=this.getClosestSubBuild(t):n=this.subBuildFn;let i;return n?i=e?n+"_"+e:n:i=e,i}build(){const{object:e,material:t,renderer:n}=this;if(t!==null){let i=n.library.fromMaterial(t);i===null&&(Ae(`NodeMaterial: Material "${t.type}" is not compatible.`),i=new en),i.build(this)}else this.addFlow("compute",e);for(const i of Q_){this.setBuildStage(i),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const r of K_){this.setShaderStage(r);const o=this.flowNodes[r];for(const u of o)i==="generate"?this.flowNode(u):u.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getSharedDataFromNode(e){let t=xJ.get(e);return t===void 0&&(t={}),t}getNodeUniform(e,t){const n=this.getSharedDataFromNode(e);let i=n.cache;if(i===void 0){if(t==="float"||t==="int"||t==="uint")i=new uJ(e);else if(t==="vec2"||t==="ivec2"||t==="uvec2")i=new cJ(e);else if(t==="vec3"||t==="ivec3"||t==="uvec3")i=new hJ(e);else if(t==="vec4"||t==="ivec4"||t==="uvec4")i=new dJ(e);else if(t==="color")i=new fJ(e);else if(t==="mat2")i=new pJ(e);else if(t==="mat3")i=new mJ(e);else if(t==="mat4")i=new gJ(e);else throw new Error(`Uniform "${t}" not implemented.`);n.cache=i}return i}format(e,t,n){if(t=this.getVectorType(t),n=this.getVectorType(n),t===n||n===null||this.isReference(n))return e;const i=this.getTypeLength(t),r=this.getTypeLength(n);return i===16&&r===9?`${this.getType(n)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:i===9&&r===4?`${this.getType(n)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:i>4||r>4||r===0?e:i===r?`${this.getType(n)}( ${e} )`:i>r?(e=n==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,r)}`,this.format(e,this.getTypeFromLength(r,this.getComponentType(t)),n)):r===4&&i>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:i===2?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(i===1&&r>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${Cf} - Node System
`}}class AR{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return n===void 0&&(n={renderId:0,frameId:0},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===Ye.FRAME){const i=this._getMaps(this.updateBeforeMap,n);if(i.frameId!==this.frameId){const r=i.frameId;i.frameId=this.frameId,e.updateBefore(this)===!1&&(i.frameId=r)}}else if(t===Ye.RENDER){const i=this._getMaps(this.updateBeforeMap,n);if(i.renderId!==this.renderId){const r=i.renderId;i.renderId=this.renderId,e.updateBefore(this)===!1&&(i.renderId=r)}}else t===Ye.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===Ye.FRAME){const i=this._getMaps(this.updateAfterMap,n);i.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(i.frameId=this.frameId)}else if(t===Ye.RENDER){const i=this._getMaps(this.updateAfterMap,n);i.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(i.renderId=this.renderId)}else t===Ye.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===Ye.FRAME){const i=this._getMaps(this.updateMap,n);i.frameId!==this.frameId&&e.update(this)!==!1&&(i.frameId=this.frameId)}else if(t===Ye.RENDER){const i=this._getMaps(this.updateMap,n);i.renderId!==this.renderId&&e.update(this)!==!1&&(i.renderId=this.renderId)}else t===Ye.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class HS{constructor(e,t,n=null,i="",r=!1){this.type=e,this.name=t,this.count=n,this.qualifier=i,this.isConst=r}}HS.isNodeFunctionInput=!0;class _J extends au{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:VS(this.light),lightColor:e}}}const g_=new gt,ng=new gt;let Td=null;class vJ extends au{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=ze(new J).setGroup(Ue),this.halfWidth=ze(new J).setGroup(Ue),this.updateType=Ye.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;ng.identity(),g_.copy(t.matrixWorld),g_.premultiply(n),ng.extractRotation(g_),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(ng),this.halfHeight.value.applyMatrix4(ng)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=_t(Td.LTC_FLOAT_1),n=_t(Td.LTC_FLOAT_2)):(t=_t(Td.LTC_HALF_1),n=_t(Td.LTC_HALF_2));const{colorNode:i,light:r}=this,o=zS(r);return{lightColor:i,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){Td=e}}class jS extends au{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=ze(0).setGroup(Ue),this.penumbraCosNode=ze(0).setGroup(Ue),this.cutoffDistanceNode=ze(0).setGroup(Ue),this.decayExponentNode=ze(0).setGroup(Ue),this.colorNode=ze(this.color).setGroup(Ue)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:n,penumbraCosNode:i}=this;return Yi(n,i,t)}getLightCoord(e){const t=e.getNodeProperties(this);let n=t.projectionUV;return n===void 0&&(n=WO(this.light,e.context.positionWorld),t.projectionUV=n),n}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:i,light:r}=this,o=this.getLightVector(e),u=o.normalize(),c=u.dot(VS(r)),d=this.getSpotAttenuation(e,c),f=o.length(),p=kS({lightDistance:f,cutoffDistance:n,decayExponent:i});let g=t.mul(d).mul(p),y,x;return r.colorNode?(x=this.getLightCoord(e),y=r.colorNode(x)):r.map&&(x=this.getLightCoord(e),y=_t(r.map,x.xy).onRenderUpdate(()=>r.map)),y&&(g=x.mul(2).sub(1).abs().lessThan(1).all().select(g.mul(y),g)),{lightColor:g,lightDirection:u}}}class TJ extends jS{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const n=this.light.iesMap;let i=null;if(n&&n.isTexture===!0){const r=t.acos().mul(1/Math.PI);i=_t(n,Se(r,0),0).r}else i=super.getSpotAttenuation(t);return i}}const SJ=te(([s,e])=>{const t=s.abs().sub(e);return vr(Jt(t,0)).add(Bs(Jt(t.x,t.y),0))});class wJ extends jS{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let n=1;t.map!==null&&(n=t.map.width/t.map.height),t.shadow.aspect=n}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=z(0),n=this.penumbraCosNode,i=Vy(this.light).mul(e.context.positionWorld||Tr);return ke(i.w.greaterThan(0),()=>{const r=i.xyz.div(i.w),o=SJ(r.xy.sub(Se(.5)),Se(.5)),u=ti(-1,ot(1,VT(n)).sub(1));t.assign(_y(o.mul(-2).mul(u)))}),t}}class MJ extends au{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class NJ extends au{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=US(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=ze(new Qe).setGroup(Ue)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:i}=this,o=Wo.dot(i).mul(.5).add(.5),u=at(n,t,o);e.context.irradiance.addAssign(u)}}class AJ extends au{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let n=0;n<9;n++)t.push(new J);this.lightProbe=Jn(t)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=gU(Wo,this.lightProbe);e.context.irradiance.addAssign(t)}}class bU{parseFunction(){Ne("Abstract function.")}}class qS{constructor(e,t,n="",i=""){this.type=e,this.inputs=t,this.name=n,this.precision=i}getCode(){Ne("Abstract function.")}}qS.isNodeFunction=!0;const EJ=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,RJ=/[a-z_0-9]+/ig,ER="#pragma main",CJ=s=>{s=s.trim();const e=s.indexOf(ER),t=e!==-1?s.slice(e+ER.length):s,n=t.match(EJ);if(n!==null&&n.length===5){const i=n[4],r=[];let o=null;for(;(o=RJ.exec(i))!==null;)r.push(o);const u=[];let c=0;for(;c<r.length;){const x=r[c][0]==="const";x===!0&&c++;let v=r[c][0];v==="in"||v==="out"||v==="inout"?c++:v="";const S=r[c++][0];let w=Number.parseInt(r[c][0]);Number.isNaN(w)===!1?c++:w=null;const M=r[c++][0];u.push(new HS(S,M,w,v,x))}const d=t.substring(n[0].length),f=n[3]!==void 0?n[3]:"",p=n[2],g=n[1]!==void 0?n[1]:"",y=e!==-1?s.slice(0,e):"";return{type:p,inputs:u,name:f,precision:g,inputsCode:i,blockCode:d,headerCode:y}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class DJ extends qS{constructor(e){const{type:t,inputs:n,name:i,precision:r,inputsCode:o,blockCode:u,headerCode:c}=CJ(e);super(t,n,i,r),this.inputsCode=o,this.blockCode=u,this.headerCode=c}getCode(e=this.name){let t;const n=this.blockCode;if(n!==""){const{type:i,inputsCode:r,headerCode:o,precision:u}=this;let c=`${i} ${e} ( ${r.trim()} )`;u!==""&&(c=`${u} ${c}`),t=o+c+n}else t="";return t}}class BJ extends bU{parseFunction(e){return new DJ(e)}}const RR=new WeakMap,hr=[],To=[];class LJ extends Xo{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new AR,this.nodeBuilderCache=new Map,this.callHashCache=new Zi,this.groupsData=new Zi,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===BT.name)return!0;if(n===Ue.name){const r=this.get(e),o=this.nodeFrame.renderId;return r.renderId!==o?(r.renderId=o,!0):!1}if(n===hB.name){const r=this.get(e),o=this.nodeFrame.frameId;return r.frameId!==o?(r.frameId=o,!0):!1}hr[0]=t,hr[1]=e;let i=this.groupsData.get(hr);return i===void 0&&this.groupsData.set(hr,i={}),hr.length=0,i.version!==t.version?(i.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:i}=this,r=this.getForRenderCacheKey(e);if(n=i.get(r),n===void 0){const o=c=>{const d=this.backend.createNodeBuilder(e.object,this.renderer);return d.scene=e.scene,d.material=c,d.camera=e.camera,d.context.material=c,d.lightsNode=e.lightsNode,d.environmentNode=this.getEnvironmentNode(e.scene),d.fogNode=this.getFogNode(e.scene),d.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&d.enableMultiview(),d};let u=o(e.material);try{u.build()}catch(c){u=o(new en),u.build(),Ae("TSL: "+c)}n=this._createNodeBuilderState(u),i.set(r,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const i=this.backend.createNodeBuilder(e,this.renderer);i.build(),n=this._createNodeBuilderState(i),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new YK(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){hr[0]=e,hr[1]=t;const n=this.renderer.info.calls,i=this.callHashCache.get(hr)||{};if(i.callId!==n){const r=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&To.push(t.getCacheKey(!0)),r&&To.push(r.getCacheKey()),o&&To.push(o.getCacheKey()),To.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),To.push(this.renderer.shadowMap.enabled?1:0),To.push(this.renderer.shadowMap.type),i.callId=n,i.cacheKey=ih(To),this.callHashCache.set(hr,i),To.length=0}return hr.length=0,i.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const i=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==n||i){const r=this.getCacheNode("background",n,()=>{if(n.isCubeTexture===!0||n.mapping===Q0||n.mapping===Zv||n.mapping===$_){if(e.backgroundBlurriness>0||n.mapping===$_)return NS(n);{let o;return n.isCubeTexture===!0?o=fs(n):o=_t(n),sO(o)}}else{if(n.isTexture===!0)return _t(n,Ma.flipY()).setUpdateMatrix(!0);n.isColor!==!0&&Ae("WebGPUNodes: Unsupported background configuration.",n)}},i);t.backgroundNode=r,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,i=!1){const r=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=r.get(t);return(o===void 0||i)&&(o=n(),r.set(t,o)),o}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const i=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const r=Et("color","color",n).setGroup(Ue),o=Et("density","float",n).setGroup(Ue);return _f(r,FS(o))}else if(n.isFog){const r=Et("color","color",n).setGroup(Ue),o=Et("near","float",n).setGroup(Ue),u=Et("far","float",n).setGroup(Ue);return _f(r,LS(o,u))}else Ae("Renderer: Unsupported fog configuration.",n)});t.fogNode=i,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const i=this.getCacheNode("environment",n,()=>{if(n.isCubeTexture===!0)return fs(n);if(n.isTexture===!0)return _t(n);Ae("Nodes: Unsupported environment configuration.",n)});t.environmentNode=i,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,i=null,r=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=n,o.camera=i,o.material=r,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return RR.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),i=e.isArrayTexture?Oy(e,Z(Ma,Oa("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):_t(e,Ma).renderOutput(t.toneMapping,t.currentColorSpace);return RR.set(e,n),i}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const i of n.updateNodes)t.updateNode(i)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const i of n.updateNodes)t.updateNode(i)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new AR,this.nodeBuilderCache=new Map,this.cacheLib={}}}const y_=new ca;class F0{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new Fs,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const i=e.length;for(let r=0;r<i;r++){y_.copy(e[r]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[n+r],u=y_.normal;o.x=-u.x,o.y=-u.y,o.z=-u.z,o.w=y_.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const i=t.clippingPlanes,r=i.length;let o,u;if(this.clipIntersection?(o=this.intersectionPlanes,u=e.intersectionPlanes.length):(o=this.unionPlanes,u=e.unionPlanes.length),o.length!==u+r){o.length=u+r;for(let c=0;c<r;c++)o[u+c]=new yt;n=!0}this.projectPlanes(i,o,u),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new F0(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class FJ{constructor(e,t){this.bundleGroup=e,this.camera=t}}const Sd=[];class OJ{constructor(){this.bundles=new Zi}get(e,t){const n=this.bundles;Sd[0]=e,Sd[1]=t;let i=n.get(Sd);return i===void 0&&(i=new FJ(e,t),n.set(Sd,i)),Sd.length=0,i}dispose(){this.bundles=new Zi}}class _U{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){t=new n;for(const i in e)t[i]=e[i]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t)){Ne(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}addClass(e,t,n){if(n.has(t)){Ne(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}}const UJ=new PS,wd=[];class zJ extends Zi{constructor(){super()}createNode(e=[]){return new PS().setLights(e)}getNode(e,t){if(e.isQuadMesh)return UJ;wd[0]=e,wd[1]=t;let n=this.get(wd);return n===void 0&&(n=this.createNode(),this.set(wd,n)),wd.length=0,n}}class Ld extends La{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const CR=new J,DR=new J;class VJ extends Er{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new Ms,this._cameraL.viewport=new yt,this._cameraR=new Ms,this._cameraR.viewport=new yt,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new pH,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=HJ.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Ge,this._onSessionEvent=kJ.bind(this),this._onSessionEnd=GJ.bind(this),this._onInputSourcesChange=$J.bind(this),this._onAnimationFrame=jJ.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&Ne("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&Ne("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,n,i,r,o,u,c={}){const d=new cT(e,t),f=new Ld(r,o,{format:Zs,type:es,depthTexture:new gi(r,o,c.stencil?Vo:rn,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?ba:Hi),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});f._autoAllocateDepthBuffer=!0;const p=new Eo({color:16777215,side:zo});p.map=f.texture,p.map.offset.y=1,p.map.repeat.y=-1;const g=new Rn(d,p);g.position.copy(n),g.quaternion.copy(i);const y={type:"quad",width:e,height:t,translation:n,quaternion:i,pixelwidth:r,pixelheight:o,plane:g,material:p,rendercall:u,renderTarget:f};if(this._layers.push(y),this._session!==null){y.plane.material=new Eo({color:16777215,side:zo}),y.plane.material.blending=Ud,y.plane.material.blendEquation=Pi,y.plane.material.blendSrc=Mo,y.plane.material.blendDst=Mo,y.xrlayer=this._createXRLayer(y);const x=this._session.renderState.layers;x.unshift(y.xrlayer),this._session.updateRenderState({layers:x})}else f.isXRRenderTarget=!1;return g}createCylinderLayer(e,t,n,i,r,o,u,c,d={}){const f=new oT(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),p=new Ld(o,u,{format:Zs,type:es,depthTexture:new gi(o,u,d.stencil?Vo:rn,void 0,void 0,void 0,void 0,void 0,void 0,d.stencil?ba:Hi),stencilBuffer:d.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});p._autoAllocateDepthBuffer=!0;const g=new Eo({color:16777215,side:ns});g.map=p.texture,g.map.offset.y=1,g.map.repeat.y=-1;const y=new Rn(f,g);y.position.copy(i),y.quaternion.copy(r);const x={type:"cylinder",radius:e,centralAngle:t,aspectratio:n,translation:i,quaternion:r,pixelwidth:o,pixelheight:u,plane:y,material:g,rendercall:c,renderTarget:p};if(this._layers.push(x),this._session!==null){x.plane.material=new Eo({color:16777215,side:ns}),x.plane.material.blending=Ud,x.plane.material.blendEquation=Pi,x.plane.material.blendSrc=Mo,x.plane.material.blendDst=Mo,x.xrlayer=this._createXRLayer(x);const v=this._session.renderState.layers;v.unshift(x.xrlayer),this._session.updateRenderState({layers:v})}else p.isXRRenderTarget=!1;return y}renderLayers(){const e=new J,t=new Go,n=this._renderer,i=this.isPresenting,r=n.getOutputRenderTarget(),o=n._frameBufferTarget;this.isPresenting=!1;const u=new Ge;n.getSize(u);const c=n._quad;for(const d of this._layers)if(d.renderTarget.isXRRenderTarget=this._session!==null,d.renderTarget._hasExternalTextures=d.renderTarget.isXRRenderTarget,d.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){d.xrlayer.transform=new XRRigidTransform(d.plane.getWorldPosition(e),d.plane.getWorldQuaternion(t));const f=this._glBinding.getSubImage(d.xrlayer,this._xrFrame);n.backend.setXRRenderTargetTextures(d.renderTarget,f.colorTexture,void 0),n._setXRLayerSize(d.renderTarget.width,d.renderTarget.height),n.setOutputRenderTarget(d.renderTarget),n.setRenderTarget(null),n._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:p,quad:g}=this._frameBufferTargets.get(d.renderTarget)||{frameBufferTarget:null,quad:null};p?(n._frameBufferTarget=p,n._quad=g):(n._quad=new If(new en),this._frameBufferTargets.set(d.renderTarget,{frameBufferTarget:n._getFrameBufferTarget(),quad:n._quad})),d.rendercall(),n._frameBufferTarget=null}else n.setRenderTarget(d.renderTarget),d.rendercall();n.setRenderTarget(null),n.setOutputRenderTarget(r),n._frameBufferTarget=o,n._setXRLayerSize(u.x,u.y),n._quad=c,this.isPresenting=i}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend;this._gl=t.getContext();const i=this._gl,r=i.getContextAttributes();if(this._session=e,e!==null){if(n.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let o=null,u=null,c=null;t.depth&&(c=t.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,o=t.stencil?ba:Hi,u=t.stencil?Vo:rn);const d={colorFormat:i.RGBA8,depthFormat:c,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(d.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const f=this._glBinding.createProjectionLayer(d),p=[f];this._glProjLayer=f,t.setPixelRatio(1),t._setXRLayerSize(f.textureWidth,f.textureHeight);const g=this._useMultiview?2:1,y=new gi(f.textureWidth,f.textureHeight,u,void 0,void 0,void 0,void 0,void 0,void 0,o,g);if(this._xrRenderTarget=new Ld(f.textureWidth,f.textureHeight,{format:Zs,type:es,colorSpace:t.outputColorSpace,depthTexture:y,stencilBuffer:t.stencil,samples:r.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const x of this._layers)x.plane.material=new Eo({color:16777215,side:x.type==="cylinder"?ns:zo}),x.plane.material.blending=Ud,x.plane.material.blendEquation=Pi,x.plane.material.blendSrc=Mo,x.plane.material.blendDst=Mo,x.xrlayer=this._createXRLayer(x),p.unshift(x.xrlayer);e.updateRenderState({layers:p})}else{const o={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},u=new XRWebGLLayer(e,i,o);this._glBaseLayer=u,e.updateRenderState({baseLayer:u}),t.setPixelRatio(1),t._setXRLayerSize(u.framebufferWidth,u.framebufferHeight),this._xrRenderTarget=new Ld(u.framebufferWidth,u.framebufferHeight,{format:Zs,type:es,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:u.ignoreDepthValues===!1,resolveStencilBuffer:u.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const n=e.near,i=e.far,r=this._cameraXR,o=this._cameraL,u=this._cameraR;r.near=u.near=o.near=n,r.far=u.far=o.far=i,r.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==r.near||this._currentDepthFar!==r.far)&&(t.updateRenderState({depthNear:r.near,depthFar:r.far}),this._currentDepthNear=r.near,this._currentDepthFar=r.far),r.layers.mask=e.layers.mask|6,o.layers.mask=r.layers.mask&3,u.layers.mask=r.layers.mask&5;const c=e.parent,d=r.cameras;BR(r,c);for(let f=0;f<d.length;f++)BR(d[f],c);d.length===2?PJ(r,o,u):r.projectionMatrix.copy(o.projectionMatrix),IJ(e,r,c)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new G9,this._controllers[e]=t),t}}function PJ(s,e,t){CR.setFromMatrixPosition(e.matrixWorld),DR.setFromMatrixPosition(t.matrixWorld);const n=CR.distanceTo(DR),i=e.projectionMatrix.elements,r=t.projectionMatrix.elements,o=i[14]/(i[10]-1),u=i[14]/(i[10]+1),c=(i[9]+1)/i[5],d=(i[9]-1)/i[5],f=(i[8]-1)/i[0],p=(r[8]+1)/r[0],g=o*f,y=o*p,x=n/(-f+p),v=x*-f;if(e.matrixWorld.decompose(s.position,s.quaternion,s.scale),s.translateX(v),s.translateZ(x),s.matrixWorld.compose(s.position,s.quaternion,s.scale),s.matrixWorldInverse.copy(s.matrixWorld).invert(),i[10]===-1)s.projectionMatrix.copy(e.projectionMatrix),s.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const S=o+x,w=u+x,M=g-v,T=y+(n-v),A=c*u/w*S,C=d*u/w*S;s.projectionMatrix.makePerspective(M,T,A,C,S,w),s.projectionMatrixInverse.copy(s.projectionMatrix).invert()}}function BR(s,e){e===null?s.matrixWorld.copy(s.matrix):s.matrixWorld.multiplyMatrices(e.matrixWorld,s.matrix),s.matrixWorldInverse.copy(s.matrixWorld).invert()}function IJ(s,e,t){t===null?s.matrix.copy(e.matrixWorld):(s.matrix.copy(t.matrixWorld),s.matrix.invert(),s.matrix.multiply(e.matrixWorld)),s.matrix.decompose(s.position,s.quaternion,s.scale),s.updateMatrixWorld(!0),s.projectionMatrix.copy(e.projectionMatrix),s.projectionMatrixInverse.copy(e.projectionMatrixInverse),s.isPerspectiveCamera&&(s.fov=Kc*2*Math.atan(1/s.projectionMatrix.elements[5]),s.zoom=1)}function kJ(s){const e=this._controllerInputSources.indexOf(s.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const n=this.getReferenceSpace();t.update(s.inputSource,s.frame,n),t.dispatchEvent({type:s.type,data:s.inputSource})}}function GJ(){const s=this._session,e=this._renderer;s.removeEventListener("select",this._onSessionEvent),s.removeEventListener("selectstart",this._onSessionEvent),s.removeEventListener("selectend",this._onSessionEvent),s.removeEventListener("squeeze",this._onSessionEvent),s.removeEventListener("squeezestart",this._onSessionEvent),s.removeEventListener("squeezeend",this._onSessionEvent),s.removeEventListener("end",this._onSessionEnd),s.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const n=this._controllerInputSources[t];n!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(n))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new Ld(t.pixelwidth,t.pixelheight,{format:Zs,type:es,depthTexture:new gi(t.pixelwidth,t.pixelheight,t.stencilBuffer?Vo:rn,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?ba:Hi),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function $J(s){const e=this._controllers,t=this._controllerInputSources;for(let n=0;n<s.removed.length;n++){const i=s.removed[n],r=t.indexOf(i);r>=0&&(t[r]=null,e[r].disconnect(i))}for(let n=0;n<s.added.length;n++){const i=s.added[n];let r=t.indexOf(i);if(r===-1){for(let u=0;u<e.length;u++)if(u>=t.length){t.push(i),r=u;break}else if(t[u]===null){t[u]=i,r=u;break}if(r===-1)break}const o=e[r];o&&o.connect(i)}}function HJ(s){return s.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(s.translation,s.quaternion),width:s.width/2,height:s.height/2,space:this._referenceSpace,viewPixelWidth:s.pixelwidth,viewPixelHeight:s.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(s.translation,s.quaternion),radius:s.radius,centralAngle:s.centralAngle,aspectRatio:s.aspectRatio,space:this._referenceSpace,viewPixelWidth:s.pixelwidth,viewPixelHeight:s.pixelheight,clearOnAccess:!1})}function jJ(s,e){if(e===void 0)return;const t=this._cameraXR,n=this._renderer,i=n.backend,r=this._glBaseLayer,o=this.getReferenceSpace(),u=e.getViewerPose(o);if(this._xrFrame=e,u!==null){const c=u.views;this._glBaseLayer!==null&&i.setXRTarget(r.framebuffer);let d=!1;c.length!==t.cameras.length&&(t.cameras.length=0,d=!0);for(let f=0;f<c.length;f++){const p=c[f];let g;if(this._supportsLayers===!0){const x=this._glBinding.getViewSubImage(this._glProjLayer,p);g=x.viewport,f===0&&i.setXRRenderTargetTextures(this._xrRenderTarget,x.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:x.depthStencilTexture)}else g=r.getViewport(p);let y=this._cameras[f];y===void 0&&(y=new Ms,y.layers.enable(f),y.viewport=new yt,this._cameras[f]=y),y.matrix.fromArray(p.transform.matrix),y.matrix.decompose(y.position,y.quaternion,y.scale),y.projectionMatrix.fromArray(p.projectionMatrix),y.projectionMatrixInverse.copy(y.projectionMatrix).invert(),y.viewport.set(g.x,g.y,g.width,g.height),f===0&&(t.matrix.copy(y.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),d===!0&&t.cameras.push(y)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let c=0;c<this._controllers.length;c++){const d=this._controllerInputSources[c],f=this._controllers[c];d!==null&&f!==void 0&&f.update(d,e,o)}this._currentAnimationLoop&&this._currentAnimationLoop(s,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}class qJ extends Er{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new yt(0,0,this._width,this._height),this._scissor=new yt(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new aT,this.depthTexture=new gi}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,i){const r=this._scissor;e.isVector4?r.copy(e):r.set(e,t,n,i)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,i,r=0,o=1){const u=this._viewport;e.isVector4?u.copy(e):u.set(e,t,n,i),u.minDepth=r,u.maxDepth=o}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const LR=new ay,pc=new Ge,x_=new yt,b_=new iT,__=new rT,sg=new gt,aa=new yt;class WJ{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:i=!0,depth:r=!0,stencil:o=!1,antialias:u=!1,samples:c=0,getFallback:d=null,outputBufferType:f=Gn,multiview:p=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=n,this.outputColorSpace=cs,this.toneMapping=Lo,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=r,this.stencil=o,this.info=new OW,this.contextNode=Fa(),this.library=new _U,this.lighting=new zJ,this._samples=c||u===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new qJ(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new EL,this._inspector.setRenderer(this),this._getFallback=d,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new If(new en),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const g=this.alpha===!0?0:1;this._clearColor=new AS(0,0,0,g),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._outputBufferType=f,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:S8},this.xr=new VJ(this,p),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(y,x,v)=>{await this.compileAsync(y,x);const S=this._renderLists.get(y,x),w=this._renderContexts.get(y,x,this._renderTarget,this._mrt),M=y.overrideMaterial||v.material,T=this._objects.get(v,M,y,x,S.lightsNode,w,w.clippingContext),{fragmentShader:A,vertexShader:C}=T.getNodeBuilderState();return{fragmentShader:A,vertexShader:C}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(i){if(this._getFallback!==null)try{this.backend=n=this._getFallback(i),await n.init(this)}catch(r){t(r);return}else{t(i);return}}this._nodes=new LJ(this,n),this._animation=new NW(this,this._nodes,this.info),this._attributes=new LW(n),this._background=new WK(this,this._nodes),this._geometries=new FW(this._attributes,this.info),this._textures=new ZW(this,n,this.info),this._pipelines=new PW(n,this._nodes),this._bindings=new IW(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new CW(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new $W(this.lighting),this._bundles=new OJ,this._renderContexts=new XW,this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const i=this._nodes.nodeFrame,r=i.renderId,o=this._currentRenderContext,u=this._currentRenderObjectFunction,c=this._compilationPromises,d=e.isScene===!0?e:LR;n===null&&(n=e);const f=this._renderTarget,p=this._renderContexts.get(n,t,f,this._mrt),g=this._activeMipmapLevel,y=[];this._currentRenderContext=p,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=y,i.renderId++,i.update(),p.depth=this.depth,p.stencil=this.stencil,p.clippingContext||(p.clippingContext=new F0),p.clippingContext.updateGlobal(d,t),d.onBeforeRender(this,e,t,f);const x=this._renderLists.get(e,t);if(x.begin(),this._projectObject(e,t,0,x,p.clippingContext),n!==e&&n.traverseVisible(function(T){T.isLight&&T.layers.test(t.layers)&&x.pushLight(T)}),x.finish(),f!==null){this._textures.updateRenderTarget(f,g);const T=this._textures.get(f);p.textures=T.textures,p.depthTexture=T.depthTexture}else p.textures=null,p.depthTexture=null;this._background.update(d,x,p);const v=x.opaque,S=x.transparent,w=x.transparentDoublePass,M=x.lightsNode;this.opaque===!0&&v.length>0&&this._renderObjects(v,t,d,M),this.transparent===!0&&S.length>0&&this._renderTransparents(S,w,t,d,M),i.renderId=r,this._currentRenderContext=o,this._currentRenderObjectFunction=u,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(y)}async renderAsync(e,t){$t('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){Ae("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){const t=this.contextNode.value;e===!0?(t.modelViewMatrix=iv,t.modelNormalViewMatrix=rv):this.highPrecision&&(delete t.modelViewMatrix,delete t.modelNormalViewMatrix)}get highPrecision(){const e=this.contextNode.value;return e.modelViewMatrix===iv&&e.modelNormalViewMatrix===rv}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getOutputBufferType(){return this._outputBufferType}getColorBufferType(){return $t('Renderer: ".getColorBufferType()" has been renamed to ".getOutputBufferType()".'),this.getOutputBufferType()}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),Ae(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:i,camera:r,renderList:o}=e,u=this._currentRenderContext,c=this._bundles.get(i,r),d=this.backend.get(c);d.renderContexts===void 0&&(d.renderContexts=new Set);const f=i.version!==d.version,p=d.renderContexts.has(u)===!1||f;if(d.renderContexts.add(u),p){this.backend.beginBundle(u),(d.renderObjects===void 0||f)&&(d.renderObjects=[]),this._currentRenderBundle=c;const{transparentDoublePass:g,transparent:y,opaque:x}=o;this.opaque===!0&&x.length>0&&this._renderObjects(x,r,t,n),this.transparent===!0&&y.length>0&&this._renderTransparents(y,g,r,t,n),this._currentRenderBundle=null,this.backend.finishBundle(u,c),d.version=i.version}else{const{renderObjects:g}=d;for(let y=0,x=g.length;y<x;y++){const v=g[y];this._nodes.needsRefresh(v)&&(this._nodes.updateBefore(v),this._nodes.updateForRender(v),this._bindings.updateForRender(v),this._nodes.updateAfter(v))}}this.backend.addBundle(u,c)}render(e,t){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,n=e!==Lo,i=t!==bt.workingColorSpace;if(n===!1&&i===!1)return null;const{width:r,height:o}=this.getDrawingBufferSize(pc),{depth:u,stencil:c}=this;let d=this._frameBufferTarget;d===null&&(d=new La(r,o,{depthBuffer:u,stencilBuffer:c,type:this._outputBufferType,format:Zs,colorSpace:bt.workingColorSpace,generateMipmaps:!1,minFilter:ms,magFilter:ms,samples:this.samples}),d.isPostProcessingRenderTarget=!0,this._frameBufferTarget=d);const f=this.getOutputRenderTarget();d.depthBuffer=u,d.stencilBuffer=c,f!==null?d.setSize(f.width,f.height,f.depth):d.setSize(r,o,1);const p=this._canvasTarget;return d.viewport.copy(p._viewport),d.scissor.copy(p._scissor),d.viewport.multiplyScalar(p._pixelRatio),d.scissor.multiplyScalar(p._pixelRatio),d.scissorTest=p._scissorTest,d.multiview=f!==null?f.multiview:!1,d.resolveDepthBuffer=f!==null?f.resolveDepthBuffer:!0,d._autoAllocateDepthBuffer=f!==null?f._autoAllocateDepthBuffer:!1,d}_renderScene(e,t,n=!0){if(this._isDeviceLost===!0)return;const i=n?this._getFrameBufferTarget():null,r=this._nodes.nodeFrame,o=r.renderId,u=this._currentRenderContext,c=this._currentRenderObjectFunction,d=e.isScene===!0?e:LR,f=this._renderTarget||this._outputRenderTarget,p=this._activeCubeFace,g=this._activeMipmapLevel;let y;i!==null?(y=i,this.setRenderTarget(y)):y=f;const x=this._renderContexts.get(e,t,y,this._mrt);this._currentRenderContext=x,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,r.renderId=this.info.calls,this.backend.updateTimeStampUID(x),this.inspector.beginRender(this.backend.getTimestampUID(x),e,t,y);const v=this.coordinateSystem,S=this.xr;if(t.coordinateSystem!==v&&S.isPresenting===!1&&(t.coordinateSystem=v,t.updateProjectionMatrix(),t.isArrayCamera))for(const P of t.cameras)P.coordinateSystem=v,P.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),S.enabled===!0&&S.isPresenting===!0&&(S.cameraAutoUpdate===!0&&S.updateCamera(t),t=S.getCamera());const w=this._canvasTarget;let M=w._viewport,T=w._scissor,A=w._pixelRatio;y!==null&&(M=y.viewport,T=y.scissor,A=1),this.getDrawingBufferSize(pc),x_.set(0,0,pc.width,pc.height);const C=M.minDepth===void 0?0:M.minDepth,D=M.maxDepth===void 0?1:M.maxDepth;x.viewportValue.copy(M).multiplyScalar(A).floor(),x.viewportValue.width>>=g,x.viewportValue.height>>=g,x.viewportValue.minDepth=C,x.viewportValue.maxDepth=D,x.viewport=x.viewportValue.equals(x_)===!1,x.scissorValue.copy(T).multiplyScalar(A).floor(),x.scissor=w._scissorTest&&x.scissorValue.equals(x_)===!1,x.scissorValue.width>>=g,x.scissorValue.height>>=g,x.clippingContext||(x.clippingContext=new F0),x.clippingContext.updateGlobal(d,t),d.onBeforeRender(this,e,t,y);const R=t.isArrayCamera?__:b_;t.isArrayCamera||(sg.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),R.setFromProjectionMatrix(sg,t.coordinateSystem,t.reversedDepth));const B=this._renderLists.get(e,t);if(B.begin(),this._projectObject(e,t,0,B,x.clippingContext),B.finish(),this.sortObjects===!0&&B.sort(this._opaqueSort,this._transparentSort),y!==null){this._textures.updateRenderTarget(y,g);const P=this._textures.get(y);x.textures=P.textures,x.depthTexture=P.depthTexture,x.width=P.width,x.height=P.height,x.renderTarget=y,x.depth=y.depthBuffer,x.stencil=y.stencilBuffer}else x.textures=null,x.depthTexture=null,x.width=pc.width,x.height=pc.height,x.depth=this.depth,x.stencil=this.stencil;x.width>>=g,x.height>>=g,x.activeCubeFace=p,x.activeMipmapLevel=g,x.occlusionQueryCount=B.occlusionQueryCount,x.scissorValue.max(aa.set(0,0,0,0)),x.scissorValue.x+x.scissorValue.width>x.width&&(x.scissorValue.width=Math.max(x.width-x.scissorValue.x,0)),x.scissorValue.y+x.scissorValue.height>x.height&&(x.scissorValue.height=Math.max(x.height-x.scissorValue.y,0)),this._background.update(d,B,x),x.camera=t,this.backend.beginRender(x);const{bundles:L,lightsNode:X,transparentDoublePass:G,transparent:j,opaque:ee}=B;return L.length>0&&this._renderBundles(L,d,X),this.opaque===!0&&ee.length>0&&this._renderObjects(ee,t,d,X),this.transparent===!0&&j.length>0&&this._renderTransparents(j,G,t,d,X),this.backend.finishRender(x),r.renderId=o,this._currentRenderContext=u,this._currentRenderObjectFunction=c,i!==null&&(this.setRenderTarget(f,p,g),this._renderOutput(y)),d.onAfterRender(this,e,t,y),this.inspector.finishRender(this.backend.getTimestampUID(x)),x}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,i=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=i}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,n)}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,n)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,n,i){this._canvasTarget.setScissor(e,t,n,i)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,n,i,r=0,o=1){this._canvasTarget.setViewport(e,t,n,i,r,o)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const i=this._renderTarget||this._getFrameBufferTarget();let r=null;if(i!==null){this._textures.updateRenderTarget(i);const o=this._textures.get(i);r=this._renderContexts.getForClear(i),r.textures=o.textures,r.depthTexture=o.depthTexture,r.width=o.width,r.height=o.height,r.renderTarget=i,r.depth=i.depthBuffer,r.stencil=i.stencilBuffer,r.clearColorValue=this.backend.getClearColor(),r.activeCubeFace=this.getActiveCubeFace(),r.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,r),i!==null&&this._renderTarget===null&&this._renderOutput(i)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){$t('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,n)}async clearColorAsync(){$t('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){$t('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){$t('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=this.currentToneMapping!==Lo,t=this.currentColorSpace!==bt.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget!==null?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Lo}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:bt.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return Ne("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const n=this._nodes.nodeFrame,i=n.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,n.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const r=this.backend,o=this._pipelines,u=this._bindings,c=this._nodes,d=Array.isArray(e)?e:[e];if(d[0]===void 0||d[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");r.beginCompute(e);for(const f of d){if(o.has(f)===!1){const y=()=>{f.removeEventListener("dispose",y),o.delete(f),u.deleteForCompute(f),c.delete(f)};f.addEventListener("dispose",y);const x=f.onInitFunction;x!==null&&x.call(f,{renderer:this})}c.updateForCompute(f),u.updateForCompute(f);const p=u.getForCompute(f),g=o.getForCompute(f,p);r.compute(e,f,p,g,t)}r.finishCompute(e),n.renderId=i,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return $t('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){$t('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=aa.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=aa.copy(t).floor();else{Ae("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=aa.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,i;n!==null?i=n.renderTarget:(i=this._renderTarget||this._getFrameBufferTarget(),i!==null&&(this._textures.updateRenderTarget(i),n=this._textures.get(i))),this._textures.updateTexture(e,{renderTarget:i}),this.backend.copyFramebufferToTexture(e,n,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,n=null,i=null,r=0,o=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,i,r,o),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,n,i,r,o=0,u=0){return this.backend.copyTextureToBuffer(e.textures[o],t,n,i,r,u)}_projectObject(e,t,n,i,r){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(r=r.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)i.pushLight(e);else if(e.isSprite){const c=t.isArrayCamera?__:b_;if(!e.frustumCulled||c.intersectsSprite(e,t)){this.sortObjects===!0&&aa.setFromMatrixPosition(e.matrixWorld).applyMatrix4(sg);const{geometry:d,material:f}=e;f.visible&&i.push(e,d,f,n,aa.z,null,r)}}else if(e.isLineLoop)Ae("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const c=t.isArrayCamera?__:b_;if(!e.frustumCulled||c.intersectsObject(e,t)){const{geometry:d,material:f}=e;if(this.sortObjects===!0&&(d.boundingSphere===null&&d.computeBoundingSphere(),aa.copy(d.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(sg)),Array.isArray(f)){const p=d.groups;for(let g=0,y=p.length;g<y;g++){const x=p[g],v=f[x.materialIndex];v&&v.visible&&i.push(e,d,v,n,aa.z,x,r)}}else f.visible&&i.push(e,d,f,n,aa.z,null,r)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const c=i;i=this._renderLists.get(e,t),i.begin(),c.pushBundle({bundleGroup:e,camera:t,renderList:i}),i.finish()}const u=e.children;for(let c=0,d=u.length;c<d;c++)this._projectObject(u[c],t,n,i,r)}_renderBundles(e,t,n){for(const i of e)this._renderBundle(i,t,n)}_renderTransparents(e,t,n,i,r){if(t.length>0){for(const{material:o}of t)o.side=ns;this._renderObjects(t,n,i,r,"backSide");for(const{material:o}of t)o.side=zo;this._renderObjects(e,n,i,r);for(const{material:o}of t)o.side=ql}else this._renderObjects(e,n,i,r)}_renderObjects(e,t,n,i,r=null){for(let o=0,u=e.length;o<u;o++){const{object:c,geometry:d,material:f,group:p,clippingContext:g}=e[o];this._currentRenderObjectFunction(c,n,t,d,f,p,i,g,r)}}_getShadowNodes(e){const t=e.version;let n=this._cacheShadowNodes.get(e);if(n===void 0||n.version!==t){const i=e.map!==null,r=e.colorNode&&e.colorNode.isNode,o=e.castShadowNode&&e.castShadowNode.isNode;let u=null,c=null,d=null;if(i||r||o){let f,p;o?(f=e.castShadowNode.rgb,p=e.castShadowNode.a):(f=Z(0),p=z(1)),i&&(p=p.mul(Et("map","texture",e).a)),r&&(p=p.mul(e.colorNode.a)),c=Ie(f,p)}e.depthNode&&e.depthNode.isNode&&(d=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?u=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(u=e.positionNode),n={version:t,colorNode:c,depthNode:d,positionNode:u},this._cacheShadowNodes.set(e,n)}return n}renderObject(e,t,n,i,r,o,u,c=null,d=null){let f=!1,p,g,y,x;if(e.onBeforeRender(this,t,n,i,r,o),r.allowOverride===!0&&t.overrideMaterial!==null){const v=t.overrideMaterial;if(f=!0,p=t.overrideMaterial.colorNode,g=t.overrideMaterial.depthNode,y=t.overrideMaterial.positionNode,x=t.overrideMaterial.side,r.positionNode&&r.positionNode.isNode&&(v.positionNode=r.positionNode),v.alphaTest=r.alphaTest,v.alphaMap=r.alphaMap,v.transparent=r.transparent||r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode||r.backdropNode&&r.backdropNode.isNode,v.isShadowPassMaterial){const{colorNode:S,depthNode:w,positionNode:M}=this._getShadowNodes(r);v.side=r.shadowSide===null?r.side:r.shadowSide,S!==null&&(v.colorNode=S),w!==null&&(v.depthNode=w),M!==null&&(v.positionNode=M)}r=v}r.transparent===!0&&r.side===ql&&r.forceSinglePass===!1?(r.side=ns,this._handleObjectFunction(e,r,t,n,u,o,c,"backSide"),r.side=zo,this._handleObjectFunction(e,r,t,n,u,o,c,d),r.side=ql):this._handleObjectFunction(e,r,t,n,u,o,c,d),f&&(t.overrideMaterial.colorNode=p,t.overrideMaterial.depthNode=g,t.overrideMaterial.positionNode=y,t.overrideMaterial.side=x),e.onAfterRender(this,t,n,i,r,o)}_renderObjectDirect(e,t,n,i,r,o,u,c){const d=this._objects.get(e,t,n,i,r,this._currentRenderContext,u,c);d.drawRange=e.geometry.drawRange,d.group=o;const f=this._nodes.needsRefresh(d);f&&(this._nodes.updateBefore(d),this._geometries.updateForRender(d),this._nodes.updateForRender(d),this._bindings.updateForRender(d)),this._pipelines.updateForRender(d),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(d),d.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(d,this.info),f&&this._nodes.updateAfter(d)}_createObjectPipeline(e,t,n,i,r,o,u,c){const d=this._objects.get(e,t,n,i,r,this._currentRenderContext,u,c);d.drawRange=e.geometry.drawRange,d.group=o,this._nodes.updateBefore(d),this._geometries.updateForRender(d),this._nodes.updateForRender(d),this._bindings.updateForRender(d),this._pipelines.getForRender(d,this._compilationPromises),this._nodes.updateAfter(d)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class vU{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}getVisibility(){return this.visibility}clone(){return Object.assign(new this.constructor,this)}}function XJ(s){return s+(Bo-s%Bo)%Bo}class TU extends vU{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t,this._updateRanges=[]}get updateRanges(){return this._updateRanges}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}get byteLength(){return XJ(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class SU extends TU{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let YJ=0;class wU extends SU{constructor(e,t){super("UniformBuffer_"+YJ++,e?e.value:null),this.nodeUniform=e,this.groupNode=t,this.isNodeUniformBuffer=!0}set updateRanges(e){this.nodeUniform.updateRanges=e}get updateRanges(){return this.nodeUniform.updateRanges}addUpdateRange(e,t){this.nodeUniform.addUpdateRange(e,t)}clearUpdateRanges(){this.nodeUniform.clearUpdateRanges()}get buffer(){return this.nodeUniform.value}}class ZJ extends SU{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let n=0,i=this.uniforms.length;n<i;n++){const r=this.uniforms[n],o=r.boundary,u=r.itemSize*e,c=t%Bo,d=c%o,f=c+d;t+=d,f!==0&&Bo-f<u&&(t+=Bo-f),r.offset=t/e,t+=u}return Math.ceil(t/Bo)*Bo}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);Ae("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,i=e.getValue(),r=e.offset,o=e.getType();if(n[r]!==i){const u=this._getBufferForType(o);u[r]=n[r]=i,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,i=e.getValue(),r=e.offset,o=e.getType();if(n[r+0]!==i.x||n[r+1]!==i.y){const u=this._getBufferForType(o);u[r+0]=n[r+0]=i.x,u[r+1]=n[r+1]=i.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,i=e.getValue(),r=e.offset,o=e.getType();if(n[r+0]!==i.x||n[r+1]!==i.y||n[r+2]!==i.z){const u=this._getBufferForType(o);u[r+0]=n[r+0]=i.x,u[r+1]=n[r+1]=i.y,u[r+2]=n[r+2]=i.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,i=e.getValue(),r=e.offset,o=e.getType();if(n[r+0]!==i.x||n[r+1]!==i.y||n[r+2]!==i.z||n[r+4]!==i.w){const u=this._getBufferForType(o);u[r+0]=n[r+0]=i.x,u[r+1]=n[r+1]=i.y,u[r+2]=n[r+2]=i.z,u[r+3]=n[r+3]=i.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,i=e.getValue(),r=e.offset;if(n[r+0]!==i.r||n[r+1]!==i.g||n[r+2]!==i.b){const o=this.buffer;o[r+0]=n[r+0]=i.r,o[r+1]=n[r+1]=i.g,o[r+2]=n[r+2]=i.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,i=e.getValue().elements,r=e.offset;if(n[r+0]!==i[0]||n[r+1]!==i[1]||n[r+2]!==i[2]||n[r+4]!==i[3]||n[r+5]!==i[4]||n[r+6]!==i[5]||n[r+8]!==i[6]||n[r+9]!==i[7]||n[r+10]!==i[8]){const o=this.buffer;o[r+0]=n[r+0]=i[0],o[r+1]=n[r+1]=i[1],o[r+2]=n[r+2]=i[2],o[r+4]=n[r+4]=i[3],o[r+5]=n[r+5]=i[4],o[r+6]=n[r+6]=i[5],o[r+8]=n[r+8]=i[6],o[r+9]=n[r+9]=i[7],o[r+10]=n[r+10]=i[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,i=e.getValue().elements,r=e.offset;return KJ(n,i,r)===!1&&(this.buffer.set(i,r),QJ(n,i,r),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function QJ(s,e,t){for(let n=0,i=e.length;n<i;n++)s[t+n]=e[n]}function KJ(s,e,t){for(let n=0,i=e.length;n<i;n++)if(s[t+n]!==e[n])return!1;return!0}let JJ=0;class MU extends ZJ{constructor(e,t){super(e),this.id=JJ++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class NU extends vU{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=t,this.version=t?t.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=0},e.texture=this.texture,e}}let eee=0;class tee extends NU{constructor(e,t){super(e,t),this.id=eee++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class ky extends tee{constructor(e,t,n,i=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=i}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class AU extends ky{constructor(e,t,n,i=null){super(e,t,n,i),this.isSampledCubeTexture=!0}}class bv extends ky{constructor(e,t,n,i=null){super(e,t,n,i),this.isSampledTexture3D=!0}}const FR={bitcast_int_uint:new Fn("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }"),bitcast_uint_int:new Fn("uint tsl_bitcast_uint_to_int ( uint x ) { return floatBitsToInt( uintBitsToFloat ( x ) ); }")},nee={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint",floatpack_snorm_2x16:"packSnorm2x16",floatpack_unorm_2x16:"packUnorm2x16",floatpack_float16_2x16:"packHalf2x16",floatunpack_snorm_2x16:"unpackSnorm2x16",floatunpack_unorm_2x16:"unpackUnorm2x16",floatunpack_float16_2x16:"unpackHalf2x16"},see={low:"lowp",medium:"mediump",high:"highp"},OR={swizzleAssign:!0,storageBuffer:!1},UR={perspective:"smooth",linear:"noperspective"},zR={centroid:"centroid"},VR=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class iee extends xU{constructor(e,t){super(e,t,new BJ),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==ko}_include(e){const t=FR[e];return t.build(this),this.addInclude(t),t}getMethod(e){return FR[e]!==void 0&&this._include(e),nee[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,n){return`${e} ? ${t} : ${n}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),i=[];for(const o of t.inputs)i.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${i.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const n=t.array,i=t.count*t.itemSize,{itemSize:r}=t,o=t.array.constructor.name.toLowerCase().includes("int");let u=o?ey:J0;r===2?u=o?ty:gr:r===3?u=o?O8:K0:r===4&&(u=o?ny:Zs);const c={Float32Array:Ns,Uint8Array:es,Uint16Array:Vl,Uint32Array:rn,Int8Array:Cc,Int16Array:Dc,Int32Array:Kn,Uint8ClampedArray:es},d=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(i/r))));let f=Math.ceil(i/r/d);d*f*r<i&&f++;const p=d*f*r,g=new n.constructor(p);g.set(n,0),t.array=g;const y=new GD(t.array,d,f,u,c[t.array.constructor.name]||Ns);y.needsUpdate=!0,y.isPBOTexture=!0;const x=new Mr(y,null,null);x.setPrecision("high"),t.pboNode=x,t.pbo=x.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,i=t.value;if(this.renderer.backend.has(i)){const f=this.renderer.backend.get(i);f.pbo=i.pbo}const r=this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.nodeName),o=this.getPropertyName(r);this.increaseUsage(n);const u=n.build(this,"uint"),c=this.getDataFromNode(e);let d=c.propertyName;if(d===void 0){const f=this.getVarFromNode(e);d=this.getPropertyName(f);const p=this.getDataFromNode(t);let g=p.propertySizeName;g===void 0&&(g=d+"Size",this.getVarFromNode(t,g,"uint"),this.addLineFlowCode(`${g} = uint( textureSize( ${o}, 0 ).x )`,e),p.propertySizeName=g);const{itemSize:y}=i,x="."+nu.join("").slice(0,y),v=`ivec2(${u} % ${g}, ${u} / ${g})`,S=this.generateTextureLoad(null,o,v,"0",null,null);let w="vec4";i.pbo.type===rn?w="uvec4":i.pbo.type===Kn&&(w="ivec4"),this.addLineFlowCode(`${d} = ${w}(${S})${x}`,e),c.propertyName=d}return d}generateTextureLoad(e,t,n,i,r,o){i===null&&(i="0");let u;return r?o?u=`texelFetchOffset( ${t}, ivec3( ${n}, ${r} ), ${i}, ${o} )`:u=`texelFetch( ${t}, ivec3( ${n}, ${r} ), ${i} )`:o?u=`texelFetchOffset( ${t}, ${n}, ${i}, ${o} )`:u=`texelFetch( ${t}, ${n}, ${i} )`,e!==null&&e.isDepthTexture&&(u+=".x"),u}generateTexture(e,t,n,i,r){return i&&(n=`vec3( ${n}, ${i} )`),e.isDepthTexture?r?`textureOffset( ${t}, ${n}, ${r} ).x`:`texture( ${t}, ${n} ).x`:r?`textureOffset( ${t}, ${n}, ${r} )`:`texture( ${t}, ${n} )`}generateTextureLevel(e,t,n,i,r){return r?`textureLodOffset( ${t}, ${n}, ${i}, ${r} )`:`textureLod( ${t}, ${n}, ${i} )`}generateTextureBias(e,t,n,i,r){return r?`textureOffset( ${t}, ${n}, ${r}, ${i} )`:`texture( ${t}, ${n}, ${i} )`}generateTextureGrad(e,t,n,i,r){return r?`textureGradOffset( ${t}, ${n}, ${i[0]}, ${i[1]}, ${r} )`:`textureGrad( ${t}, ${n}, ${i[0]}, ${i[1]} )`}generateTextureCompare(e,t,n,i,r,o,u=this.shaderStage){if(u==="fragment")return e.isCubeTexture?`texture( ${t}, vec4( ${n}, ${i} ) )`:r?o?`textureOffset( ${t}, vec4( ${n}, ${r}, ${i} ), ${o} )`:`texture( ${t}, vec4( ${n}, ${r}, ${i} ) )`:o?`textureOffset( ${t}, vec3( ${n}, ${i} ), ${o} )`:`texture( ${t}, vec3( ${n}, ${i} ) )`;Ae(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${u} shader.`)}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const i of n)t.push(`${this.getVar(i.type,i.name,i.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],n=[],i={};for(const o of t){let u=null,c=!1;if(o.type==="texture"||o.type==="texture3D"){const f=o.node.value;let p="";(f.isDataTexture===!0||f.isData3DTexture===!0)&&(f.type===rn?p="u":f.type===Kn&&(p="i")),o.type==="texture3D"&&f.isArrayTexture===!1?u=`${p}sampler3D ${o.name};`:f.compareFunction?f.isArrayTexture===!0?u=`sampler2DArrayShadow ${o.name};`:u=`sampler2DShadow ${o.name};`:f.isArrayTexture===!0||f.isDataArrayTexture===!0||f.isCompressedArrayTexture===!0?u=`${p}sampler2DArray ${o.name};`:u=`${p}sampler2D ${o.name};`}else if(o.type==="cubeTexture")u=`samplerCube ${o.name};`;else if(o.type==="cubeDepthTexture")u=`samplerCubeShadow ${o.name};`;else if(o.type==="buffer"){const f=o.node,p=this.getType(f.bufferType),g=f.bufferCount,y=g>0?g:"";u=`${f.name} {
	${p} ${o.name}[${y}];
};
`}else u=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,c=!0;const d=o.node.precision;if(d!==null&&(u=see[d]+" "+u),c){u="	"+u;const f=o.groupNode.name;(i[f]||(i[f]=[])).push(u)}else u="uniform "+u,n.push(u)}let r="";for(const o in i){const u=i[o];r+=this._getGLSLUniformStruct(e+"_"+o,u.join(`
`))+`
`}return r+=n.join(`
`),r}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Kn){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const i=n.array;i instanceof Uint32Array||i instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let i=0;for(const r of n)t+=`layout( location = ${i++} ) in ${r.type} ${r.name};
`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`	${n.type} ${n.name};`);return t.join(`
`)}getStructs(e){const t=[],n=this.structs[e],i=[];for(const r of n)if(r.output)for(const o of r.members)i.push(`layout( location = ${o.index} ) out ${o.type} ${o.name};`);else{let o="struct "+r.name+` {
`;o+=this.getStructMembers(r),o+=`
};
`,t.push(o)}return i.length===0&&i.push("layout( location = 0 ) out vec4 fragColor;"),`
`+i.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const i of n){e==="compute"&&(i.needsInterpolation=!0);const r=this.getType(i.type);if(i.needsInterpolation)if(i.interpolationType){const o=UR[i.interpolationType]||i.interpolationType,u=zR[i.interpolationSampling]||"";t+=`${o} ${u} out ${r} ${i.name};
`}else{const o=r.includes("int")||r.includes("uv")||r.includes("iv")?"flat ":"";t+=`${o}out ${r} ${i.name};
`}else t+=`${r} ${i.name};
`}else if(e==="fragment"){for(const i of n)if(i.needsInterpolation){const r=this.getType(i.type);if(i.interpolationType){const o=UR[i.interpolationType]||i.interpolationType,u=zR[i.interpolationSampling]||"";t+=`${o} ${u} in ${r} ${i.name};
`}else{const o=r.includes("int")||r.includes("uv")||r.includes("iv")?"flat ":"";t+=`${o}in ${r} ${i.name};
`}}}for(const i of this.builtins[e])t+=`${i};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((n,i)=>n*i,1)}u`}getSubgroupSize(){Ae("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){Ae("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){Ae("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,n=this.shaderStage){const i=this.extensions[n]||(this.extensions[n]=new Map);i.has(e)===!1&&i.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const i=this.renderer.backend.extensions;this.object.isBatchedMesh&&i.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:i,behavior:r}of n.values())t.push(`#extension ${i} : ${r}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=OR[e];if(t===void 0){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance";break}if(n!==void 0){const i=this.renderer.backend.extensions;i.has(n)&&(i.get(n),t=!0)}OR[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const i=e[n],r=this.getPropertyName(i.attributeNode);r&&(t+=`${i.varyingName} = ${r};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${VR}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${VR}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n=`// code

`;n+=this.flowCode[t];const i=this.flowNodes[t],r=i[i.length-1];for(const u of i){const c=this.getFlowData(u),d=u.name;d&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${d}
	`),n+=`${c.code}
	`,u===r&&t!=="compute"&&(n+=`// result
	`,t==="vertex"?(n+="gl_Position = ",n+=`${c.result};`):t==="fragment"&&(u.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${c.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n,i=null){const r=super.getUniformFromNode(e,t,n,i),o=this.getDataFromNode(e,n,this.globalCache);let u=o.uniformGPU;if(u===void 0){const c=e.groupNode,d=c.name,f=this.getBindGroupArray(d,n);if(t==="texture")u=new ky(r.name,r.node,c),f.push(u);else if(t==="cubeTexture"||t==="cubeDepthTexture")u=new AU(r.name,r.node,c),f.push(u);else if(t==="texture3D")u=new bv(r.name,r.node,c),f.push(u);else if(t==="buffer"){r.name=`buffer${e.id}`;const p=this.getSharedDataFromNode(e);let g=p.buffer;g===void 0&&(e.name=`NodeBuffer_${e.id}`,g=new wU(e,c),g.name=e.name,p.buffer=g),f.push(g),u=g}else{const p=this.uniformGroups[n]||(this.uniformGroups[n]={});let g=p[d];g===void 0&&(g=new MU(n+"_"+d,c),p[d]=g,f.push(g)),u=this.getNodeUniform(r,t),g.addUniform(u)}o.uniformGPU=u}return r}}let v_=null,mc=null;class EU{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[yr.RENDER]:null,[yr.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),n=this.renderer.info.frame;let i;e.isComputeNode===!0?i="c:"+this.renderer.info.compute.frameCalls:i="r:"+this.renderer.info.render.frameCalls,t.timestampUID=i+":"+e.id+":f"+n}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?yr.COMPUTE:yr.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){$t("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t)return;const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return v_=v_||new Ge,this.renderer.getDrawingBufferSize(v_)}setScissorTest(){}getClearColor(){const e=this.renderer;return mc=mc||new AS,e.getClearColor(mc),mc.getRGB(mc),mc}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:e9(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Cf} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}deleteBindGroupData(){}dispose(){}}let ree=0;class aee{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class oee{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:i}=n,r=e.array,o=e.usage||i.STATIC_DRAW,u=e.isInterleavedBufferAttribute?e.data:e,c=n.get(u);let d=c.bufferGPU;d===void 0&&(d=this._createBuffer(i,t,r,o),c.bufferGPU=d,c.bufferType=t,c.version=u.version);let f;if(r instanceof Float32Array)f=i.FLOAT;else if(typeof Float16Array<"u"&&r instanceof Float16Array)f=i.HALF_FLOAT;else if(r instanceof Uint16Array)e.isFloat16BufferAttribute?f=i.HALF_FLOAT:f=i.UNSIGNED_SHORT;else if(r instanceof Int16Array)f=i.SHORT;else if(r instanceof Uint32Array)f=i.UNSIGNED_INT;else if(r instanceof Int32Array)f=i.INT;else if(r instanceof Int8Array)f=i.BYTE;else if(r instanceof Uint8Array)f=i.UNSIGNED_BYTE;else if(r instanceof Uint8ClampedArray)f=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+r);let p={bufferGPU:d,bufferType:t,type:f,byteLength:r.byteLength,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:f===i.INT||f===i.UNSIGNED_INT||e.gpuType===Kn,id:ree++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const g=this._createBuffer(i,t,r,o);p=new aee(p,g)}n.set(e,p)}updateAttribute(e){const t=this.backend,{gl:n}=t,i=e.array,r=e.isInterleavedBufferAttribute?e.data:e,o=t.get(r),u=o.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(u,o.bufferGPU),c.length===0)n.bufferSubData(u,0,i);else{for(let d=0,f=c.length;d<f;d++){const p=c[d];n.bufferSubData(u,p.start*i.BYTES_PER_ELEMENT,i,p.start,p.count)}r.clearUpdateRanges()}n.bindBuffer(u,null),o.version=r.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const i=t.get(e);n.deleteBuffer(i.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,i=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:r}=t.get(i),o=e.array,u=o.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,r);const c=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.bufferData(n.COPY_WRITE_BUFFER,u,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,u),await t.utils._clientWaitAsync();const d=new e.array.constructor(o.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,d),n.deleteBuffer(c),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),d.buffer}_createBuffer(e,t,n,i){const r=e.createBuffer();return e.bindBuffer(t,r),e.bufferData(t,n,i),e.bindBuffer(t,null),r}}let T_,Md;class lee{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;T_={[Pi]:e.FUNC_ADD,[sD]:e.FUNC_SUBTRACT,[iD]:e.FUNC_REVERSE_SUBTRACT},Md={[Mo]:e.ZERO,[rD]:e.ONE,[aD]:e.SRC_COLOR,[Ig]:e.SRC_ALPHA,[dD]:e.SRC_ALPHA_SATURATE,[cD]:e.DST_COLOR,[lD]:e.DST_ALPHA,[oD]:e.ONE_MINUS_SRC_COLOR,[kg]:e.ONE_MINUS_SRC_ALPHA,[hD]:e.ONE_MINUS_DST_COLOR,[uD]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=new yt().fromArray(t),this.currentViewport=new yt().fromArray(n),this._tempVec4=new yt}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==b8?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===_8?t.cullFace(t.BACK):e===v8?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setMRTBlending(e){const t=this.gl,n=this.backend.drawBuffersIndexedExt;if(n)for(let i=1;i<e.length;i++)n.blendFuncSeparateiOES(i,t.ONE,t.ZERO,t.ONE,t.ZERO)}setBlending(e,t,n,i,r,o,u,c){const{gl:d}=this;if(e===Xc){this.currentBlendingEnabled===!0&&(this.disable(d.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(d.BLEND),this.currentBlendingEnabled=!0),e!==Ud){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==Pi||this.currentBlendEquationAlpha!==Pi)&&(d.blendEquation(d.FUNC_ADD),this.currentBlendEquation=Pi,this.currentBlendEquationAlpha=Pi),c)switch(e){case ya:d.blendFuncSeparate(d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case zg:d.blendFunc(d.ONE,d.ONE);break;case Vg:d.blendFuncSeparate(d.ZERO,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);break;case Pg:d.blendFuncSeparate(d.DST_COLOR,d.ONE_MINUS_SRC_ALPHA,d.ZERO,d.ONE);break;default:Ae("WebGLState: Invalid blending: ",e);break}else switch(e){case ya:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case zg:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE,d.ONE,d.ONE);break;case Vg:Ae("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Pg:Ae("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Ae("WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}r=r||t,o=o||n,u=u||i,(t!==this.currentBlendEquation||r!==this.currentBlendEquationAlpha)&&(d.blendEquationSeparate(T_[t],T_[r]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=r),(n!==this.currentBlendSrc||i!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||u!==this.currentBlendDstAlpha)&&(d.blendFuncSeparate(Md[n],Md[i],Md[o],Md[u]),this.currentBlendSrc=n,this.currentBlendDst=i,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=u),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case fD:t.depthFunc(t.NEVER);break;case pD:t.depthFunc(t.ALWAYS);break;case mD:t.depthFunc(t.LESS);break;case Gg:t.depthFunc(t.LEQUAL);break;case gD:t.depthFunc(t.EQUAL);break;case yD:t.depthFunc(t.GEQUAL);break;case xD:t.depthFunc(t.GREATER);break;case bD:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,i){const r=this._tempVec4.set(e,t,n,i);if(this.currentScissor.equals(r)===!1){const{gl:o}=this;o.scissor(r.x,r.y,r.z,r.w),this.currentScissor.copy(r)}}viewport(e,t,n,i){const r=this._tempVec4.set(e,t,n,i);if(this.currentViewport.equals(r)===!1){const{gl:o}=this;o.viewport(r.x,r.y,r.z,r.w),this.currentViewport.copy(r)}}setScissorTest(e){const t=this.gl;e?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:i}=this;e.side===ql?this.disable(i.CULL_FACE):this.enable(i.CULL_FACE);let r=e.side===ns;t&&(r=!r),this.setFlipSided(r),e.blending===ya&&e.transparent===!1?this.setBlending(Xc):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(i.SAMPLE_ALPHA_TO_COVERAGE):this.disable(i.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let c=0;c<8;c++)c<n?this.enable(12288+c):this.disable(12288+c)}setPolygonOffset(e,t,n){const{gl:i}=this;e?(this.enable(i.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==n)&&(i.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(i.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const n=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(n.bindVertexArray(e),t!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:i}=this;return i[e]!==t?(n.bindFramebuffer(e,t),i[e]=t,e===n.DRAW_FRAMEBUFFER&&(i[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(i[n.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:n}=this;let i=[],r=!1;if(e.textures!==null){i=this.currentDrawbuffers.get(t),i===void 0&&(i=[],this.currentDrawbuffers.set(t,i));const o=e.textures;if(i.length!==o.length||i[0]!==n.COLOR_ATTACHMENT0){for(let u=0,c=o.length;u<c;u++)i[u]=n.COLOR_ATTACHMENT0+u;i.length=o.length,r=!0}}else i[0]!==n.BACK&&(i[0]=n.BACK,r=!0);r&&n.drawBuffers(i)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:i}=this;e===void 0&&(e=t.TEXTURE0+i-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:i,currentTextureSlot:r,currentBoundTextures:o,maxTextures:u}=this;n===void 0&&(r===null?n=i.TEXTURE0+u-1:n=r);let c=o[n];c===void 0&&(c={type:void 0,texture:void 0},o[n]=c),(c.type!==e||c.texture!==t)&&(r!==n&&(i.activeTexture(n),this.currentTextureSlot=n),i.bindTexture(e,t),c.type=e,c.texture=t)}bindBufferBase(e,t,n){const{gl:i}=this,r=`${e}-${t}`;return this.currentBoundBufferBases[r]!==n?(i.bindBufferBase(e,t,n),this.currentBoundBufferBases[r]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,i=n[t];i!==void 0&&i.type!==void 0&&(e.bindTexture(i.type,null),i.type=void 0,i.texture=void 0)}}class uee{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=ko){const{gl:n,extensions:i}=this;let r;const o=bt.getTransfer(t);if(e===es)return n.UNSIGNED_BYTE;if(e===TD)return n.UNSIGNED_SHORT_4_4_4_4;if(e===SD)return n.UNSIGNED_SHORT_5_5_5_1;if(e===Qv)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===Kv)return n.UNSIGNED_INT_10F_11F_11F_REV;if(e===Cc)return n.BYTE;if(e===Dc)return n.SHORT;if(e===Vl)return n.UNSIGNED_SHORT;if(e===Kn)return n.INT;if(e===rn)return n.UNSIGNED_INT;if(e===Ns)return n.FLOAT;if(e===Gn)return n.HALF_FLOAT;if(e===wD)return n.ALPHA;if(e===K0)return n.RGB;if(e===Zs)return n.RGBA;if(e===Hi)return n.DEPTH_COMPONENT;if(e===ba)return n.DEPTH_STENCIL;if(e===J0)return n.RED;if(e===ey)return n.RED_INTEGER;if(e===gr)return n.RG;if(e===ty)return n.RG_INTEGER;if(e===ny)return n.RGBA_INTEGER;if(e===zd||e===Vd||e===Pd||e===Id)if(o===Ke)if(r=i.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(e===zd)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===Vd)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===Pd)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===Id)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=i.get("WEBGL_compressed_texture_s3tc"),r!==null){if(e===zd)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Vd)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Pd)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Id)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===j_||e===q_||e===W_||e===X_)if(r=i.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(e===j_)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===q_)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===W_)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===X_)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===Hg||e===jg||e===qg||e===Wg||e===Xg||e===df||e===Yg)if(r=i.get("WEBGL_compressed_texture_etc"),r!==null){if(e===Hg||e===jg)return o===Ke?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(e===qg)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC;if(e===Wg)return r.COMPRESSED_R11_EAC;if(e===Xg)return r.COMPRESSED_SIGNED_R11_EAC;if(e===df)return r.COMPRESSED_RG11_EAC;if(e===Yg)return r.COMPRESSED_SIGNED_RG11_EAC}else return null;if(e===Zg||e===Qg||e===Kg||e===Jg||e===e0||e===t0||e===n0||e===s0||e===i0||e===r0||e===a0||e===o0||e===l0||e===u0)if(r=i.get("WEBGL_compressed_texture_astc"),r!==null){if(e===Zg)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Qg)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Kg)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Jg)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===e0)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===t0)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===n0)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===s0)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===i0)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===r0)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===a0)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===o0)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===l0)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===u0)return o===Ke?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===c0)if(r=i.get("EXT_texture_compression_bptc"),r!==null){if(e===c0)return o===Ke?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===h0||e===d0||e===ff||e===f0)if(r=i.get("EXT_texture_compression_rgtc"),r!==null){if(e===h0)return r.COMPRESSED_RED_RGTC1_EXT;if(e===d0)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===ff)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===f0)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===Vo?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,i)=>{function r(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),i();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(r);return}e.deleteSync(t),n()}r()})}}let PR=!1,ig,S_,IR;class cee{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,PR===!1&&(this._init(),PR=!0)}_init(){const e=this.gl;ig={[Io]:e.REPEAT,[mr]:e.CLAMP_TO_EDGE,[Zc]:e.MIRRORED_REPEAT},S_={[hn]:e.NEAREST,[vD]:e.NEAREST_MIPMAP_NEAREST,[hf]:e.NEAREST_MIPMAP_LINEAR,[ms]:e.LINEAR,[H_]:e.LINEAR_MIPMAP_NEAREST,[xa]:e.LINEAR_MIPMAP_LINEAR},IR={[ND]:e.NEVER,[BD]:e.ALWAYS,[sy]:e.LESS,[ED]:e.LEQUAL,[AD]:e.EQUAL,[DD]:e.GEQUAL,[RD]:e.GREATER,[CD]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return e.isCubeTexture===!0?n=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=t.TEXTURE_3D:n=t.TEXTURE_2D,n}getInternalFormat(e,t,n,i,r=!1){const{gl:o,extensions:u}=this;if(e!==null){if(o[e]!==void 0)return o[e];Ne("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=t;if(t===o.RED&&(n===o.FLOAT&&(c=o.R32F),n===o.HALF_FLOAT&&(c=o.R16F),n===o.UNSIGNED_BYTE&&(c=o.R8),n===o.UNSIGNED_SHORT&&(c=o.R16),n===o.UNSIGNED_INT&&(c=o.R32UI),n===o.BYTE&&(c=o.R8I),n===o.SHORT&&(c=o.R16I),n===o.INT&&(c=o.R32I)),t===o.RED_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.R8UI),n===o.UNSIGNED_SHORT&&(c=o.R16UI),n===o.UNSIGNED_INT&&(c=o.R32UI),n===o.BYTE&&(c=o.R8I),n===o.SHORT&&(c=o.R16I),n===o.INT&&(c=o.R32I)),t===o.RG&&(n===o.FLOAT&&(c=o.RG32F),n===o.HALF_FLOAT&&(c=o.RG16F),n===o.UNSIGNED_BYTE&&(c=o.RG8),n===o.UNSIGNED_SHORT&&(c=o.RG16),n===o.UNSIGNED_INT&&(c=o.RG32UI),n===o.BYTE&&(c=o.RG8I),n===o.SHORT&&(c=o.RG16I),n===o.INT&&(c=o.RG32I)),t===o.RG_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RG8UI),n===o.UNSIGNED_SHORT&&(c=o.RG16UI),n===o.UNSIGNED_INT&&(c=o.RG32UI),n===o.BYTE&&(c=o.RG8I),n===o.SHORT&&(c=o.RG16I),n===o.INT&&(c=o.RG32I)),t===o.RGB){const d=r?m0:bt.getTransfer(i);n===o.FLOAT&&(c=o.RGB32F),n===o.HALF_FLOAT&&(c=o.RGB16F),n===o.UNSIGNED_BYTE&&(c=o.RGB8),n===o.UNSIGNED_SHORT&&(c=o.RGB16),n===o.UNSIGNED_INT&&(c=o.RGB32UI),n===o.BYTE&&(c=o.RGB8I),n===o.SHORT&&(c=o.RGB16I),n===o.INT&&(c=o.RGB32I),n===o.UNSIGNED_BYTE&&(c=d===Ke?o.SRGB8:o.RGB8),n===o.UNSIGNED_SHORT_5_6_5&&(c=o.RGB565),n===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1),n===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGB4),n===o.UNSIGNED_INT_5_9_9_9_REV&&(c=o.RGB9_E5),n===o.UNSIGNED_INT_10F_11F_11F_REV&&(c=o.R11F_G11F_B10F)}if(t===o.RGB_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RGB8UI),n===o.UNSIGNED_SHORT&&(c=o.RGB16UI),n===o.UNSIGNED_INT&&(c=o.RGB32UI),n===o.BYTE&&(c=o.RGB8I),n===o.SHORT&&(c=o.RGB16I),n===o.INT&&(c=o.RGB32I)),t===o.RGBA){const d=r?m0:bt.getTransfer(i);n===o.FLOAT&&(c=o.RGBA32F),n===o.HALF_FLOAT&&(c=o.RGBA16F),n===o.UNSIGNED_BYTE&&(c=o.RGBA8),n===o.UNSIGNED_SHORT&&(c=o.RGBA16),n===o.UNSIGNED_INT&&(c=o.RGBA32UI),n===o.BYTE&&(c=o.RGBA8I),n===o.SHORT&&(c=o.RGBA16I),n===o.INT&&(c=o.RGBA32I),n===o.UNSIGNED_BYTE&&(c=d===Ke?o.SRGB8_ALPHA8:o.RGBA8),n===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGBA4),n===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1)}return t===o.RGBA_INTEGER&&(n===o.UNSIGNED_BYTE&&(c=o.RGBA8UI),n===o.UNSIGNED_SHORT&&(c=o.RGBA16UI),n===o.UNSIGNED_INT&&(c=o.RGBA32UI),n===o.BYTE&&(c=o.RGBA8I),n===o.SHORT&&(c=o.RGBA16I),n===o.INT&&(c=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(n===o.UNSIGNED_SHORT&&(c=o.DEPTH_COMPONENT16),n===o.UNSIGNED_INT&&(c=o.DEPTH_COMPONENT24),n===o.FLOAT&&(c=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&n===o.UNSIGNED_INT_24_8&&(c=o.DEPTH24_STENCIL8),(c===o.R16F||c===o.R32F||c===o.RG16F||c===o.RG32F||c===o.RGBA16F||c===o.RGBA32F)&&u.get("EXT_color_buffer_float"),c}setTextureParameters(e,t){const{gl:n,extensions:i,backend:r}=this,o=bt.getPrimaries(bt.workingColorSpace),u=t.colorSpace===ko?null:bt.getPrimaries(t.colorSpace),c=t.colorSpace===ko||o===u?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,c),n.texParameteri(e,n.TEXTURE_WRAP_S,ig[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,ig[t.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||n.texParameteri(e,n.TEXTURE_WRAP_R,ig[t.wrapR])),n.texParameteri(e,n.TEXTURE_MAG_FILTER,S_[t.magFilter]);const d=t.mipmaps!==void 0&&t.mipmaps.length>0,f=t.minFilter===ms&&d?xa:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,S_[f]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,IR[t.compareFunction])),i.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===hn||t.minFilter!==hf&&t.minFilter!==xa||t.type===Ns&&i.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const p=i.get("EXT_texture_filter_anisotropic");n.texParameterf(e,p.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,r.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:i}=this,r=this.getGLTextureType(e);let o=i[r];o===void 0&&(o=t.createTexture(),n.state.bindTexture(r,o),t.texParameteri(r,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(r,t.TEXTURE_MAG_FILTER,t.NEAREST),i[r]=o),n.set(e,{textureGPU:o,glTextureType:r})}createTexture(e,t){const{gl:n,backend:i}=this,{levels:r,width:o,height:u,depth:c}=t,d=i.utils.convert(e.format,e.colorSpace),f=i.utils.convert(e.type),p=this.getInternalFormat(e.internalFormat,d,f,e.colorSpace,e.isVideoTexture),g=n.createTexture(),y=this.getGLTextureType(e);i.state.bindTexture(y,g),this.setTextureParameters(y,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,r,p,o,u,c):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,r,p,o,u,c):e.isVideoTexture||n.texStorage2D(y,r,p,o,u),i.set(e,{textureGPU:g,glTextureType:y,glFormat:d,glType:f,glInternalFormat:p})}copyBufferToTexture(e,t){const{gl:n,backend:i}=this,{textureGPU:r,glTextureType:o,glFormat:u,glType:c}=i.get(t),{width:d,height:f}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),i.state.bindTexture(o,r),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(o,0,0,0,d,f,u,c,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),i.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:i,height:r}=t,{textureGPU:o,glTextureType:u,glFormat:c,glType:d,glInternalFormat:f}=this.backend.get(e);if(!(e.isRenderTargetTexture||o===void 0))if(this.backend.state.bindTexture(u,o),this.setTextureParameters(u,e),e.isCompressedTexture){const p=e.mipmaps,g=t.image;for(let y=0;y<p.length;y++){const x=p[y];e.isCompressedArrayTexture?e.format!==n.RGBA?c!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,x.width,x.height,g.depth,c,x.data):Ne("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,x.width,x.height,g.depth,c,d,x.data):c!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,y,0,0,x.width,x.height,c,x.data):Ne("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const p=t.images,g=e.mipmaps;for(let y=0;y<6;y++){const x=rg(p[y]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+y,0,0,0,i,r,c,d,x);for(let v=0;v<g.length;v++){const S=g[v],w=rg(S.images[y]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+y,v+1,0,0,w.width,w.height,c,d,w)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const p=t.image;if(e.layerUpdates.size>0){const g=yH(p.width,p.height,e.format,e.type);for(const y of e.layerUpdates){const x=p.data.subarray(y*g/p.data.BYTES_PER_ELEMENT,(y+1)*g/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,y,p.width,p.height,1,c,d,x)}e.clearLayerUpdates()}else n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,c,d,p.data)}else if(e.isData3DTexture){const p=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,c,d,p.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(u,0,f,c,d,t.image);else{const p=e.mipmaps;if(p.length>0)for(let g=0,y=p.length;g<y;g++){const x=p[g],v=rg(x);n.texSubImage2D(u,g,0,0,x.width,x.height,c,d,v)}else{const g=rg(t.image);n.texSubImage2D(u,0,0,0,i,r,c,d,g)}}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:i,glTextureType:r}=n.get(e);n.state.bindTexture(r,i),t.generateMipmap(r)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const i=n.get(e);if(i.renderBufferStorageSetup=void 0,i.framebuffers){for(const r in i.framebuffers)t.deleteFramebuffer(i.framebuffers[r]);delete i.framebuffers}if(i.depthRenderbuffer&&(t.deleteRenderbuffer(i.depthRenderbuffer),delete i.depthRenderbuffer),i.stencilRenderbuffer&&(t.deleteRenderbuffer(i.stencilRenderbuffer),delete i.stencilRenderbuffer),i.msaaFrameBuffer&&(t.deleteFramebuffer(i.msaaFrameBuffer),delete i.msaaFrameBuffer),i.msaaRenderbuffers){for(let r=0;r<i.msaaRenderbuffers.length;r++)t.deleteRenderbuffer(i.msaaRenderbuffers[r]);delete i.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:n,backend:i}=this,{textureGPU:r,renderTarget:o}=i.get(e);this.deallocateRenderBuffers(o),t===!1&&n.deleteTexture(r),i.delete(e)}copyTextureToTexture(e,t,n=null,i=null,r=0,o=0){const{gl:u,backend:c}=this,{state:d}=this.backend,{textureGPU:f,glTextureType:p,glType:g,glFormat:y}=c.get(t);d.bindTexture(p,f);let x,v,S,w,M,T,A,C,D;const R=e.isCompressedTexture?e.mipmaps[o]:e.image;if(n!==null)x=n.max.x-n.min.x,v=n.max.y-n.min.y,S=n.isBox3?n.max.z-n.min.z:1,w=n.min.x,M=n.min.y,T=n.isBox3?n.min.z:0;else{const Y=Math.pow(2,-r);x=Math.floor(R.width*Y),v=Math.floor(R.height*Y),e.isDataArrayTexture||e.isArrayTexture?S=R.depth:e.isData3DTexture?S=Math.floor(R.depth*Y):S=1,w=0,M=0,T=0}i!==null?(A=i.x,C=i.y,D=i.z):(A=0,C=0,D=0),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,t.flipY),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),u.pixelStorei(u.UNPACK_ALIGNMENT,t.unpackAlignment);const B=u.getParameter(u.UNPACK_ROW_LENGTH),L=u.getParameter(u.UNPACK_IMAGE_HEIGHT),X=u.getParameter(u.UNPACK_SKIP_PIXELS),G=u.getParameter(u.UNPACK_SKIP_ROWS),j=u.getParameter(u.UNPACK_SKIP_IMAGES);u.pixelStorei(u.UNPACK_ROW_LENGTH,R.width),u.pixelStorei(u.UNPACK_IMAGE_HEIGHT,R.height),u.pixelStorei(u.UNPACK_SKIP_PIXELS,w),u.pixelStorei(u.UNPACK_SKIP_ROWS,M),u.pixelStorei(u.UNPACK_SKIP_IMAGES,T);const ee=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,P=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const Y=c.get(e),F=c.get(t),k=c.get(Y.renderTarget),I=c.get(F.renderTarget),$=k.framebuffers[Y.cacheKey],re=I.framebuffers[F.cacheKey];d.bindFramebuffer(u.READ_FRAMEBUFFER,$),d.bindFramebuffer(u.DRAW_FRAMEBUFFER,re);for(let V=0;V<S;V++)ee&&(u.framebufferTextureLayer(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,Y.textureGPU,r,T+V),u.framebufferTextureLayer(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0,f,o,D+V)),u.blitFramebuffer(w,M,x,v,A,C,x,v,u.DEPTH_BUFFER_BIT,u.NEAREST);d.bindFramebuffer(u.READ_FRAMEBUFFER,null),d.bindFramebuffer(u.DRAW_FRAMEBUFFER,null)}else if(r!==0||e.isRenderTargetTexture||c.has(e)){const Y=c.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=u.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=u.createFramebuffer()),d.bindFramebuffer(u.READ_FRAMEBUFFER,this._srcFramebuffer),d.bindFramebuffer(u.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let F=0;F<S;F++)ee?u.framebufferTextureLayer(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,Y.textureGPU,r,T+F):u.framebufferTexture2D(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,Y.textureGPU,r),P?u.framebufferTextureLayer(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0,f,o,D+F):u.framebufferTexture2D(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,f,o),r!==0?u.blitFramebuffer(w,M,x,v,A,C,x,v,u.COLOR_BUFFER_BIT,u.NEAREST):P?u.copyTexSubImage3D(p,o,A,C,D+F,w,M,x,v):u.copyTexSubImage2D(p,o,A,C,w,M,x,v);d.bindFramebuffer(u.READ_FRAMEBUFFER,null),d.bindFramebuffer(u.DRAW_FRAMEBUFFER,null)}else P?e.isDataTexture||e.isData3DTexture?u.texSubImage3D(p,o,A,C,D,x,v,S,y,g,R.data):t.isCompressedArrayTexture?u.compressedTexSubImage3D(p,o,A,C,D,x,v,S,y,R.data):u.texSubImage3D(p,o,A,C,D,x,v,S,y,g,R):e.isDataTexture?u.texSubImage2D(u.TEXTURE_2D,o,A,C,x,v,y,g,R.data):e.isCompressedTexture?u.compressedTexSubImage2D(u.TEXTURE_2D,o,A,C,R.width,R.height,y,R.data):u.texSubImage2D(u.TEXTURE_2D,o,A,C,x,v,y,g,R);u.pixelStorei(u.UNPACK_ROW_LENGTH,B),u.pixelStorei(u.UNPACK_IMAGE_HEIGHT,L),u.pixelStorei(u.UNPACK_SKIP_PIXELS,X),u.pixelStorei(u.UNPACK_SKIP_ROWS,G),u.pixelStorei(u.UNPACK_SKIP_IMAGES,j),o===0&&t.generateMipmaps&&u.generateMipmap(p),d.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:i}=this,{state:r}=this.backend,{textureGPU:o}=this.backend.get(e),{x:u,y:c,z:d,w:f}=n,p=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,g=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(p){const y=u!==0||c!==0;let x,v;if(e.isDepthTexture===!0?(x=i.DEPTH_BUFFER_BIT,v=i.DEPTH_ATTACHMENT,t.stencil&&(x|=i.STENCIL_BUFFER_BIT)):(x=i.COLOR_BUFFER_BIT,v=i.COLOR_ATTACHMENT0),y){const S=this.backend.get(t.renderTarget),w=S.framebuffers[t.getCacheKey()],M=S.msaaFrameBuffer;r.bindFramebuffer(i.DRAW_FRAMEBUFFER,w),r.bindFramebuffer(i.READ_FRAMEBUFFER,M);const T=g-c-f;i.blitFramebuffer(u,T,u+d,T+f,u,T,u+d,T+f,x,i.NEAREST),r.bindFramebuffer(i.READ_FRAMEBUFFER,w),r.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,u,T,d,f),r.unbindTexture()}else{const S=i.createFramebuffer();r.bindFramebuffer(i.DRAW_FRAMEBUFFER,S),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,v,i.TEXTURE_2D,o,0),i.blitFramebuffer(0,0,d,f,0,0,d,f,x,i.NEAREST),i.deleteFramebuffer(S)}}else r.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,u,g-f-c,d,f),r.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,i=!1){const{gl:r}=this,o=t.renderTarget,{depthTexture:u,depthBuffer:c,stencilBuffer:d,width:f,height:p}=o;if(r.bindRenderbuffer(r.RENDERBUFFER,e),c&&!d){let g=r.DEPTH_COMPONENT24;i===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(r.RENDERBUFFER,o.samples,g,f,p):n>0?(u&&u.isDepthTexture&&u.type===r.FLOAT&&(g=r.DEPTH_COMPONENT32F),r.renderbufferStorageMultisample(r.RENDERBUFFER,n,g,f,p)):r.renderbufferStorage(r.RENDERBUFFER,g,f,p),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e)}else c&&d&&(n>0?r.renderbufferStorageMultisample(r.RENDERBUFFER,n,r.DEPTH24_STENCIL8,f,p):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,f,p),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e));r.bindRenderbuffer(r.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,n,i,r,o){const{backend:u,gl:c}=this,{textureGPU:d,glFormat:f,glType:p}=this.backend.get(e),g=c.createFramebuffer();u.state.bindFramebuffer(c.READ_FRAMEBUFFER,g);const y=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+o:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,y,d,0);const x=this._getTypedArrayType(p),v=this._getBytesPerTexel(p,f),w=i*r*v,M=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,M),c.bufferData(c.PIXEL_PACK_BUFFER,w,c.STREAM_READ),c.readPixels(t,n,i,r,f,p,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await u.utils._clientWaitAsync();const T=new x(w/x.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,M),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,T),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),u.state.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.deleteFramebuffer(g),T}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let i=0;if(e===n.UNSIGNED_BYTE&&(i=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(i=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(i=4),t===n.RGBA)return i*4;if(t===n.RGB)return i*3;if(t===n.ALPHA)return i}dispose(){const{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}}function rg(s){return s.isDataTexture?s.image.data:typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas?s:s.data}class hee{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class dee{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const kR={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class fee{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:i,object:r,type:o,info:u,index:c}=this;c!==0?n.drawElements(i,t,o,e):n.drawArrays(i,e,t),u.update(r,t,1)}renderInstances(e,t,n){const{gl:i,mode:r,type:o,index:u,object:c,info:d}=this;n!==0&&(u!==0?i.drawElementsInstanced(r,t,o,e,n):i.drawArraysInstanced(r,e,t,n),d.update(c,t,n))}renderMultiDraw(e,t,n){const{extensions:i,mode:r,object:o,info:u}=this;if(n===0)return;const c=i.get("WEBGL_multi_draw");if(c===null)for(let d=0;d<n;d++)this.render(e[d],t[d]);else{this.index!==0?c.multiDrawElementsWEBGL(r,t,0,this.type,e,0,n):c.multiDrawArraysWEBGL(r,e,0,t,0,n);let d=0;for(let f=0;f<n;f++)d+=t[f];u.update(o,d,1)}}renderMultiDrawInstances(e,t,n,i){const{extensions:r,mode:o,object:u,info:c}=this;if(n===0)return;const d=r.get("WEBGL_multi_draw");if(d===null)for(let f=0;f<n;f++)this.renderInstances(e[f],t[f],i[f]);else{this.index!==0?d.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,i,0,n):d.multiDrawArraysInstancedWEBGL(o,e,0,t,0,i,0,n);let f=0;for(let p=0;p<n;p++)f+=t[p]*i[p];c.update(u,f,1)}}}class RU{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(Ne(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class pee extends RU{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){Ne("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let i=0;i<this.maxQueries;i++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return $t(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const n=this.queries[t];if(n)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(i){Ae("Error in beginQuery:",i),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(n){Ae("Error in endQuery:",n),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[r,o]of this.queryOffsets)if(this.queryStates.get(o)==="ended"){const c=this.queries[o];e.set(r,this.resolveQuery(c))}if(e.size===0)return this.lastValue;const t={},n=[];for(const[r,o]of e){const u=r.match(/^(.*):f(\d+)$/),c=parseInt(u[2]);n.includes(c)===!1&&n.push(c),t[c]===void 0&&(t[c]=0);const d=await o;this.timestamps.set(r,d),t[c]+=d}const i=t[n[n.length-1]];return this.lastValue=i,this.frames=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,i}catch(e){return Ae("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let n,i=!1;const r=()=>{n&&(clearTimeout(n),n=null)},o=c=>{i||(i=!0,r(),t(c))},u=()=>{if(this.isDisposed){o(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){o(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(u,1);return}const f=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(f)/1e6)}catch(c){Ae("Error checking query:",c),t(this.lastValue)}};u()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class GR extends EU{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},i=t.context!==void 0?t.context:e.domElement.getContext("webgl2",n);function r(o){o.preventDefault();const u={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(u)}this._onContextLost=r,e.domElement.addEventListener("webglcontextlost",r,!1),this.gl=i,this.extensions=new hee(this),this.capabilities=new dee(this),this.attributeUtils=new oee(this),this.textureUtils=new cee(this),this.bufferRenderer=new fee(this),this.state=new lee(this),this.utils=new uee(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this.drawBuffersIndexedExt=this.extensions.get("OES_draw_buffers_indexed")}get coordinateSystem(){return Qs}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){const i=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:i.RGBA8}),n!==null){const r=e.stencilBuffer?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:r}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&Ne("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new pee(this.gl,e,2048));const n=this.timestampQueryPool[e];n.allocateQueriesForContext(t)!==null&&n.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,n=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:r,height:o}=this.getDrawingBufferSize();t.viewport(0,0,r,o)}if(e.scissor){const{x:r,y:o,width:u,height:c}=e.scissorValue;t.scissor(r,e.height-c-o,u,c)}this.initTimestampQuery(yr.RENDER,this.getTimestampUID(e)),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const i=e.occlusionQueryCount;i>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(i),n.occlusionQueryObjects=new Array(i),n.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,i=this.get(e),r=i.previousContext;n.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>i.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const u=e.textures;if(u!==null)for(let c=0;c<u.length;c++){const d=u[c];d.generateMipmaps&&this.generateMipmaps(d)}if(this._currentContext=r,this._resolveRenderTarget(e),r!==null)if(this._setFramebuffer(r),r.viewport)this.updateViewport(r);else{const{width:c,height:d}=this.getDrawingBufferSize();n.viewport(0,0,c,d)}this.prepareTimestampBuffer(yr.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:i}=t;if(n&&i){const r=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const u=()=>{let c=0;for(let d=0;d<n.length;d++){const f=n[d];f!==null&&o.getQueryParameter(f,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(f,o.QUERY_RESULT)===0&&r.add(i[d]),n[d]=null,o.deleteQuery(f),c++)}c<n.length?requestAnimationFrame(u):t.occluded=r};u()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:i,width:r,height:o}=e.viewportValue;t.viewport(n,e.height-o-i,r,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,i=null,r=!0,o=!0){const{gl:u,renderer:c}=this;i===null&&(i={textures:null,clearColorValue:this.getClearColor()});let d=0;if(e&&(d|=u.COLOR_BUFFER_BIT),t&&(d|=u.DEPTH_BUFFER_BIT),n&&(d|=u.STENCIL_BUFFER_BIT),d!==0){let f;i.clearColorValue?f=i.clearColorValue:f=this.getClearColor();const p=c.getClearDepth(),g=c.getClearStencil();if(t&&this.state.setDepthMask(!0),i.textures===null)u.clearColor(f.r,f.g,f.b,f.a),u.clear(d);else{if(r&&this._setFramebuffer(i),e)for(let y=0;y<i.textures.length;y++)y===0?u.clearBufferfv(u.COLOR,y,[f.r,f.g,f.b,f.a]):u.clearBufferfv(u.COLOR,y,[0,0,0,1]);t&&n?u.clearBufferfi(u.DEPTH_STENCIL,0,p,g):t?u.clearBufferfv(u.DEPTH,0,[p]):n&&u.clearBufferiv(u.STENCIL,0,[g]),r&&o&&this._resolveRenderTarget(i)}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(yr.COMPUTE,this.getTimestampUID(e))}compute(e,t,n,i,r=null){const{state:o,gl:u}=this;this.discard===!1&&(o.enable(u.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:c,transformBuffers:d,attributes:f}=this.get(i),p=this._getVaoKey(f),g=this.vaoCache[p];g===void 0?this.vaoCache[p]=this._createVao(f):o.setVertexState(g),o.useProgram(c),this._bindUniforms(n);const y=this._getTransformFeedback(d);u.bindTransformFeedback(u.TRANSFORM_FEEDBACK,y),u.beginTransformFeedback(u.POINTS),r=r!==null?r:t.count,Array.isArray(r)?($t("WebGLBackend.compute(): The count parameter must be a single number, not an array."),r=r[0]):r&&typeof r=="object"&&r.isIndirectStorageBufferAttribute&&($t("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),r=t.count),f[0].isStorageInstancedBufferAttribute?u.drawArraysInstanced(u.POINTS,0,1,r):u.drawArrays(u.POINTS,0,r),u.endTransformFeedback(),u.bindTransformFeedback(u.TRANSFORM_FEEDBACK,null);for(let x=0;x<d.length;x++){const v=d[x];v.pbo&&this.has(v.pbo)&&this.textureUtils.copyBufferToTexture(v.transformBuffer,v.pbo),v.switchBuffers()}}finishCompute(e){const{state:t,gl:n}=this;this.discard=!1,t.disable(n.RASTERIZER_DISCARD),this.prepareTimestampBuffer(yr.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:n,material:i,context:r,hardwareClippingPlanes:o}=e,{programGPU:u}=this.get(n),{gl:c,state:d}=this,f=this.get(r),p=e.getDrawParameters();if(p===null)return;this._bindUniforms(e.getBindings());const g=t.isMesh&&t.matrixWorld.determinant()<0;d.setMaterial(i,g,o),r.textures!==null&&r.textures.length>1&&d.setMRTBlending(r.textures),d.useProgram(u);const y=e.getAttributes(),x=this.get(y);let v=x.vaoGPU;if(v===void 0){const B=this._getVaoKey(y);v=this.vaoCache[B],v===void 0&&(v=this._createVao(y),this.vaoCache[B]=v,x.vaoGPU=v)}const S=e.getIndex(),w=S!==null?this.get(S).bufferGPU:null;d.setVertexState(v,w);const M=f.lastOcclusionObject;if(M!==t&&M!==void 0){if(M!==null&&M.occlusionTest===!0&&(c.endQuery(c.ANY_SAMPLES_PASSED),f.occlusionQueryIndex++),t.occlusionTest===!0){const B=c.createQuery();c.beginQuery(c.ANY_SAMPLES_PASSED,B),f.occlusionQueries[f.occlusionQueryIndex]=B,f.occlusionQueryObjects[f.occlusionQueryIndex]=t}f.lastOcclusionObject=t}const T=this.bufferRenderer;t.isPoints?T.mode=c.POINTS:t.isLineSegments?T.mode=c.LINES:t.isLine?T.mode=c.LINE_STRIP:t.isLineLoop?T.mode=c.LINE_LOOP:i.wireframe===!0?(d.setLineWidth(i.wireframeLinewidth*this.renderer.getPixelRatio()),T.mode=c.LINES):T.mode=c.TRIANGLES;const{vertexCount:A,instanceCount:C}=p;let{firstVertex:D}=p;if(T.object=t,S!==null){D*=S.array.BYTES_PER_ELEMENT;const B=this.get(S);T.index=S.count,T.type=B.type}else T.index=0;const R=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?($t("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),T.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?T.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):$t("WebGLBackend: WEBGL_multi_draw not supported."):C>1?T.renderInstances(D,A,C):T.render(D,A)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const B=this.get(e.camera),L=e.camera.cameras,X=e.getBindingGroup("cameraIndex").bindings[0];if(B.indexesGPU===void 0||B.indexesGPU.length!==L.length){const F=new Uint32Array([0,0,0,0]),k=[];for(let I=0,$=L.length;I<$;I++){const re=c.createBuffer();F[0]=I,c.bindBuffer(c.UNIFORM_BUFFER,re),c.bufferData(c.UNIFORM_BUFFER,F,c.STATIC_DRAW),k.push(re)}B.indexesGPU=k}const G=this.get(X),j=this.renderer.getPixelRatio(),ee=this._currentContext.renderTarget,P=this._isRenderCameraDepthArray(this._currentContext),Y=this._currentContext.activeCubeFace;if(P){const F=this.get(ee.depthTexture);if(F.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){F.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:k}=ee;for(let I=0,$=L.length;I<$;I++)this.renderer._activeCubeFace=I,this._currentContext.activeCubeFace=I,this._setFramebuffer(this._currentContext),this.clear(!1,!0,k,this._currentContext,!1,!1);this.renderer._activeCubeFace=Y,this._currentContext.activeCubeFace=Y}}for(let F=0,k=L.length;F<k;F++){const I=L[F];if(t.layers.test(I.layers)){P&&(this.renderer._activeCubeFace=F,this._currentContext.activeCubeFace=F,this._setFramebuffer(this._currentContext));const $=I.viewport;if($!==void 0){const re=$.x*j,V=$.y*j,q=$.width*j,he=$.height*j;d.viewport(Math.floor(re),Math.floor(e.context.height-he-V),Math.floor(q),Math.floor(he))}d.bindBufferBase(c.UNIFORM_BUFFER,G.index,B.indexesGPU[F]),R()}this._currentContext.activeCubeFace=Y,this.renderer._activeCubeFace=Y}}else R()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,i,r,o){return this.textureUtils.copyTextureToBuffer(e,t,n,i,r,o)}updateSampler(){return""}createNodeBuilder(e,t){return new iee(e,t)}createProgram(e){const t=this.gl,{stage:n,code:i}=e,r=n==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(r,i),t.compileShader(r),this.set(e,{shaderGPU:r})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,i=e.pipeline,{fragmentProgram:r,vertexProgram:o}=i,u=n.createProgram(),c=this.get(r).shaderGPU,d=this.get(o).shaderGPU;if(n.attachShader(u,c),n.attachShader(u,d),n.linkProgram(u),this.set(i,{programGPU:u,fragmentShader:c,vertexShader:d}),t!==null&&this.parallel){const f=new Promise(p=>{const g=this.parallel,y=()=>{n.getProgramParameter(u,g.COMPLETION_STATUS_KHR)?(this._completeCompile(e,i),p()):requestAnimationFrame(y)};y()});t.push(f);return}this._completeCompile(e,i)}_handleSource(e,t){const n=e.split(`
`),i=[],r=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let u=r;u<o;u++){const c=u+1;i.push(`${c===t?">":" "} ${c}: ${n[u]}`)}return i.join(`
`)}_getShaderErrors(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),o=(e.getShaderInfoLog(t)||"").trim();if(i&&o==="")return"";const u=/ERROR: 0:(\d+)/.exec(o);if(u){const c=parseInt(u[1]);return n.toUpperCase()+`

`+o+`

`+this._handleSource(e.getShaderSource(t),c)}else return o}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const i=this.gl,o=(i.getProgramInfoLog(e)||"").trim();if(i.getProgramParameter(e,i.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(i,e,n,t);else{const u=this._getShaderErrors(i,n,"vertex"),c=this._getShaderErrors(i,t,"fragment");Ae("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(e,i.VALIDATE_STATUS)+`

Program Info Log: `+o+`
`+u+`
`+c)}else o!==""&&Ne("WebGLProgram: Program Info Log:",o)}}_completeCompile(e,t){const{state:n,gl:i}=this,r=this.get(t),{programGPU:o,fragmentShader:u,vertexShader:c}=r;i.getProgramParameter(o,i.LINK_STATUS)===!1&&this._logProgramError(o,u,c),n.useProgram(o);const d=e.getBindings();this._setupBindings(d,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:n,gl:i}=this,r={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(r);const{computeProgram:o}=e,u=i.createProgram(),c=this.get(r).shaderGPU,d=this.get(o).shaderGPU,f=o.transforms,p=[],g=[];for(let S=0;S<f.length;S++){const w=f[S];p.push(w.varyingName),g.push(w.attributeNode)}i.attachShader(u,c),i.attachShader(u,d),i.transformFeedbackVaryings(u,p,i.SEPARATE_ATTRIBS),i.linkProgram(u),i.getProgramParameter(u,i.LINK_STATUS)===!1&&this._logProgramError(u,c,d),n.useProgram(u),this._setupBindings(t,u);const y=o.attributes,x=[],v=[];for(let S=0;S<y.length;S++){const w=y[S].node.attribute;x.push(w),this.has(w)||this.attributeUtils.createAttribute(w,i.ARRAY_BUFFER)}for(let S=0;S<g.length;S++){const w=g[S].attribute;this.has(w)||this.attributeUtils.createAttribute(w,i.ARRAY_BUFFER);const M=this.get(w);v.push(M)}this.set(e,{programGPU:u,transformBuffers:v,attributes:x})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let n=0,i=0;for(const r of t){this.set(r,{textures:i,uniformBuffers:n});for(const o of r.bindings)o.isUniformBuffer&&n++,o.isSampledTexture&&i++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let i=n.uniformBuffers,r=n.textures;for(const o of e.bindings){const u=this.get(o);if(o.isUniformsGroup||o.isUniformBuffer){const c=o.buffer;let{bufferGPU:d}=this.get(c);d===void 0?(d=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,d),t.bufferData(t.UNIFORM_BUFFER,c.byteLength,t.DYNAMIC_DRAW),this.set(c,{bufferGPU:d})):t.bindBuffer(t.UNIFORM_BUFFER,d);const f=o.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,d),f.length===0)t.bufferData(t.UNIFORM_BUFFER,c,t.DYNAMIC_DRAW);else{const p=g0(c),g=p?1:c.BYTES_PER_ELEMENT;for(let y=0,x=f.length;y<x;y++){const v=f[y],S=v.start*g,w=v.count*g,M=S*(p?c.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,M,c,S,w)}}u.index=i++,u.bufferGPU=d,this.set(o,u)}else if(o.isSampledTexture){const{textureGPU:c,glTextureType:d}=this.get(o.texture);u.index=r++,u.textureGPU=c,u.glTextureType=d,this.set(o,u)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const i=this.get(e).bufferGPU,r=e.buffer,o=e.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,i),o.length===0)t.bufferData(t.UNIFORM_BUFFER,r,t.DYNAMIC_DRAW);else{const u=g0(r),c=u?1:r.BYTES_PER_ELEMENT;for(let d=0,f=o.length;d<f;d++){const p=o[d],g=p.start*c,y=p.count*c,x=g*(u?r.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,x,r,g,y)}}}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(kR).filter(i=>kR[i]===e),n=this.extensions;for(let i=0;i<t.length;i++)if(n.has(t[i]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,i=null,r=0,o=0){this.textureUtils.copyTextureToTexture(e,t,n,i,r,o)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let i=null;if(e.textures!==null){const r=e.renderTarget,o=this.get(r),{samples:u,depthBuffer:c,stencilBuffer:d}=r,f=r.isWebGLCubeRenderTarget===!0,p=r.isRenderTarget3D===!0,g=r.depth>1,y=r.isXRRenderTarget===!0,x=y===!0&&r._hasExternalTextures===!0;let v=o.msaaFrameBuffer,S=o.depthRenderbuffer;const w=this.extensions.get("WEBGL_multisampled_render_to_texture"),M=this.extensions.get("OVR_multiview2"),T=this._useMultisampledExtension(r),A=TO(e);let C;if(f?(o.cubeFramebuffers||(o.cubeFramebuffers={}),C=o.cubeFramebuffers[A]):y&&x===!1?C=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),C=o.framebuffers[A]),C===void 0){C=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,C);const D=e.textures,R=[];if(f){o.cubeFramebuffers[A]=C;const{textureGPU:L}=this.get(D[0]),X=this.renderer._activeCubeFace,G=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+X,L,G)}else{o.framebuffers[A]=C;for(let L=0;L<D.length;L++){const X=D[L],G=this.get(X);G.renderTarget=e.renderTarget,G.cacheKey=A;const j=t.COLOR_ATTACHMENT0+L;if(r.multiview)M.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,j,G.textureGPU,0,u,0,2);else if(p||g){const ee=this.renderer._activeCubeFace,P=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,j,G.textureGPU,P,ee)}else if(T)w.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,j,t.TEXTURE_2D,G.textureGPU,0,u);else{const ee=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,j,t.TEXTURE_2D,G.textureGPU,ee)}}}const B=d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(r._autoAllocateDepthBuffer===!0){const L=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(L,e,0,T),o.xrDepthRenderbuffer=L,R.push(d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,L),t.framebufferRenderbuffer(t.FRAMEBUFFER,B,t.RENDERBUFFER,L)}else if(e.depthTexture!==null){R.push(d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const L=this.get(e.depthTexture);if(L.renderTarget=e.renderTarget,L.cacheKey=A,r.multiview)M.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,B,L.textureGPU,0,u,0,2);else if(x&&T)w.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,B,t.TEXTURE_2D,L.textureGPU,0,u);else if(e.depthTexture.isArrayTexture){const X=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,B,L.textureGPU,0,X)}else if(e.depthTexture.isCubeTexture){const X=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,B,t.TEXTURE_CUBE_MAP_POSITIVE_X+X,L.textureGPU,0)}else t.framebufferTexture2D(t.FRAMEBUFFER,B,t.TEXTURE_2D,L.textureGPU,0)}o.depthInvalidationArray=R}else{if(this._isRenderCameraDepthArray(e)){n.bindFramebuffer(t.FRAMEBUFFER,C);const R=this.renderer._activeCubeFace,B=this.get(e.depthTexture),L=d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,L,B.textureGPU,0,R)}if((y||T||r.multiview)&&r._isOpaqueFramebuffer!==!0){n.bindFramebuffer(t.FRAMEBUFFER,C);const R=this.get(e.textures[0]);r.multiview?M.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,R.textureGPU,0,u,0,2):T?w.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,R.textureGPU,0,u):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,R.textureGPU,0);const B=d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(r._autoAllocateDepthBuffer===!0){const L=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,L),t.framebufferRenderbuffer(t.FRAMEBUFFER,B,t.RENDERBUFFER,L)}else{const L=this.get(e.depthTexture);r.multiview?M.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,B,L.textureGPU,0,u,0,2):T?w.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,B,t.TEXTURE_2D,L.textureGPU,0,u):t.framebufferTexture2D(t.FRAMEBUFFER,B,t.TEXTURE_2D,L.textureGPU,0)}}}if(u>0&&T===!1&&!r.multiview){if(v===void 0){const D=[];v=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,v);const R=[],B=e.textures;for(let L=0;L<B.length;L++){R[L]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,R[L]),D.push(t.COLOR_ATTACHMENT0+L);const X=e.textures[L],G=this.get(X);t.renderbufferStorageMultisample(t.RENDERBUFFER,u,G.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+L,t.RENDERBUFFER,R[L])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),o.msaaFrameBuffer=v,o.msaaRenderbuffers=R,c&&S===void 0){S=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(S,e,u),o.depthRenderbuffer=S;const L=d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;D.push(L)}o.invalidationArray=D}i=o.msaaFrameBuffer}else i=C;n.drawBuffers(e,C)}n.bindFramebuffer(t.FRAMEBUFFER,i)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){const i=this.get(e[n]);t+=":"+i.id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();t.bindVertexArray(n);for(let i=0;i<e.length;i++){const r=e[i],o=this.get(r);t.bindBuffer(t.ARRAY_BUFFER,o.bufferGPU),t.enableVertexAttribArray(i);let u,c;r.isInterleavedBufferAttribute===!0?(u=r.data.stride*o.bytesPerElement,c=r.offset*o.bytesPerElement):(u=0,c=0),o.isInteger?t.vertexAttribIPointer(i,r.itemSize,o.type,u,c):t.vertexAttribPointer(i,r.itemSize,o.type,r.normalized,u,c),r.isInstancedBufferAttribute&&!r.isInterleavedBufferAttribute?t.vertexAttribDivisor(i,r.meshPerAttribute):r.isInterleavedBufferAttribute&&r.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(i,r.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),n}_getTransformFeedback(e){let t="";for(let r=0;r<e.length;r++)t+=":"+e[r].id;let n=this.transformFeedbackCache[t];if(n!==void 0)return n;const{gl:i}=this;n=i.createTransformFeedback(),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,n);for(let r=0;r<e.length;r++){const o=e[r];i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,r,o.transformBuffer)}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const i of e)for(const r of i.bindings){const u=this.get(r).index;if(r.isUniformsGroup||r.isUniformBuffer){const c=n.getUniformBlockIndex(t,r.name);n.uniformBlockBinding(t,c,u)}else if(r.isSampledTexture){const c=n.getUniformLocation(t,r.name);n.uniform1i(c,u)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const i of e)for(const r of i.bindings){const o=this.get(r),u=o.index;r.isUniformsGroup||r.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,u,o.bufferGPU):r.isSampledTexture&&n.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+u)}}_resolveRenderTarget(e){const{gl:t,state:n}=this,i=e.renderTarget;if(e.textures!==null&&i){const r=this.get(i);if(i.samples>0&&this._useMultisampledExtension(i)===!1){const o=r.framebuffers[e.getCacheKey()];let u=t.COLOR_BUFFER_BIT;i.resolveDepthBuffer&&(i.depthBuffer&&(u|=t.DEPTH_BUFFER_BIT),i.stencilBuffer&&i.resolveStencilBuffer&&(u|=t.STENCIL_BUFFER_BIT));const c=r.msaaFrameBuffer,d=r.msaaRenderbuffers,f=e.textures,p=f.length>1;if(n.bindFramebuffer(t.READ_FRAMEBUFFER,c),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),p)for(let g=0;g<f.length;g++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+g,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+g,t.TEXTURE_2D,null,0);for(let g=0;g<f.length;g++){if(p){const{textureGPU:y}=this.get(f[g]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,d[g]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,y,0)}if(e.scissor){const{x:y,y:x,width:v,height:S}=e.scissorValue,w=e.height-S-x;t.blitFramebuffer(y,w,y+v,w+S,y,w,y+v,w+S,u,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,u,t.NEAREST)}if(p)for(let g=0;g<f.length;g++){const{textureGPU:y}=this.get(f[g]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+g,t.RENDERBUFFER,d[g]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+g,t.TEXTURE_2D,y,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,r.invalidationArray)}else if(i.resolveDepthBuffer===!1&&r.framebuffers){const o=r.framebuffers[e.getCacheKey()];n.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,r.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const wc={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},$l=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},kn={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},ls={Store:"store"},Mt={Load:"load",Clear:"clear"},$R={CCW:"ccw",CW:"cw"},HR={None:"none",Back:"back"},nh={Uint16:"uint16",Uint32:"uint32"},K={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},w_={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Ol={Linear:"linear",Nearest:"nearest"},ct={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Rl={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},jR={None:0,All:15},So={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},M_={Storage:"storage",ReadOnlyStorage:"read-only-storage"},N_={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},qR={NonFiltering:"non-filtering",Comparison:"comparison"},Cl={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},WR={TwoD:"2d",ThreeD:"3d"},Tn={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},mee={All:"all"},ag={Vertex:"vertex",Instance:"instance"},_v={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},XR={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class gee extends NU{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class yee extends TU{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let xee=0;class bee extends yee{constructor(e,t){super("StorageBuffer_"+xee++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:$n.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class _ee extends Xo{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Ol.Linear}),this.flipYSampler=e.createSampler({minFilter:Ol.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:i})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:wc.TriangleStrip,stripIndexFormat:nh.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:wc.TriangleStrip,stripIndexFormat:nh.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,n=0){const i=t.format,{width:r,height:o}=t.size,u=this.getTransferPipeline(i),c=this.getFlipYPipeline(i),d=this.device.createTexture({size:{width:r,height:o,depthOrArrayLayers:1},format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),f=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Tn.TwoD,baseArrayLayer:n}),p=d.createView({baseMipLevel:0,mipLevelCount:1,dimension:Tn.TwoD,baseArrayLayer:0}),g=this.device.createCommandEncoder({}),y=(x,v,S)=>{const w=x.getBindGroupLayout(0),M=this.device.createBindGroup({layout:w,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:v}]}),T=g.beginRenderPass({colorAttachments:[{view:S,loadOp:Mt.Clear,storeOp:ls.Store,clearValue:[0,0,0,0]}]});T.setPipeline(x),T.setBindGroup(0,M),T.draw(4,1,0,0),T.end()};y(u,f,p),y(c,p,f),this.device.queue.submit([g.finish()]),d.destroy()}generateMipmaps(e,t,n=0,i=null){const r=this.get(e);r.layers===void 0&&(r.layers=[]);const o=r.layers[n]||this._mipmapCreateBundles(e,t,n),u=i||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(u,o),i===null&&this.device.queue.submit([u.finish()]),r.layers[n]=o}_mipmapCreateBundles(e,t,n){const i=this.getTransferPipeline(t.format),r=i.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Tn.TwoD,baseArrayLayer:n});const u=[];for(let c=1;c<t.mipLevelCount;c++){const d=this.device.createBindGroup({layout:r,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),f=e.createView({baseMipLevel:c,mipLevelCount:1,dimension:Tn.TwoD,baseArrayLayer:n}),p={colorAttachments:[{view:f,loadOp:Mt.Clear,storeOp:ls.Store,clearValue:[0,0,0,0]}]},g=this.device.createRenderBundleEncoder({colorFormats:[t.format]});g.setPipeline(i),g.setBindGroup(0,d),g.draw(4,1,0,0),u.push({renderBundles:[g.finish()],passDescriptor:p}),o=f}return u}_mipmapRunBundles(e,t){const n=t.length;for(let i=0;i<n;i++){const r=t[i],o=e.beginRenderPass(r.passDescriptor);o.executeBundles(r.renderBundles),o.end()}}}const vee={[ND]:"never",[sy]:"less",[AD]:"equal",[ED]:"less-equal",[RD]:"greater",[DD]:"greater-equal",[BD]:"always",[CD]:"not-equal"},Tee=[0,1,3,2,4,5];class See{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,n=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let i=this._samplerCache.get(n);if(i===void 0){const o={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};o.magFilter===Ol.Linear&&o.minFilter===Ol.Linear&&o.mipmapFilter===Ol.Linear&&(o.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(o.compare=vee[e.compareFunction]),i={sampler:t.device.createSampler(o),usedTimes:0},this._samplerCache.set(n,i)}const r=t.get(e);if(r.sampler!==i.sampler){if(r.sampler!==void 0){const o=this._samplerCache.get(r.samplerKey);o.usedTimes--,o.usedTimes===0&&this._samplerCache.delete(r.samplerKey)}r.samplerKey=n,r.sampler=i.sampler,i.usedTimes++}return n}createDefaultTexture(e){let t;const n=vv(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){const n=this.backend,i=n.get(e);if(i.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){i.texture=e.sourceTexture,i.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:r,height:o,depth:u,levels:c}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const d=this._getDimension(e),f=e.internalFormat||t.format||vv(e,n.device);i.format=f;const{samples:p,primarySamples:g,isMSAA:y}=n.utils.getTextureSampleData(e);let x=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(x|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&f!==K.RGB9E5UFloat&&(x|=GPUTextureUsage.RENDER_ATTACHMENT);const v={label:e.name,size:{width:r,height:o,depthOrArrayLayers:u},mipLevelCount:c,sampleCount:g,dimension:d,format:f,usage:x};if(f===void 0){Ne("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}if(e.isCubeTexture&&(v.textureBindingViewDimension=Tn.Cube),i.texture=n.device.createTexture(v),y){const S=Object.assign({},v);S.label=S.label+"-msaa",S.sampleCount=p,S.mipLevelCount=1,i.msaaTexture=n.device.createTexture(S)}i.initialized=!0,i.textureDescriptorGPU=v}destroyTexture(e,t=!1){const n=this.backend,i=n.get(e);i.texture!==void 0&&t===!1&&i.texture.destroy(),i.msaaTexture!==void 0&&i.msaaTexture.destroy(),n.delete(e)}generateMipmaps(e,t=null){const n=this.backend.get(e);if(e.isCubeTexture)for(let i=0;i<6;i++)this._generateMipmaps(n.texture,n.textureDescriptorGPU,i,t);else{const i=e.image.depth||1;for(let r=0;r<i;r++)this._generateMipmaps(n.texture,n.textureDescriptorGPU,r,t)}}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:n,height:i}=e.getDrawingBufferSize(),r=e.renderer.currentSamples,o=t.colorTexture,u=e.get(o);if(o.width===n&&o.height===i&&o.samples===r)return u.texture;let c=u.texture;return c&&c.destroy(),c=e.device.createTexture({label:"colorBuffer",size:{width:n,height:i,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),o.source.width=n,o.source.height=i,o.samples=r,u.texture=c,c}getDepthBuffer(e=!0,t=!1){const n=this.backend,i=n.renderer.getCanvasTarget(),{width:r,height:o}=n.getDrawingBufferSize(),u=n.renderer.currentSamples,c=i.depthTexture;if(c.width===r&&c.height===o&&c.samples===u&&c.depth===e&&c.stencil===t)return n.get(c).texture;const d=n.get(c).texture;let f,p;if(t?(f=ba,p=Vo):e&&(f=Hi,p=rn),d!==void 0){if(c.image.width===r&&c.image.height===o&&c.format===f&&c.type===p&&c.samples===u)return d;this.destroyTexture(c)}return c.name="depthBuffer",c.format=f,c.type=p,c.image.width=r,c.image.height=o,c.samples=u,this.createTexture(c,{width:r,height:o}),n.get(c).texture}updateTexture(e,t){const n=this.backend.get(e),i=e.mipmaps,{textureDescriptorGPU:r}=n;if(!(e.isRenderTargetTexture||r===void 0)){if(e.isDataTexture)if(i.length>0)for(let o=0,u=i.length;o<u;o++){const c=i[o];this._copyBufferToTexture(c,n.texture,r,0,e.flipY,0,o)}else this._copyBufferToTexture(t.image,n.texture,r,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let o=0;o<t.image.depth;o++)this._copyBufferToTexture(t.image,n.texture,r,o,e.flipY,o);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,r);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,n.texture,r);else if(i.length>0)for(let o=0,u=i.length;o<u;o++){const c=i[o];this._copyImageToTexture(c,n.texture,r,0,e.flipY,e.premultiplyAlpha,o)}else this._copyImageToTexture(t.image,n.texture,r,0,e.flipY,e.premultiplyAlpha);n.version=e.version}}async copyTextureToBuffer(e,t,n,i,r,o){const u=this.backend.device,c=this.backend.get(e),d=c.texture,f=c.textureDescriptorGPU.format,p=this._getBytesPerTexel(f);let g=i*p;g=Math.ceil(g/256)*256;const y=u.createBuffer({size:(r-1)*g+i*p,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),x=u.createCommandEncoder();x.copyTextureToBuffer({texture:d,origin:{x:t,y:n,z:o}},{buffer:y,bytesPerRow:g},{width:i,height:r});const v=this._getTypedArrayType(f);u.queue.submit([x.finish()]),await y.mapAsync(GPUMapMode.READ);const S=y.getMappedRange();return new v(S)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new jn;n.minFilter=hn,n.magFilter=hn,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultCubeTexture[e];if(t===void 0){const n=new ry;n.minFilter=hn,n.magFilter=hn,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,n){const i=e.images,r=e.mipmaps;for(let o=0;o<6;o++){const u=i[o],c=e.flipY===!0?Tee[o]:o;u.isDataTexture?this._copyBufferToTexture(u.image,t,n,c,e.flipY):this._copyImageToTexture(u,t,n,c,e.flipY,e.premultiplyAlpha);for(let d=0;d<r.length;d++){const p=r[d].images[o];p.isDataTexture?this._copyBufferToTexture(p.image,t,n,c,e.flipY,0,d+1):this._copyImageToTexture(p,t,n,c,e.flipY,e.premultiplyAlpha,d+1)}}}_copyImageToTexture(e,t,n,i,r,o,u=0){const c=this.backend.device,d=u>0?e.width:n.size.width,f=u>0?e.height:n.size.height;try{c.queue.copyExternalImageToTexture({source:e,flipY:r},{texture:t,mipLevel:u,origin:{x:0,y:0,z:i},premultipliedAlpha:o},{width:d,height:f,depthOrArrayLayers:1})}catch{}}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new _ee(this.backend.device)),e}_generateMipmaps(e,t,n=0,i=null){this._getPassUtils().generateMipmaps(e,t,n,i)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,i,r,o=0,u=0){const c=this.backend.device,d=e.data,f=this._getBytesPerTexel(n.format),p=e.width*f;c.queue.writeTexture({texture:t,mipLevel:u,origin:{x:0,y:0,z:i}},d,{offset:e.width*e.height*f*o,bytesPerRow:p},{width:e.width,height:e.height,depthOrArrayLayers:1}),r===!0&&this._flipY(t,n,i)}_copyCompressedBufferToTexture(e,t,n){const i=this.backend.device,r=this._getBlockData(n.format),o=n.size.depthOrArrayLayers>1;for(let u=0;u<e.length;u++){const c=e[u],d=c.width,f=c.height,p=o?n.size.depthOrArrayLayers:1,g=Math.ceil(d/r.width)*r.byteLength,y=g*Math.ceil(f/r.height);for(let x=0;x<p;x++)i.queue.writeTexture({texture:t,mipLevel:u,origin:{x:0,y:0,z:x}},c.data,{offset:x*y,bytesPerRow:g,rowsPerImage:Math.ceil(f/r.height)},{width:Math.ceil(d/r.width)*r.width,height:Math.ceil(f/r.height)*r.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===K.BC1RGBAUnorm||e===K.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===K.BC2RGBAUnorm||e===K.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.BC3RGBAUnorm||e===K.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.BC4RUnorm||e===K.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===K.BC5RGUnorm||e===K.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===K.BC6HRGBUFloat||e===K.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===K.BC7RGBAUnorm||e===K.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.ETC2RGB8Unorm||e===K.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===K.ETC2RGB8A1Unorm||e===K.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===K.ETC2RGBA8Unorm||e===K.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===K.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===K.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===K.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===K.ASTC4x4Unorm||e===K.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.ASTC5x4Unorm||e===K.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===K.ASTC5x5Unorm||e===K.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===K.ASTC6x5Unorm||e===K.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===K.ASTC6x6Unorm||e===K.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===K.ASTC8x5Unorm||e===K.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===K.ASTC8x6Unorm||e===K.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===K.ASTC8x8Unorm||e===K.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===K.ASTC10x5Unorm||e===K.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===K.ASTC10x6Unorm||e===K.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===K.ASTC10x8Unorm||e===K.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===K.ASTC10x10Unorm||e===K.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===K.ASTC12x10Unorm||e===K.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===K.ASTC12x12Unorm||e===K.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=w_.ClampToEdge;return e===Io?t=w_.Repeat:e===Zc&&(t=w_.MirrorRepeat),t}_convertFilterMode(e){let t=Ol.Linear;return(e===hn||e===vD||e===hf)&&(t=Ol.Nearest),t}_getBytesPerTexel(e){if(e===K.R8Unorm||e===K.R8Snorm||e===K.R8Uint||e===K.R8Sint)return 1;if(e===K.R16Uint||e===K.R16Sint||e===K.R16Float||e===K.RG8Unorm||e===K.RG8Snorm||e===K.RG8Uint||e===K.RG8Sint)return 2;if(e===K.R32Uint||e===K.R32Sint||e===K.R32Float||e===K.RG16Uint||e===K.RG16Sint||e===K.RG16Float||e===K.RGBA8Unorm||e===K.RGBA8UnormSRGB||e===K.RGBA8Snorm||e===K.RGBA8Uint||e===K.RGBA8Sint||e===K.BGRA8Unorm||e===K.BGRA8UnormSRGB||e===K.RGB9E5UFloat||e===K.RGB10A2Unorm||e===K.RG11B10UFloat||e===K.Depth32Float||e===K.Depth24Plus||e===K.Depth24PlusStencil8||e===K.Depth32FloatStencil8)return 4;if(e===K.RG32Uint||e===K.RG32Sint||e===K.RG32Float||e===K.RGBA16Uint||e===K.RGBA16Sint||e===K.RGBA16Float)return 8;if(e===K.RGBA32Uint||e===K.RGBA32Sint||e===K.RGBA32Float)return 16}_getTypedArrayType(e){if(e===K.R8Uint)return Uint8Array;if(e===K.R8Sint)return Int8Array;if(e===K.R8Unorm)return Uint8Array;if(e===K.R8Snorm)return Int8Array;if(e===K.RG8Uint)return Uint8Array;if(e===K.RG8Sint)return Int8Array;if(e===K.RG8Unorm)return Uint8Array;if(e===K.RG8Snorm)return Int8Array;if(e===K.RGBA8Uint)return Uint8Array;if(e===K.RGBA8Sint)return Int8Array;if(e===K.RGBA8Unorm||e===K.RGBA8UnormSRGB)return Uint8Array;if(e===K.RGBA8Snorm)return Int8Array;if(e===K.R16Uint)return Uint16Array;if(e===K.R16Sint)return Int16Array;if(e===K.RG16Uint)return Uint16Array;if(e===K.RG16Sint)return Int16Array;if(e===K.RGBA16Uint)return Uint16Array;if(e===K.RGBA16Sint)return Int16Array;if(e===K.R16Float||e===K.RG16Float||e===K.RGBA16Float)return Uint16Array;if(e===K.R32Uint)return Uint32Array;if(e===K.R32Sint)return Int32Array;if(e===K.R32Float)return Float32Array;if(e===K.RG32Uint)return Uint32Array;if(e===K.RG32Sint)return Int32Array;if(e===K.RG32Float)return Float32Array;if(e===K.RGBA32Uint)return Uint32Array;if(e===K.RGBA32Sint)return Int32Array;if(e===K.RGBA32Float)return Float32Array;if(e===K.BGRA8Unorm||e===K.BGRA8UnormSRGB)return Uint8Array;if(e===K.RGB10A2Unorm||e===K.RGB9E5UFloat||e===K.RG11B10UFloat)return Uint32Array;if(e===K.Depth32Float)return Float32Array;if(e===K.Depth24Plus||e===K.Depth24PlusStencil8)return Uint32Array;if(e===K.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=WR.ThreeD:t=WR.TwoD,t}}function vv(s,e=null){const t=s.format,n=s.type,i=s.colorSpace,r=bt.getTransfer(i);let o;if(s.isCompressedTexture===!0||s.isCompressedArrayTexture===!0)switch(t){case zd:case Vd:o=r===Ke?K.BC1RGBAUnormSRGB:K.BC1RGBAUnorm;break;case Pd:o=r===Ke?K.BC2RGBAUnormSRGB:K.BC2RGBAUnorm;break;case Id:o=r===Ke?K.BC3RGBAUnormSRGB:K.BC3RGBAUnorm;break;case h0:o=K.BC4RUnorm;break;case d0:o=K.BC4RSnorm;break;case ff:o=K.BC5RGUnorm;break;case f0:o=K.BC5RGSnorm;break;case c0:o=r===Ke?K.BC7RGBAUnormSRGB:K.BC7RGBAUnorm;break;case jg:case Hg:o=r===Ke?K.ETC2RGB8UnormSRGB:K.ETC2RGB8Unorm;break;case qg:o=r===Ke?K.ETC2RGBA8UnormSRGB:K.ETC2RGBA8Unorm;break;case Wg:o=K.EACR11Unorm;break;case Xg:o=K.EACR11Snorm;break;case df:o=K.EACRG11Unorm;break;case Yg:o=K.EACRG11Snorm;break;case Zg:o=r===Ke?K.ASTC4x4UnormSRGB:K.ASTC4x4Unorm;break;case Qg:o=r===Ke?K.ASTC5x4UnormSRGB:K.ASTC5x4Unorm;break;case Kg:o=r===Ke?K.ASTC5x5UnormSRGB:K.ASTC5x5Unorm;break;case Jg:o=r===Ke?K.ASTC6x5UnormSRGB:K.ASTC6x5Unorm;break;case e0:o=r===Ke?K.ASTC6x6UnormSRGB:K.ASTC6x6Unorm;break;case t0:o=r===Ke?K.ASTC8x5UnormSRGB:K.ASTC8x5Unorm;break;case n0:o=r===Ke?K.ASTC8x6UnormSRGB:K.ASTC8x6Unorm;break;case s0:o=r===Ke?K.ASTC8x8UnormSRGB:K.ASTC8x8Unorm;break;case i0:o=r===Ke?K.ASTC10x5UnormSRGB:K.ASTC10x5Unorm;break;case r0:o=r===Ke?K.ASTC10x6UnormSRGB:K.ASTC10x6Unorm;break;case a0:o=r===Ke?K.ASTC10x8UnormSRGB:K.ASTC10x8Unorm;break;case o0:o=r===Ke?K.ASTC10x10UnormSRGB:K.ASTC10x10Unorm;break;case l0:o=r===Ke?K.ASTC12x10UnormSRGB:K.ASTC12x10Unorm;break;case u0:o=r===Ke?K.ASTC12x12UnormSRGB:K.ASTC12x12Unorm;break;case Zs:o=r===Ke?K.RGBA8UnormSRGB:K.RGBA8Unorm;break;default:Ae("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case Zs:switch(n){case Cc:o=K.RGBA8Snorm;break;case Dc:o=K.RGBA16Sint;break;case Vl:o=K.RGBA16Uint;break;case rn:o=K.RGBA32Uint;break;case Kn:o=K.RGBA32Sint;break;case es:o=r===Ke?K.RGBA8UnormSRGB:K.RGBA8Unorm;break;case Gn:o=K.RGBA16Float;break;case Ns:o=K.RGBA32Float;break;default:Ae("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case K0:switch(n){case Qv:o=K.RGB9E5UFloat;break;case Kv:o=K.RG11B10UFloat;break;default:Ae("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case J0:switch(n){case Cc:o=K.R8Snorm;break;case Dc:o=K.R16Sint;break;case Vl:o=K.R16Uint;break;case rn:o=K.R32Uint;break;case Kn:o=K.R32Sint;break;case es:o=K.R8Unorm;break;case Gn:o=K.R16Float;break;case Ns:o=K.R32Float;break;default:Ae("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case gr:switch(n){case Cc:o=K.RG8Snorm;break;case Dc:o=K.RG16Sint;break;case Vl:o=K.RG16Uint;break;case rn:o=K.RG32Uint;break;case Kn:o=K.RG32Sint;break;case es:o=K.RG8Unorm;break;case Gn:o=K.RG16Float;break;case Ns:o=K.RG32Float;break;default:Ae("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case Hi:switch(n){case Vl:o=K.Depth16Unorm;break;case rn:o=K.Depth24Plus;break;case Ns:o=K.Depth32Float;break;default:Ae("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case ba:switch(n){case Vo:o=K.Depth24PlusStencil8;break;case Ns:e&&e.features.has(_v.Depth32FloatStencil8)===!1&&Ae('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=K.Depth32FloatStencil8;break;default:Ae("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case ey:switch(n){case Kn:o=K.R32Sint;break;case rn:o=K.R32Uint;break;default:Ae("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case ty:switch(n){case Kn:o=K.RG32Sint;break;case rn:o=K.RG32Uint;break;default:Ae("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case ny:switch(n){case Kn:o=K.RGBA32Sint;break;case rn:o=K.RGBA32Uint;break;default:Ae("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:Ae("WebGPURenderer: Unsupported texture format.",t)}return o}const wee=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,Mee=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,YR={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},Nee=s=>{s=s.trim();const e=s.match(wee);if(e!==null&&e.length===4){const t=e[2],n=[];let i=null;for(;(i=Mee.exec(t))!==null;)n.push({name:i[1],type:i[2]});const r=[];for(let f=0;f<n.length;f++){const{name:p,type:g}=n[f];let y=g;y.startsWith("ptr")?y="pointer":(y.startsWith("texture")&&(y=g.split("<")[0]),y=YR[y]),r.push(new HS(y,p))}const o=s.substring(e[0].length),u=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:YR[u]||u,inputs:r,name:c,inputsCode:t,blockCode:o,outputType:u}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class Aee extends qS{constructor(e){const{type:t,inputs:n,name:i,inputsCode:r,blockCode:o,outputType:u}=Nee(e);super(t,n,i),this.inputsCode=r,this.blockCode=o,this.outputType=u}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class Eee extends bU{parseFunction(e){return new Aee(e)}}const Ree={[$n.READ_ONLY]:"read",[$n.WRITE_ONLY]:"write",[$n.READ_WRITE]:"read_write"},ZR={[Io]:"repeat",[mr]:"clamp",[Zc]:"mirror"},og={vertex:$l.VERTEX,fragment:$l.FRAGMENT,compute:$l.COMPUTE},QR={instance:!0,swizzleAssign:!1,storageBuffer:!0},Cee={"^^":"tsl_xor"},Dee={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},KR={},Nd={tsl_xor:new Fn("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Fn("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Fn("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Fn("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Fn("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Fn("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Fn("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Fn("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Fn("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Fn("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Fn("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Fn("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Fn(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},Bee={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>",floatpack_snorm_2x16:"pack2x16snorm",floatpack_unorm_2x16:"pack2x16unorm",floatpack_float16_2x16:"pack2x16float",floatunpack_snorm_2x16:"unpack2x16snorm",floatunpack_unorm_2x16:"unpack2x16unorm",floatunpack_float16_2x16:"unpack2x16float"};let CU="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(CU+=`diagnostic( off, derivative_uniformity );
`);class Lee extends xU{constructor(e,t){super(e,t,new Eee),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,n,i,r,o=this.shaderStage){return o==="fragment"?i?r?`textureSample( ${t}, ${t}_sampler, ${n}, ${i}, ${r} )`:`textureSample( ${t}, ${t}_sampler, ${n}, ${i} )`:r?`textureSample( ${t}, ${t}_sampler, ${n}, ${r} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this.generateTextureSampleLevel(e,t,n,"0",i)}generateTextureSampleLevel(e,t,n,i,r,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${i}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,o,i):this.generateTextureLod(e,t,n,r,o,i)}generateWrapFunction(e){const t=`tsl_coord_${ZR[e.wrapS]}S_${ZR[e.wrapT]}_${e.is3DTexture||e.isData3DTexture?"3d":"2d"}T`;let n=KR[t];if(n===void 0){const i=[],r=e.is3DTexture||e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${r} ) -> ${r} {

	return ${r}(
`;const u=(c,d)=>{c===Io?(i.push(Nd.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${d} )`):c===mr?(i.push(Nd.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${d} )`):c===Zc?(i.push(Nd.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${d} )`):(o+=`		coord.${d}`,Ne(`WebGPURenderer: Unsupported texture wrap type "${c}" for vertex shader.`))};u(e.wrapS,"x"),o+=`,
`,u(e.wrapT,"y"),(e.is3DTexture||e.isData3DTexture)&&(o+=`,
`,u(e.wrapR,"z")),o+=`
	);

}
`,KR[t]=n=new Fn(o,i)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const i=this.getDataFromNode(e,this.shaderStage,this.globalCache);i.dimensionsSnippet===void 0&&(i.dimensionsSnippet={});let r=i.dimensionsSnippet[n];if(i.dimensionsSnippet[n]===void 0){let o,u;const{primarySamples:c}=this.renderer.backend.utils.getTextureSampleData(e),d=c>1;e.is3DTexture||e.isData3DTexture?u="vec3<u32>":u="vec2<u32>",d||e.isStorageTexture?o=t:o=`${t}${n?`, u32( ${n} )`:""}`,r=new yg(new xg(`textureDimensions( ${o} )`,u)),i.dimensionsSnippet[n]=r,(e.isArrayTexture||e.isDataArrayTexture||e.is3DTexture||e.isData3DTexture)&&(i.arrayLayerCount=new yg(new xg(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(i.cubeFaceCount=new yg(new xg("6u","u32")))}return r.build(this)}generateFilteredTexture(e,t,n,i,r="0u"){this._include("biquadraticTexture");const o=this.generateWrapFunction(e),u=this.generateTextureDimension(e,t,r);return i&&(n=`${n} + vec2<f32>(${i}) / ${u}`),`tsl_biquadraticTexture( ${t}, ${o}( ${n} ), ${u}, u32( ${r} ) )`}generateTextureLod(e,t,n,i,r,o="0u"){const u=this.generateWrapFunction(e),c=this.generateTextureDimension(e,t,o),d=e.is3DTexture||e.isData3DTexture?"vec3":"vec2";r&&(n=`${n} + ${d}<f32>(${r}) / ${d}<f32>( ${c} )`);const f=`${d}<u32>( ${u}( ${n} ) * ${d}<f32>( ${c} ) )`;return this.generateTextureLoad(e,t,f,o,i,null)}generateTextureLoad(e,t,n,i,r,o){i===null&&(i="0u"),o&&(n=`${n} + ${o}`);let u;return r?u=`textureLoad( ${t}, ${n}, ${r}, u32( ${i} ) )`:(u=`textureLoad( ${t}, ${n}, u32( ${i} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(u+=".x")),u}generateTextureStore(e,t,n,i,r){let o;return i?o=`textureStore( ${t}, ${n}, ${i}, ${r} )`:o=`textureStore( ${t}, ${n}, ${r} )`,o}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===Ns||this.isSampleCompare(e)===!1&&e.minFilter===hn&&e.magFilter===hn||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,i,r,o=this.shaderStage){let u=null;return this.isUnfilterable(e)?u=this.generateTextureLod(e,t,n,i,r,"0",o):u=this._generateTextureSample(e,t,n,i,r,o),u}generateTextureGrad(e,t,n,i,r,o,u=this.shaderStage){if(u==="fragment")return o?`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${i[0]}, ${i[1]}, ${o} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${i[0]}, ${i[1]} )`;Ae(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${u} shader.`)}generateTextureCompare(e,t,n,i,r,o,u=this.shaderStage){if(u==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?o?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r}, ${i}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r}, ${i} )`:o?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${i}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${i} )`;Ae(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${u} shader.`)}generateTextureLevel(e,t,n,i,r,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${i}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,o,i):this.generateTextureLod(e,t,n,r,o,i)}generateTextureBias(e,t,n,i,r,o,u=this.shaderStage){if(u==="fragment")return o?`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${i}, ${o} )`:`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${i} )`;Ae(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${u} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,i=e.type;return i==="texture"||i==="cubeTexture"||i==="cubeDepthTexture"||i==="storageTexture"||i==="texture3D"?n:i==="buffer"||i==="storageBuffer"||i==="indirectStorageBuffer"?this.isCustomStruct(e)?n:n+".value":e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=Cee[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(Ne("WebGPURenderer: Atomic operations are only supported in compute shaders."),$n.READ_WRITE):$n.READ_ONLY:e.access}getStorageAccess(e,t){return Ree[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,i=null){const r=super.getUniformFromNode(e,t,n,i),o=this.getDataFromNode(e,n,this.globalCache);if(o.uniformGPU===void 0){let u;const c=e.groupNode,d=c.name,f=this.getBindGroupArray(d,n);if(t==="texture"||t==="cubeTexture"||t==="cubeDepthTexture"||t==="storageTexture"||t==="texture3D"){let p=null;const g=this.getNodeAccess(e,n);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?p=new bv(r.name,r.node,c,g):p=new ky(r.name,r.node,c,g):t==="cubeTexture"||t==="cubeDepthTexture"?p=new AU(r.name,r.node,c,g):t==="texture3D"&&(p=new bv(r.name,r.node,c,g)),p.store=e.isStorageTextureNode===!0,p.mipLevel=p.store?e.mipLevel:0,p.setVisibility(og[n]),this.isUnfilterable(e.value)===!1&&p.store===!1){const y=new gee(`${r.name}_sampler`,r.node,c);y.setVisibility(og[n]),f.push(y,p),u=[y,p]}else f.push(p),u=[p]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const p=this.getSharedDataFromNode(e);let g=p.buffer;if(g===void 0){const y=t==="buffer"?wU:bee;g=new y(e,c),p.buffer=g}g.setVisibility(g.getVisibility()|og[n]),f.push(g),u=g,r.name=i||"NodeBuffer_"+r.id}else{const p=this.uniformGroups[n]||(this.uniformGroups[n]={});let g=p[d];g===void 0&&(g=new MU(d,c),g.setVisibility(og[n]),p[d]=g,f.push(g)),u=this.getNodeUniform(r,t),g.addUniform(u)}o.uniformGPU=u}return r}getBuiltin(e,t,n,i=this.shaderStage){const r=this.builtins[i]||(this.builtins[i]=new Map);return r.has(e)===!1&&r.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),i=[];for(const o of t.inputs)i.push(o.name+" : "+this.getType(o.type));let r=`fn ${t.name}( ${i.join(", ")} ) -> ${this.getType(t.type)} {
${n.vars}
${n.code}
`;return n.result&&(r+=`	return ${n.result};
`),r+=`
}
`,r}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(n!==void 0)for(const i of n)t.push(`enable ${i};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(n!==void 0)for(const{name:i,property:r,type:o}of n.values())t.push(`@builtin( ${i} ) ${r} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,n,i){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:i}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:n,scope:i,bufferType:r,bufferCount:o}of this.scopedArrays.values()){const u=this.getType(r);t.push(`var<${i}> ${n}: array< ${u}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&t.push(n);const i=this.getAttributesArray();for(let r=0,o=i.length;r<o;r++){const u=i[r],c=u.name,d=this.getType(u.type);t.push(`@location( ${r} ) ${c} : ${d}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const n of e.members){const i=e.output?"@location( "+n.index+" ) ":"";let r=this.getType(n.type);n.atomic&&(r="atomic< "+r+" >"),t.push(`	${i+n.name} : ${r}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const i=[];for(const r of n){let o=`struct ${r.name} {
`;o+=this.getStructMembers(r),o+=`
};`,i.push(o)}t=`
`+i.join(`

`)+`
`}return t}getVar(e,t,n=null){let i=`var ${t} : `;return n!==null?i+=this.generateArrayDeclaration(e,n):i+=this.getType(e),i}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const i of n)t.push(`	${this.getVar(i.type,i.name,i.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const r=this.varyings,o=this.vars[e];for(let u=0;u<r.length;u++){const c=r[u];if(c.needsInterpolation){let d=`@location( ${u} )`;if(c.interpolationType){const f=c.interpolationSampling!==null?`, ${c.interpolationSampling} )`:" )";d+=` @interpolate( ${c.interpolationType}${f}`}else/^(int|uint|ivec|uvec)/.test(c.type)&&(d+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${d} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&o.includes(c)===!1&&o.push(c)}}const n=this.getBuiltins(e);n&&t.push(n);const i=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+i):i}isCustomStruct(e){const t=e.value,n=e.node,i=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&n.structTypeNode!==null,r=n.value&&n.value.array&&typeof n.value.itemSize=="number"&&n.value.array.length>n.value.itemSize;return i&&!r}getUniforms(e){const t=this.uniforms[e],n=[],i=[],r=[],o={};for(const c of t){const d=c.groupNode.name,f=this.bindingsIndexes[d];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="cubeDepthTexture"||c.type==="storageTexture"||c.type==="texture3D"){const p=c.node.value;this.isUnfilterable(p)===!1&&c.node.isStorageTextureNode!==!0&&(this.isSampleCompare(p)?n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${c.name}_sampler : sampler_comparison;`):n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${c.name}_sampler : sampler;`));let g,y="";const{primarySamples:x}=this.renderer.backend.utils.getTextureSampleData(p);if(x>1&&(y="_multisampled"),p.isCubeTexture===!0&&p.isDepthTexture===!0)g="texture_depth_cube";else if(p.isCubeTexture===!0)g="texture_cube<f32>";else if(p.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&p.compareFunction===null?g=`texture${y}_2d<f32>`:g=`texture_depth${y}_2d${p.isArrayTexture===!0?"_array":""}`;else if(c.node.isStorageTextureNode===!0){const v=vv(p),S=this.getStorageAccess(c.node,e),w=c.node.value.is3DTexture,M=c.node.value.isArrayTexture;g=`texture_storage_${w?"3d":`2d${M?"_array":""}`}<${v}, ${S}>`}else if(p.isArrayTexture===!0||p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0)g="texture_2d_array<f32>";else if(p.is3DTexture===!0||p.isData3DTexture===!0)g="texture_3d<f32>";else{const v=this.getComponentTypeFromTexture(p).charAt(0);g=`texture${y}_2d<${v}32>`}n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${c.name} : ${g};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const p=c.node,g=this.getType(p.getNodeType(this)),y=p.bufferCount,x=y>0&&c.type==="buffer"?", "+y:"",v=p.isStorageBufferNode?`storage, ${this.getStorageAccess(p,e)}`:"uniform";if(this.isCustomStruct(c))i.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var<${v}> ${c.name} : ${g};`);else{const w=`	value : array< ${p.isAtomic?`atomic<${g}>`:`${g}`}${x} >`;i.push(this._getWGSLStructBinding(c.name,w,v,f.binding++,f.group))}}else{const p=this.getType(this.getVectorType(c.type)),g=c.groupNode.name;(o[g]||(o[g]={index:f.binding++,id:f.group,snippets:[]})).snippets.push(`	${c.name} : ${p}`)}}for(const c in o){const d=o[c];r.push(this._getWGSLStructBinding(c,d.snippets.join(`,
`),"uniform",d.index,d.id))}return[...n,...i,...r].join(`
`)}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let i=`// code

`;i+=this.flowCode[t];const r=this.flowNodes[t],o=r[r.length-1],u=o.outputNode,c=u!==void 0&&u.isOutputStructNode===!0;for(const d of r){const f=this.getFlowData(d),p=d.name;if(p&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${p}
`),i+=`${f.code}
	`,d===o&&t!=="compute"){if(i+=`// result

	`,t==="vertex")i+=`varyings.Vertex = ${f.result};`;else if(t==="fragment")if(c)n.returnType=u.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",i+=`return ${f.result};`;else{let g="	@location(0) color: vec4<f32>";const y=this.getBuiltins("output");y&&(g+=`,
	`+y),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",g),n.structs+=`
var<private> output : OutputStruct;`,i+=`output.color = ${f.result};

	return output;`}}}n.flow=i}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let n;return t!==null&&(n=this._getWGSLMethod(e+"_"+t)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,n){return`select( ${n}, ${t}, ${e} )`}getType(e){return Dee[e]||e}isAvailable(e){let t=QR[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),QR[e]=t),t}_getWGSLMethod(e){return Nd[e]!==void 0&&this._include(e),Bee[e]}_include(e){const t=Nd[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${CU}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[n,i,r]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${n}, ${i}, ${r} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${n} * numWorkgroups.x )
		+ globalId.z * ( ${n} * numWorkgroups.x ) * ( ${i} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,n,i=0,r=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${i} ) @group( ${r} )
var<${n}> ${e} : ${o};`}}class Fee{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=K.Depth24PlusStencil8:e.depth&&(t=K.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const r=this.backend.renderer,o=r.getRenderTarget();t=o?o.samples:r.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return e.textures!==null?e.textures.map(t=>this.getTextureFormatGPU(t)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return wc.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return wc.LineList;if(e.isLine)return wc.LineStrip;if(e.isMesh)return wc.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const t=this.backend.parameters.outputType;if(t===void 0)return navigator.gpu.getPreferredCanvasFormat();if(t===es)return K.BGRA8Unorm;if(t===Gn)return K.RGBA16Float;throw new Error("Unsupported output buffer type.")}}const DU=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&DU.set(Float16Array,["float16"]);const Oee=new Map([[VD,["float16"]]]),Uee=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class zee{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),i=this.backend,r=i.get(n);let o=r.buffer;if(o===void 0){const u=i.device;let c=n.array;if(e.normalized===!1){if(c.constructor===Int16Array||c.constructor===Int8Array)c=new Int32Array(c);else if((c.constructor===Uint16Array||c.constructor===Uint8Array)&&(c=new Uint32Array(c),t&GPUBufferUsage.INDEX))for(let p=0;p<c.length;p++)c[p]===65535&&(c[p]=4294967295)}if(n.array=c,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){c=new c.constructor(n.count*4);for(let p=0;p<n.count;p++)c.set(n.array.subarray(p*3,p*3+3),p*4);n.itemSize=4,n.array=c,r._force3to4BytesAlignment=!0}const d=c.byteLength,f=d+(4-d%4)%4;o=u.createBuffer({label:n.name,size:f,usage:t,mappedAtCreation:!0}),new c.constructor(o.getMappedRange()).set(c),o.unmap(),r.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,i=n.device,r=n.get(t),o=n.get(t).buffer;let u=t.array;if(r._force3to4BytesAlignment===!0){u=new u.constructor(t.count*4);for(let d=0;d<t.count;d++)u.set(t.array.subarray(d*3,d*3+3),d*4);t.array=u}const c=t.updateRanges;if(c.length===0)i.queue.writeBuffer(o,0,u,0);else{const d=g0(u),f=d?1:u.BYTES_PER_ELEMENT;for(let p=0,g=c.length;p<g;p++){const y=c[p];let x,v;if(r._force3to4BytesAlignment===!0){const w=Math.floor(y.start/3),M=Math.ceil(y.count/3);x=w*4*f,v=M*4*f}else x=y.start*f,v=y.count*f;const S=x*(d?u.BYTES_PER_ELEMENT:1);i.queue.writeBuffer(o,S,u,x,v)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let i=0;i<t.length;i++){const r=t[i],o=r.array.BYTES_PER_ELEMENT,u=this._getBufferAttribute(r);let c=n.get(u);if(c===void 0){let p,g;r.isInterleavedBufferAttribute===!0?(p=r.data.stride*o,g=r.data.isInstancedInterleavedBuffer?ag.Instance:ag.Vertex):(p=r.itemSize*o,g=r.isInstancedBufferAttribute?ag.Instance:ag.Vertex),r.normalized===!1&&(r.array.constructor===Int16Array||r.array.constructor===Uint16Array)&&(p=4),c={arrayStride:p,attributes:[],stepMode:g},n.set(u,c)}const d=this._getVertexFormat(r),f=r.isInterleavedBufferAttribute===!0?r.offset*o:0;c.attributes.push({shaderLocation:i,offset:f,format:d})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,r=t.get(this._getBufferAttribute(e)).buffer,o=r.size,u=n.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=n.createCommandEncoder({label:`readback_encoder_${e.name}`});c.copyBufferToBuffer(r,0,u,0,o);const d=c.finish();n.queue.submit([d]),await u.mapAsync(GPUMapMode.READ);const f=u.getMappedRange(),p=new e.array.constructor(f.slice(0));return u.unmap(),p.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,i=e.array.constructor,r=e.constructor;let o;if(t===1)o=Uee.get(i);else{const c=(Oee.get(r)||DU.get(i))[n?1:0];if(c){const d=i.BYTES_PER_ELEMENT*t,p=Math.floor((d+3)/4)*4/i.BYTES_PER_ELEMENT;if(p%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${c}x${p}`}}return o||Ae("WebGPUAttributeUtils: Vertex format not supported yet."),o}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class Vee{constructor(e){this.layoutGPU=e,this.usedTimes=0}}class Pee{constructor(e){this.backend=e,this._bindGroupLayoutCache=new Map}createBindingsLayout(e){const t=this.backend,n=t.device,i=t.get(e);if(i.layout)return i.layout.layoutGPU;const r=this._createLayoutEntries(e),o=JSON.stringify(r);let u=this._bindGroupLayoutCache.get(o);return u===void 0&&(u=new Vee(n.createBindGroupLayout({entries:r})),this._bindGroupLayoutCache.set(o,u)),u.usedTimes++,i.layout=u,i.layoutKey=o,u.layoutGPU}createBindings(e,t,n,i=0){const{backend:r}=this,o=r.get(e),u=this.createBindingsLayout(e);let c;n>0&&(o.groups===void 0&&(o.groups=[],o.versions=[]),o.versions[n]===i&&(c=o.groups[n])),c===void 0&&(c=this.createBindGroup(e,u),n>0&&(o.groups[n]=c,o.versions[n]=i)),o.group=c}updateBinding(e){const t=this.backend,n=t.device,i=e.buffer,r=t.get(e).buffer,o=e.updateRanges;if(o.length===0)n.queue.writeBuffer(r,0,i,0);else{const u=g0(i),c=u?1:i.BYTES_PER_ELEMENT;for(let d=0,f=o.length;d<f;d++){const p=o[d],g=p.start*c,y=p.count*c,x=g*(u?i.BYTES_PER_ELEMENT:1);n.queue.writeBuffer(r,x,i,g,y)}e.clearUpdateRanges()}}createBindGroupIndex(e,t){const i=this.backend.device,r=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,o=e[0],u=i.createBuffer({label:"bindingCameraIndex_"+o,size:16,usage:r});i.queue.writeBuffer(u,0,e,0);const c=[{binding:0,resource:{buffer:u}}];return i.createBindGroup({label:"bindGroupCameraIndex_"+o,layout:t,entries:c})}createBindGroup(e,t){const n=this.backend,i=n.device;let r=0;const o=[];for(const u of e.bindings){if(u.isUniformBuffer){const c=n.get(u);if(c.buffer===void 0){const d=u.byteLength,f=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,p=[];u.visibility&$l.VERTEX&&p.push("vertex"),u.visibility&$l.FRAGMENT&&p.push("fragment"),u.visibility&$l.COMPUTE&&p.push("compute");const g=`(${p.join(",")})`,y=i.createBuffer({label:`bindingBuffer${u.id}_${u.name}_${g}`,size:d,usage:f});c.buffer=y}o.push({binding:r,resource:{buffer:c.buffer}})}else if(u.isStorageBuffer){const c=n.get(u);if(c.buffer===void 0){const d=u.attribute;c.buffer=n.get(d).buffer}o.push({binding:r,resource:{buffer:c.buffer}})}else if(u.isSampledTexture){const c=n.get(u.texture);let d;if(c.externalTexture!==void 0)d=i.importExternalTexture({source:c.externalTexture});else{const f=u.store?1:c.texture.mipLevelCount,p=u.store?u.mipLevel:0;let g=`view-${c.texture.width}-${c.texture.height}`;if(c.texture.depthOrArrayLayers>1&&(g+=`-${c.texture.depthOrArrayLayers}`),g+=`-${f}-${p}`,d=c[g],d===void 0){const y=mee.All;let x;u.isSampledCubeTexture?x=Tn.Cube:u.isSampledTexture3D?x=Tn.ThreeD:u.texture.isArrayTexture||u.texture.isDataArrayTexture||u.texture.isCompressedArrayTexture?x=Tn.TwoDArray:x=Tn.TwoD,d=c[g]=c.texture.createView({aspect:y,dimension:x,mipLevelCount:f,baseMipLevel:p})}}o.push({binding:r,resource:d})}else if(u.isSampler){const c=n.get(u.texture);o.push({binding:r,resource:c.sampler})}r++}return i.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}_createLayoutEntries(e){const t=[];let n=0;for(const i of e.bindings){const r=this.backend,o={binding:n,visibility:i.visibility};if(i.isUniformBuffer||i.isStorageBuffer){const u={};i.isStorageBuffer&&(i.visibility&$l.COMPUTE&&(i.access===$n.READ_WRITE||i.access===$n.WRITE_ONLY)?u.type=M_.Storage:u.type=M_.ReadOnlyStorage),o.buffer=u}else if(i.isSampledTexture&&i.store){const u={};u.format=this.backend.get(i.texture).texture.format;const c=i.access;c===$n.READ_WRITE?u.access=N_.ReadWrite:c===$n.WRITE_ONLY?u.access=N_.WriteOnly:u.access=N_.ReadOnly,i.texture.isArrayTexture?u.viewDimension=Tn.TwoDArray:i.texture.is3DTexture&&(u.viewDimension=Tn.ThreeD),o.storageTexture=u}else if(i.isSampledTexture){const u={},{primarySamples:c}=r.utils.getTextureSampleData(i.texture);if(c>1&&(u.multisampled=!0,i.texture.isDepthTexture||(u.sampleType=Cl.UnfilterableFloat)),i.texture.isDepthTexture)r.compatibilityMode&&i.texture.compareFunction===null?u.sampleType=Cl.UnfilterableFloat:u.sampleType=Cl.Depth;else if(i.texture.isDataTexture||i.texture.isDataArrayTexture||i.texture.isData3DTexture){const d=i.texture.type;d===Kn?u.sampleType=Cl.SInt:d===rn?u.sampleType=Cl.UInt:d===Ns&&(this.backend.hasFeature("float32-filterable")?u.sampleType=Cl.Float:u.sampleType=Cl.UnfilterableFloat)}i.isSampledCubeTexture?u.viewDimension=Tn.Cube:i.texture.isArrayTexture||i.texture.isDataArrayTexture||i.texture.isCompressedArrayTexture?u.viewDimension=Tn.TwoDArray:i.isSampledTexture3D&&(u.viewDimension=Tn.ThreeD),o.texture=u}else if(i.isSampler){const u={};i.texture.isDepthTexture&&(i.texture.compareFunction!==null?u.type=qR.Comparison:r.compatibilityMode&&(u.type=qR.NonFiltering)),o.sampler=u}else Ae(`WebGPUBindingUtils: Unsupported binding "${i}".`);t.push(o),n++}return t}deleteBindGroupData(e){const{backend:t}=this,n=t.get(e);n.layout&&(n.layout.usedTimes--,n.layout.usedTimes===0&&this._bindGroupLayoutCache.delete(n.layoutKey),n.layout=void 0,n.layoutKey=void 0)}dispose(){this._bindGroupLayoutCache.clear()}}class Iee{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:i,geometry:r,pipeline:o}=e,{vertexProgram:u,fragmentProgram:c}=o,d=this.backend,f=d.device,p=d.utils,g=d.get(o),y=[];for(const ee of e.getBindings()){const P=d.get(ee),{layoutGPU:Y}=P.layout;y.push(Y)}const x=d.attributeUtils.createShaderVertexBuffers(e);let v;i.blending!==Xc&&(i.blending!==ya||i.transparent!==!1)&&(v=this._getBlending(i));let S={};i.stencilWrite===!0&&(S={compare:this._getStencilCompare(i),failOp:this._getStencilOperation(i.stencilFail),depthFailOp:this._getStencilOperation(i.stencilZFail),passOp:this._getStencilOperation(i.stencilZPass)});const w=this._getColorWriteMask(i),M=[];if(e.context.textures!==null){const ee=e.context.textures;for(let P=0;P<ee.length;P++){const Y=p.getTextureFormatGPU(ee[P]);P===0?M.push({format:Y,blend:v,writeMask:w}):M.push({format:Y,writeMask:w})}}else{const ee=p.getCurrentColorFormat(e.context);M.push({format:ee,blend:v,writeMask:w})}const T=d.get(u).module,A=d.get(c).module,C=this._getPrimitiveState(n,r,i),D=this._getDepthCompare(i),R=p.getCurrentDepthStencilFormat(e.context),B=this._getSampleCount(e.context),L={label:`renderPipeline_${i.name||i.type}_${i.id}`,vertex:Object.assign({},T,{buffers:x}),fragment:Object.assign({},A,{targets:M}),primitive:C,multisample:{count:B,alphaToCoverageEnabled:i.alphaToCoverage&&B>1},layout:f.createPipelineLayout({bindGroupLayouts:y})},X={},G=e.context.depth,j=e.context.stencil;if((G===!0||j===!0)&&(G===!0&&(X.format=R,X.depthWriteEnabled=i.depthWrite,X.depthCompare=D),j===!0&&(X.stencilFront=S,X.stencilBack={},X.stencilReadMask=i.stencilFuncMask,X.stencilWriteMask=i.stencilWriteMask),i.polygonOffset===!0&&(X.depthBias=i.polygonOffsetUnits,X.depthBiasSlopeScale=i.polygonOffsetFactor,X.depthBiasClamp=0),L.depthStencil=X),f.pushErrorScope("validation"),t===null)g.pipeline=f.createRenderPipeline(L),f.popErrorScope().then(ee=>{ee!==null&&(g.error=!0,Ae(ee.message))});else{const ee=new Promise(async P=>{try{g.pipeline=await f.createRenderPipelineAsync(L)}catch{}const Y=await f.popErrorScope();Y!==null&&(g.error=!0,Ae(Y.message)),P()});t.push(ee)}}createBundleEncoder(e,t="renderBundleEncoder"){const n=this.backend,{utils:i,device:r}=n,o=i.getCurrentDepthStencilFormat(e),u=i.getCurrentColorFormats(e),c=this._getSampleCount(e),d={label:t,colorFormats:u,depthStencilFormat:o,sampleCount:c};return r.createRenderBundleEncoder(d)}createComputePipeline(e,t){const n=this.backend,i=n.device,r=n.get(e.computeProgram).module,o=n.get(e),u=[];for(const c of t){const d=n.get(c),{layoutGPU:f}=d.layout;u.push(f)}o.pipeline=i.createComputePipeline({compute:r,layout:i.createPipelineLayout({bindGroupLayouts:u})})}_getBlending(e){let t,n;const i=e.blending,r=e.blendSrc,o=e.blendDst,u=e.blendEquation;if(i===Ud){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:r,d=e.blendDstAlpha!==null?e.blendDstAlpha:o,f=e.blendEquationAlpha!==null?e.blendEquationAlpha:u;t={srcFactor:this._getBlendFactor(r),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(u)},n={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(d),operation:this._getBlendOperation(f)}}else{const c=e.premultipliedAlpha,d=(f,p,g,y)=>{t={srcFactor:f,dstFactor:p,operation:Rl.Add},n={srcFactor:g,dstFactor:y,operation:Rl.Add}};if(c)switch(i){case ya:d(ct.One,ct.OneMinusSrcAlpha,ct.One,ct.OneMinusSrcAlpha);break;case zg:d(ct.One,ct.One,ct.One,ct.One);break;case Vg:d(ct.Zero,ct.OneMinusSrc,ct.Zero,ct.One);break;case Pg:d(ct.Dst,ct.OneMinusSrcAlpha,ct.Zero,ct.One);break}else switch(i){case ya:d(ct.SrcAlpha,ct.OneMinusSrcAlpha,ct.One,ct.OneMinusSrcAlpha);break;case zg:d(ct.SrcAlpha,ct.One,ct.One,ct.One);break;case Vg:Ae("WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Pg:Ae("WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true");break}}if(t!==void 0&&n!==void 0)return{color:t,alpha:n};Ae("WebGPURenderer: Invalid blending: ",i)}_getBlendFactor(e){let t;switch(e){case Mo:t=ct.Zero;break;case rD:t=ct.One;break;case aD:t=ct.Src;break;case oD:t=ct.OneMinusSrc;break;case Ig:t=ct.SrcAlpha;break;case kg:t=ct.OneMinusSrcAlpha;break;case cD:t=ct.Dst;break;case hD:t=ct.OneMinusDst;break;case lD:t=ct.DstAlpha;break;case uD:t=ct.OneMinusDstAlpha;break;case dD:t=ct.SrcAlphaSaturated;break;case DW:t=ct.Constant;break;case BW:t=ct.OneMinusConstant;break;default:Ae("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case W8:t=kn.Never;break;case Y_:t=kn.Always;break;case X8:t=kn.Less;break;case Z8:t=kn.LessEqual;break;case Y8:t=kn.Equal;break;case J8:t=kn.GreaterEqual;break;case Q8:t=kn.Greater;break;case K8:t=kn.NotEqual;break;default:Ae("WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case Bl:t=So.Keep;break;case I8:t=So.Zero;break;case k8:t=So.Replace;break;case q8:t=So.Invert;break;case G8:t=So.IncrementClamp;break;case $8:t=So.DecrementClamp;break;case H8:t=So.IncrementWrap;break;case j8:t=So.DecrementWrap;break;default:Ae("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case Pi:t=Rl.Add;break;case sD:t=Rl.Subtract;break;case iD:t=Rl.ReverseSubtract;break;case M8:t=Rl.Min;break;case N8:t=Rl.Max;break;default:Ae("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const i={},r=this.backend.utils;i.topology=r.getPrimitiveTopology(e,n),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(i.stripIndexFormat=t.index.array instanceof Uint16Array?nh.Uint16:nh.Uint32);let o=n.side===ns;return e.isMesh&&e.matrixWorld.determinant()<0&&(o=!o),i.frontFace=o===!0?$R.CW:$R.CCW,i.cullMode=n.side===ql?HR.None:HR.Back,i}_getColorWriteMask(e){return e.colorWrite===!0?jR.All:jR.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=kn.Always;else{const n=e.depthFunc;switch(n){case fD:t=kn.Never;break;case pD:t=kn.Always;break;case mD:t=kn.Less;break;case Gg:t=kn.LessEqual;break;case gD:t=kn.Equal;break;case yD:t=kn.GreaterEqual;break;case xD:t=kn.Greater;break;case bD:t=kn.NotEqual;break;default:Ae("WebGPUPipelineUtils: Invalid depth function.",n)}}return t}}class kee extends RU{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const i=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return $t(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const i=this.device.createCommandEncoder();i.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),i.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const r=i.finish();if(this.device.queue.submit([r]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,n)),u={},c=[];for(const[f,p]of e){const g=f.match(/^(.*):f(\d+)$/),y=parseInt(g[2]);c.includes(y)===!1&&c.push(y),u[y]===void 0&&(u[y]=0);const x=o[p],v=o[p+1],S=Number(v-x)/1e6;this.timestamps.set(f,S),u[y]+=S}const d=u[c[c.length-1]];return this.resultBuffer.unmap(),this.lastValue=d,this.frames=c,d}catch(e){return Ae("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){Ae("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){Ae("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class Gee extends EU{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new Fee(this),this.attributeUtils=new zee(this),this.bindingUtils=new Pee(this),this.pipelineUtils=new Iee(this),this.textureUtils=new See(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(t.device===void 0){const i={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},r=typeof navigator<"u"?await navigator.gpu.requestAdapter(i):null;if(r===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const o=Object.values(_v),u=[];for(const d of o)r.features.has(d)&&u.push(d);const c={requiredFeatures:u,requiredLimits:t.requiredLimits};n=await r.requestDevice(c)}else n=t.device;n.lost.then(i=>{if(i.reason==="destroyed")return;const r={api:"WebGPU",message:i.message||"Unknown reason",reason:i.reason||null,originalEvent:i};e.onDeviceLost(r)}),this.device=n,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(_v.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let n=t.context;if(n===void 0){const i=this.parameters;e.isDefaultCanvasTarget===!0&&i.context!==void 0?n=i.context:n=e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${Cf} webgpu`);const r=i.alpha?"premultiplied":"opaque",o=i.outputType===Gn?"extended":"standard";n.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:r,toneMapping:{mode:o}}),t.context=n}return n}get coordinateSystem(){return xi}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),n=this.get(t),i=e.currentSamples;let r=n.descriptor;if(r===void 0||n.samples!==i){r={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(r.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const u=r.colorAttachments[0];i>0?u.view=this.textureUtils.getColorBuffer().createView():u.resolveTarget=void 0,n.descriptor=r,n.samples=i}const o=r.colorAttachments[0];return i>0?o.resolveTarget=this.context.getCurrentTexture().createView():o.view=this.context.getCurrentTexture().createView(),r}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const n=e.renderTarget,i=this.get(n);let r=i.descriptors;(r===void 0||i.width!==n.width||i.height!==n.height||i.samples!==n.samples)&&(r={},i.descriptors=r);const o=e.getCacheKey();let u=r[o];if(u===void 0){const d=e.textures,f=[];let p;const g=this._isRenderCameraDepthArray(e);for(let y=0;y<d.length;y++){const x=this.get(d[y]),v={label:`colorAttachment_${y}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:Tn.TwoD};if(n.isRenderTarget3D)p=e.activeCubeFace,v.baseArrayLayer=0,v.dimension=Tn.ThreeD,v.depthOrArrayLayers=d[y].image.depth;else if(n.isRenderTarget&&d[y].image.depth>1)if(g===!0){const S=e.camera.cameras;for(let w=0;w<S.length;w++){const M={...v,baseArrayLayer:w,arrayLayerCount:1,dimension:Tn.TwoD},T=x.texture.createView(M);f.push({view:T,resolveTarget:void 0,depthSlice:void 0})}}else v.dimension=Tn.TwoDArray,v.depthOrArrayLayers=d[y].image.depth;if(g!==!0){const S=x.texture.createView(v);let w,M;x.msaaTexture!==void 0?(w=x.msaaTexture.createView(),M=S):(w=S,M=void 0),f.push({view:w,resolveTarget:M,depthSlice:p})}}if(u={textureViews:f},e.depth){const y=this.get(e.depthTexture),x={};(e.depthTexture.isArrayTexture||e.depthTexture.isCubeTexture)&&(x.dimension=Tn.TwoD,x.arrayLayerCount=1,x.baseArrayLayer=e.activeCubeFace),u.depthStencilView=y.texture.createView(x)}r[o]=u,i.width=n.width,i.height=n.height,i.samples=n.samples,i.activeMipmapLevel=e.activeMipmapLevel,i.activeCubeFace=e.activeCubeFace}const c={colorAttachments:[]};for(let d=0;d<u.textureViews.length;d++){const f=u.textureViews[d];let p={r:0,g:0,b:0,a:1};d===0&&t.clearValue&&(p=t.clearValue),c.colorAttachments.push({view:f.view,depthSlice:f.depthSlice,resolveTarget:f.resolveTarget,loadOp:t.loadOp||Mt.Load,storeOp:t.storeOp||ls.Store,clearValue:p})}return u.depthStencilView&&(c.depthStencilAttachment={view:u.depthStencilView}),c}beginRender(e){const t=this.get(e),n=this.device,i=e.occlusionQueryCount;let r;i>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,r=n.createQuerySet({type:"occlusion",count:i,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=r,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(i),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:Mt.Load}),this.initTimestampQuery(yr.RENDER,this.getTimestampUID(e),o),o.occlusionQuerySet=r;const u=o.depthStencilAttachment;if(e.textures!==null){const d=o.colorAttachments;for(let f=0;f<d.length;f++){const p=d[f];e.clearColor?(p.clearValue=f===0?e.clearColorValue:{r:0,g:0,b:0,a:1},p.loadOp=Mt.Clear):p.loadOp=Mt.Load,p.storeOp=ls.Store}}else{const d=o.colorAttachments[0];e.clearColor?(d.clearValue=e.clearColorValue,d.loadOp=Mt.Clear):d.loadOp=Mt.Load,d.storeOp=ls.Store}e.depth&&(e.clearDepth?(u.depthClearValue=e.clearDepthValue,u.depthLoadOp=Mt.Clear):u.depthLoadOp=Mt.Load,u.depthStoreOp=ls.Store),e.stencil&&(e.clearStencil?(u.stencilClearValue=e.clearStencilValue,u.stencilLoadOp=Mt.Clear):u.stencilLoadOp=Mt.Load,u.stencilStoreOp=ls.Store);const c=n.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const d=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==d.length?this._createDepthLayerDescriptors(e,t,o,d):this._updateDepthLayerDescriptors(e,t,d),t.bundleEncoders=[],t.bundleSets=[];for(let f=0;f<d.length;f++){const p=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+f),g={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(p),t.bundleSets.push(g)}t.currentPass=null}else{const d=c.beginRenderPass(o);t.currentPass=d,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=o,t.encoder=c,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,n,i){const r=n.depthStencilAttachment;t.layerDescriptors=[];const o=this.get(e.depthTexture);o.viewCache||(o.viewCache=[]);for(let u=0;u<i.length;u++){const c={...n,colorAttachments:[{...n.colorAttachments[0],view:n.colorAttachments[u].view}]};if(n.depthStencilAttachment){const d=u;o.viewCache[d]||(o.viewCache[d]=o.texture.createView({dimension:Tn.TwoD,baseArrayLayer:u,arrayLayerCount:1})),c.depthStencilAttachment={view:o.viewCache[d],depthLoadOp:r.depthLoadOp||Mt.Clear,depthStoreOp:r.depthStoreOp||ls.Store,depthClearValue:r.depthClearValue||1},e.stencil&&(c.depthStencilAttachment.stencilLoadOp=r.stencilLoadOp,c.depthStencilAttachment.stencilStoreOp=r.stencilStoreOp,c.depthStencilAttachment.stencilClearValue=r.stencilClearValue)}else c.depthStencilAttachment={...r};t.layerDescriptors.push(c)}}_updateDepthLayerDescriptors(e,t,n){for(let i=0;i<n.length;i++){const r=t.layerDescriptors[i];if(r.depthStencilAttachment){const o=r.depthStencilAttachment;e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=Mt.Clear):o.depthLoadOp=Mt.Load),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=Mt.Clear):o.stencilLoadOp=Mt.Load)}}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const i=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const r=[];for(let o=0;o<t.bundleEncoders.length;o++){const u=t.bundleEncoders[o];r.push(u.finish())}for(let o=0;o<t.layerDescriptors.length;o++)if(o<r.length){const u=t.layerDescriptors[o],c=i.beginRenderPass(u);if(e.viewport){const{x:d,y:f,width:p,height:g,minDepth:y,maxDepth:x}=e.viewportValue;c.setViewport(d,f,p,g,y,x)}if(e.scissor){const{x:d,y:f,width:p,height:g}=e.scissorValue;c.setScissorRect(d,f,p,g)}c.executeBundles([r[o]]),c.end()}}else t.currentPass&&t.currentPass.end();if(n>0){const r=n*8;let o=this.occludedResolveCache.get(r);o===void 0&&(o=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,o));const u=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,o,0),t.encoder.copyBufferToBuffer(o,0,u,0,r),t.occlusionQueryBuffer=u,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const r=e.textures;for(let o=0;o<r.length;o++){const u=r[o];u.generateMipmaps===!0&&this.textureUtils.generateMipmaps(u)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:i}=t;if(n&&i){const r=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const o=n.getMappedRange(),u=new BigUint64Array(o);for(let c=0;c<i.length;c++)u[c]===BigInt(0)&&r.add(i[c]);n.destroy(),t.occluded=r}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:i,width:r,height:o,minDepth:u,maxDepth:c}=e.viewportValue;t.setViewport(n,i,r,o,u,c)}updateScissor(e){const{currentPass:t}=this.get(e),{x:n,y:i,width:r,height:o}=e.scissorValue;t.setScissorRect(n,i,r,o)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,i=null){const r=this.device,o=this.renderer;let u=[],c,d,f,p;if(e){const x=this.getClearColor();d={r:x.r,g:x.g,b:x.b,a:x.a}}if(i===null){f=o.depth,p=o.stencil;const x=this._getDefaultRenderPassDescriptor();if(e){u=x.colorAttachments;const v=u[0];v.clearValue=d,v.loadOp=Mt.Clear,v.storeOp=ls.Store}(f||p)&&(c=x.depthStencilAttachment)}else{f=i.depth,p=i.stencil;const x={loadOp:e?Mt.Clear:Mt.Load,clearValue:e?d:void 0};f&&(x.depthLoadOp=t?Mt.Clear:Mt.Load,x.depthClearValue=t?o.getClearDepth():void 0,x.depthStoreOp=ls.Store),p&&(x.stencilLoadOp=n?Mt.Clear:Mt.Load,x.stencilClearValue=n?o.getClearStencil():void 0,x.stencilStoreOp=ls.Store);const v=this._getRenderPassDescriptor(i,x);u=v.colorAttachments,c=v.depthStencilAttachment}f&&c&&(t?(c.depthLoadOp=Mt.Clear,c.depthClearValue=o.getClearDepth(),c.depthStoreOp=ls.Store):(c.depthLoadOp=Mt.Load,c.depthStoreOp=ls.Store)),p&&c&&(n?(c.stencilLoadOp=Mt.Clear,c.stencilClearValue=o.getClearStencil(),c.stencilStoreOp=ls.Store):(c.stencilLoadOp=Mt.Load,c.stencilStoreOp=ls.Store));const g=r.createCommandEncoder({label:"clear"});g.beginRenderPass({colorAttachments:u,depthStencilAttachment:c}).end(),r.queue.submit([g.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(yr.COMPUTE,this.getTimestampUID(e),n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,i,r=null){const o=this.get(t),{passEncoderGPU:u}=this.get(e),c=this.get(i).pipeline;this.pipelineUtils.setPipeline(u,c);for(let d=0,f=n.length;d<f;d++){const p=n[d],g=this.get(p);u.setBindGroup(d,g.group)}if(r===null&&(r=t.count),r&&typeof r=="object"&&r.isIndirectStorageBufferAttribute){const d=this.get(r).buffer;u.dispatchWorkgroupsIndirect(d,0);return}if(typeof r=="number"){const d=r;if(o.dispatchSize===void 0||o.count!==d){o.dispatchSize=[0,1,1],o.count=d;const f=t.workgroupSize;let p=f[0];for(let x=1;x<f.length;x++)p*=f[x];const g=Math.ceil(d/p),y=this.device.limits.maxComputeWorkgroupsPerDimension;r=[g,1,1],g>y&&(r[0]=Math.min(g,y),r[1]=Math.ceil(g/y)),o.dispatchSize=r}r=o.dispatchSize}u.dispatchWorkgroups(r[0],r[1]||1,r[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:n,material:i,context:r,pipeline:o}=e,u=e.getBindings(),c=this.get(r),d=this.get(o),f=d.pipeline;if(d.error===!0)return;const p=e.getIndex(),g=p!==null,y=e.getDrawParameters();if(y===null)return;const x=(S,w)=>{this.pipelineUtils.setPipeline(S,f),w.pipeline=f;const M=w.bindingGroups;for(let A=0,C=u.length;A<C;A++){const D=u[A],R=this.get(D);M[D.index]!==D.id&&(S.setBindGroup(D.index,R.group),M[D.index]=D.id)}if(g===!0&&w.index!==p){const A=this.get(p).buffer,C=p.array instanceof Uint16Array?nh.Uint16:nh.Uint32;S.setIndexBuffer(A,C),w.index=p}const T=e.getVertexBuffers();for(let A=0,C=T.length;A<C;A++){const D=T[A];if(w.attributes[A]!==D){const R=this.get(D).buffer;S.setVertexBuffer(A,R),w.attributes[A]=D}}r.stencil===!0&&i.stencilWrite===!0&&c.currentStencilRef!==i.stencilRef&&(S.setStencilReference(i.stencilRef),c.currentStencilRef=i.stencilRef)},v=(S,w)=>{if(x(S,w),n.isBatchedMesh===!0){const M=n._multiDrawStarts,T=n._multiDrawCounts,A=n._multiDrawCount,C=n._multiDrawInstances;C!==null&&$t("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let D=0;D<A;D++){const R=C?C[D]:1,B=R>1?0:D;g===!0?S.drawIndexed(T[D],R,M[D]/p.array.BYTES_PER_ELEMENT,0,B):S.draw(T[D],R,M[D],B),t.update(n,T[D],R)}}else if(g===!0){const{vertexCount:M,instanceCount:T,firstVertex:A}=y,C=e.getIndirect();if(C!==null){const D=this.get(C).buffer,R=e.getIndirectOffset(),B=Array.isArray(R)?R:[R];for(let L=0;L<B.length;L++)S.drawIndexedIndirect(D,B[L])}else S.drawIndexed(M,T,A,0,0);t.update(n,M,T)}else{const{vertexCount:M,instanceCount:T,firstVertex:A}=y,C=e.getIndirect();if(C!==null){const D=this.get(C).buffer,R=e.getIndirectOffset(),B=Array.isArray(R)?R:[R];for(let L=0;L<B.length;L++)S.drawIndirect(D,B[L])}else S.draw(M,T,A,0);t.update(n,M,T)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const S=this.get(e.camera),w=e.camera.cameras,M=e.getBindingGroup("cameraIndex");if(S.indexesGPU===void 0||S.indexesGPU.length!==w.length){const A=this.get(M),C=[],D=new Uint32Array([0,0,0,0]);for(let R=0,B=w.length;R<B;R++){D[0]=R;const{layoutGPU:L}=A.layout,X=this.bindingUtils.createBindGroupIndex(D,L);C.push(X)}S.indexesGPU=C}const T=this.renderer.getPixelRatio();for(let A=0,C=w.length;A<C;A++){const D=w[A];if(n.layers.test(D.layers)){const R=D.viewport;let B=c.currentPass,L=c.currentSets;if(c.bundleEncoders){const X=c.bundleEncoders[A],G=c.bundleSets[A];B=X,L=G}R&&B.setViewport(Math.floor(R.x*T),Math.floor(R.y*T),Math.floor(R.width*T),Math.floor(R.height*T),r.viewportValue.minDepth,r.viewportValue.maxDepth),M&&S.indexesGPU&&(B.setBindGroup(M.index,S.indexesGPU[A]),L.bindingGroups[M.index]=M.id),v(B,L)}}}else if(c.currentPass){if(c.occlusionQuerySet!==void 0){const S=c.lastOcclusionObject;S!==n&&(S!==null&&S.occlusionTest===!0&&(c.currentPass.endOcclusionQuery(),c.occlusionQueryIndex++),n.occlusionTest===!0&&(c.currentPass.beginOcclusionQuery(c.occlusionQueryIndex),c.occlusionQueryObjects[c.occlusionQueryIndex]=n),c.lastOcclusionObject=n)}v(c.currentPass,c.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:n,material:i}=e,r=this.utils,o=r.getSampleCountRenderContext(e.context),u=r.getCurrentColorSpace(e.context),c=r.getCurrentColorFormat(e.context),d=r.getCurrentDepthStencilFormat(e.context),f=r.getPrimitiveTopology(n,i);let p=!1;return(t.material!==i||t.materialVersion!==i.version||t.transparent!==i.transparent||t.blending!==i.blending||t.premultipliedAlpha!==i.premultipliedAlpha||t.blendSrc!==i.blendSrc||t.blendDst!==i.blendDst||t.blendEquation!==i.blendEquation||t.blendSrcAlpha!==i.blendSrcAlpha||t.blendDstAlpha!==i.blendDstAlpha||t.blendEquationAlpha!==i.blendEquationAlpha||t.colorWrite!==i.colorWrite||t.depthWrite!==i.depthWrite||t.depthTest!==i.depthTest||t.depthFunc!==i.depthFunc||t.stencilWrite!==i.stencilWrite||t.stencilFunc!==i.stencilFunc||t.stencilFail!==i.stencilFail||t.stencilZFail!==i.stencilZFail||t.stencilZPass!==i.stencilZPass||t.stencilFuncMask!==i.stencilFuncMask||t.stencilWriteMask!==i.stencilWriteMask||t.side!==i.side||t.alphaToCoverage!==i.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==u||t.colorFormat!==c||t.depthStencilFormat!==d||t.primitiveTopology!==f||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=i,t.materialVersion=i.version,t.transparent=i.transparent,t.blending=i.blending,t.premultipliedAlpha=i.premultipliedAlpha,t.blendSrc=i.blendSrc,t.blendDst=i.blendDst,t.blendEquation=i.blendEquation,t.blendSrcAlpha=i.blendSrcAlpha,t.blendDstAlpha=i.blendDstAlpha,t.blendEquationAlpha=i.blendEquationAlpha,t.colorWrite=i.colorWrite,t.depthWrite=i.depthWrite,t.depthTest=i.depthTest,t.depthFunc=i.depthFunc,t.stencilWrite=i.stencilWrite,t.stencilFunc=i.stencilFunc,t.stencilFail=i.stencilFail,t.stencilZFail=i.stencilZFail,t.stencilZPass=i.stencilZPass,t.stencilFuncMask=i.stencilFuncMask,t.stencilWriteMask=i.stencilWriteMask,t.side=i.side,t.alphaToCoverage=i.alphaToCoverage,t.sampleCount=o,t.colorSpace=u,t.colorFormat=c,t.depthStencilFormat=d,t.primitiveTopology=f,t.clippingContextCacheKey=e.clippingContextCacheKey,p=!0),p}getRenderCacheKey(e){const{object:t,material:n}=e,i=this.utils,r=e.context,o=t.isMesh&&t.matrixWorld.determinant()<0;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,o,i.getSampleCountRenderContext(r),i.getCurrentColorSpace(r),i.getCurrentColorFormat(r),i.getCurrentDepthStencilFormat(r),i.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,i,r,o){return this.textureUtils.copyTextureToBuffer(e,t,n,i,r,o)}initTimestampQuery(e,t,n){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new kee(this.device,e,2048));const i=this.timestampQueryPool[e],r=i.allocateQueriesForContext(t);n.timestampWrites={querySet:i.querySet,beginningOfPassWriteIndex:r,endOfPassWriteIndex:r+1}}createNodeBuilder(e,t){return new Lee(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),r=n.currentPass.finish();this.get(t).bundleGPU=r,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,i){this.bindingUtils.createBindings(e,t,n,i)}updateBindings(e,t,n,i){this.bindingUtils.createBindings(e,t,n,i)}updateBinding(e){this.bindingUtils.updateBinding(e)}deleteBindGroupData(e){this.bindingUtils.deleteBindGroupData(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return XR[e]!==void 0&&(e=XR[e]),this.device.features.has(e)}copyTextureToTexture(e,t,n=null,i=null,r=0,o=0){let u=0,c=0,d=0,f=0,p=0,g=0,y=e.image.width,x=e.image.height,v=1;n!==null&&(n.isBox3===!0?(f=n.min.x,p=n.min.y,g=n.min.z,y=n.max.x-n.min.x,x=n.max.y-n.min.y,v=n.max.z-n.min.z):(f=n.min.x,p=n.min.y,y=n.max.x-n.min.x,x=n.max.y-n.min.y,v=1)),i!==null&&(u=i.x,c=i.y,d=i.z||0);const S=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),w=this.get(e).texture,M=this.get(t).texture;S.copyTextureToTexture({texture:w,mipLevel:r,origin:{x:f,y:p,z:g}},{texture:M,mipLevel:o,origin:{x:u,y:c,z:d}},[y,x,v]),this.device.queue.submit([S.finish()]),o===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){const i=this.get(t);let r=null;t.renderTarget?e.isDepthTexture?r=this.get(t.depthTexture).texture:r=this.get(t.textures[0]).texture:e.isDepthTexture?r=this.textureUtils.getDepthBuffer(t.depth,t.stencil):r=this.context.getCurrentTexture();const o=this.get(e).texture;if(r.format!==o.format){Ae("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",r.format,o.format);return}let u;if(i.currentPass?(i.currentPass.end(),u=i.encoder):u=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),u.copyTextureToTexture({texture:r,origin:[n.x,n.y,0]},{texture:o},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,u),i.currentPass){const{descriptor:c}=i;for(let d=0;d<c.colorAttachments.length;d++)c.colorAttachments[d].loadOp=Mt.Load;t.depth&&(c.depthStencilAttachment.depthLoadOp=Mt.Load),t.stencil&&(c.depthStencilAttachment.stencilLoadOp=Mt.Load),i.currentPass=u.beginRenderPass(c),i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([u.finish()])}dispose(){if(this.bindingUtils.dispose(),this.textureUtils.dispose(),this.occludedResolveCache){for(const e of this.occludedResolveCache.values())e.destroy();this.occludedResolveCache.clear()}if(this.timestampQueryPool)for(const e of Object.values(this.timestampQueryPool))e!==null&&e.dispose();this.parameters.device===void 0&&this.device!==null&&this.device.destroy()}}class $ee extends oy{constructor(e,t,n,i,r,o){super(e,t,n,i,r,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class Hee extends oy{constructor(e,t,n,i,r,o){super(e,t,n,i,r,o),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class jee extends _U{constructor(){super(),this.addMaterial(bq,"MeshPhongMaterial"),this.addMaterial(Ly,"MeshStandardMaterial"),this.addMaterial(cW,"MeshPhysicalMaterial"),this.addMaterial(pW,"MeshToonMaterial"),this.addMaterial(rO,"MeshBasicMaterial"),this.addMaterial(yq,"MeshLambertMaterial"),this.addMaterial(lq,"MeshNormalMaterial"),this.addMaterial(gW,"MeshMatcapMaterial"),this.addMaterial(nq,"LineBasicMaterial"),this.addMaterial(iq,"LineDashedMaterial"),this.addMaterial(vW,"PointsMaterial"),this.addMaterial(bO,"SpriteMaterial"),this.addMaterial(MW,"ShadowMaterial"),this.addLight(uQ,uH),this.addLight(_J,jD),this.addLight(vJ,hH),this.addLight(jS,oy),this.addLight(MJ,qD),this.addLight(NJ,aH),this.addLight(AJ,fH),this.addLight(TJ,$ee),this.addLight(wJ,Hee),this.addToneMapping(zO,R8),this.addToneMapping(VO,_D),this.addToneMapping(PO,C8),this.addToneMapping(IO,D8),this.addToneMapping(kO,B8),this.addToneMapping(GO,L8)}}class qee extends WJ{constructor(e={}){let t;e.forceWebGL?t=GR:(t=Gee,e.getFallback=()=>(Ne("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new GR(e)));const n=new t(e);super(n,e),this.library=new jee,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}class Wee{constructor(e,t=Ie(0,0,1,1)){this.renderer=e,this.outputNode=t,this.outputColorTransform=!0,this.needsUpdate=!0;const n=new en;n.name="PostProcessing",this._quadMesh=new If(n),this._quadMesh.name="Post-Processing",this._context=null}render(){const e=this.renderer;this._update(),this._context.onBeforePostProcessing!==null&&this._context.onBeforePostProcessing();const t=e.toneMapping,n=e.outputColorSpace;e.toneMapping=Lo,e.outputColorSpace=bt.workingColorSpace;const i=e.xr.enabled;e.xr.enabled=!1,this._quadMesh.render(e),e.xr.enabled=i,e.toneMapping=t,e.outputColorSpace=n,this._context.onAfterPostProcessing!==null&&this._context.onAfterPostProcessing()}get context(){return this._context}dispose(){this._quadMesh.material.dispose()}_update(){if(this.needsUpdate===!0){const e=this.renderer,t=e.toneMapping,n=e.outputColorSpace,i={postProcessing:this,onBeforePostProcessing:null,onAfterPostProcessing:null};let r=this.outputNode;this.outputColorTransform===!0?(r=r.context(i),r=nS(r,t,n)):(i.toneMapping=t,i.outputColorSpace=n,r=r.context(i)),this._context=i,this._quadMesh.material.fragmentNode=r,this._quadMesh.material.needsUpdate=!0,this.needsUpdate=!1}}async renderAsync(){$t('PostProcessing: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.renderer.init(),this.render()}}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Xee=N.BRDF_GGX,Yee=N.BRDF_Lambert,Zee=N.BasicPointShadowFilter,Qee=N.BasicShadowFilter,Kee=N.Break,Jee=N.Const,ete=N.Continue,tte=N.DFGLUT,nte=N.D_GGX,ste=N.Discard,ite=N.EPSILON,rte=N.F_Schlick,WS=N.Fn,ate=N.INFINITY,ote=N.If,lte=N.Loop,ute=N.NodeAccess,cte=N.NodeShaderStage,hte=N.NodeType,dte=N.NodeUpdateType,fte=N.PCFShadowFilter,pte=N.PCFSoftShadowFilter,mte=N.PI,gte=N.PI2,yte=N.TWO_PI,xte=N.HALF_PI,bte=N.PointShadowFilter,_te=N.Return,vte=N.Schlick_to_F0,Tte=N.ScriptableNodeResources,Ste=N.ShaderNode,wte=N.Stack,Mte=N.Switch,Nte=N.TBNViewMatrix,Ate=N.VSMShadowFilter,Ete=N.V_GGX_SmithCorrelated,Rte=N.Var,Cte=N.VarIntent,XS=N.abs,Dte=N.acesFilmicToneMapping,Bte=N.acos,BU=N.add,Lte=N.addMethodChaining,Fte=N.addNodeElement,Ote=N.agxToneMapping,Ute=N.all,zte=N.alphaT,Vte=N.and,Pte=N.anisotropy,Ite=N.anisotropyB,kte=N.anisotropyT,Gte=N.any,$te=N.append,Hte=N.array,jte=N.arrayBuffer,qte=N.asin,Wte=N.assign,Xte=N.atan,Yte=N.atan2,Zte=N.atomicAdd,Qte=N.atomicAnd,Kte=N.atomicFunc,Jte=N.atomicLoad,ene=N.atomicMax,tne=N.atomicMin,nne=N.atomicOr,sne=N.atomicStore,ine=N.atomicSub,rne=N.atomicXor,ane=N.attenuationColor,one=N.attenuationDistance,lne=N.attribute,une=N.attributeArray,cne=N.backgroundBlurriness,hne=N.backgroundIntensity,dne=N.backgroundRotation,fne=N.batch,pne=N.bentNormalView,mne=N.billboarding,gne=N.bitAnd,yne=N.bitNot,xne=N.bitOr,bne=N.bitXor,_ne=N.bitangentGeometry,vne=N.bitangentLocal,Tne=N.bitangentView,Sne=N.bitangentWorld,wne=N.bitcast,Mne=N.blendBurn,Nne=N.blendColor,Ane=N.blendDodge,Ene=N.blendOverlay,Rne=N.blendScreen,Cne=N.blur,Dne=N.bool,Bne=N.buffer,Lne=N.bufferAttribute,Fne=N.bumpMap,One=N.burn,Une=N.builtin,zne=N.builtinAOContext,Vne=N.builtinShadowContext,Pne=N.bvec2,Ine=N.bvec3,kne=N.bvec4,Gne=N.bypass,$ne=N.cache,Hne=N.call,Tv=N.cameraFar,jne=N.cameraIndex,Sv=N.cameraNear,qne=N.cameraNormalMatrix,Wne=N.cameraPosition,Xne=N.cameraProjectionMatrix,Yne=N.cameraProjectionMatrixInverse,Zne=N.cameraViewMatrix,Qne=N.cameraViewport,Kne=N.cameraWorldMatrix,Jne=N.cbrt,ese=N.cdl,LU=N.ceil,FU=N.checker,tse=N.cineonToneMapping,OU=N.clamp,nse=N.clearcoat,sse=N.clearcoatNormalView,ise=N.clearcoatRoughness,rse=N.code,UU=N.color,ase=N.colorSpaceToWorking,ose=N.colorToDirection,lse=N.compute,use=N.computeKernel,cse=N.computeSkinning,hse=N.context,dse=N.convert,fse=N.convertColorSpace,pse=N.convertToTexture,mse=N.countLeadingZeros,gse=N.countOneBits,yse=N.countTrailingZeros,zU=N.cos,VU=N.cross,xse=N.cubeTexture,bse=N.cubeTextureBase,_se=N.dFdx,vse=N.dFdy,Tse=N.dashSize,Sse=N.debug,wse=N.decrement,Mse=N.decrementBefore,Nse=N.defaultBuildStages,Ase=N.defaultShaderStages,Ese=N.defined,Rse=N.degrees,Cse=N.deltaTime,Dse=N.densityFog,Bse=N.densityFogFactor,PU=N.depth,IU=N.depthPass,Lse=N.determinant,Fse=N.difference,Ose=N.diffuseColor,Use=N.directPointLight,zse=N.directionToColor,Vse=N.directionToFaceDirection,Pse=N.dispersion,kU=N.distance,GU=N.div,Ise=N.dodge,da=N.dot,kse=N.drawIndex,Gse=N.dynamicBufferAttribute,$se=N.element,Hse=N.emissive,jse=N.equal,qse=N.equals,Wse=N.equirectUV,Xse=N.exp,Yse=N.exp2,Zse=N.expression,Qse=N.faceDirection,Kse=N.faceForward,Jse=N.faceforward,Ht=N.float,eie=N.floatBitsToInt,tie=N.floatBitsToUint,O0=N.floor,nie=N.fog,YS=N.fract,sie=N.frameGroup,iie=N.frameId,rie=N.frontFacing,aie=N.fwidth,oie=N.gain,lie=N.gapSize,uie=N.getConstNodeType,cie=N.getCurrentStack,hie=N.getDirection,die=N.getDistanceAttenuation,fie=N.getGeometryRoughness,pie=N.getNormalFromDepth,mie=N.interleavedGradientNoise,gie=N.vogelDiskSample,yie=N.getParallaxCorrectNormal,xie=N.getRoughness,bie=N.getScreenPosition,_ie=N.getShIrradianceAt,vie=N.getShadowMaterial,Tie=N.getShadowRenderObjectFunction,Sie=N.getTextureIndex,wie=N.getViewPosition,Mie=N.globalId,Nie=N.glsl,Aie=N.glslFn,Eie=N.grayscale,Rie=N.greaterThan,Cie=N.greaterThanEqual,Die=N.hash,Bie=N.highpModelNormalViewMatrix,Lie=N.highpModelViewMatrix,Fie=N.hue,Oie=N.increment,Uie=N.incrementBefore,zie=N.instance,Vie=N.instanceIndex,Pie=N.instancedArray,Iie=N.instancedBufferAttribute,kie=N.instancedDynamicBufferAttribute,Gie=N.instancedMesh,$ie=N.int,Hie=N.intBitsToFloat,jie=N.inverse,qie=N.inverseSqrt,Wie=N.inversesqrt,Xie=N.invocationLocalIndex,Yie=N.invocationSubgroupIndex,Zie=N.ior,Qie=N.iridescence,Kie=N.iridescenceIOR,Jie=N.iridescenceThickness,ere=N.ivec2,tre=N.ivec3,nre=N.ivec4,sre=N.js,ire=N.label,$U=N.length,rre=N.lengthSq,are=N.lessThan,ore=N.lessThanEqual,lre=N.lightPosition,ure=N.lightProjectionUV,cre=N.lightShadowMatrix,hre=N.lightTargetDirection,dre=N.lightTargetPosition,fre=N.lightViewPosition,pre=N.lightingContext,mre=N.lights,HU=N.linearDepth,gre=N.linearToneMapping,yre=N.localId,xre=N.log,bre=N.log2,jU=N.logarithmicDepthToViewZ,_re=N.luminance,vre=N.mat2,Tre=N.mat3,Sre=N.mat4,wre=N.matcapUV,Mre=N.materialAO,Nre=N.materialAlphaTest,Are=N.materialAnisotropy,Ere=N.materialAnisotropyVector,Rre=N.materialAttenuationColor,Cre=N.materialAttenuationDistance,Dre=N.materialClearcoat,Bre=N.materialClearcoatNormal,Lre=N.materialClearcoatRoughness,Fre=N.materialColor,Ore=N.materialDispersion,Ure=N.materialEmissive,zre=N.materialEnvIntensity,Vre=N.materialEnvRotation,Pre=N.materialIOR,Ire=N.materialIridescence,kre=N.materialIridescenceIOR,Gre=N.materialIridescenceThickness,$re=N.materialLightMap,Hre=N.materialLineDashOffset,jre=N.materialLineDashSize,qre=N.materialLineGapSize,Wre=N.materialLineScale,Xre=N.materialLineWidth,Yre=N.materialMetalness,Zre=N.materialNormal,Qre=N.materialOpacity,Kre=N.materialPointSize,Jre=N.materialReference,eae=N.materialReflectivity,tae=N.materialRefractionRatio,nae=N.materialRotation,sae=N.materialRoughness,iae=N.materialSheen,rae=N.materialSheenRoughness,aae=N.materialShininess,oae=N.materialSpecular,lae=N.materialSpecularColor,uae=N.materialSpecularIntensity,cae=N.materialSpecularStrength,hae=N.materialThickness,dae=N.materialTransmission,ZS=N.max,fae=N.maxMipLevel,pae=N.mediumpModelViewMatrix,mae=N.metalness,qU=N.min,WU=N.mix,gae=N.mixElement,Gy=N.mod,yae=N.modInt,xae=N.modelDirection,bae=N.modelNormalMatrix,_ae=N.modelPosition,vae=N.modelRadius,Tae=N.modelScale,Sae=N.modelViewMatrix,XU=N.modelViewPosition,wae=N.modelViewProjection,Mae=N.modelWorldMatrix,Nae=N.modelWorldMatrixInverse,Aae=N.morphReference,Eae=N.mrt,YU=N.mul,Rae=N.mx_aastep,Cae=N.mx_add,Dae=N.mx_atan2,Bae=N.mx_cell_noise_float,Lae=N.mx_contrast,Fae=N.mx_divide,Oae=N.mx_fractal_noise_float,Uae=N.mx_fractal_noise_vec2,zae=N.mx_fractal_noise_vec3,Vae=N.mx_fractal_noise_vec4,Pae=N.mx_frame,Iae=N.mx_heighttonormal,kae=N.mx_hsvtorgb,Gae=N.mx_ifequal,$ae=N.mx_ifgreater,Hae=N.mx_ifgreatereq,jae=N.mx_invert,qae=N.mx_modulo,Wae=N.mx_multiply,Xae=N.mx_noise_float,Yae=N.mx_noise_vec3,Zae=N.mx_noise_vec4,Qae=N.mx_place2d,Kae=N.mx_power,Jae=N.mx_ramp4,eoe=N.mx_ramplr,toe=N.mx_ramptb,noe=N.mx_rgbtohsv,soe=N.mx_rotate2d,ioe=N.mx_rotate3d,roe=N.mx_safepower,aoe=N.mx_separate,ooe=N.mx_splitlr,loe=N.mx_splittb,uoe=N.mx_srgb_texture_to_lin_rec709,coe=N.mx_subtract,hoe=N.mx_timer,doe=N.mx_transform_uv,foe=N.mx_unifiednoise2d,poe=N.mx_unifiednoise3d,moe=N.mx_worley_noise_float,goe=N.mx_worley_noise_vec2,yoe=N.mx_worley_noise_vec3,xoe=N.negate,boe=N.neutralToneMapping,_oe=N.nodeArray,voe=N.nodeImmutable,Toe=N.nodeObject,Soe=N.nodeObjectIntent,woe=N.nodeObjects,Moe=N.nodeProxy,Noe=N.nodeProxyIntent,Aoe=N.normalFlat,Eoe=N.normalGeometry,ZU=N.normalLocal,Roe=N.normalMap,QS=N.normalView,Coe=N.normalViewGeometry,Doe=N.normalWorld,Boe=N.normalWorldGeometry,KS=N.normalize,Loe=N.not,Foe=N.notEqual,Ooe=N.numWorkgroups,Uoe=N.objectDirection,zoe=N.objectGroup,Voe=N.objectPosition,Poe=N.objectRadius,Ioe=N.objectScale,koe=N.objectViewPosition,Goe=N.objectWorldMatrix,$oe=N.OnBeforeObjectUpdate,Hoe=N.OnBeforeMaterialUpdate,joe=N.OnObjectUpdate,qoe=N.OnMaterialUpdate,QU=N.oneMinus,Woe=N.or,Xoe=N.orthographicDepthToViewZ,Yoe=N.oscSawtooth,Zoe=N.oscSine,Qoe=N.oscSquare,Koe=N.oscTriangle,Joe=N.output,ele=N.outputStruct,tle=N.overlay,nle=N.overloadingFn,sle=N.packHalf2x16,ile=N.packSnorm2x16,rle=N.packUnorm2x16,ale=N.parabola,ole=N.parallaxDirection,lle=N.parallaxUV,ule=N.parameter,JS=N.pass,cle=N.passTexture,hle=N.pcurve,wv=N.perspectiveDepthToViewZ,dle=N.pmremTexture,fle=N.pointShadow,ple=N.pointUV,mle=N.pointWidth,gle=N.positionGeometry,ew=N.positionLocal,yle=N.positionPrevious,Zd=N.positionView,xle=N.positionViewDirection,ble=N.positionWorld,_le=N.positionWorldDirection,vle=N.posterize,tw=N.pow,Tle=N.pow2,Sle=N.pow3,wle=N.pow4,Mle=N.premultiplyAlpha,Nle=N.property,Ale=N.radians,Ele=N.rand,Rle=N.range,Cle=N.rangeFog,Dle=N.rangeFogFactor,KU=N.reciprocal,Ble=N.reference,Lle=N.referenceBuffer,JU=N.reflect,Fle=N.reflectVector,Ole=N.reflectView,Ule=N.reflector,zle=N.refract,Vle=N.refractVector,Ple=N.refractView,Ile=N.reinhardToneMapping,ez=N.remap,kle=N.remapClamp,Gle=N.renderGroup,$le=N.renderOutput,Hle=N.rendererReference,jle=N.replaceDefaultUV,qle=N.rotate,Wle=N.rotateUV,Xle=N.roughness,Yle=N.round,Zle=N.rtt,Qle=N.sRGBTransferEOTF,Kle=N.sRGBTransferOETF,Jle=N.sample,eue=N.sampler,tue=N.samplerComparison,nue=N.saturate,sue=N.saturation,iue=N.screen,rue=N.screenCoordinate,aue=N.screenDPR,oue=N.screenSize,tz=N.screenUV,lue=N.scriptable,uue=N.scriptableValue,cue=N.select,hue=N.setCurrentStack,due=N.setName,fue=N.shaderStages,pue=N.shadow,mue=N.shadowPositionWorld,gue=N.shapeCircle,yue=N.sharedUniformGroup,xue=N.sheen,bue=N.sheenRoughness,_ue=N.shiftLeft,vue=N.shiftRight,Tue=N.shininess,nz=N.sign,sz=N.sin,Sue=N.sinc,wue=N.skinning,iz=N.smoothstep,Mue=N.smoothstepElement,Nue=N.specularColor,Aue=N.specularF90,Eue=N.spherizeUV,Rue=N.split,Cue=N.spritesheetUV,rz=N.sqrt,Due=N.stack,nw=N.step,Bue=N.stepElement,Lue=N.storage,Fue=N.storageBarrier,Oue=N.storageObject,Uue=N.storageTexture,zue=N.string,Vue=N.struct,az=N.sub,Pue=N.subgroupAdd,Iue=N.subgroupAll,kue=N.subgroupAnd,Gue=N.subgroupAny,$ue=N.subgroupBallot,Hue=N.subgroupBroadcast,jue=N.subgroupBroadcastFirst,que=N.subBuild,Wue=N.subgroupElect,Xue=N.subgroupExclusiveAdd,Yue=N.subgroupExclusiveMul,Zue=N.subgroupInclusiveAdd,Que=N.subgroupInclusiveMul,Kue=N.subgroupIndex,Jue=N.subgroupMax,ece=N.subgroupMin,tce=N.subgroupMul,nce=N.subgroupOr,sce=N.subgroupShuffle,ice=N.subgroupShuffleDown,rce=N.subgroupShuffleUp,ace=N.subgroupShuffleXor,oce=N.subgroupSize,lce=N.subgroupXor,oz=N.tan,uce=N.tangentGeometry,cce=N.tangentLocal,hce=N.tangentView,dce=N.tangentWorld,Mv=N.texture,fce=N.texture3D,pce=N.textureBarrier,mce=N.textureBicubic,gce=N.textureBicubicLevel,yce=N.textureCubeUV,xce=N.textureLoad,bce=N.textureSize,_ce=N.textureLevel,vce=N.textureStore,Tce=N.thickness,lz=N.time,Sce=N.toneMapping,wce=N.toneMappingExposure,Mce=N.toonOutlinePass,Nce=N.transformDirection,Ace=N.transformNormal,Ece=N.transformNormalToView,Rce=N.transformedClearcoatNormalView,Cce=N.transformedNormalView,Dce=N.transformedNormalWorld,Bce=N.transmission,Lce=N.transpose,Fce=N.triNoise3D,uz=N.triplanarTexture,Oce=N.triplanarTextures,Uce=N.trunc,zce=N.uint,Vce=N.uintBitsToFloat,xc=N.uniform,Pce=N.uniformArray,Ice=N.uniformCubeTexture,kce=N.uniformGroup,Gce=N.uniformFlow,$ce=N.uniformTexture,Hce=N.unpackHalf2x16,jce=N.unpackSnorm2x16,qce=N.unpackUnorm2x16,Wce=N.unpremultiplyAlpha,Xce=N.userData,U0=N.uv,Yce=N.uvec2,Zce=N.uvec3,Qce=N.uvec4,Kce=N.varying,Jce=N.varyingProperty,Qd=N.vec2,Mc=N.vec3,sw=N.vec4,ehe=N.vectorComponents,the=N.velocity,nhe=N.vertexColor,she=N.vertexIndex,ihe=N.vertexStage,rhe=N.vibrance,ahe=N.viewZToLogarithmicDepth,cz=N.viewZToOrthographicDepth,ohe=N.viewZToPerspectiveDepth,lhe=N.viewport,uhe=N.viewportCoordinate,wg=N.viewportDepthTexture,hz=N.viewportLinearDepth,che=N.viewportMipTexture,hhe=N.viewportResolution,dhe=N.viewportSafeUV,fhe=N.viewportSharedTexture,phe=N.viewportSize,mhe=N.viewportTexture,dz=N.viewportUV,ghe=N.wgsl,yhe=N.wgslFn,xhe=N.workgroupArray,bhe=N.workgroupBarrier,_he=N.workgroupId,vhe=N.workingToColorSpace,The=N.xor,fz=Object.freeze(Object.defineProperty({__proto__:null,BRDF_GGX:Xee,BRDF_Lambert:Yee,BasicPointShadowFilter:Zee,BasicShadowFilter:Qee,Break:Kee,Const:Jee,Continue:ete,DFGLUT:tte,D_GGX:nte,Discard:ste,EPSILON:ite,F_Schlick:rte,Fn:WS,HALF_PI:xte,INFINITY:ate,If:ote,Loop:lte,NodeAccess:ute,NodeShaderStage:cte,NodeType:hte,NodeUpdateType:dte,OnBeforeMaterialUpdate:Hoe,OnBeforeObjectUpdate:$oe,OnMaterialUpdate:qoe,OnObjectUpdate:joe,PCFShadowFilter:fte,PCFSoftShadowFilter:pte,PI:mte,PI2:gte,PointShadowFilter:bte,Return:_te,Schlick_to_F0:vte,ScriptableNodeResources:Tte,ShaderNode:Ste,Stack:wte,Switch:Mte,TBNViewMatrix:Nte,TWO_PI:yte,VSMShadowFilter:Ate,V_GGX_SmithCorrelated:Ete,Var:Rte,VarIntent:Cte,abs:XS,acesFilmicToneMapping:Dte,acos:Bte,add:BU,addMethodChaining:Lte,addNodeElement:Fte,agxToneMapping:Ote,all:Ute,alphaT:zte,and:Vte,anisotropy:Pte,anisotropyB:Ite,anisotropyT:kte,any:Gte,append:$te,array:Hte,arrayBuffer:jte,asin:qte,assign:Wte,atan:Xte,atan2:Yte,atomicAdd:Zte,atomicAnd:Qte,atomicFunc:Kte,atomicLoad:Jte,atomicMax:ene,atomicMin:tne,atomicOr:nne,atomicStore:sne,atomicSub:ine,atomicXor:rne,attenuationColor:ane,attenuationDistance:one,attribute:lne,attributeArray:une,backgroundBlurriness:cne,backgroundIntensity:hne,backgroundRotation:dne,batch:fne,bentNormalView:pne,billboarding:mne,bitAnd:gne,bitNot:yne,bitOr:xne,bitXor:bne,bitangentGeometry:_ne,bitangentLocal:vne,bitangentView:Tne,bitangentWorld:Sne,bitcast:wne,blendBurn:Mne,blendColor:Nne,blendDodge:Ane,blendOverlay:Ene,blendScreen:Rne,blur:Cne,bool:Dne,buffer:Bne,bufferAttribute:Lne,builtin:Une,builtinAOContext:zne,builtinShadowContext:Vne,bumpMap:Fne,burn:One,bvec2:Pne,bvec3:Ine,bvec4:kne,bypass:Gne,cache:$ne,call:Hne,cameraFar:Tv,cameraIndex:jne,cameraNear:Sv,cameraNormalMatrix:qne,cameraPosition:Wne,cameraProjectionMatrix:Xne,cameraProjectionMatrixInverse:Yne,cameraViewMatrix:Zne,cameraViewport:Qne,cameraWorldMatrix:Kne,cbrt:Jne,cdl:ese,ceil:LU,checker:FU,cineonToneMapping:tse,clamp:OU,clearcoat:nse,clearcoatNormalView:sse,clearcoatRoughness:ise,code:rse,color:UU,colorSpaceToWorking:ase,colorToDirection:ose,compute:lse,computeKernel:use,computeSkinning:cse,context:hse,convert:dse,convertColorSpace:fse,convertToTexture:pse,cos:zU,countLeadingZeros:mse,countOneBits:gse,countTrailingZeros:yse,cross:VU,cubeTexture:xse,cubeTextureBase:bse,dFdx:_se,dFdy:vse,dashSize:Tse,debug:Sse,decrement:wse,decrementBefore:Mse,defaultBuildStages:Nse,defaultShaderStages:Ase,defined:Ese,degrees:Rse,deltaTime:Cse,densityFog:Dse,densityFogFactor:Bse,depth:PU,depthPass:IU,determinant:Lse,difference:Fse,diffuseColor:Ose,directPointLight:Use,directionToColor:zse,directionToFaceDirection:Vse,dispersion:Pse,distance:kU,div:GU,dodge:Ise,dot:da,drawIndex:kse,dynamicBufferAttribute:Gse,element:$se,emissive:Hse,equal:jse,equals:qse,equirectUV:Wse,exp:Xse,exp2:Yse,expression:Zse,faceDirection:Qse,faceForward:Kse,faceforward:Jse,float:Ht,floatBitsToInt:eie,floatBitsToUint:tie,floor:O0,fog:nie,fract:YS,frameGroup:sie,frameId:iie,frontFacing:rie,fwidth:aie,gain:oie,gapSize:lie,getConstNodeType:uie,getCurrentStack:cie,getDirection:hie,getDistanceAttenuation:die,getGeometryRoughness:fie,getNormalFromDepth:pie,getParallaxCorrectNormal:yie,getRoughness:xie,getScreenPosition:bie,getShIrradianceAt:_ie,getShadowMaterial:vie,getShadowRenderObjectFunction:Tie,getTextureIndex:Sie,getViewPosition:wie,globalId:Mie,glsl:Nie,glslFn:Aie,grayscale:Eie,greaterThan:Rie,greaterThanEqual:Cie,hash:Die,highpModelNormalViewMatrix:Bie,highpModelViewMatrix:Lie,hue:Fie,increment:Oie,incrementBefore:Uie,instance:zie,instanceIndex:Vie,instancedArray:Pie,instancedBufferAttribute:Iie,instancedDynamicBufferAttribute:kie,instancedMesh:Gie,int:$ie,intBitsToFloat:Hie,interleavedGradientNoise:mie,inverse:jie,inverseSqrt:qie,inversesqrt:Wie,invocationLocalIndex:Xie,invocationSubgroupIndex:Yie,ior:Zie,iridescence:Qie,iridescenceIOR:Kie,iridescenceThickness:Jie,ivec2:ere,ivec3:tre,ivec4:nre,js:sre,label:ire,length:$U,lengthSq:rre,lessThan:are,lessThanEqual:ore,lightPosition:lre,lightProjectionUV:ure,lightShadowMatrix:cre,lightTargetDirection:hre,lightTargetPosition:dre,lightViewPosition:fre,lightingContext:pre,lights:mre,linearDepth:HU,linearToneMapping:gre,localId:yre,log:xre,log2:bre,logarithmicDepthToViewZ:jU,luminance:_re,mat2:vre,mat3:Tre,mat4:Sre,matcapUV:wre,materialAO:Mre,materialAlphaTest:Nre,materialAnisotropy:Are,materialAnisotropyVector:Ere,materialAttenuationColor:Rre,materialAttenuationDistance:Cre,materialClearcoat:Dre,materialClearcoatNormal:Bre,materialClearcoatRoughness:Lre,materialColor:Fre,materialDispersion:Ore,materialEmissive:Ure,materialEnvIntensity:zre,materialEnvRotation:Vre,materialIOR:Pre,materialIridescence:Ire,materialIridescenceIOR:kre,materialIridescenceThickness:Gre,materialLightMap:$re,materialLineDashOffset:Hre,materialLineDashSize:jre,materialLineGapSize:qre,materialLineScale:Wre,materialLineWidth:Xre,materialMetalness:Yre,materialNormal:Zre,materialOpacity:Qre,materialPointSize:Kre,materialReference:Jre,materialReflectivity:eae,materialRefractionRatio:tae,materialRotation:nae,materialRoughness:sae,materialSheen:iae,materialSheenRoughness:rae,materialShininess:aae,materialSpecular:oae,materialSpecularColor:lae,materialSpecularIntensity:uae,materialSpecularStrength:cae,materialThickness:hae,materialTransmission:dae,max:ZS,maxMipLevel:fae,mediumpModelViewMatrix:pae,metalness:mae,min:qU,mix:WU,mixElement:gae,mod:Gy,modInt:yae,modelDirection:xae,modelNormalMatrix:bae,modelPosition:_ae,modelRadius:vae,modelScale:Tae,modelViewMatrix:Sae,modelViewPosition:XU,modelViewProjection:wae,modelWorldMatrix:Mae,modelWorldMatrixInverse:Nae,morphReference:Aae,mrt:Eae,mul:YU,mx_aastep:Rae,mx_add:Cae,mx_atan2:Dae,mx_cell_noise_float:Bae,mx_contrast:Lae,mx_divide:Fae,mx_fractal_noise_float:Oae,mx_fractal_noise_vec2:Uae,mx_fractal_noise_vec3:zae,mx_fractal_noise_vec4:Vae,mx_frame:Pae,mx_heighttonormal:Iae,mx_hsvtorgb:kae,mx_ifequal:Gae,mx_ifgreater:$ae,mx_ifgreatereq:Hae,mx_invert:jae,mx_modulo:qae,mx_multiply:Wae,mx_noise_float:Xae,mx_noise_vec3:Yae,mx_noise_vec4:Zae,mx_place2d:Qae,mx_power:Kae,mx_ramp4:Jae,mx_ramplr:eoe,mx_ramptb:toe,mx_rgbtohsv:noe,mx_rotate2d:soe,mx_rotate3d:ioe,mx_safepower:roe,mx_separate:aoe,mx_splitlr:ooe,mx_splittb:loe,mx_srgb_texture_to_lin_rec709:uoe,mx_subtract:coe,mx_timer:hoe,mx_transform_uv:doe,mx_unifiednoise2d:foe,mx_unifiednoise3d:poe,mx_worley_noise_float:moe,mx_worley_noise_vec2:goe,mx_worley_noise_vec3:yoe,negate:xoe,neutralToneMapping:boe,nodeArray:_oe,nodeImmutable:voe,nodeObject:Toe,nodeObjectIntent:Soe,nodeObjects:woe,nodeProxy:Moe,nodeProxyIntent:Noe,normalFlat:Aoe,normalGeometry:Eoe,normalLocal:ZU,normalMap:Roe,normalView:QS,normalViewGeometry:Coe,normalWorld:Doe,normalWorldGeometry:Boe,normalize:KS,not:Loe,notEqual:Foe,numWorkgroups:Ooe,objectDirection:Uoe,objectGroup:zoe,objectPosition:Voe,objectRadius:Poe,objectScale:Ioe,objectViewPosition:koe,objectWorldMatrix:Goe,oneMinus:QU,or:Woe,orthographicDepthToViewZ:Xoe,oscSawtooth:Yoe,oscSine:Zoe,oscSquare:Qoe,oscTriangle:Koe,output:Joe,outputStruct:ele,overlay:tle,overloadingFn:nle,packHalf2x16:sle,packSnorm2x16:ile,packUnorm2x16:rle,parabola:ale,parallaxDirection:ole,parallaxUV:lle,parameter:ule,pass:JS,passTexture:cle,pcurve:hle,perspectiveDepthToViewZ:wv,pmremTexture:dle,pointShadow:fle,pointUV:ple,pointWidth:mle,positionGeometry:gle,positionLocal:ew,positionPrevious:yle,positionView:Zd,positionViewDirection:xle,positionWorld:ble,positionWorldDirection:_le,posterize:vle,pow:tw,pow2:Tle,pow3:Sle,pow4:wle,premultiplyAlpha:Mle,property:Nle,radians:Ale,rand:Ele,range:Rle,rangeFog:Cle,rangeFogFactor:Dle,reciprocal:KU,reference:Ble,referenceBuffer:Lle,reflect:JU,reflectVector:Fle,reflectView:Ole,reflector:Ule,refract:zle,refractVector:Vle,refractView:Ple,reinhardToneMapping:Ile,remap:ez,remapClamp:kle,renderGroup:Gle,renderOutput:$le,rendererReference:Hle,replaceDefaultUV:jle,rotate:qle,rotateUV:Wle,roughness:Xle,round:Yle,rtt:Zle,sRGBTransferEOTF:Qle,sRGBTransferOETF:Kle,sample:Jle,sampler:eue,samplerComparison:tue,saturate:nue,saturation:sue,screen:iue,screenCoordinate:rue,screenDPR:aue,screenSize:oue,screenUV:tz,scriptable:lue,scriptableValue:uue,select:cue,setCurrentStack:hue,setName:due,shaderStages:fue,shadow:pue,shadowPositionWorld:mue,shapeCircle:gue,sharedUniformGroup:yue,sheen:xue,sheenRoughness:bue,shiftLeft:_ue,shiftRight:vue,shininess:Tue,sign:nz,sin:sz,sinc:Sue,skinning:wue,smoothstep:iz,smoothstepElement:Mue,specularColor:Nue,specularF90:Aue,spherizeUV:Eue,split:Rue,spritesheetUV:Cue,sqrt:rz,stack:Due,step:nw,stepElement:Bue,storage:Lue,storageBarrier:Fue,storageObject:Oue,storageTexture:Uue,string:zue,struct:Vue,sub:az,subBuild:que,subgroupAdd:Pue,subgroupAll:Iue,subgroupAnd:kue,subgroupAny:Gue,subgroupBallot:$ue,subgroupBroadcast:Hue,subgroupBroadcastFirst:jue,subgroupElect:Wue,subgroupExclusiveAdd:Xue,subgroupExclusiveMul:Yue,subgroupInclusiveAdd:Zue,subgroupInclusiveMul:Que,subgroupIndex:Kue,subgroupMax:Jue,subgroupMin:ece,subgroupMul:tce,subgroupOr:nce,subgroupShuffle:sce,subgroupShuffleDown:ice,subgroupShuffleUp:rce,subgroupShuffleXor:ace,subgroupSize:oce,subgroupXor:lce,tan:oz,tangentGeometry:uce,tangentLocal:cce,tangentView:hce,tangentWorld:dce,texture:Mv,texture3D:fce,textureBarrier:pce,textureBicubic:mce,textureBicubicLevel:gce,textureCubeUV:yce,textureLevel:_ce,textureLoad:xce,textureSize:bce,textureStore:vce,thickness:Tce,time:lz,toneMapping:Sce,toneMappingExposure:wce,toonOutlinePass:Mce,transformDirection:Nce,transformNormal:Ace,transformNormalToView:Ece,transformedClearcoatNormalView:Rce,transformedNormalView:Cce,transformedNormalWorld:Dce,transmission:Bce,transpose:Lce,triNoise3D:Fce,triplanarTexture:uz,triplanarTextures:Oce,trunc:Uce,uint:zce,uintBitsToFloat:Vce,uniform:xc,uniformArray:Pce,uniformCubeTexture:Ice,uniformFlow:Gce,uniformGroup:kce,uniformTexture:$ce,unpackHalf2x16:Hce,unpackSnorm2x16:jce,unpackUnorm2x16:qce,unpremultiplyAlpha:Wce,userData:Xce,uv:U0,uvec2:Yce,uvec3:Zce,uvec4:Qce,varying:Kce,varyingProperty:Jce,vec2:Qd,vec3:Mc,vec4:sw,vectorComponents:ehe,velocity:the,vertexColor:nhe,vertexIndex:she,vertexStage:ihe,vibrance:rhe,viewZToLogarithmicDepth:ahe,viewZToOrthographicDepth:cz,viewZToPerspectiveDepth:ohe,viewport:lhe,viewportCoordinate:uhe,viewportDepthTexture:wg,viewportLinearDepth:hz,viewportMipTexture:che,viewportResolution:hhe,viewportSafeUV:dhe,viewportSharedTexture:fhe,viewportSize:phe,viewportTexture:mhe,viewportUV:dz,vogelDiskSample:gie,wgsl:ghe,wgslFn:yhe,workgroupArray:xhe,workgroupBarrier:bhe,workgroupId:_he,workingToColorSpace:vhe,xor:The},Symbol.toStringTag,{value:"Module"}));var ie=(s=>(s.FLOAT="float",s.COLOR="color",s.VEC2="vec2",s.VEC3="vec3",s.VEC4="vec4",s.UV="uv",s.SCREEN_UV="screenUV",s.VIEWPORT_UV="viewportUV",s.NORMAL="normal",s.NORMAL_VIEW="normalView",s.POSITION="position",s.POSITION_VIEW="positionView",s.VIEW_Z="viewZ",s.VIEW_DIRECTION="viewDirection",s.MODEL_VIEW_POSITION="modelViewPosition",s.TIME="time",s.ADD="add",s.SUB="sub",s.MUL="mul",s.DIV="div",s.MOD="mod",s.ONE_MINUS="oneMinus",s.RECIPROCAL="reciprocal",s.POW="pow",s.ABS="abs",s.SQRT="sqrt",s.SIN="sin",s.COS="cos",s.TAN="tan",s.FLOOR="floor",s.CEIL="ceil",s.MIN="min",s.MAX="max",s.CLAMP="clamp",s.FRACT="fract",s.SIGN="sign",s.REMAP="remap",s.DOT="dot",s.CROSS="cross",s.LENGTH="length",s.DISTANCE="distance",s.NORMALIZE="normalize",s.REFLECT="reflect",s.MIX="mix",s.STEP="step",s.SMOOTHSTEP="smoothstep",s.FRESNEL="fresnel",s.SIMPLEX_NOISE_2D="simplexNoise2d",s.CHECKER="checker",s.VIEWPORT_DEPTH_TEXTURE="viewportDepthTexture",s.VIEWPORT_DEPTH="viewportDepth",s.VIEWPORT_LINEAR_DEPTH="viewportLinearDepth",s.SCENE_VIEW_Z="sceneViewZ",s.LINEAR_DEPTH="linearDepth",s.CAMERA_NEAR="cameraNear",s.CAMERA_FAR="cameraFar",s.PERSPECTIVE_DEPTH_TO_VIEW_Z="perspectiveDepthToViewZ",s.VIEW_Z_TO_ORTHOGRAPHIC_DEPTH="viewZToOrthographicDepth",s.LOGARITHMIC_DEPTH_TO_VIEW_Z="logarithmicDepthToViewZ",s.DEPTH="depth",s.TEXTURE="texture",s.TRIPLANAR="triplanar",s.PASS="pass",s.DEPTH_PASS="depthPass",s.SPLIT="split",s.PREVIEW="preview",s.COMMENT="comment",s.CODE="code",s.MATERIAL="material",s.BASIC_MATERIAL="basicMaterial",s))(ie||{});const pz=se.createContext({simpleMode:!1,setSimpleMode:()=>{}}),uh=()=>se.useContext(pz),She=({children:s})=>{const[e,t]=se.useState(!1);return U.jsx(pz.Provider,{value:{simpleMode:e,setSimpleMode:t},children:s})},mz=s=>{const e=s.toLowerCase();return["color","emissive","alpha"].includes(e)?"#3b82f6":["uv","normal","position","out"].includes(e)?"#fbbf24":["x","y","z","w","r","g","b","a"].includes(e)?"#ef4444":["ao","roughness","metalness","in","opacity"].includes(e)?"#d4d4d8":"#71717a"},whe=se.memo(({input:s,data:e,simpleMode:t})=>{var r,o;const i=jv({handleType:"target",handleId:s}).length>0;return U.jsxs("div",{className:"flex flex-col relative group",children:[U.jsx("div",{className:`flex items-center justify-between ${t?"mb-0":"mb-0.5"}`,children:U.jsx("span",{className:`${t?"text-[7px]":"text-[8px]"} font-bold uppercase ${i?"text-zinc-400":"text-zinc-600"}`,children:s})}),!i&&U.jsx("div",{className:`${t?"opacity-50 group-hover:opacity-100 transition-opacity":""}`,children:s.includes("color")||s==="emissive"?U.jsx("div",{className:`flex items-center gap-1 bg-zinc-900 rounded-sm border border-zinc-800 ${t?"px-0.5 py-0 h-2.5":"px-1 h-3"}`,children:U.jsx("input",{type:"color",value:((r=e.values)==null?void 0:r[s])||"#000000",onChange:u=>{var c;return(c=e.onChange)==null?void 0:c.call(e,s,u.target.value)},className:"w-full h-full bg-transparent p-0 border-none cursor-pointer"})}):U.jsx("input",{type:"number",step:"0.05",value:((o=e.values)==null?void 0:o[s])??0,onChange:u=>{var c;return(c=e.onChange)==null?void 0:c.call(e,s,u.target.value)},className:`w-full bg-zinc-900/50 text-zinc-400 px-1 rounded-sm border border-zinc-800 text-[8px] focus:outline-none focus:border-zinc-600 ${t?"h-3 text-[7px]":"h-4"}`})}),U.jsx(qi,{type:"target",position:He.Left,id:s,style:{backgroundColor:mz(s)},className:`!border-2 border-zinc-950 transition-transform hover:scale-125 ${t?"!w-2 !h-2 !-left-[9px]":"!w-2.5 !h-2.5 !-left-[15px]"}`})]})}),Mhe=se.memo(({id:s,data:e,selected:t})=>{var i,r,o,u,c,d,f,p;const{simpleMode:n}=uh();return e.icon||sh.Fragment,U.jsxs("div",{className:`relative min-w-[120px] rounded-md border bg-zinc-950 transition-all ${t?"border-blue-500/50 ring-1 ring-blue-500/20":"border-zinc-800 shadow-xl"} ${n?"min-w-[100px]":""}`,children:[U.jsx("div",{className:"overflow-hidden rounded-t-md",children:U.jsx("div",{className:`px-2 flex items-center justify-between bg-zinc-900/40 border-b border-zinc-900 ${n?"py-1":"py-1.5"}`,children:U.jsxs("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[!n&&U.jsx("div",{className:"text-blue-500 shrink-0",children:e.icon&&U.jsx(e.icon,{size:10})}),U.jsx("span",{className:`${n?"text-[8px]":"text-[9px]"} font-black uppercase tracking-tight text-zinc-300 truncate`,children:e.label})]})})}),U.jsxs("div",{className:`${n?"p-1.5 space-y-1":"p-2 space-y-2"}`,children:[(i=e.inputs)==null?void 0:i.map(g=>U.jsx(whe,{input:g,data:e,simpleMode:n},g)),(((r=e.meta)==null?void 0:r.settings)||((o=e.meta)==null?void 0:o.enums))&&U.jsxs("div",{className:`border-t border-zinc-900 ${n?"mt-1 pt-1 space-y-1":"mt-2 pt-2 space-y-1.5"}`,children:[(u=e.meta.settings)==null?void 0:u.map(g=>{var y;return U.jsxs("div",{className:"flex items-center justify-between px-1",children:[U.jsx("span",{className:"text-[7px] font-bold uppercase text-zinc-500",children:g.replace(/([A-Z])/g," $1").trim()}),U.jsx("input",{type:"checkbox",checked:!!((y=e.values)!=null&&y[g]),onChange:x=>{var v;return(v=e.onChange)==null?void 0:v.call(e,g,x.target.checked)},className:"w-3 h-3 bg-zinc-900 border-zinc-800 rounded focus:ring-0 text-blue-500 cursor-pointer accent-blue-500"})]},g)}),e.meta.enums&&Object.entries(e.meta.enums).map(([g,y])=>{var x;return U.jsxs("div",{className:"flex items-center justify-between px-1",children:[U.jsx("span",{className:"text-[7px] font-bold uppercase text-zinc-500",children:g}),U.jsx("select",{value:((x=e.values)==null?void 0:x[g])??0,onChange:v=>{var S;return(S=e.onChange)==null?void 0:S.call(e,g,parseInt(v.target.value))},className:"bg-zinc-900 text-zinc-300 text-[8px] border border-zinc-800 rounded px-1 py-0.5 focus:outline-none cursor-pointer hover:bg-zinc-800 max-w-[60px]",children:Object.entries(y.options).map(([v,S])=>U.jsx("option",{value:S,children:v},v))})]},g)})]}),((c=e.meta)==null?void 0:c.showTransparencyToggle)&&!((d=e.meta)!=null&&d.settings)&&U.jsxs("div",{className:"flex items-center justify-between mt-2 pt-2 border-t border-zinc-900 px-1",children:[U.jsx("span",{className:"text-[7px] font-bold uppercase text-zinc-500",children:"Transparent"}),U.jsx("input",{type:"checkbox",checked:!!((f=e.values)!=null&&f.transparent),onChange:g=>{var y;return(y=e.onChange)==null?void 0:y.call(e,"transparent",g.target.checked)},className:"w-3 h-3 bg-zinc-900 border-zinc-800 rounded focus:ring-0 text-blue-500 cursor-pointer accent-blue-500"})]}),e.value!==void 0&&U.jsx("div",{className:"pt-0.5",children:typeof e.value=="string"&&e.value.startsWith("#")?U.jsx("div",{className:`flex items-center gap-1 bg-zinc-900 rounded-sm border border-zinc-800 ${n?"px-0.5 h-3":"px-1 h-4"}`,children:U.jsx("input",{type:"color",value:e.value||"#ffffff",onChange:g=>{var y;return(y=e.onChange)==null?void 0:y.call(e,"value",g.target.value)},className:"w-full h-full bg-transparent p-0 cursor-pointer"})}):U.jsxs("div",{className:"relative group",children:[U.jsx("input",{type:"number",step:"0.1",value:e.value??1,onChange:g=>{var y;return(y=e.onChange)==null?void 0:y.call(e,"value",g.target.value)},className:`w-full bg-zinc-900/50 text-zinc-200 px-1.5 rounded-sm border border-zinc-800 text-[9px] focus:outline-none focus:border-blue-500/50 ${n?"h-3":"h-4"}`}),!n&&U.jsx("div",{className:"absolute right-1 top-0 bottom-0 flex items-center text-[7px] text-zinc-600 pointer-events-none font-mono",children:"VAL"})]})}),(p=e.outputs)==null?void 0:p.map(g=>U.jsxs("div",{className:`relative flex items-center justify-end ${n?"h-2":"h-3"}`,children:[U.jsx("span",{className:`${n?"text-[6px]":"text-[7px]"} font-bold uppercase text-zinc-600 mr-1.5`,children:g}),U.jsx(qi,{type:"source",position:He.Right,id:g,style:{backgroundColor:mz(g)},className:`!border-2 border-zinc-950 transition-transform hover:scale-125 ${n?"!w-2 !h-2 !-right-[9px]":"!w-2.5 !h-2.5 !-right-[15px]"}`})]},g))]})]})}),Oe=(s,e,t,n,i,r,o,u=Mhe)=>({type:s,label:e,category:t,icon:n,component:u,...i,tslFn:r,codeFn:o}),Nhe=s=>s||Ht(0),Ft=(s,e,t)=>[n=>s(...t.map(i=>Nhe(n[i]))),(n,i,r,o)=>{o&&o(e);const u=t.map(c=>n[c]||"float(0)").join(", ");return`${e}(${u})`}];function Ahe(s){return sh.createElement(Rf,{...s,className:"rotate-180"})}const oa=s=>s||Ht(0),Ehe=[Oe(ie.ADD,"Add","Math",o8,{inputs:["a","b"],outputs:["out"],initialValues:{a:1,b:1}},s=>BU(oa(s.a),oa(s.b)),(s,e,t,n)=>(n==null||n("add"),`${s.a||"float(0)"}.add(${s.b||"float(0)"})`)),Oe(ie.SUB,"Subtract","Math",o2,{inputs:["a","b"],outputs:["out"],initialValues:{a:1,b:1}},s=>az(oa(s.a),oa(s.b)),(s,e,t,n)=>(n==null||n("sub"),`${s.a||"float(0)"}.sub(${s.b||"float(0)"})`)),Oe(ie.MUL,"Multiply","Math",Xv,{inputs:["a","b"],outputs:["out"],initialValues:{a:1,b:1}},s=>YU(oa(s.a),oa(s.b)),(s,e,t,n)=>(n==null||n("mul"),`${s.a||"float(0)"}.mul(${s.b||"float(0)"})`)),Oe(ie.DIV,"Divide","Math",a2,{inputs:["a","b"],outputs:["out"],initialValues:{a:1,b:1}},s=>GU(oa(s.a),oa(s.b)),(s,e,t,n)=>(n==null||n("div"),`${s.a||"float(0)"}.div(${s.b||"float(0)"})`)),Oe(ie.MOD,"Modulo","Math",a8,{inputs:["a","b"],outputs:["out"],initialValues:{a:1,b:1}},...Ft(Gy,"mod",["a","b"])),Oe(ie.POW,"Power","Math",Ug,{inputs:["a","b"],outputs:["out"],initialValues:{a:1,b:1}},...Ft(tw,"pow",["a","b"])),Oe(ie.SQRT,"Sqrt","Math",zl,{inputs:["in"],outputs:["out"],initialValues:{in:1}},...Ft(rz,"sqrt",["in"])),Oe(ie.RECIPROCAL,"Reciprocal (1/x)","Math",a2,{inputs:["in"],outputs:["out"],initialValues:{in:1}},...Ft(KU,"reciprocal",["in"])),Oe(ie.ONE_MINUS,"One Minus (1-x)","Math",o2,{inputs:["in"],outputs:["out"],initialValues:{in:0}},...Ft(QU,"oneMinus",["in"])),Oe(ie.SIN,"Sin","Math",Ec,{inputs:["in"],outputs:["out"],initialValues:{in:0}},...Ft(sz,"sin",["in"])),Oe(ie.COS,"Cos","Math",Ec,{inputs:["in"],outputs:["out"],initialValues:{in:0}},...Ft(zU,"cos",["in"])),Oe(ie.TAN,"Tan","Math",Ec,{inputs:["in"],outputs:["out"],initialValues:{in:0}},...Ft(oz,"tan",["in"])),Oe(ie.ABS,"Abs","Math",zl,{inputs:["in"],outputs:["out"],initialValues:{in:0}},...Ft(XS,"abs",["in"])),Oe(ie.FLOOR,"Floor","Math",r8,{inputs:["in"],outputs:["out"],initialValues:{in:0}},...Ft(O0,"floor",["in"])),Oe(ie.CEIL,"Ceil","Math",Y0,{inputs:["in"],outputs:["out"],initialValues:{in:0}},...Ft(LU,"ceil",["in"])),Oe(ie.FRACT,"Fract","Math",zl,{inputs:["in"],outputs:["out"],initialValues:{in:0}},...Ft(YS,"fract",["in"])),Oe(ie.SIGN,"Sign","Math",zl,{inputs:["in"],outputs:["out"],initialValues:{in:0}},...Ft(nz,"sign",["in"])),Oe(ie.MIN,"Min","Math",Rf,{inputs:["a","b"],outputs:["out"],initialValues:{a:0,b:0}},...Ft(qU,"min",["a","b"])),Oe(ie.MAX,"Max","Math",Ahe,{inputs:["a","b"],outputs:["out"],initialValues:{a:0,b:0}},...Ft(ZS,"max",["a","b"])),Oe(ie.CLAMP,"Clamp","Math",u2,{inputs:["in","min","max"],outputs:["out"],initialValues:{in:0,min:0,max:1}},...Ft(OU,"clamp",["in","min","max"])),Oe(ie.REMAP,"Remap","Math",u2,{inputs:["in","inLow","inHigh","outLow","outHigh"],outputs:["out"],initialValues:{in:.5,inLow:0,inHigh:1,outLow:0,outHigh:1}},...Ft(ez,"remap",["in","inLow","inHigh","outLow","outHigh"])),Oe(ie.SPLIT,"Split / Separate","Math",d8,{inputs:["in"],outputs:["x","y","z","w"]},s=>oa(s.in),s=>s.in||"float(0)")];function Rhe(s){return sh.createElement(Rf,{...s,className:"rotate-180"})}const Che=[Oe(ie.DOT,"Dot Product","Vectors",qv,{inputs:["a","b"],outputs:["out"],initialValues:{a:0,b:0}},...Ft(da,"dot",["a","b"])),Oe(ie.CROSS,"Cross Product","Vectors",Xv,{inputs:["a","b"],outputs:["out"],initialValues:{a:0,b:0}},...Ft(VU,"cross",["a","b"])),Oe(ie.LENGTH,"Length","Vectors",Rhe,{inputs:["in"],outputs:["out"],initialValues:{in:0}},...Ft($U,"length",["in"])),Oe(ie.DISTANCE,"Distance","Vectors",Y0,{inputs:["a","b"],outputs:["out"],initialValues:{a:0,b:0}},...Ft(kU,"distance",["a","b"])),Oe(ie.NORMALIZE,"Normalize","Vectors",m8,{inputs:["in"],outputs:["out"],initialValues:{in:0}},...Ft(KS,"normalize",["in"])),Oe(ie.REFLECT,"Reflect","Vectors",j6,{inputs:["in","normal"],outputs:["out"],initialValues:{in:0,normal:0}},...Ft(JU,"reflect",["in","normal"]))],la=s=>s||Ht(0),ua=s=>s||"0.0",Dhe=[Oe(ie.FLOAT,"Float","Constants",s8,{inputs:[],outputs:["out"],initialValue:.5},(s,e)=>Ht(e.value??0),(s,e,t,n)=>(n==null||n("float"),`const ${t} = float(${e.value??0});`)),Oe(ie.COLOR,"Color","Constants",qv,{inputs:[],outputs:["out"],initialValue:"#ffffff"},(s,e)=>UU(e.value||"#ffffff"),(s,e,t,n)=>(n==null||n("color"),`const ${t} = color('${e.value??"#fff"}');`)),Oe(ie.VEC2,"Vec2","Constants",p8,{inputs:["x","y"],outputs:["out"],initialValues:{x:0,y:0}},s=>Qd(la(s.x),la(s.y)),(s,e,t,n)=>(n==null||n("vec2"),`const ${t} = vec2(${ua(s.x)}, ${ua(s.y)});`)),Oe(ie.VEC3,"Vec3","Constants",c2,{inputs:["x","y","z"],outputs:["out"],initialValues:{x:0,y:0,z:0}},s=>Mc(la(s.x),la(s.y),la(s.z)),(s,e,t,n)=>(n==null||n("vec3"),`const ${t} = vec3(${ua(s.x)}, ${ua(s.y)}, ${ua(s.z)});`)),Oe(ie.VEC4,"Vec4","Constants",c2,{inputs:["x","y","z","w"],outputs:["out"],initialValues:{x:0,y:0,z:0,w:0}},s=>sw(la(s.x),la(s.y),la(s.z),la(s.w)),(s,e,t,n)=>(n==null||n("vec4"),`const ${t} = vec4(${ua(s.x)}, ${ua(s.y)}, ${ua(s.z)}, ${ua(s.w)});`)),Oe(ie.UV,"UV Scale","Attributes",cf,{inputs:[],outputs:["out"],initialValue:1},(s,e)=>U0().mul(e.value??1),(s,e,t,n)=>(n==null||n("uv"),`const ${t} = uv().mul(${e.value??1});`)),Oe(ie.SCREEN_UV,"Screen UV","Attributes",cf,{inputs:[],outputs:["out"]},()=>tz,(s,e,t,n)=>(n==null||n("screenUV"),`const ${t} = screenUV;`)),Oe(ie.VIEWPORT_UV,"Viewport UV","Attributes",f8,{inputs:[],outputs:["out"]},()=>dz,(s,e,t,n)=>(n==null||n("viewportUV"),`const ${t} = viewportUV;`)),Oe(ie.NORMAL,"Normal","Attributes",zl,{inputs:[],outputs:["out"]},()=>ZU,(s,e,t,n)=>(n==null||n("normalLocal"),`const ${t} = normalLocal;`)),Oe(ie.NORMAL_VIEW,"Normal (View)","Attributes",zl,{inputs:[],outputs:["out"]},()=>QS,(s,e,t,n)=>(n==null||n("normalView"),`const ${t} = normalView;`)),Oe(ie.POSITION,"Position","Attributes",l2,{inputs:[],outputs:["out"]},()=>ew,(s,e,t,n)=>(n==null||n("positionLocal"),`const ${t} = positionLocal;`)),Oe(ie.POSITION_VIEW,"Position (View)","Attributes",l2,{inputs:[],outputs:["out"]},()=>Zd,(s,e,t,n)=>(n==null||n("positionView"),`const ${t} = positionView;`)),Oe(ie.VIEW_Z,"View Z","Attributes",wo,{inputs:[],outputs:["out"]},()=>Zd.z.mul(1).toVar(),(s,e,t,n)=>(n==null||n("positionView"),`const ${t} = positionView.z.mul(1).toVar();`)),Oe(ie.VIEW_DIRECTION,"View Direction","Attributes",Q6,{inputs:[],outputs:["out"]},()=>KS(Zd.negate()),(s,e,t,n)=>(n==null||n("positionView"),n==null||n("normalize"),`const ${t} = normalize(positionView.negate());`)),Oe(ie.MODEL_VIEW_POSITION,"ModelView Position","Attributes",n8,{inputs:[],outputs:["out"]},()=>XU,(s,e,t,n)=>(n==null||n("modelViewPosition"),`const ${t} = modelViewPosition;`)),Oe(ie.TIME,"Time","Attributes",Ug,{inputs:[],outputs:["out"]},()=>lz,(s,e,t,n)=>(n==null||n("time"),`const ${t} = time;`)),Oe(ie.MIX,"Mix (Lerp)","Logic",Z6,{inputs:["a","b","alpha"],outputs:["out"],initialValues:{a:0,b:1,alpha:.5}},...Ft(WU,"mix",["a","b","alpha"])),Oe(ie.STEP,"Step","Logic",y8,{inputs:["edge","in"],outputs:["out"],initialValues:{edge:.5,in:0}},...Ft(nw,"step",["edge","in"])),Oe(ie.SMOOTHSTEP,"Smoothstep","Logic",Ec,{inputs:["low","high","in"],outputs:["out"],initialValues:{low:0,high:1,in:0}},...Ft(iz,"smoothstep",["low","high","in"]))],JR=WS(([s])=>Gy(s.mul(34).add(1).mul(s),289)),Bhe=WS(([s])=>{const e=sw(.211324865405187,.366025403784439,-.577350269189626,.024390243902439),t=O0(s.add(da(s,Qd(e.y,e.y)))),n=s.sub(t).add(da(t,Qd(e.x,e.x))),i=nw(n.y,n.x),r=Ht(1).sub(i),o=n.sub(Qd(i,r)).add(e.x),u=n.add(e.z),c=Gy(t,289),d=JR(JR(Mc(c.y,c.y.add(r),c.y.add(1))).add(Mc(c.x,c.x.add(i),c.x.add(1)))),f=ZS(Ht(.5).sub(Mc(da(n,n),da(o,o),da(u,u))),0),p=f.mul(f).mul(f).mul(f),g=YS(d.mul(e.w)).mul(2).sub(1),y=XS(g).sub(.5),x=O0(g.add(.5)),v=g.sub(x),S=p.mul(Ht(1.79284291400159).sub(Ht(.85373472095314).mul(v.mul(v).add(y.mul(y))))),w=Mc(v.x.mul(n.x).add(y.x.mul(n.y)),v.y.mul(o.x).add(y.y.mul(o.y)),v.z.mul(u.x).add(y.z.mul(u.y)));return Ht(130).mul(da(S,w)).mul(.5).add(.5)}),Lhe="https://threejs.org/examples/textures/uv_grid_opengl.jpg",Fhe=se.memo(({input:s,data:e,simpleMode:t})=>{var r;const i=jv({handleType:"target",handleId:s}).length>0;return U.jsxs("div",{className:"flex flex-col relative",children:[U.jsx("div",{className:`flex items-center justify-between ${t?"mb-0":"mb-0.5"}`,children:U.jsx("span",{className:`${t?"text-[7px]":"text-[8px]"} font-bold uppercase ${i?"text-zinc-400":"text-zinc-600"}`,children:s})}),!i&&s!=="uv"&&U.jsx("input",{type:"number",step:"0.05",value:((r=e.values)==null?void 0:r[s])??0,onChange:o=>{var u;return(u=e.onChange)==null?void 0:u.call(e,s,parseFloat(o.target.value))},className:`w-full bg-zinc-900/50 text-zinc-400 px-1 rounded-sm border border-zinc-800 text-[8px] focus:outline-none focus:border-zinc-600 ${t?"h-3":"h-4"}`}),U.jsx(qi,{type:"target",position:He.Left,id:s,style:{backgroundColor:s==="uv"?"#fbbf24":"#d4d4d8"},className:`!border-2 border-zinc-950 transition-transform hover:scale-125 ${t?"!w-2 !h-2 !-left-[9px]":"!w-2.5 !h-2.5 !-left-[15px]"}`})]})}),eC=se.memo(({id:s,data:e,selected:t})=>{var u;const n=se.useRef(null),{simpleMode:i}=uh(),r=c=>{var f,p;const d=(f=c.target.files)==null?void 0:f[0];if(d){const g=URL.createObjectURL(d);(p=e.onChange)==null||p.call(e,"value",g)}},o=e.value||Lhe;return U.jsxs("div",{className:`relative min-w-[120px] rounded-md border bg-zinc-950 transition-all ${t?"border-blue-500/50 ring-1 ring-blue-500/20":"border-zinc-800 shadow-xl"} ${i?"min-w-[100px]":""}`,children:[U.jsx("div",{className:"overflow-hidden rounded-t-md",children:U.jsx("div",{className:`px-2 flex items-center justify-between bg-zinc-900/40 border-b border-zinc-900 ${i?"py-1":"py-1.5"}`,children:U.jsxs("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[!i&&U.jsx("div",{className:"text-blue-500 shrink-0",children:U.jsx(J3,{size:10})}),U.jsx("span",{className:`${i?"text-[8px]":"text-[9px]"} font-black uppercase tracking-tight text-zinc-300 truncate`,children:e.label})]})})}),U.jsxs("div",{className:`${i?"p-1.5 space-y-1":"p-2 space-y-2"}`,children:[U.jsxs("div",{className:`relative w-full bg-black rounded-sm border border-zinc-800 overflow-hidden group cursor-pointer ${i?"h-10":"h-16"}`,onClick:()=>{var c;return(c=n.current)==null?void 0:c.click()},children:[U.jsx("img",{src:o,alt:"Texture",className:"w-full h-full object-cover"}),U.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:U.jsx(x8,{size:12,className:"text-white"})}),U.jsx("input",{ref:n,type:"file",accept:"image/*",className:"hidden",onChange:r})]}),(u=e.inputs)==null?void 0:u.map(c=>U.jsx(Fhe,{input:c,data:e,simpleMode:i},c)),U.jsxs("div",{className:`relative flex items-center justify-end ${i?"h-2":"h-3 pt-1"}`,children:[U.jsx("span",{className:`${i?"text-[6px]":"text-[7px]"} font-bold uppercase text-zinc-600 mr-1.5`,children:"RGB"}),U.jsx(qi,{type:"source",position:He.Right,id:"out",style:{backgroundColor:"#3b82f6"},className:`!border-2 border-zinc-950 transition-transform hover:scale-125 ${i?"!w-2 !h-2 !-right-[9px]":"!w-2.5 !h-2.5 !-right-[15px]"}`})]})]})]})});function lg(s,e){const t=Math.sin(s*12.9898+e*78.233)*43758.5453;return t-Math.floor(t)}function Ohe(s,e){const t=Math.floor(s),n=Math.floor(e),i=s-t,r=e-n,o=lg(t,n),u=lg(t+1,n),c=lg(t,n+1),d=lg(t+1,n+1),f=i*i*(3-2*i),p=r*r*(3-2*r);return o+(u-o)*f+(c-o)*p*(d-u+(o-u)*f)*(1-p)}class tC{static evaluateNode(e,t,n,i,r=0){var p;if(r>10)return 0;const o=(p=e.type)==null?void 0:p.replace("Node",""),u=(g,y=0)=>{var S;const x=n.find(w=>w.target===e.id&&w.targetHandle===g);if(x){const w=t.find(M=>M.id===x.source);if(w){const M=this.evaluateNode(w,t,n,i,r+1);if(x.sourceHandle&&x.sourceHandle!=="out"){const T=x.sourceHandle;if(M instanceof Ge||M instanceof J||M instanceof yt)return M[T]!==void 0?M[T]:0;if(M instanceof Qe){if(T==="x"||T==="r")return M.r;if(T==="y"||T==="g")return M.g;if(T==="z"||T==="b")return M.b}if(typeof M=="number")return M}return M}}const v=((S=e.data.values)==null?void 0:S[g])??e.data.value??y;return typeof v=="string"&&v.startsWith("#")?new Qe(v):v},c=g=>{if(typeof g=="number")return isNaN(g)?0:g;if(typeof g=="string"){const y=parseFloat(g);return isNaN(y)?0:y}return g instanceof Qe?(g.r+g.g+g.b)/3:g instanceof J?g.x:0},d=g=>{if(g instanceof Qe)return g.clone();if(g instanceof J)return new Qe(g.x,g.y,g.z);const y=c(g);return new Qe(y,y,y)},f=g=>{if(g instanceof J)return g.clone();if(g instanceof Qe)return new J(g.r,g.g,g.b);const y=c(g);return new J(y,y,y)};switch(o){case ie.FLOAT:return c(e.data.value);case ie.COLOR:return new Qe(e.data.value??"#ffffff");case ie.VEC2:return new Ge(c(u("x")),c(u("y")));case ie.VEC3:return new J(c(u("x")),c(u("y")),c(u("z")));case ie.VEC4:return new yt(c(u("x")),c(u("y")),c(u("z")),c(u("w")));case ie.UV:{const g=c(u("value",1));return new Ge(i.uv.x*g,i.uv.y*g)}case ie.SCREEN_UV:case ie.VIEWPORT_UV:return new Ge(i.uv.x,i.uv.y);case ie.CHECKER:{const g=u("uv"),y=g instanceof Ge?g:new Ge(i.uv.x,i.uv.y),x=Math.floor(y.x*2),v=Math.floor(y.y*2);return(x+v)%2===0?1:0}case ie.SIMPLEX_NOISE_2D:{const g=u("uv"),y=g instanceof Ge?g:new Ge(i.uv.x,i.uv.y);return Ohe(y.x*5,y.y*5)}case ie.TEXTURE:case ie.TRIPLANAR:case ie.PASS:return(Math.floor(i.uv.x*5)+Math.floor(i.uv.y*5))%2===0?.2:.8;case ie.VIEWPORT_DEPTH_TEXTURE:return i.uv.x;case ie.VIEWPORT_DEPTH:case ie.VIEWPORT_LINEAR_DEPTH:case ie.DEPTH:case ie.DEPTH_PASS:return .5;case ie.LINEAR_DEPTH:return c(u("depth"));case ie.SCENE_VIEW_Z:case ie.LOGARITHMIC_DEPTH_TO_VIEW_Z:case ie.PERSPECTIVE_DEPTH_TO_VIEW_Z:return c(u("depth"))*10;case ie.VIEW_Z_TO_ORTHOGRAPHIC_DEPTH:return c(u("viewZ"))/10;case ie.VIEW_Z:return 0;case ie.VIEW_DIRECTION:return new J(0,0,1);case ie.CAMERA_NEAR:return .1;case ie.CAMERA_FAR:return 100;case ie.NORMAL:case ie.NORMAL_VIEW:return new J(0,0,1);case ie.POSITION:case ie.POSITION_VIEW:case ie.MODEL_VIEW_POSITION:return new J(i.uv.x,i.uv.y,0);case ie.FRESNEL:{const g=c(u("power",5)),y=f(u("viewDir")),x=f(u("normal"))||new J(0,0,1),v=y.lengthSq()===0?new J(0,0,1):y,S=Math.max(0,x.dot(v));return Math.pow(1-S,g)}case ie.SPLIT:return u("in");case ie.PREVIEW:return u("in");case ie.REMAP:{const g=c(u("in")),y=c(u("inLow",0)),x=c(u("inHigh",1)),v=c(u("outLow",0)),S=c(u("outHigh",1)),w=x-y;return v+(g-y)*(S-v)/(w===0?1e-4:w)}case ie.CLAMP:{const g=c(u("in")),y=c(u("min",0)),x=c(u("max",1));return Math.max(y,Math.min(x,g))}case ie.ADD:{const g=u("a"),y=u("b");return g instanceof Qe||y instanceof Qe?d(g).add(d(y)):c(g)+c(y)}case ie.SUB:{const g=u("a"),y=u("b");return g instanceof Qe||y instanceof Qe?d(g).sub(d(y)):c(g)-c(y)}case ie.MUL:{const g=u("a"),y=u("b");return g instanceof Qe||y instanceof Qe?d(g).multiply(d(y)):c(g)*c(y)}case ie.DIV:return c(u("a"))/(c(u("b"))||.001);case ie.MOD:return c(u("a"))%(c(u("b"))||1);case ie.ONE_MINUS:return 1-c(u("in"));case ie.RECIPROCAL:return 1/(c(u("in"))||.001);case ie.SIN:return Math.sin(c(u("in")));case ie.COS:return Math.cos(c(u("in")));case ie.TAN:return Math.tan(c(u("in")));case ie.ABS:return Math.abs(c(u("in")));case ie.SIGN:return Math.sign(c(u("in")));case ie.FRACT:{const g=c(u("in"));return g-Math.floor(g)}case ie.SQRT:return Math.sqrt(Math.max(0,c(u("in"))));case ie.POW:return Math.pow(c(u("a")),c(u("b")));case ie.MIN:return Math.min(c(u("a")),c(u("b")));case ie.MAX:return Math.max(c(u("a")),c(u("b")));case ie.FLOOR:return Math.floor(c(u("in")));case ie.CEIL:return Math.ceil(c(u("in")));case ie.DOT:return f(u("a")).dot(f(u("b")));case ie.CROSS:return f(u("a")).cross(f(u("b")));case ie.LENGTH:return f(u("in")).length();case ie.DISTANCE:return f(u("a")).distanceTo(f(u("b")));case ie.NORMALIZE:return f(u("in")).normalize();case ie.REFLECT:{const g=f(u("in")),y=f(u("normal"));return g.clone().sub(y.clone().multiplyScalar(2*y.dot(g)))}case ie.MIX:{const g=d(u("a")),y=d(u("b")),x=c(u("alpha"));return g.lerp(y,x)}default:return 0}}static renderPreview(e,t,n,i,r,o){const u=i.createImageData(r,o),c=u.data;for(let d=0;d<o;d++)for(let f=0;f<r;f++){const p=f/r,g=1-d/o,y=this.evaluateNode(e,t,n,{uv:{x:p,y:g},time:0}),x=(d*r+f)*4;let v=0,S=0,w=0;y instanceof Qe?(v=y.r,S=y.g,w=y.b):y instanceof Ge?(v=y.x,S=y.y,w=0):y instanceof J?(v=y.x,S=y.y,w=y.z):typeof y=="number"&&(v=y,S=y,w=y),c[x]=Math.max(0,Math.min(1,v))*255,c[x+1]=Math.max(0,Math.min(1,S))*255,c[x+2]=Math.max(0,Math.min(1,w))*255,c[x+3]=255}i.putImageData(u,0,0)}}const dr=64,Uhe=se.memo(({id:s,data:e,selected:t})=>{const n=h6(),i=f6(),r=se.useRef(null),[o,u]=se.useState(null),{simpleMode:c}=uh();return se.useEffect(()=>{const d=setTimeout(()=>{const f=n.find(g=>g.id===s);if(!f)return;if(i.find(g=>g.target===s&&g.targetHandle==="in")){try{const g=tC.evaluateNode(f,n,i,{uv:{x:0,y:0},time:0});typeof g=="number"?u(g.toFixed(2)):g&&typeof g=="object"&&"isColor"in g?u("#"+g.getHexString()):g&&typeof g=="object"&&"x"in g?u(`(${g.x.toFixed(1)}, ${g.y.toFixed(1)})`):u(null)}catch{u(null)}if(r.current){const g=r.current.getContext("2d");g&&tC.renderPreview(f,n,i,g,dr,dr)}}else{if(r.current){const g=r.current.getContext("2d");g&&(g.fillStyle="#09090b",g.fillRect(0,0,dr,dr),g.strokeStyle="#27272a",g.lineWidth=1,g.beginPath(),g.moveTo(0,0),g.lineTo(dr,dr),g.moveTo(dr,0),g.lineTo(0,dr),g.stroke())}u("No Input")}},80);return()=>clearTimeout(d)},[s,e,n,i]),U.jsxs("div",{className:`relative rounded-lg overflow-hidden bg-zinc-950 border shadow-2xl transition-all group ${t?"border-blue-500 ring-1 ring-blue-500/20":"border-zinc-800"} ${c?"w-24 h-24":"w-32 h-32"}`,children:[U.jsx("canvas",{ref:r,width:dr,height:dr,className:"absolute inset-0 w-full h-full object-cover bg-black rendering-pixelated"}),!c&&U.jsx("div",{className:"absolute top-1 left-1 pointer-events-none z-10",children:U.jsx("div",{className:"flex items-center justify-center w-5 h-5 bg-zinc-950/80 backdrop-blur-sm rounded-md border border-white/10 text-blue-500 shadow-lg",children:U.jsx(K3,{size:10})})}),o&&U.jsx("div",{className:`absolute bottom-1 right-1 bg-zinc-950/80 backdrop-blur-sm rounded-sm border border-white/10 pointer-events-none flex items-center justify-end z-10 shadow-lg ${c?"px-1 py-0":"px-1.5 py-0.5 max-w-[110px]"}`,children:U.jsx("span",{className:`font-mono text-zinc-300 truncate ${c?"text-[7px]":"text-[8px]"}`,children:o})}),U.jsxs("div",{className:`absolute top-1/2 transform -translate-y-1/2 z-20 ${c?"-left-2":"-left-3"}`,children:[U.jsx(qi,{type:"target",position:He.Left,id:"in",style:{backgroundColor:"#fbbf24"},className:`!relative !left-0 !transform-none border-2 border-zinc-950 transition-transform hover:scale-125 shadow-lg ${c?"!w-2 !h-2":"!w-2.5 !h-2.5"}`}),!c&&U.jsx("span",{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-[8px] font-black uppercase text-white drop-shadow-md pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 px-1 rounded",children:"IN"})]})]})}),zhe=se.memo(({id:s,data:e,selected:t})=>{const{simpleMode:n}=uh();return U.jsxs("div",{className:`relative rounded-md border bg-yellow-500/10 transition-all ${t?"border-yellow-500 ring-1 ring-yellow-500/50":"border-yellow-500/30 hover:border-yellow-500/50"} ${n?"min-w-[120px]":"min-w-[200px]"}`,children:[U.jsxs("div",{className:`px-2 flex items-center gap-2 bg-yellow-500/20 border-b border-yellow-500/20 rounded-t-md ${n?"py-1":"py-1.5"}`,children:[!n&&U.jsx(eD,{size:12,className:"text-yellow-500"}),U.jsx("span",{className:`${n?"text-[8px]":"text-[10px]"} font-bold uppercase tracking-wider text-yellow-500`,children:e.label})]}),U.jsx("div",{className:"p-0",children:U.jsx("textarea",{className:`w-full bg-transparent text-yellow-100/90 resize-none outline-none font-mono nodrag ${n?"text-[9px] p-1.5 min-h-[60px]":"text-[10px] p-2 min-h-[100px]"}`,value:e.value,onChange:i=>{var r;return(r=e.onChange)==null?void 0:r.call(e,"value",i.target.value)},placeholder:"Type your comment here...",onKeyDown:i=>i.stopPropagation()})})]})}),Vhe=window;function gz(s,e,t={}){const n=Object.assign({tab:"	",indentOn:/[({\[]$/,moveToNewLine:/^[)}\]]/,spellcheck:!1,catchTab:!0,preserveIdent:!0,addClosing:!0,history:!0,window:Vhe},t),i=n.window,r=i.document;let o=[],u=[],c=-1,d=!1,f,p;s.setAttribute("contenteditable","plaintext-only"),s.setAttribute("spellcheck",n.spellcheck?"true":"false"),s.style.outline="none",s.style.overflowWrap="break-word",s.style.overflowY="auto",s.style.whiteSpace="pre-wrap";let g=!1;e(s),s.contentEditable!=="plaintext-only"&&(g=!0),g&&s.setAttribute("contenteditable","true");const y=re(()=>{const W=M();e(s,W),T(W)},30);let x=!1;const v=W=>!Y(W)&&!F(W)&&W.key!=="Meta"&&W.key!=="Control"&&W.key!=="Alt"&&!W.key.startsWith("Arrow"),S=re(W=>{v(W)&&(G(),x=!1)},300),w=(W,le)=>{o.push([W,le]),s.addEventListener(W,le)};w("keydown",W=>{W.defaultPrevented||(p=q(),n.preserveIdent?D(W):R(W),n.catchTab&&L(W),n.addClosing&&B(W),n.history&&(X(W),v(W)&&!x&&(G(),x=!0)),g&&!k(W)&&T(M()))}),w("keyup",W=>{W.defaultPrevented||W.isComposing||(p!==q()&&y(),S(W),f&&f(q()))}),w("focus",W=>{d=!0}),w("blur",W=>{d=!1}),w("paste",W=>{G(),j(W),G(),f&&f(q())});function M(){const W=fe(),le={start:0,end:0,dir:void 0};let{anchorNode:pe,anchorOffset:xe,focusNode:Me,focusOffset:Fe}=W;if(!pe||!Me)throw"error1";if(pe===s&&Me===s)return le.start=xe>0&&s.textContent?s.textContent.length:0,le.end=Fe>0&&s.textContent?s.textContent.length:0,le.dir=Fe>=xe?"->":"<-",le;if(pe.nodeType===Node.ELEMENT_NODE){const De=r.createTextNode("");pe.insertBefore(De,pe.childNodes[xe]),pe=De,xe=0}if(Me.nodeType===Node.ELEMENT_NODE){const De=r.createTextNode("");Me.insertBefore(De,Me.childNodes[Fe]),Me=De,Fe=0}return ee(s,De=>{if(De===pe&&De===Me)return le.start+=xe,le.end+=Fe,le.dir=xe<=Fe?"->":"<-","stop";if(De===pe)if(le.start+=xe,!le.dir)le.dir="->";else return"stop";else if(De===Me)if(le.end+=Fe,!le.dir)le.dir="<-";else return"stop";De.nodeType===Node.TEXT_NODE&&(le.dir!="->"&&(le.start+=De.nodeValue.length),le.dir!="<-"&&(le.end+=De.nodeValue.length))}),s.normalize(),le}function T(W){const le=fe();let pe,xe=0,Me,Fe=0;if(W.dir||(W.dir="->"),W.start<0&&(W.start=0),W.end<0&&(W.end=0),W.dir=="<-"){const{start:Le,end:Ve}=W;W.start=Ve,W.end=Le}let De=0;ee(s,Le=>{if(Le.nodeType!==Node.TEXT_NODE)return;const Ve=(Le.nodeValue||"").length;if(De+Ve>W.start&&(pe||(pe=Le,xe=W.start-De),De+Ve>W.end))return Me=Le,Fe=W.end-De,"stop";De+=Ve}),pe||(pe=s,xe=s.childNodes.length),Me||(Me=s,Fe=s.childNodes.length),W.dir=="<-"&&([pe,xe,Me,Fe]=[Me,Fe,pe,xe]),le.setBaseAndExtent(pe,xe,Me,Fe)}function A(){const le=fe().getRangeAt(0),pe=r.createRange();return pe.selectNodeContents(s),pe.setEnd(le.startContainer,le.startOffset),pe.toString()}function C(){const le=fe().getRangeAt(0),pe=r.createRange();return pe.selectNodeContents(s),pe.setStart(le.endContainer,le.endOffset),pe.toString()}function D(W){if(W.key==="Enter"){const le=A(),pe=C();let[xe]=V(le),Me=xe;if(n.indentOn.test(le)&&(Me+=n.tab),Me.length>0?(he(W),W.stopPropagation(),$(`
`+Me)):R(W),Me!==xe&&n.moveToNewLine.test(pe)){const Fe=M();$(`
`+xe),T(Fe)}}}function R(W){if(g&&W.key==="Enter")if(he(W),W.stopPropagation(),C()==""){$(`
 `);const le=M();le.start=--le.end,T(le)}else $(`
`)}function B(W){const le=`([{'"`,pe=`)]}'"`,xe=C(),Me=A(),Fe=Me.substr(Me.length-1)==="\\",De=xe.substr(0,1);if(pe.includes(W.key)&&!Fe&&De===W.key){const Le=M();he(W),Le.start=++Le.end,T(Le)}else if(le.includes(W.key)&&!Fe&&(`"'`.includes(W.key)||[""," ",`
`].includes(De))){he(W);const Le=M(),Ve=Le.start==Le.end?"":fe().toString(),nt=W.key+Ve+pe[le.indexOf(W.key)];$(nt),Le.start++,Le.end++,T(Le)}}function L(W){if(W.key==="Tab")if(he(W),W.shiftKey){const le=A();let[pe,xe]=V(le);if(pe.length>0){const Me=M(),Fe=Math.min(n.tab.length,pe.length);T({start:xe,end:xe+Fe}),r.execCommand("delete"),Me.start-=Fe,Me.end-=Fe,T(Me)}}else $(n.tab)}function X(W){if(Y(W)){he(W),c--;const le=u[c];le&&(s.innerHTML=le.html,T(le.pos)),c<0&&(c=0)}if(F(W)){he(W),c++;const le=u[c];le&&(s.innerHTML=le.html,T(le.pos)),c>=u.length&&c--}}function G(){if(!d)return;const W=s.innerHTML,le=M(),pe=u[c];if(pe&&pe.html===W&&pe.pos.start===le.start&&pe.pos.end===le.end)return;c++,u[c]={html:W,pos:le},u.splice(c+1);const xe=300;c>xe&&(c=xe,u.splice(0,1))}function j(W){he(W);const le=(W.originalEvent||W).clipboardData.getData("text/plain").replace(/\r/g,""),pe=M();$(le),e(s),T({start:Math.min(pe.start,pe.end)+le.length,end:Math.min(pe.start,pe.end)+le.length,dir:"<-"})}function ee(W,le){const pe=[];W.firstChild&&pe.push(W.firstChild);let xe=pe.pop();for(;xe&&le(xe)!=="stop";)xe.nextSibling&&pe.push(xe.nextSibling),xe.firstChild&&pe.push(xe.firstChild),xe=pe.pop()}function P(W){return W.metaKey||W.ctrlKey}function Y(W){return P(W)&&!W.shiftKey&&I(W)==="Z"}function F(W){return P(W)&&W.shiftKey&&I(W)==="Z"}function k(W){return P(W)&&I(W)==="C"}function I(W){let le=W.key||W.keyCode||W.which;if(le)return(typeof le=="string"?le:String.fromCharCode(le)).toUpperCase()}function $(W){W=W.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),r.execCommand("insertHTML",!1,W)}function re(W,le){let pe=0;return(...xe)=>{clearTimeout(pe),pe=i.setTimeout(()=>W(...xe),le)}}function V(W){let le=W.length-1;for(;le>=0&&W[le]!==`
`;)le--;le++;let pe=le;for(;pe<W.length&&/[ \t]/.test(W[pe]);)pe++;return[W.substring(le,pe)||"",le,pe]}function q(){return s.textContent||""}function he(W){W.preventDefault()}function fe(){var W;return((W=s.parentNode)===null||W===void 0?void 0:W.nodeType)==Node.DOCUMENT_FRAGMENT_NODE?s.parentNode.getSelection():i.getSelection()}return{updateOptions(W){Object.assign(n,W)},updateCode(W){s.textContent=W,e(s)},onUpdate(W){f=W},toString:q,save:M,restore:T,recordHistory:G,destroy(){for(let[W,le]of o)s.removeEventListener(W,le)}}}var A_={exports:{}},nC;function Phe(){return nC||(nC=1,(function(s){var e=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var t=(function(n){var i=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,r=0,o={},u={manual:n.Prism&&n.Prism.manual,disableWorkerMessageHandler:n.Prism&&n.Prism.disableWorkerMessageHandler,util:{encode:function M(T){return T instanceof c?new c(T.type,M(T.content),T.alias):Array.isArray(T)?T.map(M):T.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(M){return Object.prototype.toString.call(M).slice(8,-1)},objId:function(M){return M.__id||Object.defineProperty(M,"__id",{value:++r}),M.__id},clone:function M(T,A){A=A||{};var C,D;switch(u.util.type(T)){case"Object":if(D=u.util.objId(T),A[D])return A[D];C={},A[D]=C;for(var R in T)T.hasOwnProperty(R)&&(C[R]=M(T[R],A));return C;case"Array":return D=u.util.objId(T),A[D]?A[D]:(C=[],A[D]=C,T.forEach(function(B,L){C[L]=M(B,A)}),C);default:return T}},getLanguage:function(M){for(;M;){var T=i.exec(M.className);if(T)return T[1].toLowerCase();M=M.parentElement}return"none"},setLanguage:function(M,T){M.className=M.className.replace(RegExp(i,"gi"),""),M.classList.add("language-"+T)},currentScript:function(){if(typeof document>"u")return null;if("currentScript"in document)return document.currentScript;try{throw new Error}catch(C){var M=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(C.stack)||[])[1];if(M){var T=document.getElementsByTagName("script");for(var A in T)if(T[A].src==M)return T[A]}return null}},isActive:function(M,T,A){for(var C="no-"+T;M;){var D=M.classList;if(D.contains(T))return!0;if(D.contains(C))return!1;M=M.parentElement}return!!A}},languages:{plain:o,plaintext:o,text:o,txt:o,extend:function(M,T){var A=u.util.clone(u.languages[M]);for(var C in T)A[C]=T[C];return A},insertBefore:function(M,T,A,C){C=C||u.languages;var D=C[M],R={};for(var B in D)if(D.hasOwnProperty(B)){if(B==T)for(var L in A)A.hasOwnProperty(L)&&(R[L]=A[L]);A.hasOwnProperty(B)||(R[B]=D[B])}var X=C[M];return C[M]=R,u.languages.DFS(u.languages,function(G,j){j===X&&G!=M&&(this[G]=R)}),R},DFS:function M(T,A,C,D){D=D||{};var R=u.util.objId;for(var B in T)if(T.hasOwnProperty(B)){A.call(T,B,T[B],C||B);var L=T[B],X=u.util.type(L);X==="Object"&&!D[R(L)]?(D[R(L)]=!0,M(L,A,null,D)):X==="Array"&&!D[R(L)]&&(D[R(L)]=!0,M(L,A,B,D))}}},plugins:{},highlightAll:function(M,T){u.highlightAllUnder(document,M,T)},highlightAllUnder:function(M,T,A){var C={callback:A,container:M,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};u.hooks.run("before-highlightall",C),C.elements=Array.prototype.slice.apply(C.container.querySelectorAll(C.selector)),u.hooks.run("before-all-elements-highlight",C);for(var D=0,R;R=C.elements[D++];)u.highlightElement(R,T===!0,C.callback)},highlightElement:function(M,T,A){var C=u.util.getLanguage(M),D=u.languages[C];u.util.setLanguage(M,C);var R=M.parentElement;R&&R.nodeName.toLowerCase()==="pre"&&u.util.setLanguage(R,C);var B=M.textContent,L={element:M,language:C,grammar:D,code:B};function X(j){L.highlightedCode=j,u.hooks.run("before-insert",L),L.element.innerHTML=L.highlightedCode,u.hooks.run("after-highlight",L),u.hooks.run("complete",L),A&&A.call(L.element)}if(u.hooks.run("before-sanity-check",L),R=L.element.parentElement,R&&R.nodeName.toLowerCase()==="pre"&&!R.hasAttribute("tabindex")&&R.setAttribute("tabindex","0"),!L.code){u.hooks.run("complete",L),A&&A.call(L.element);return}if(u.hooks.run("before-highlight",L),!L.grammar){X(u.util.encode(L.code));return}if(T&&n.Worker){var G=new Worker(u.filename);G.onmessage=function(j){X(j.data)},G.postMessage(JSON.stringify({language:L.language,code:L.code,immediateClose:!0}))}else X(u.highlight(L.code,L.grammar,L.language))},highlight:function(M,T,A){var C={code:M,grammar:T,language:A};if(u.hooks.run("before-tokenize",C),!C.grammar)throw new Error('The language "'+C.language+'" has no grammar.');return C.tokens=u.tokenize(C.code,C.grammar),u.hooks.run("after-tokenize",C),c.stringify(u.util.encode(C.tokens),C.language)},tokenize:function(M,T){var A=T.rest;if(A){for(var C in A)T[C]=A[C];delete T.rest}var D=new p;return g(D,D.head,M),f(M,D,T,D.head,0),x(D)},hooks:{all:{},add:function(M,T){var A=u.hooks.all;A[M]=A[M]||[],A[M].push(T)},run:function(M,T){var A=u.hooks.all[M];if(!(!A||!A.length))for(var C=0,D;D=A[C++];)D(T)}},Token:c};n.Prism=u;function c(M,T,A,C){this.type=M,this.content=T,this.alias=A,this.length=(C||"").length|0}c.stringify=function M(T,A){if(typeof T=="string")return T;if(Array.isArray(T)){var C="";return T.forEach(function(X){C+=M(X,A)}),C}var D={type:T.type,content:M(T.content,A),tag:"span",classes:["token",T.type],attributes:{},language:A},R=T.alias;R&&(Array.isArray(R)?Array.prototype.push.apply(D.classes,R):D.classes.push(R)),u.hooks.run("wrap",D);var B="";for(var L in D.attributes)B+=" "+L+'="'+(D.attributes[L]||"").replace(/"/g,"&quot;")+'"';return"<"+D.tag+' class="'+D.classes.join(" ")+'"'+B+">"+D.content+"</"+D.tag+">"};function d(M,T,A,C){M.lastIndex=T;var D=M.exec(A);if(D&&C&&D[1]){var R=D[1].length;D.index+=R,D[0]=D[0].slice(R)}return D}function f(M,T,A,C,D,R){for(var B in A)if(!(!A.hasOwnProperty(B)||!A[B])){var L=A[B];L=Array.isArray(L)?L:[L];for(var X=0;X<L.length;++X){if(R&&R.cause==B+","+X)return;var G=L[X],j=G.inside,ee=!!G.lookbehind,P=!!G.greedy,Y=G.alias;if(P&&!G.pattern.global){var F=G.pattern.toString().match(/[imsuy]*$/)[0];G.pattern=RegExp(G.pattern.source,F+"g")}for(var k=G.pattern||G,I=C.next,$=D;I!==T.tail&&!(R&&$>=R.reach);$+=I.value.length,I=I.next){var re=I.value;if(T.length>M.length)return;if(!(re instanceof c)){var V=1,q;if(P){if(q=d(k,$,M,ee),!q||q.index>=M.length)break;var le=q.index,he=q.index+q[0].length,fe=$;for(fe+=I.value.length;le>=fe;)I=I.next,fe+=I.value.length;if(fe-=I.value.length,$=fe,I.value instanceof c)continue;for(var W=I;W!==T.tail&&(fe<he||typeof W.value=="string");W=W.next)V++,fe+=W.value.length;V--,re=M.slice($,fe),q.index-=$}else if(q=d(k,0,re,ee),!q)continue;var le=q.index,pe=q[0],xe=re.slice(0,le),Me=re.slice(le+pe.length),Fe=$+re.length;R&&Fe>R.reach&&(R.reach=Fe);var De=I.prev;xe&&(De=g(T,De,xe),$+=xe.length),y(T,De,V);var Le=new c(B,j?u.tokenize(pe,j):pe,Y,pe);if(I=g(T,De,Le),Me&&g(T,I,Me),V>1){var Ve={cause:B+","+X,reach:Fe};f(M,T,A,I.prev,$,Ve),R&&Ve.reach>R.reach&&(R.reach=Ve.reach)}}}}}}function p(){var M={value:null,prev:null,next:null},T={value:null,prev:M,next:null};M.next=T,this.head=M,this.tail=T,this.length=0}function g(M,T,A){var C=T.next,D={value:A,prev:T,next:C};return T.next=D,C.prev=D,M.length++,D}function y(M,T,A){for(var C=T.next,D=0;D<A&&C!==M.tail;D++)C=C.next;T.next=C,C.prev=T,M.length-=D}function x(M){for(var T=[],A=M.head.next;A!==M.tail;)T.push(A.value),A=A.next;return T}if(!n.document)return n.addEventListener&&(u.disableWorkerMessageHandler||n.addEventListener("message",function(M){var T=JSON.parse(M.data),A=T.language,C=T.code,D=T.immediateClose;n.postMessage(u.highlight(C,u.languages[A],A)),D&&n.close()},!1)),u;var v=u.util.currentScript();v&&(u.filename=v.src,v.hasAttribute("data-manual")&&(u.manual=!0));function S(){u.manual||u.highlightAll()}if(!u.manual){var w=document.readyState;w==="loading"||w==="interactive"&&v&&v.defer?document.addEventListener("DOMContentLoaded",S):window.requestAnimationFrame?window.requestAnimationFrame(S):window.setTimeout(S,16)}return u})(e);s.exports&&(s.exports=t),typeof GA<"u"&&(GA.Prism=t),t.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},t.languages.markup.tag.inside["attr-value"].inside.entity=t.languages.markup.entity,t.languages.markup.doctype.inside["internal-subset"].inside=t.languages.markup,t.hooks.add("wrap",function(n){n.type==="entity"&&(n.attributes.title=n.content.replace(/&amp;/,"&"))}),Object.defineProperty(t.languages.markup.tag,"addInlined",{value:function(i,r){var o={};o["language-"+r]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:t.languages[r]},o.cdata=/^<!\[CDATA\[|\]\]>$/i;var u={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:o}};u["language-"+r]={pattern:/[\s\S]+/,inside:t.languages[r]};var c={};c[i]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return i}),"i"),lookbehind:!0,greedy:!0,inside:u},t.languages.insertBefore("markup","cdata",c)}}),Object.defineProperty(t.languages.markup.tag,"addAttribute",{value:function(n,i){t.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+n+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[i,"language-"+i],inside:t.languages[i]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),t.languages.html=t.languages.markup,t.languages.mathml=t.languages.markup,t.languages.svg=t.languages.markup,t.languages.xml=t.languages.extend("markup",{}),t.languages.ssml=t.languages.xml,t.languages.atom=t.languages.xml,t.languages.rss=t.languages.xml,(function(n){var i=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;n.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+i.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+i.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+i.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+i.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:i,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},n.languages.css.atrule.inside.rest=n.languages.css;var r=n.languages.markup;r&&(r.tag.addInlined("style","css"),r.tag.addAttribute("style","css"))})(t),t.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},t.languages.javascript=t.languages.extend("clike",{"class-name":[t.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),t.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,t.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:t.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:t.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:t.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:t.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:t.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),t.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:t.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),t.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),t.languages.markup&&(t.languages.markup.tag.addInlined("script","javascript"),t.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),t.languages.js=t.languages.javascript,(function(){if(typeof t>"u"||typeof document>"u")return;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var n="Loading",i=function(v,S){return" Error "+v+" while fetching file: "+S},r=" Error: File does not exist or is empty",o={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},u="data-src-status",c="loading",d="loaded",f="failed",p="pre[data-src]:not(["+u+'="'+d+'"]):not(['+u+'="'+c+'"])';function g(v,S,w){var M=new XMLHttpRequest;M.open("GET",v,!0),M.onreadystatechange=function(){M.readyState==4&&(M.status<400&&M.responseText?S(M.responseText):M.status>=400?w(i(M.status,M.statusText)):w(r))},M.send(null)}function y(v){var S=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(v||"");if(S){var w=Number(S[1]),M=S[2],T=S[3];return M?T?[w,Number(T)]:[w,void 0]:[w,w]}}t.hooks.add("before-highlightall",function(v){v.selector+=", "+p}),t.hooks.add("before-sanity-check",function(v){var S=v.element;if(S.matches(p)){v.code="",S.setAttribute(u,c);var w=S.appendChild(document.createElement("CODE"));w.textContent=n;var M=S.getAttribute("data-src"),T=v.language;if(T==="none"){var A=(/\.(\w+)$/.exec(M)||[,"none"])[1];T=o[A]||A}t.util.setLanguage(w,T),t.util.setLanguage(S,T);var C=t.plugins.autoloader;C&&C.loadLanguages(T),g(M,function(D){S.setAttribute(u,d);var R=y(S.getAttribute("data-range"));if(R){var B=D.split(/\r\n?|\n/g),L=R[0],X=R[1]==null?B.length:R[1];L<0&&(L+=B.length),L=Math.max(0,Math.min(L-1,B.length)),X<0&&(X+=B.length),X=Math.max(0,Math.min(X,B.length)),D=B.slice(L,X).join(`
`),S.hasAttribute("data-start")||S.setAttribute("data-start",String(L+1))}w.textContent=D,t.highlightElement(w)},function(D){S.setAttribute(u,f),w.textContent=D})}}),t.plugins.fileHighlight={highlight:function(S){for(var w=(S||document).querySelectorAll(p),M=0,T;T=w[M++];)t.highlightElement(T)}};var x=!1;t.fileHighlight=function(){x||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),x=!0),t.plugins.fileHighlight.highlight.apply(this,arguments)}})()})(A_)),A_.exports}var Ihe=Phe();const Pc=z0(Ihe),Ad=`/* 
  Dynamic TSL Code Node
  - 'tsl': The entire three/tsl library.
  - 'inputs': Object containing connected inputs.
*/

// 1. Access Inputs (use defaults if not connected)
// Note: You must list these keys in the return object below
const uv = inputs.uv || tsl.uv();
const scale = inputs.scale || tsl.float(10.0);

// 2. Implement Logic
const pattern = tsl.sin(uv.x.mul(scale))
               .mul(tsl.cos(uv.y.mul(scale)));

// 3. Define Interface (Inputs & Outputs)
return {
  inputs: ['uv', 'scale'],
  outputs: [
    { result: pattern }
  ]
};`,khe=se.memo(({input:s,data:e,simpleMode:t})=>{const i=jv({handleType:"target",handleId:s}).length>0;return U.jsxs("div",{className:"flex items-center justify-between relative group h-4",children:[U.jsx("span",{className:`${t?"text-[7px]":"text-[8px]"} font-bold uppercase ${i?"text-zinc-400":"text-zinc-500"}`,children:s}),U.jsx(qi,{type:"target",position:He.Left,id:s,className:`!border-2 border-zinc-950 !bg-zinc-400 transition-transform hover:scale-125 ${t?"!w-2 !h-2 !-left-[9px]":"!w-2.5 !h-2.5 !-left-[15px]"}`})]})}),Ghe=se.memo(({id:s,data:e,selected:t})=>{var g;const{simpleMode:n}=uh(),{updateNodeData:i}=Ef(),[r,o]=se.useState(e.code||Ad),[u,c]=se.useState(null),d=se.useRef(null),f=se.useRef(null);se.useEffect(()=>{if(d.current&&!f.current){const y=v=>{const S=v.textContent||"";Pc.languages.javascript?v.innerHTML=Pc.highlight(S,Pc.languages.javascript,"javascript"):v.textContent=S},x=gz(d.current,y,{tab:"  "});return x.updateCode(e.code||Ad),x.onUpdate(v=>{o(v)}),f.current=x,()=>{x.destroy(),f.current=null}}},[]),se.useEffect(()=>{f.current&&e.code&&e.code!==r&&document.activeElement!==d.current&&(f.current.updateCode(e.code),o(e.code))},[e.code]);const p=se.useCallback(()=>{try{c(null);const y=new Function("tsl","inputs",r),x=new Proxy({},{get:(T,A)=>Ht(0)}),v=y(fz,x);if(!v||typeof v!="object")throw new Error("Return object { inputs: [], outputs: [] }");const S=Array.isArray(v.inputs)?v.inputs:[];let w=[];v.outputs&&(Array.isArray(v.outputs)?w=v.outputs.map(T=>Object.keys(T)[0]):w=Object.keys(v.outputs));const M={...e,code:r,inputs:S,outputs:w};i(s,M)}catch(y){c(y.message||"Syntax Error")}},[r,s,e,i]);return se.useEffect(()=>{!e.inputs&&!e.outputs&&e.code?p():e.code||(i(s,{...e,code:Ad}),f.current&&f.current.updateCode(Ad),o(Ad))},[]),U.jsxs("div",{className:`relative rounded-md border bg-zinc-950 transition-all flex flex-col ${t?"border-purple-500 ring-1 ring-purple-500/20":"border-zinc-800 shadow-xl"} ${n?"min-w-[160px]":"min-w-[220px]"}`,children:[U.jsxs("div",{className:`px-2 flex items-center justify-between bg-zinc-900/40 border-b border-zinc-900 rounded-t-md ${n?"py-1":"py-1.5"}`,children:[U.jsxs("div",{className:"flex items-center gap-1.5 text-purple-400",children:[!n&&U.jsx(Q3,{size:12}),U.jsx("span",{className:`${n?"text-[8px]":"text-[9px]"} font-black uppercase tracking-tight text-zinc-300`,children:"JS Code"})]}),U.jsx("button",{onClick:p,className:"text-zinc-400 hover:text-green-400 transition-colors bg-zinc-900/50 hover:bg-zinc-800 rounded px-2 py-0.5 border border-zinc-800",title:"Compile & Run",children:U.jsx(tD,{size:10,fill:"currentColor"})})]}),e.inputs&&e.inputs.length>0&&U.jsx("div",{className:`border-b border-zinc-900/50 bg-zinc-900/20 ${n?"p-1.5 space-y-1":"p-2 space-y-1"}`,children:e.inputs.map(y=>U.jsx(khe,{input:y,data:e,simpleMode:n},y))}),U.jsxs("div",{className:"relative group bg-[#0d0d0d]",children:[U.jsx("div",{ref:d,className:`w-full text-zinc-300 font-mono custom-scrollbar border-b border-zinc-900 focus:outline-none focus:bg-zinc-900/10 ${n?"text-[9px] p-1.5 min-h-[80px]":"text-[10px] p-2 min-h-[120px]"}`,style:{tabSize:2,caretColor:"#a855f7",lineHeight:"1.4",whiteSpace:"pre"}}),u&&U.jsxs("div",{className:"absolute bottom-1 right-1 max-w-[95%] bg-red-900/95 text-red-100 text-[9px] px-2 py-1 rounded border border-red-500/50 flex items-center gap-1.5 truncate pointer-events-none shadow-lg z-10",children:[U.jsx(Y6,{size:10,className:"shrink-0"})," ",u]})]}),U.jsxs("div",{className:`${n?"p-1.5 space-y-1":"p-2 space-y-1"}`,children:[(g=e.outputs)==null?void 0:g.map(y=>U.jsxs("div",{className:"relative flex items-center justify-end h-3",children:[U.jsx("span",{className:`${n?"text-[6px]":"text-[7px]"} font-bold uppercase text-zinc-500 mr-1.5`,children:y}),U.jsx(qi,{type:"source",position:He.Right,id:y,className:`!border-2 border-zinc-950 !bg-purple-500 transition-transform hover:scale-125 ${n?"!w-2 !h-2 !-right-[9px]":"!w-2.5 !h-2.5 !-right-[15px]"}`})]},y)),(!e.outputs||e.outputs.length===0)&&U.jsx("div",{className:"text-[8px] text-zinc-700 italic text-center py-0.5",children:"No Outputs"})]})]})}),$he=[Oe(ie.TEXTURE,"Texture 2D","Patterns & Textures",J3,{inputs:["uv"],outputs:["out"],initialValue:null},s=>Mv(s.map,s.uv),(s,e,t,n)=>(n==null||n("texture"),`const ${t} = texture(textureLoader.load('${e.value||"texture.jpg"}'), ${s.uv||"uv()"});`),eC),Oe(ie.TRIPLANAR,"Triplanar","Patterns & Textures",uf,{inputs:["scale","normal","position"],outputs:["out"],initialValues:{scale:1}},s=>{const e=Mv(s.map);return uz(e,e,e,s.scale||Ht(1),s.position||Ht(0),s.normal||Ht(0))},(s,e,t,n)=>(n==null||n("texture"),n==null||n("triplanarTexture"),`const ${t}_tex = texture(textureLoader.load('${e.value||"texture.jpg"}'));
const ${t} = triplanarTexture(${t}_tex, ${t}_tex, ${t}_tex, ${s.scale||"1.0"}, ${s.position||"positionLocal"}, ${s.normal||"normalLocal"});`),eC),Oe(ie.CHECKER,"Checker","Patterns & Textures",cf,{inputs:["uv"],outputs:["out"]},s=>FU(s.uv||U0()),(s,e,t,n)=>(n==null||n("checker"),`checker(${s.uv||"uv()"})`)),Oe(ie.SIMPLEX_NOISE_2D,"Simplex Noise 2D","Patterns & Textures",Ec,{inputs:["uv"],outputs:["out"]},s=>Bhe(s.uv||U0()),(s,e,t,n)=>(n==null||n("simplexNoise2D"),`simplexNoise2D(${s.uv||"uv()"})`)),Oe(ie.PASS,"Pass","Patterns & Textures",tD,{inputs:["in"],outputs:["out"]},s=>JS(s.in||Ht(0)),(s,e,t,n)=>(n==null||n("pass"),`pass(${s.in||"float(0)"})`)),Oe(ie.DEPTH_PASS,"Depth Pass","Patterns & Textures",nD,{inputs:[],outputs:["out"]},()=>IU(void 0,void 0),(s,e,t,n)=>(n==null||n("depthPass"),"depthPass(scene, camera)")),Oe(ie.FRESNEL,"Fresnel","Math",Ug,{inputs:["viewDir","power"],outputs:["out"],initialValues:{power:5}},s=>{const e=s.viewDir||Zd.negate().normalize(),t=s.power||Ht(5);return tw(Ht(1).sub(da(QS,e)),t)},(s,e,t,n)=>{n==null||n("pow"),n==null||n("dot"),n==null||n("normalView"),n==null||n("float");const i=s.viewDir||"normalize(positionView.negate())";s.viewDir||(n==null||n("normalize"),n==null||n("positionView"));const r=s.power||"5.0";return`const ${t} = pow(float(1).sub(dot(normalView, ${i})), ${r});`}),Oe(ie.DEPTH,"Fragment Depth","Depth",wo,{inputs:[],outputs:["out"]},()=>PU,(s,e,t,n)=>(n==null||n("depth"),"depth")),Oe(ie.SCENE_VIEW_Z,"Scene View Z","Depth",wo,{inputs:["depth","near","far"],outputs:["out"]},s=>wv(s.depth||wg(),s.near||Sv,s.far||Tv).mul(1).toVar(),(s,e,t,n)=>(n==null||n("perspectiveDepthToViewZ"),`const ${t} = perspectiveDepthToViewZ(${s.depth||"viewportDepthTexture()"}, ${s.near||"cameraNear"}, ${s.far||"cameraFar"}).mul(1).toVar();`)),Oe(ie.VIEWPORT_DEPTH_TEXTURE,"Viewport Depth Tex","Depth",Wv,{inputs:["uv"],outputs:["out"]},s=>wg(s.uv),(s,e,t,n)=>(n==null||n("viewportDepthTexture"),`viewportDepthTexture(${s.uv||""})`)),Oe(ie.VIEWPORT_LINEAR_DEPTH,"Viewport Linear Depth","Depth",wo,{inputs:[],outputs:["out"]},()=>hz,(s,e,t,n)=>(n==null||n("viewportLinearDepth"),"viewportLinearDepth")),Oe(ie.LINEAR_DEPTH,"Linear Depth","Depth",wo,{inputs:["depth"],outputs:["out"]},s=>HU(s.depth||wg()),(s,e,t,n)=>(n==null||n("linearDepth"),n==null||n("viewportDepthTexture"),`linearDepth(${s.depth||"viewportDepthTexture()"})`)),Oe(ie.CAMERA_NEAR,"Camera Near","Depth",Rf,{inputs:[],outputs:["out"]},()=>Sv,(s,e,t,n)=>(n==null||n("cameraNear"),"cameraNear")),Oe(ie.CAMERA_FAR,"Camera Far","Depth",Y0,{inputs:[],outputs:["out"]},()=>Tv,(s,e,t,n)=>(n==null||n("cameraFar"),"cameraFar")),Oe(ie.PERSPECTIVE_DEPTH_TO_VIEW_Z,"Depth  ViewZ (Persp)","Depth",wo,{inputs:["depth","near","far"],outputs:["out"]},...Ft(wv,"perspectiveDepthToViewZ",["depth","near","far"])),Oe(ie.LOGARITHMIC_DEPTH_TO_VIEW_Z,"Depth  ViewZ (Log)","Depth",wo,{inputs:["depth","near","far"],outputs:["out"]},...Ft(jU,"logarithmicDepthToViewZ",["depth","near","far"])),Oe(ie.VIEW_Z_TO_ORTHOGRAPHIC_DEPTH,"ViewZ  OrthoDepth","Depth",wo,{inputs:["viewZ","near","far"],outputs:["out"]},...Ft(cz,"viewZToOrthographicDepth",["viewZ","near","far"])),Oe(ie.PREVIEW,"Preview","Tools",K3,{inputs:["in"],outputs:[]},s=>s.in||Ht(0),s=>s.in||"float(0)",Uhe),Oe(ie.COMMENT,"Comment","Tools",eD,{inputs:[],outputs:[],initialValue:""},()=>"",(s,e)=>`// ${e.value||""}`,zhe),Oe(ie.CODE,"Code","Tools",Q3,{inputs:[],outputs:[]},(s,e)=>{if(!e.code)return Ht(0);try{const n=new Function("tsl","inputs",e.code)(fz,s);if(n&&n.outputs){if(Array.isArray(n.outputs)){const i={};return n.outputs.forEach(r=>Object.assign(i,r)),i}return n.outputs}return n||Ht(0)}catch(t){return console.warn("Code Node Runtime Error",t),Ht(0)}},(s,e,t)=>{const n=Object.entries(s).map(([i,r])=>`${i}: ${r}`).join(", ");return`const ${t} = (() => {
  // Inputs from graph
  const inputs = { ${n} };
  
  // User Code Wrapper
  const userFn = (tsl, inputs) => {
    ${e.code}
  };
  
  // Execute
  const result = userFn(tsl, inputs);
  
  // Normalize Return
  if (result && result.outputs) {
      if (Array.isArray(result.outputs)) {
          return Object.assign({}, ...result.outputs);
      }
      return result.outputs;
  }
  return {};
})();`},Ghe),Oe(ie.MATERIAL,"Standard Material","Output",uf,{inputs:["color","roughness","metalness","emissive","ao","normal","opacity","position"],outputs:[],initialValues:{color:"#ffffff",roughness:.2,metalness:.8,emissive:"#000000",ao:1,normal:0,opacity:1,transparent:!1,side:0},meta:{settings:["transparent"],enums:{side:{options:{Front:0,Back:1,Double:2}}}}},()=>Ht(0),()=>""),Oe(ie.BASIC_MATERIAL,"Basic Material","Output",Ug,{inputs:["fragment","opacity","position"],outputs:[],initialValues:{fragment:"#ffffff",opacity:1,transparent:!1,side:0},meta:{settings:["transparent"],enums:{side:{options:{Front:0,Back:1,Double:2}}}}},()=>Ht(0),()=>"")],Hhe=[...Dhe,...Ehe,...Che,...$he],iw=Hhe,jhe=iw.reduce((s,e)=>(s[`${e.type}Node`]=e.component,s),{}),Kd=s=>{const e=s.replace("Node","");return iw.find(t=>t.type===e)};class qhe{constructor(e){this.tslCache=new Map,this.uniformCache=e}getUniform(e,t,n,i="float"){const r=`${e}-${t}`;let o=this.uniformCache.get(r),u=n;if(i!=="color"&&typeof u=="string"){const c=parseFloat(u);u=isNaN(c)?0:c}else i!=="color"&&typeof u=="number"&&(u=isNaN(u)?0:u);return o||(i==="color"?o=xc(new Qe(u)):i==="vec2"?o=xc(new Ge((u==null?void 0:u.x)??0,(u==null?void 0:u.y)??0)):i==="vec3"?o=xc(new J((u==null?void 0:u.x)??0,(u==null?void 0:u.y)??0,(u==null?void 0:u.z)??0)):i==="vec4"?o=xc(new yt((u==null?void 0:u.x)??0,(u==null?void 0:u.y)??0,(u==null?void 0:u.z)??0,(u==null?void 0:u.w)??0)):o=xc(Number(u??0)),this.uniformCache.set(r,o)),o}getTexture(e,t){const n=`${e}-texture`;let i=this.uniformCache.get(n);if(i&&i.userData.url!==t&&(i=null),!i){const r=new HD,o=t||"https://threejs.org/examples/textures/uv_grid_opengl.jpg";i=r.load(o),i.wrapS=Io,i.wrapT=Io,i.colorSpace=cs,i.userData={url:o},this.uniformCache.set(n,i)}return i}updateUniforms(e){e.forEach(t=>{if(t.data.value!==void 0){const n=this.uniformCache.get(`${t.id}-value`);if(n)if(n.value.isColor)n.value.set(t.data.value);else{const i=parseFloat(t.data.value);n.value=isNaN(i)?0:i}}t.data.values&&Object.entries(t.data.values).forEach(([n,i])=>{const r=this.uniformCache.get(`${t.id}-${n}`);if(r)if(r.value.isColor)r.value.set(i);else if(r.value.isVector2||r.value.isVector3||r.value.isVector4)typeof i=="object"&&(r.value.isVector2?(r.value.x=i.x,r.value.y=i.y):r.value.isVector3?(r.value.x=i.x,r.value.y=i.y,r.value.z=i.z):r.value.isVector4&&(r.value.x=i.x,r.value.y=i.y,r.value.z=i.z,r.value.w=i.w));else{const o=parseFloat(i);r.value=isNaN(o)?0:o}})})}buildGraph(e,t,n,i=new Set){var g;if(this.tslCache.has(e))return this.tslCache.get(e);if(i.has(e))return Ht(0);i.add(e);const r=t.find(y=>y.id===e);if(!r)return Ht(0);const o=(g=r.type)==null?void 0:g.replace("Node","");if(o===ie.FLOAT){const y=this.getUniform(e,"value",r.data.value,"float");return r.data.label&&y.setName(r.data.label),this.tslCache.set(e,y),y}if(o===ie.COLOR){const y=this.getUniform(e,"value",r.data.value,"color");return r.data.label&&y.setName(r.data.label),this.tslCache.set(e,y),y}const u=Kd(o);if(!u)return Ht(0);const c=(y,x=null)=>{var M;const v=n.find(T=>T.target===e&&T.targetHandle===y);if(v){const T=this.buildGraph(v.source,t,n,new Set(i));if(v.sourceHandle&&v.sourceHandle!=="out")try{return T[v.sourceHandle]}catch{return T}return T}const S=((M=r.data.values)==null?void 0:M[y])??r.data.value;if(S===void 0)return x;const w=typeof S=="string"&&S.startsWith("#");return this.getUniform(e,y,S,w?"color":"float")},d={};(r.data.inputs||u.inputs).forEach(y=>{d[y]=c(y,null)}),(o===ie.TEXTURE||o===ie.TRIPLANAR)&&(d.map=this.getTexture(e,r.data.value));const p=u.tslFn(d,r.data);if(p&&typeof p.setName=="function"){const x=`${(r.data.label||o).replace(/[^a-zA-Z0-9]/g,"")}_${e.replace(/[^a-zA-Z0-9]/g,"_")}`;p.setName(x)}return this.tslCache.set(e,p),p}compile(e,t){var r,o;this.tslCache.clear();const n=e.find(u=>u.type==="materialNode"||u.type==="basicMaterialNode");if(!n)return null;const i=n.type==="basicMaterialNode";try{const u=i?new rO:new Ly;u.transparent=!!((r=n.data.values)!=null&&r.transparent),((o=n.data.values)==null?void 0:o.side)!==void 0&&(u.side=Number(n.data.values.side));const c=(f,p="float")=>{var y;const g=t.find(x=>x.target===n.id&&x.targetHandle===f);if(g){const x=this.buildGraph(g.source,e,t);if(g.sourceHandle&&g.sourceHandle!=="out")try{return x[g.sourceHandle]}catch{return x}return x}else{const x=(y=n.data.values)==null?void 0:y[f];let v=0;return f==="roughness"&&(v=.5),f==="metalness"&&(v=0),(f==="color"||f==="emissive"||f==="fragment")&&(v="#ffffff"),(f==="ao"||f==="opacity")&&(v=1),this.getUniform(n.id,f,x??v,p)}};if(i)u.fragmentNode=c("fragment","color"),u.opacityNode=c("opacity");else{const f=u;f.colorNode=c("color","color"),f.roughnessNode=c("roughness"),f.metalnessNode=c("metalness"),f.emissiveNode=c("emissive","color"),f.aoNode=c("ao"),f.opacityNode=c("opacity");const p=t.find(g=>g.target===n.id&&g.targetHandle==="normal");p&&(f.normalNode=this.buildGraph(p.source,e,t))}const d=t.find(f=>f.target===n.id&&f.targetHandle==="position");return d&&(u.positionNode=ew.add(this.buildGraph(d.source,e,t))),u}catch(u){throw console.error("Material Compilation Error:",u),u}}}class yz{static generateTSL(e,t){var T,A;const n=[],i=new Set,r=new Map,o=new Set,u=new Set,c=new Set,d=e.some(C=>C.type==="codeNode"),f=C=>{C==="MeshStandardNodeMaterial"||C==="MeshBasicNodeMaterial"?u.add(C):o.add(C)},p=(C,D)=>{if(!r.has(C)){const R=D.replace("Node","").toLowerCase(),B=C.replace(/[^a-zA-Z0-9]/g,"_");r.set(C,`${R}_${B.split("_").pop()}`)}return r.get(C)},g=C=>{var Y;if(i.has(C))return r.get(C);const D=e.find(F=>F.id===C);if(!D)return"float(0)";i.add(C);const R=p(C,D.type||"node"),B=(Y=D.type)==null?void 0:Y.replace("Node",""),L=Kd(B),X=t.filter(F=>F.target===C),G=F=>{var $;const k=X.find(re=>re.targetHandle===F);if(k){const re=g(k.source);return k.sourceHandle&&k.sourceHandle!=="out"?`${re}.${k.sourceHandle}`:re}const I=(($=D.data.values)==null?void 0:$[F])??D.data.value;if(I!==void 0){if(typeof I=="string"){if(I.startsWith("#"))return f("color"),`color('${I}')`;const re=parseFloat(I);return isNaN(re)?"float(0)":(f("float"),`float(${re})`)}return typeof I=="number"?(f("float"),`float(${I})`):"float(0)"}};if(!L)return n.push(`// Unknown node type: ${B}
const ${R} = float(0);`),R;const j={};(D.data.inputs||L.inputs).forEach(F=>{const k=G(F);k?j[F]=k:B===ie.CODE?j[F]="undefined":["viewDir","uv"].includes(F)||(j[F]="float(0)")});const P=L.codeFn(j,D.data,R,f);return P.trim().startsWith("const ")||P.trim().startsWith("//")?n.push(P):n.push(`const ${R} = ${P};`),R},y=e.find(C=>C.type==="materialNode"||C.type==="basicMaterialNode"),x=[];let v="MeshStandardNodeMaterial";if(y){const C=y.type==="basicMaterialNode";C?(v="MeshBasicNodeMaterial",f("MeshBasicNodeMaterial")):f("MeshStandardNodeMaterial"),(C?["fragment","opacity"]:["color","roughness","metalness","normal","emissive","ao","opacity"]).forEach(B=>{var G;const L=t.find(j=>j.target===y.id&&j.targetHandle===B);let X=`${B}Node`;if(C&&B==="fragment"&&(X="fragmentNode"),L){let ee=g(L.source);L.sourceHandle&&L.sourceHandle!=="out"&&(ee+=`.${L.sourceHandle}`),x.push(`material.${X} = ${ee};`)}else if(((G=y.data.values)==null?void 0:G[B])!==void 0){const j=y.data.values[B];if(B==="color"||B==="emissive"||B==="fragment")f("color"),x.push(`material.${X} = color('${j}');`);else{f("float");let ee=j;typeof j=="string"&&(ee=parseFloat(j)),isNaN(ee)&&(ee=0),x.push(`material.${X} = float(${ee});`)}}});const R=t.find(B=>B.target===y.id&&B.targetHandle==="position");if(R){f("positionLocal");let L=g(R.source);R.sourceHandle&&R.sourceHandle!=="out"&&(L+=`.${R.sourceHandle}`),x.push(`material.positionNode = positionLocal.add(${L});`)}if((T=y.data.values)!=null&&T.transparent&&x.push("material.transparent = true;"),((A=y.data.values)==null?void 0:A.side)!==void 0){const B=y.data.values.side;B===1?(c.add("BackSide"),x.push("material.side = BackSide;")):B===2&&(c.add("DoubleSide"),x.push("material.side = DoubleSide;"))}}else f("MeshStandardNodeMaterial");const S=[o.size>0?`import { 
  ${Array.from(o).join(", ")} 
} from 'three/tsl';`:"",d?"import * as tsl from 'three/tsl';":""].filter(Boolean).join(`
`),w=u.size>0?`import { 
  ${Array.from(u).join(", ")} 
} from 'three/webgpu';`:"";return[c.size>0?`import { 
  ${Array.from(c).join(", ")} 
} from 'three';`:"",S,w,"","// TSL Graph Generation",...n,"",`const material = new ${v}();`,...x].filter(C=>C!=="").join(`
`)}}function sC(s,e){const[t,n]=se.useState(s);return se.useEffect(()=>{const i=setTimeout(()=>n(s),e);return()=>clearTimeout(i)},[s,e]),t}function Whe(s,e){const[t,n]=se.useState(null),[i,r]=se.useState(null),o=se.useRef(new Map),u=se.useRef(""),c=sC(s,100),d=sC(e,100),f=se.useMemo(()=>new qhe(o.current),[]);return se.useEffect(()=>{var S,w;const p=c.find(M=>M.type==="materialNode"||M.type==="basicMaterialNode"),g=(S=p==null?void 0:p.data.values)!=null&&S.transparent?"true":"false",y=((w=p==null?void 0:p.data.values)==null?void 0:w.side)??"0",x=d.map(M=>`${M.source}:${M.sourceHandle}->${M.target}:${M.targetHandle}`).sort().join("|")+c.map(M=>`${M.id}:${M.type}`).sort().join("|")+g+":"+y;if(x!==u.current)try{console.groupCollapsed(`[TSL] Compiling Material (${c.length} nodes)`);const M=yz.generateTSL(c,d);console.log("%cGenerated TSL:","color: #3b82f6; font-weight: bold;",`
`+M);const T=f.compile(c,d);T&&(n(A=>(A&&A.dispose(),T)),u.current=x,r(null),console.log("%cMaterial Compiled Successfully","color: #22c55e; font-weight: bold;",T)),console.groupEnd()}catch(M){console.error("%cMaterial Compilation Failed","color: #ef4444; font-weight: bold;",M),r(M.message),console.groupEnd()}},[c,d,f]),se.useEffect(()=>{f.updateUniforms(s)},[s,f]),{material:t,error:i}}const iC={type:"change"},rw={type:"start"},xz={type:"end"},ug=new FD,rC=new ca,Xhe=Math.cos(70*eT.DEG2RAD),En=new J,ws=2*Math.PI,Pt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},E_=1e-6;class Yhe extends gH{constructor(e,t=null){super(e,t),this.state=Pt.NONE,this.target=new J,this.cursor=new J,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Rc.ROTATE,MIDDLE:Rc.DOLLY,RIGHT:Rc.PAN},this.touches={ONE:vc.ROTATE,TWO:vc.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new J,this._lastQuaternion=new Go,this._lastTargetPosition=new J,this._quat=new Go().setFromUnitVectors(e.up,new J(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new D2,this._sphericalDelta=new D2,this._scale=1,this._panOffset=new J,this._rotateStart=new Ge,this._rotateEnd=new Ge,this._rotateDelta=new Ge,this._panStart=new Ge,this._panEnd=new Ge,this._panDelta=new Ge,this._dollyStart=new Ge,this._dollyEnd=new Ge,this._dollyDelta=new Ge,this._dollyDirection=new J,this._mouse=new Ge,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Qhe.bind(this),this._onPointerDown=Zhe.bind(this),this._onPointerUp=Khe.bind(this),this._onContextMenu=rde.bind(this),this._onMouseWheel=tde.bind(this),this._onKeyDown=nde.bind(this),this._onTouchStart=sde.bind(this),this._onTouchMove=ide.bind(this),this._onMouseDown=Jhe.bind(this),this._onMouseMove=ede.bind(this),this._interceptControlDown=ade.bind(this),this._interceptControlUp=ode.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(iC),this.update(),this.state=Pt.NONE}update(e=null){const t=this.object.position;En.copy(t).sub(this.target),En.applyQuaternion(this._quat),this._spherical.setFromVector3(En),this.autoRotate&&this.state===Pt.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(n)&&isFinite(i)&&(n<-Math.PI?n+=ws:n>Math.PI&&(n-=ws),i<-Math.PI?i+=ws:i>Math.PI&&(i-=ws),n<=i?this._spherical.theta=Math.max(n,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+i)/2?Math.max(n,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let r=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),r=o!=this._spherical.radius}if(En.setFromSpherical(this._spherical),En.applyQuaternion(this._quatInverse),t.copy(this.target).add(En),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const u=En.length();o=this._clampDistance(u*this._scale);const c=u-o;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),r=!!c}else if(this.object.isOrthographicCamera){const u=new J(this._mouse.x,this._mouse.y,0);u.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),r=c!==this.object.zoom;const d=new J(this._mouse.x,this._mouse.y,0);d.unproject(this.object),this.object.position.sub(d).add(u),this.object.updateMatrixWorld(),o=En.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(ug.origin.copy(this.object.position),ug.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(ug.direction))<Xhe?this.object.lookAt(this.target):(rC.setFromNormalAndCoplanarPoint(this.object.up,this.target),ug.intersectPlane(rC,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),r=!0)}return this._scale=1,this._performCursorZoom=!1,r||this._lastPosition.distanceToSquared(this.object.position)>E_||8*(1-this._lastQuaternion.dot(this.object.quaternion))>E_||this._lastTargetPosition.distanceToSquared(this.target)>E_?(this.dispatchEvent(iC),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?ws/60*this.autoRotateSpeed*e:ws/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){En.setFromMatrixColumn(t,0),En.multiplyScalar(-e),this._panOffset.add(En)}_panUp(e,t){this.screenSpacePanning===!0?En.setFromMatrixColumn(t,1):(En.setFromMatrixColumn(t,0),En.crossVectors(this.object.up,En)),En.multiplyScalar(e),this._panOffset.add(En)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;En.copy(i).sub(this.target);let r=En.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*r/n.clientHeight,this.object.matrix),this._panUp(2*t*r/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),i=e-n.left,r=t-n.top,o=n.width,u=n.height;this._mouse.x=i/o*2-1,this._mouse.y=-(r/u)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ws*this._rotateDelta.x/t.clientHeight),this._rotateUp(ws*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(ws*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-ws*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(ws*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-ws*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(n,i)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(n,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,i=e.pageY-t.y,r=Math.sqrt(n*n+i*i);this._dollyStart.set(0,r)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),i=.5*(e.pageX+n.x),r=.5*(e.pageY+n.y);this._rotateEnd.set(i,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ws*this._rotateDelta.x/t.clientHeight),this._rotateUp(ws*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(n,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,i=e.pageY-t.y,r=Math.sqrt(n*n+i*i);this._dollyEnd.set(0,r),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,u=(e.pageY+t.y)*.5;this._updateZoomParameters(o,u)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Ge,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function Zhe(s){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(s.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(s)&&(this._addPointer(s),s.pointerType==="touch"?this._onTouchStart(s):this._onMouseDown(s)))}function Qhe(s){this.enabled!==!1&&(s.pointerType==="touch"?this._onTouchMove(s):this._onMouseMove(s))}function Khe(s){switch(this._removePointer(s),this._pointers.length){case 0:this.domElement.releasePointerCapture(s.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(xz),this.state=Pt.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function Jhe(s){let e;switch(s.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Rc.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(s),this.state=Pt.DOLLY;break;case Rc.ROTATE:if(s.ctrlKey||s.metaKey||s.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(s),this.state=Pt.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(s),this.state=Pt.ROTATE}break;case Rc.PAN:if(s.ctrlKey||s.metaKey||s.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(s),this.state=Pt.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(s),this.state=Pt.PAN}break;default:this.state=Pt.NONE}this.state!==Pt.NONE&&this.dispatchEvent(rw)}function ede(s){switch(this.state){case Pt.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(s);break;case Pt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(s);break;case Pt.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(s);break}}function tde(s){this.enabled===!1||this.enableZoom===!1||this.state!==Pt.NONE||(s.preventDefault(),this.dispatchEvent(rw),this._handleMouseWheel(this._customWheelEvent(s)),this.dispatchEvent(xz))}function nde(s){this.enabled!==!1&&this._handleKeyDown(s)}function sde(s){switch(this._trackPointer(s),this._pointers.length){case 1:switch(this.touches.ONE){case vc.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(s),this.state=Pt.TOUCH_ROTATE;break;case vc.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(s),this.state=Pt.TOUCH_PAN;break;default:this.state=Pt.NONE}break;case 2:switch(this.touches.TWO){case vc.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(s),this.state=Pt.TOUCH_DOLLY_PAN;break;case vc.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(s),this.state=Pt.TOUCH_DOLLY_ROTATE;break;default:this.state=Pt.NONE}break;default:this.state=Pt.NONE}this.state!==Pt.NONE&&this.dispatchEvent(rw)}function ide(s){switch(this._trackPointer(s),this.state){case Pt.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(s),this.update();break;case Pt.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(s),this.update();break;case Pt.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(s),this.update();break;case Pt.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(s),this.update();break;default:this.state=Pt.NONE}}function rde(s){this.enabled!==!1&&s.preventDefault()}function ade(s){s.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function ode(s){s.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const lde=({material:s,activeModel:e,onShaderUpdate:t})=>{const n=se.useRef(null),i=se.useRef(null),r=se.useRef(null),o=se.useRef(null),u=se.useRef(null),c=se.useRef(null),d=se.useRef(null),[f,p]=se.useState(!1);return se.useEffect(()=>{if(!n.current)return;const g=n.current.clientWidth||300,y=n.current.clientHeight||300,x=new ay;o.current=x;const v=new Ms(45,g/y,.1,100);v.position.set(2.5,2,3.5),c.current=v;const S=new qee({antialias:!0,forceWebGL:!0});S.init().then(()=>{S.setSize(g,y),S.toneMapping=_D,S.toneMappingExposure=1,S.shadowMap.enabled=!0,S.shadowMap.type=w8,n.current&&(n.current.innerHTML="",n.current.appendChild(S.domElement)),i.current=S,p(!0);try{const B=new Wee(S),L=JS(x,v);B.outputNode=L,r.current=B}catch(B){console.error("Failed to setup PostProcessing",B)}}).catch(B=>{if(console.error("Failed to init WebGPURenderer",B),document.getElementById("fatal-error-display")){const L=document.getElementById("fatal-error-display");L&&(L.textContent="Renderer Init Failed: "+B.message,L.style.display="block")}});const w=new qD(16777215,.4);x.add(w),new HD().load("https://threejs.org/manual/examples/resources/images/equirectangularmaps/tears_of_steel_bridge_2k.jpg",B=>{B.mapping=Q0,B.colorSpace=cs,x.environment=B,x.background=B,x.environmentIntensity=.5});const M=new jD(16773341,2);M.position.set(3,4,3),M.castShadow=!0,M.shadow.mapSize.width=1024,M.shadow.mapSize.height=1024,M.shadow.bias=-1e-4,x.add(M);const T=new oy(4491519,5);T.position.set(-2,3,-4),T.lookAt(0,0,0),x.add(T);const A=new Cd;x.add(A),u.current=A;const C=new Yhe(v,S.domElement);C.minDistance=1,C.maxDistance=20;const D=new ResizeObserver(B=>{for(let L of B){const{width:X,height:G}=L.contentRect;X>0&&G>0&&i.current&&(v.aspect=X/G,v.updateProjectionMatrix(),i.current.setSize(X,G))}});D.observe(n.current);const R=()=>{if(r.current)try{r.current.render()}catch(B){console.warn("PostProcessing render failed, falling back",B),r.current=null}else i.current&&i.current.render(x,v);d.current=requestAnimationFrame(R)};return d.current=requestAnimationFrame(R),()=>{D.disconnect(),d.current&&cancelAnimationFrame(d.current),i.current&&i.current.dispose(),n.current&&(n.current.innerHTML="")}},[]),se.useEffect(()=>{if(!u.current||!f)return;const g=u.current;g.clear();const y=s||new Ly({color:3355443});window.material=y;let x;if(e==="intersection"){x=new Rn(new us(1,1,1),y),x.castShadow=!0,x.receiveShadow=!0,g.add(x);const v=new Rn(new us(.8,.8,.8),new Tc({color:8421504,roughness:.2}));v.position.set(.6,.4,.5),v.castShadow=!0,v.receiveShadow=!0,g.add(v);const S=new Rn(new us(2,.2,2),new Tc({color:4210752,roughness:.5}));S.position.set(0,-.6,0),S.receiveShadow=!0,g.add(S);const w=new Rn(new us(.3,.3,.3),new Tc({color:11184810}));w.position.set(-.4,.1,.7),w.castShadow=!0,g.add(w)}else if(e==="cubes"){x=new Rn(new us(1,1,1),y),x.castShadow=!0,x.receiveShadow=!0,g.add(x);const v=new Tc({color:10265519,roughness:.3}),S=new Rn(new us(.7,.7,.7),v);S.position.set(.5,.5,.2),S.castShadow=!0,S.receiveShadow=!0,g.add(S);const w=new Rn(new us(.6,.6,.6),v);w.position.set(-.5,-.4,.5),w.rotation.y=Math.PI/6,w.castShadow=!0,w.receiveShadow=!0,g.add(w);const M=new Rn(new us(2,2,.2),v);M.position.set(0,0,-.8),M.receiveShadow=!0,g.add(M);const T=new Rn(new us(.2,2,.2),v);T.position.set(.2,0,0),T.rotation.z=Math.PI/4,T.castShadow=!0,T.receiveShadow=!0,g.add(T)}else{let v;e==="sphere"?v=new uT(1,64):e==="box"?v=new us(1.2,1.2,1.2):v=new dT(.7,.25,128,32),x=new Rn(v,y),x.castShadow=!0,x.receiveShadow=!0,g.add(x)}i.current&&o.current&&c.current&&x&&i.current.debug&&i.current.debug.getShaderAsync&&i.current.debug.getShaderAsync(o.current,c.current,x).then(v=>{t&&t(v)}).catch(v=>{})},[e,s,f,t]),U.jsx("div",{ref:n,className:"w-full h-full pointer-events-auto"})},ude=({nodes:s,edges:e,onShaderUpdate:t})=>{const[n,i]=se.useState("cubes"),[r,o]=se.useState(!1),{material:u,error:c}=Whe(s,e),d=r?"w-[500px] h-[500px]":"w-56 h-56";return U.jsxs("div",{className:`relative ${d} bg-[#080808] rounded-lg overflow-hidden border border-zinc-800 shadow-2xl group transition-all duration-300`,children:[U.jsx(lde,{material:u,activeModel:n,onShaderUpdate:t}),U.jsxs("div",{className:"absolute top-2 left-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[U.jsx("button",{onClick:()=>i("sphere"),title:"Sphere",className:`p-1 rounded-sm border ${n==="sphere"?"bg-blue-500/20 border-blue-500 text-blue-400":"bg-zinc-900/80 border-zinc-700 text-zinc-500 hover:text-white"}`,children:U.jsx(qv,{size:10})}),U.jsx("button",{onClick:()=>i("box"),title:"Box",className:`p-1 rounded-sm border ${n==="box"?"bg-blue-500/20 border-blue-500 text-blue-400":"bg-zinc-900/80 border-zinc-700 text-zinc-500 hover:text-white"}`,children:U.jsx(uf,{size:10})}),U.jsx("button",{onClick:()=>i("torus"),title:"Torus",className:`p-1 rounded-sm border ${n==="torus"?"bg-blue-500/20 border-blue-500 text-blue-400":"bg-zinc-900/80 border-zinc-700 text-zinc-500 hover:text-white"}`,children:U.jsx(J6,{size:10})}),U.jsx("div",{className:"w-px h-3 bg-zinc-700/50 self-center mx-0.5"}),U.jsx("button",{onClick:()=>i("intersection"),title:"Depth Intersection Scene",className:`p-1 rounded-sm border ${n==="intersection"?"bg-blue-500/20 border-blue-500 text-blue-400":"bg-zinc-900/80 border-zinc-700 text-zinc-500 hover:text-white"}`,children:U.jsx(Wv,{size:10})}),U.jsx("button",{onClick:()=>i("cubes"),title:"Overlapping Cubes Cluster",className:`p-1 rounded-sm border ${n==="cubes"?"bg-blue-500/20 border-blue-500 text-blue-400":"bg-zinc-900/80 border-zinc-700 text-zinc-500 hover:text-white"}`,children:U.jsx(W6,{size:10})})]}),U.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:U.jsx("button",{onClick:()=>o(!r),className:"p-1.5 rounded-sm bg-zinc-900/80 backdrop-blur-md border border-zinc-700 text-zinc-500 hover:text-white",children:r?U.jsx(Rf,{size:12}):U.jsx(i8,{size:12})})}),U.jsxs("div",{className:"absolute bottom-2 left-2 flex items-center gap-1.5 pointer-events-none bg-black/60 backdrop-blur-sm px-2 py-1 rounded-full border border-white/10",children:[U.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 shadow-[0_0_8px_#22c55e]"}),U.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest text-zinc-300",children:"GPU Live"})]}),c&&U.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/90 p-4 pointer-events-none",children:U.jsxs("div",{className:"bg-zinc-950 border border-red-900/40 p-3 rounded-md shadow-2xl text-center",children:[U.jsx("div",{className:"text-red-500 text-[9px] font-black uppercase tracking-widest mb-1",children:"Shader Error"}),U.jsx("div",{className:"text-[7px] text-zinc-400 line-clamp-3 leading-tight font-mono",children:c})]})})]})},cde=sh.memo(ude,(s,e)=>{if(s.edges!==e.edges||s.nodes.length!==e.nodes.length)return!1;for(let t=0;t<s.nodes.length;t++)if(s.nodes[t]!==e.nodes[t]&&s.nodes[t].data!==e.nodes[t].data)return!1;return!0}),hde=({label:s,onClick:e,icon:t})=>U.jsxs("button",{onClick:e,className:"flex items-center gap-2 px-2 py-1.5 text-[10px] text-zinc-400 hover:text-white hover:bg-zinc-900/50 rounded-sm transition-all group border border-transparent hover:border-zinc-800 w-full",children:[U.jsx(t,{size:12,className:"text-zinc-600 group-hover:text-blue-500 shrink-0"}),U.jsx("span",{className:"truncate",children:s})]}),dde=({onAddNode:s,isOpen:e,toggle:t})=>{const[n,i]=se.useState(""),r=se.useMemo(()=>{const o={};return["Constants","Attributes","Math","Vectors","Logic","Patterns & Textures","Depth","Tools","Output"].forEach(c=>o[c]=[]),iw.forEach(c=>{n&&!c.label.toLowerCase().includes(n.toLowerCase())&&!c.category.toLowerCase().includes(n.toLowerCase())||(o[c.category]||(o[c.category]=[]),o[c.category].push(c))}),Object.entries(o).filter(([c,d])=>d.length>0)},[n]);return U.jsxs("div",{className:`${e?"w-48":"w-10"} transition-all bg-zinc-950 border-r border-zinc-900 flex flex-col shrink-0 z-10 duration-300`,children:[U.jsxs("div",{className:"p-3 border-b border-zinc-900 flex items-center justify-between shrink-0 h-10",children:[e&&U.jsx("span",{className:"font-black text-zinc-200 tracking-tighter text-[11px]",children:"NODES"}),U.jsx("button",{onClick:t,className:"p-1 text-zinc-500 hover:bg-zinc-900 rounded transition-colors",children:U.jsx(cf,{size:14})})]}),e&&U.jsx("div",{className:"p-3 pb-0",children:U.jsxs("div",{className:"relative",children:[U.jsx(c8,{className:"absolute left-2 top-1.5 text-zinc-600",size:12}),U.jsx("input",{type:"text",placeholder:"Search...",value:n,onChange:o=>i(o.target.value),className:"w-full bg-zinc-900 border border-zinc-800 rounded px-2 py-1 pl-7 text-[10px] text-zinc-300 focus:outline-none focus:border-zinc-700 placeholder-zinc-700"})]})}),U.jsx("div",{className:`flex-1 overflow-y-auto custom-scrollbar pt-2 ${e?"px-3":"hidden"}`,children:r.map(([o,u])=>U.jsxs("div",{className:"mb-4",children:[U.jsxs("div",{className:"flex items-center gap-1.5 px-1 mb-1 text-zinc-600 font-bold text-[8px] uppercase tracking-wider sticky top-0 bg-zinc-950 py-1 z-10",children:[U.jsx(uf,{size:10})," ",o]}),U.jsx("div",{className:"grid grid-cols-1 gap-0.5",children:u.map(c=>U.jsx(hde,{label:c.label,icon:c.icon,onClick:()=>s(c.type)},c.type))})]},o))})]})},Nv=[{key:"standard",label:"Standard Material",icon:uf,generate:s=>({nodes:[s(ie.MATERIAL,{x:600,y:300},"out")].filter(Boolean),edges:[]})},{key:"intersection",label:"Depth Intersection",icon:nD,iconColor:"text-emerald-400",generate:s=>{const e=s(ie.MATERIAL,{x:1100,y:200},"out");e&&(e.data.values={color:"#00ffff",transparent:!0,opacity:1});const t=s(ie.SCREEN_UV,{x:50,y:50},"scrUV"),n=s(ie.VIEWPORT_DEPTH_TEXTURE,{x:250,y:50},"depthTex"),i=s(ie.CAMERA_NEAR,{x:250,y:150},"camNear"),r=s(ie.CAMERA_FAR,{x:250,y:250},"camFar"),o=s(ie.PERSPECTIVE_DEPTH_TO_VIEW_Z,{x:500,y:100},"sceneZ"),u=s(ie.VIEW_Z,{x:50,y:400},"viewZ"),c=s(ie.FLOAT,{x:50,y:500},"offset");c&&(c.data.value=.3);const d=s(ie.SUB,{x:250,y:450},"subOffset"),f=s(ie.SUB,{x:550,y:300},"diff"),p=s(ie.CLAMP,{x:700,y:300},"clamp");p&&(p.data.values={min:0,max:1});const g=s(ie.SMOOTHSTEP,{x:850,y:300},"smooth");g&&(g.data.values={low:0,high:1});const y=s(ie.FRESNEL,{x:700,y:50},"fresnel");y&&(y.data.values={power:5});const x=s(ie.ADD,{x:850,y:150},"add"),v=s(ie.DIV,{x:980,y:150},"div"),S=s(ie.FLOAT,{x:850,y:50},"two");return S&&(S.data.value=2),{nodes:[e,t,n,i,r,o,u,c,d,f,p,g,y,x,v,S].filter(Boolean),edges:[{id:"e1",source:"scrUV",target:"depthTex",targetHandle:"uv"},{id:"e2",source:"depthTex",target:"sceneZ",targetHandle:"depth"},{id:"e3",source:"camNear",target:"sceneZ",targetHandle:"near"},{id:"e4",source:"camFar",target:"sceneZ",targetHandle:"far"},{id:"e5",source:"viewZ",target:"subOffset",targetHandle:"a"},{id:"e6",source:"offset",target:"subOffset",targetHandle:"b"},{id:"e7",source:"sceneZ",target:"diff",targetHandle:"a"},{id:"e8",source:"subOffset",target:"diff",targetHandle:"b"},{id:"e9",source:"diff",target:"clamp",targetHandle:"in"},{id:"e10",source:"clamp",target:"smooth",targetHandle:"in"},{id:"e11",source:"fresnel",target:"add",targetHandle:"a"},{id:"e12",source:"smooth",target:"add",targetHandle:"b"},{id:"e13",source:"add",target:"div",targetHandle:"a"},{id:"e14",source:"two",target:"div",targetHandle:"b"},{id:"e15",source:"div",target:"out",targetHandle:"opacity"},{id:"e16",source:"div",target:"out",targetHandle:"emissive"}]}}},{key:"hologram",label:"Hologram Shield",icon:h8,iconColor:"text-blue-500",generate:s=>{const e=s(ie.MATERIAL,{x:900,y:150},"out");e&&(e.data.values={...e.data.values,transparent:!0,opacity:1});const t=s(ie.FRESNEL,{x:500,y:0},"fresnel");t&&t.data.values&&(t.data.values.power=3);const n=s(ie.TIME,{x:50,y:250},"time"),i=s(ie.FLOAT,{x:50,y:150},"speed");i&&(i.data.value=.5);const r=s(ie.MUL,{x:200,y:200},"mulTime"),o=s(ie.UV,{x:50,y:350},"uv"),u=s(ie.ADD,{x:350,y:300},"addUV"),c=s(ie.SIMPLEX_NOISE_2D,{x:500,y:300},"noise"),d=s(ie.COLOR,{x:400,y:-100},"baseColor");d&&(d.data.value="#00ffff");const f=s(ie.MIX,{x:700,y:200},"mix");f&&f.data.values&&(f.data.values.alpha=.5);const p=s(ie.MUL,{x:700,y:-50},"mul1"),g=s(ie.MUL,{x:700,y:50},"mul2");return{nodes:[e,t,n,i,r,o,u,c,d,p,g].filter(Boolean),edges:[{id:"e_ts",source:"time",target:"mulTime",targetHandle:"a"},{id:"e_ss",source:"speed",target:"mulTime",targetHandle:"b"},{id:"e_ut",source:"uv",target:"addUV",targetHandle:"a"},{id:"e_mt",source:"mulTime",target:"addUV",targetHandle:"b"},{id:"e_nn",source:"addUV",target:"noise",targetHandle:"uv"},{id:"e_fop",source:"fresnel",target:"out",targetHandle:"opacity"},{id:"e_c1",source:"baseColor",target:"mul1",targetHandle:"a"},{id:"e_f1",source:"fresnel",target:"mul1",targetHandle:"b"},{id:"e_m1",source:"mul1",target:"mul2",targetHandle:"a"},{id:"e_n1",source:"noise",target:"mul2",targetHandle:"b"},{id:"e_em",source:"mul2",target:"out",targetHandle:"emissive"},{id:"e_col",source:"baseColor",target:"out",targetHandle:"color"}]}}},{key:"ocean",label:"Ocean (Vertex)",icon:Ec,iconColor:"text-cyan-500",generate:s=>{const e=s(ie.MATERIAL,{x:900,y:150},"out");e&&(e.data.values={...e.data.values,color:"#0066ff",roughness:.1});const t=s(ie.TIME,{x:50,y:50},"time"),n=s(ie.POSITION,{x:50,y:200},"pos"),i=s(ie.SPLIT,{x:200,y:200},"split"),r=s(ie.ADD,{x:350,y:100},"add"),o=s(ie.SIN,{x:500,y:100},"sin"),u=s(ie.FLOAT,{x:500,y:0},"amp");u&&(u.data.value=.3);const c=s(ie.MUL,{x:650,y:100},"mul"),d=s(ie.VEC3,{x:700,y:250},"vec3");return{nodes:[e,t,n,i,r,o,u,c,d].filter(Boolean),edges:[{id:"e1",source:"pos",target:"split",targetHandle:"in"},{id:"e2",source:"split",target:"add",targetHandle:"a",sourceHandle:"x"},{id:"e3",source:"time",target:"add",targetHandle:"b"},{id:"e4",source:"add",target:"sin",targetHandle:"in"},{id:"e5",source:"sin",target:"mul",targetHandle:"a"},{id:"e6",source:"amp",target:"mul",targetHandle:"b"},{id:"e7",source:"mul",target:"vec3",targetHandle:"y"},{id:"e8",source:"vec3",target:"out",targetHandle:"position"}]}}},{key:"basic",label:"Basic Checker",icon:cf,generate:s=>{const e=s(ie.MATERIAL,{x:900,y:150},"out"),t=s(ie.CHECKER,{x:450,y:150},"check"),n=s(ie.UV,{x:150,y:150},"uv");return n&&(n.data.value=4),{nodes:[e,t,n].filter(Boolean),edges:[{id:"e1",source:"uv",target:"check",targetHandle:"uv"},{id:"e2",source:"check",target:"out",targetHandle:"color"}]}}},{key:"noise",label:"Animated Noise",icon:zl,generate:s=>{const e=s(ie.MATERIAL,{x:900,y:150},"out"),t=s(ie.SIMPLEX_NOISE_2D,{x:300,y:150},"noise"),n=s(ie.TIME,{x:50,y:50},"time"),i=s(ie.UV,{x:50,y:200},"uv"),r=s(ie.ADD,{x:180,y:150},"add");return{nodes:[e,t,n,i,r].filter(Boolean),edges:[{id:"e1",source:"uv",target:"add",targetHandle:"b"},{id:"e2",source:"time",target:"add",targetHandle:"a"},{id:"e3",source:"add",target:"noise",targetHandle:"uv"},{id:"e4",source:"noise",target:"out",targetHandle:"color"}]}}},{key:"depth",label:"Viewport Depth",icon:Wv,generate:s=>{const e=s(ie.MATERIAL,{x:900,y:150},"out"),t=s(ie.VIEWPORT_DEPTH_TEXTURE,{x:100,y:150},"depth"),n=s(ie.LINEAR_DEPTH,{x:300,y:150},"linear"),i=s(ie.REMAP,{x:500,y:150},"remap");return i&&i.data.values&&(i.data.values.inLow=0,i.data.values.inHigh=20,i.data.values.outLow=0,i.data.values.outHigh=1),{nodes:[e,t,n,i].filter(Boolean),edges:[{id:"e1",source:"depth",target:"linear",targetHandle:"depth"},{id:"e2",source:"linear",target:"remap",targetHandle:"in"},{id:"e3",source:"remap",target:"out",targetHandle:"color"}]}}}],fde=({onSave:s,onLoad:e,onExport:t,onLoadExample:n})=>{const i=se.useRef(null),{simpleMode:r,setSimpleMode:o}=uh(),u=d=>{var f;(f=d.target.files)!=null&&f[0]&&(e(d.target.files[0]),d.target.value="")},c=()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen().catch(d=>{console.error(`Error attempting to enable full-screen mode: ${d.message} (${d.name})`)})};return U.jsxs("div",{className:"h-9 bg-zinc-950 border-b border-zinc-900 flex items-center justify-between px-3 select-none",children:[U.jsxs("div",{className:"flex items-center gap-1",children:[U.jsxs("span",{className:"font-black text-zinc-100 tracking-tighter text-[12px] mr-4 flex items-center gap-2",children:["TSL ",U.jsx("span",{className:"text-zinc-600 font-normal",children:"LAB"})]}),U.jsx("div",{className:"h-4 w-px bg-zinc-800 mx-1"}),U.jsxs("button",{onClick:()=>{var d;return(d=i.current)==null?void 0:d.click()},className:"flex items-center gap-1.5 px-2 py-1 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-900 rounded transition-colors text-[10px] font-medium",children:[U.jsx(t8,{size:12})," Load"]}),U.jsx("input",{ref:i,type:"file",accept:".json",className:"hidden",onChange:u}),U.jsxs("button",{onClick:s,className:"flex items-center gap-1.5 px-2 py-1 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-900 rounded transition-colors text-[10px] font-medium",children:[U.jsx(u8,{size:12})," Save"]}),U.jsx("div",{className:"h-4 w-px bg-zinc-800 mx-1"}),U.jsxs("div",{className:"relative group",children:[U.jsxs("button",{className:"flex items-center gap-1.5 px-2 py-1 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-900 rounded transition-colors text-[10px] font-medium",children:[U.jsx(q6,{size:12})," Examples"]}),U.jsx("div",{className:"absolute top-full left-0 mt-1 w-44 bg-zinc-900 border border-zinc-800 rounded-md shadow-xl overflow-hidden hidden group-hover:block z-50",children:Nv.map((d,f)=>U.jsxs("button",{onClick:()=>n(d.key),className:`w-full text-left px-3 py-2 text-[10px] text-zinc-400 hover:text-white hover:bg-zinc-800 transition-colors flex items-center gap-2 ${f!==Nv.length-1?"border-b border-zinc-800/50":""}`,children:[U.jsx(d.icon,{size:10,className:d.iconColor||"text-zinc-500"}),d.label]},d.key))})]}),U.jsxs("div",{className:"relative group",children:[U.jsxs("button",{className:"flex items-center gap-1.5 px-2 py-1 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-900 rounded transition-colors text-[10px] font-medium",children:[U.jsx(e8,{size:12})," Export"]}),U.jsxs("div",{className:"absolute top-full left-0 mt-1 w-32 bg-zinc-900 border border-zinc-800 rounded-md shadow-xl overflow-hidden hidden group-hover:block z-50",children:[U.jsx("button",{onClick:()=>t("tsl"),className:"w-full text-left px-3 py-2 text-[10px] text-zinc-400 hover:text-white hover:bg-zinc-800 transition-colors",children:"Three.js Material (TSL)"}),U.jsx("button",{onClick:()=>t("wgsl"),className:"w-full text-left px-3 py-2 text-[10px] text-zinc-400 hover:text-white hover:bg-zinc-800 transition-colors",children:"WGSL Shader"}),U.jsx("button",{onClick:()=>t("glsl"),className:"w-full text-left px-3 py-2 text-[10px] text-zinc-400 hover:text-white hover:bg-zinc-800 transition-colors",children:"GLSL Shader"})]})]})]}),U.jsxs("div",{className:"flex items-center gap-4 text-[9px] text-zinc-600",children:[U.jsxs("div",{className:"flex items-center gap-2 border-r border-zinc-800 pr-4",children:[U.jsx("span",{className:`transition-colors ${r?"text-blue-400 font-bold":"text-zinc-500"}`,children:"Simple UI"}),U.jsx("button",{onClick:()=>o(!r),className:`w-8 h-4 rounded-full transition-colors relative ${r?"bg-blue-500/20 border border-blue-500/50":"bg-zinc-900 border border-zinc-800"}`,children:U.jsx("div",{className:`absolute top-0.5 bottom-0.5 w-2.5 rounded-full bg-current transition-all ${r?"left-[18px] text-blue-500":"left-0.5 text-zinc-500"}`})})]}),U.jsx("button",{onClick:c,className:"flex items-center gap-1 text-zinc-500 hover:text-white transition-colors",title:"Toggle Full Screen",children:U.jsx(Y0,{size:10})}),U.jsx("span",{className:"opacity-50",children:"r182"})]})]})},pde=({code:s,title:e,onClose:t})=>{const[n,i]=sh.useState(!1),r=se.useRef(null),o=se.useRef(null);se.useEffect(()=>{if(r.current){const c=f=>{const p=f.textContent||"";Pc.languages.javascript?f.innerHTML=Pc.highlight(p,Pc.languages.javascript,"javascript"):f.textContent=p},d=gz(r.current,c,{tab:"  "});return d.updateCode(s),o.current=d,()=>{d.destroy()}}},[s]);const u=()=>{const c=o.current?o.current.toString():s;navigator.clipboard.writeText(c),i(!0),setTimeout(()=>i(!1),2e3)};return U.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] flex items-center justify-center p-4",onClick:t,children:U.jsxs("div",{className:"bg-zinc-950 border border-zinc-800 rounded-lg shadow-2xl flex flex-col relative animate-in fade-in zoom-in-95 duration-200 w-[80%] h-[80%]",onClick:c=>c.stopPropagation(),children:[U.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-zinc-900 select-none bg-zinc-900/50 rounded-t-lg shrink-0",children:[U.jsx("span",{className:"font-bold text-zinc-200 text-xs uppercase tracking-wide",children:e}),U.jsxs("div",{className:"flex items-center gap-2",children:[U.jsxs("button",{onClick:u,className:`flex items-center gap-1.5 px-2 py-1.5 rounded text-[10px] font-bold uppercase transition-colors ${n?"bg-green-500/10 text-green-500":"bg-zinc-900 text-zinc-400 hover:text-white"}`,children:[n?U.jsx(X6,{size:12}):U.jsx(K6,{size:12}),n?"Copied":"Copy"]}),U.jsx("button",{onClick:t,className:"p-1.5 bg-zinc-900 hover:bg-red-500/20 text-zinc-500 hover:text-red-400 rounded transition-colors","aria-label":"Close",children:U.jsx(Xv,{size:14})})]})]}),U.jsx("div",{className:"flex-1 overflow-hidden bg-[#0d0d0d] relative group",children:U.jsx("div",{ref:r,className:"w-full h-full font-mono text-[11px] text-zinc-300 leading-relaxed p-4 overflow-auto custom-scrollbar focus:outline-none",style:{tabSize:2,caretColor:"#a855f7",whiteSpace:"pre"}})})]})})},aC="tsl-lab-graph",mde=()=>{const[s,e]=se.useState([]),[t,n]=se.useState([]),[i,r]=se.useState(!0),[o,u]=se.useState(null),[c,d]=se.useState(""),[f,p]=se.useState(null),[g,y]=se.useState(!1),{deleteElements:x,fitView:v,setViewport:S}=Ef(),w=se.useCallback((ee,P,Y)=>{e(F=>F.map(k=>{if(k.id===ee){const I={...k.data};return P==="value"?I.value=Y:I.values={...k.data.values||{},[P]:Y},{...k,data:I}}return k}))},[]),M=se.useCallback((ee,P,Y)=>{const F=Kd(ee);if(!F)return null;const k=Y||`${F.type}-${Date.now()}`;return{id:k,type:`${F.type}Node`,position:P,data:{label:F.label,inputs:[...F.inputs],outputs:[...F.outputs],value:F.initialValue,values:{...F.initialValues},icon:F.icon,meta:F.meta,onChange:($,re)=>w(k,$,re)}}},[w]),T=se.useCallback(ee=>{const P=Nv.find(Y=>Y.key===ee);if(P){const{nodes:Y,edges:F}=P.generate(M);e(Y),n(F),setTimeout(()=>v({padding:.2}),100)}else console.warn(`Example ${ee} not found.`)},[M,v]),A=se.useCallback(()=>{confirm("Reset to default material?")&&T("standard")},[T]);se.useEffect(()=>{const ee=localStorage.getItem(aC);let P=!1;if(ee)try{const Y=JSON.parse(ee);if(Array.isArray(Y.nodes)&&Array.isArray(Y.edges)){const F=Y.nodes.map(k=>{const I=Kd(k.type);return{...k,data:{...k.data,icon:I==null?void 0:I.icon,onChange:($,re)=>w(k.id,$,re)}}});e(F),n(Y.edges),setTimeout(()=>v({padding:.2}),100),P=!0}}catch(Y){console.warn("Failed to load local storage",Y)}P||T("hologram"),y(!0)},[]),se.useEffect(()=>{if(!g)return;const ee=setTimeout(()=>{const P={nodes:s,edges:t};localStorage.setItem(aC,JSON.stringify(P))},5e3);return()=>clearTimeout(ee)},[s,t,g]);const C=se.useCallback(()=>{const ee={nodes:s,edges:t,viewport:{x:0,y:0,zoom:1}},P=new Blob([JSON.stringify(ee,null,2)],{type:"application/json"}),Y=URL.createObjectURL(P),F=document.createElement("a");F.href=Y,F.download=`tsl-graph-${Date.now()}.json`,F.click()},[s,t]),D=se.useCallback(ee=>{const P=new FileReader;P.onload=Y=>{var F;try{const k=JSON.parse((F=Y.target)==null?void 0:F.result);if(k.nodes&&k.edges){const I=k.nodes.map($=>{const re=Kd($.type);return{...$,data:{...$.data,icon:re==null?void 0:re.icon,onChange:(V,q)=>w($.id,V,q)}}});e(I),n(k.edges),setTimeout(()=>v(),100)}}catch{alert("Invalid JSON file")}},P.readAsText(ee)},[w,v]),R=se.useCallback(ee=>{if(ee==="tsl"){const P=yz.generateTSL(s,t);d("Three.js Material (TSL)"),u(P)}else(ee==="glsl"||ee==="wgsl")&&(f?(d(`${ee.toUpperCase()} Shader Source`),u(`// --- VERTEX SHADER ---

${f.vertexShader}

// --- FRAGMENT SHADER ---

${f.fragmentShader}`)):(d(`${ee.toUpperCase()} Shader Source`),u(`// Shader source not available yet.
// Ensure the preview is running and has compiled successfully.`)))},[s,t,f]),B=se.useCallback(ee=>e(P=>v3(ee,P)),[]),L=se.useCallback(ee=>n(P=>T3(ee,P)),[]),X=se.useCallback(ee=>{n(P=>{const Y=P.filter(F=>!(F.target===ee.target&&F.targetHandle===ee.targetHandle));return n3(ee,Y)})},[]),G=se.useCallback(ee=>{const P=M(ee,{x:200,y:200});P&&e(Y=>Y.concat(P))},[M]),j=se.useCallback(()=>{const ee=s.filter(Y=>Y.selected),P=t.filter(Y=>Y.selected);(ee.length>0||P.length>0)&&x({nodes:ee,edges:P})},[s,t,x]);return U.jsxs("div",{className:"flex flex-col w-full h-full bg-zinc-950",children:[U.jsx(fde,{onSave:C,onLoad:D,onExport:R,onLoadExample:T}),U.jsxs("div",{className:"flex flex-1 overflow-hidden relative",children:[U.jsx(dde,{onAddNode:G,isOpen:i,toggle:()=>r(!i)}),U.jsx("div",{className:"flex-1 relative",children:U.jsxs(u6,{nodes:s,edges:t,onNodesChange:B,onEdgesChange:L,onConnect:X,nodeTypes:jhe,colorMode:"dark",fitView:!0,children:[U.jsx(b6,{color:"#111113",gap:20,size:1}),U.jsx(N6,{}),U.jsx(Wc,{position:"top-right",className:"z-20",children:U.jsx(cde,{nodes:s,edges:t,onShaderUpdate:p})}),U.jsxs(Wc,{position:"bottom-right",className:"flex items-center gap-2 p-1.5 bg-zinc-900 border border-zinc-800 rounded shadow-lg z-50",children:[U.jsx("button",{onClick:j,className:"p-1.5 bg-zinc-800 hover:bg-red-950 text-zinc-500 hover:text-red-400 rounded transition-colors",title:"Delete Selected",children:U.jsx(g8,{size:12})}),U.jsx("div",{className:"w-px h-3 bg-zinc-800"}),U.jsx("button",{onClick:()=>{confirm("Clear canvas?")&&(e([]),n([]))},className:"px-2 py-1 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white rounded transition-colors font-bold text-[8px] uppercase",children:"Clear"}),U.jsxs("button",{onClick:A,className:"flex items-center gap-1.5 px-2 py-1 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 hover:text-white rounded transition-colors font-bold text-[8px] uppercase",title:"Reset to Default",children:[U.jsx(l8,{size:10})," Reset"]})]})]})})]}),o&&U.jsx(pde,{code:o,title:c,onClose:()=>u(null)})]})},gde=()=>U.jsx(q3,{children:U.jsx(She,{children:U.jsx("div",{className:"w-screen h-screen flex bg-zinc-950 text-zinc-200 overflow-hidden text-[11px] font-sans",children:U.jsx(mde,{})})})}),oC=document.getElementById("root");oC&&LP.createRoot(oC).render(U.jsx(gde,{}));
